using System;
using System.Collections.Generic;
using System.Runtime.InteropServices;
using System.Collections;
using System.IO.Ports;
using System.ComponentModel;
using System.Data;
using System.Threading;
using System.Drawing;
using System.Drawing.Printing;
using System.Text;
using System.Windows.Forms;
using MyLib;
using System.IO;
using System.Net;
using System.Net.Sockets;
using System.Xml.Serialization;
using Crom.Controls.Docking;
using System.Xml;
using System.Globalization;
using SMLReport;
using System.Media;
using System.Text.RegularExpressions;
using System.Diagnostics;

namespace SMLPosClient
{
    // ต้องเลือกจอมาแล้ว

    public partial class _posClientForm : UserControl
    {
        #region Privete Member

        [DllImport("user32.dll", EntryPoint = "SetForegroundWindow")]
        static extern bool SetForegroundWindow(int hWnd);
        //
        /// <summary>เก็บ e-journal</summary>
        int _pos_eJournal = 0;
        int _posConfigNumber = 0;
        int _posConfigPriceNumber = 1;
        int _posConfigSlipNumber = 0;

        string _price_type_column = "price_type";
        //
        string _dateFormat = "yyyy-MM-dd";
        string _fontHeaderName = "Tahoma";
        float _fontHeaderSize = 12;
        string _fontDetailName = "Tahoma";
        float _fontDetailSize = 12;
        string _fontFooterName = "Tahoma";
        float _fontFooterSize = 10;

        /// <summary>Format ราคา ทดนิยม 2 ตำแนห่ง</summary>
        string _formatNumber1 = "#,0.00";
        /// <summary>format จำนวน ไม่มีจุดทดนิยม</summary>
        string _formatNumber2 = "#,0";
        string _savePosScreenConfigFileName = "smlPOSScreenConfig";

        /// <summary>เลขที่ใบกำกับภาษีแบบย่อ</summary>
        string _posDocFormat = "";
        /// <summary>เลขที่เอกสารเติมเงิน</summary>
        string _posFillmoneyDocFormat = "";
        /// <summary>เลขที่เอกสารยกเลิกบิล</summary>
        string _posCancelDocFormat = "";
        /// <summary>เลขที่เอกสารแบบเต็ม</summary>
        string _posFullDocFormat = "";
        /// <summary>เลขที่เอกสารส่งเงิน</summary>
        string _posSaveSendMoneyDocFormat = "";
        /// <summary>
        /// รหัสเอกสาร POS
        /// </summary>
        string _pos_doc_format_code = "";

        // toe กำหนดเลขทีเอกสารเริ่มต้น
        /// <summary>เลขที่เอกสารใบกำกับภาษีแบบย่อเริ่มต้น</summary>
        string _posRunningDocFormat = "";
        /// <summary>เลขที่เอกสารเติมเงินเริ่มต้น</summary>
        string _posRunningFillmoneyDocFormat = "";
        /// <summary>เลขที่เอกสารยกเลิกบิลเริ่มต้น</summary>
        string _posRunningCancelDocFormat = "";
        /// <summary>เลขที่เอกสารแบบเต็มเริ่มต้น</summary>
        string _posRunningFullDocFormat = "";
        /// <summary>เลขที่เอกสารส่งเงินเริ่มต้น</summary>
        string _posRunningSaveSendMoneyDocFormat = "";

        /// <summary>
        /// รูปแบบเอกสารขายเชื่อ
        /// </summary>
        string _creditDocFormat = "";
        /// <summary>
        /// เลขที่เอกสารขายเชื่อเริ่มต้น
        /// </summary>
        string _creditRunningFormat = "";
        /// <summary>
        /// ประเภทเอกสารขายเชื่อ
        /// </summary>
        string _doc_format_code_credit = "";
        /// <summary>
        /// รหัสเอกสารยกเลิก
        /// </summary>
        string _doc_format_code_calcel = "";

        /// <summary>คลังที่ต้องการตัดสต๊อก</summary>
        string _posWareHouse = "";
        /// <summary>ที่เก็บที่ต้องการตัดสต๊อก</summary>
        string _posLocation = "";
        /// <summary>ฟอร์ม POS ที่เปิดไว้ทุกจอ</summary>
        private List<Form> _posMoniter = new List<Form>();
        /// <summary>จอทั้งหมดที่เชื่อมต่อกับคอม</summary>
        private Screen[] _posScreen;
        /// <summary>ข้อมูลการกำหนด จอ POS</summary>
        //private SMLPOSControl._posScreenConfig _posScreenConfig = null;

        /// <summary>รหัส POS design ที่จะโหลดขึ้นมาทำงาน</summary>
        public string _posScreenCode = "";
        /// <summary>Design XML</summary>
        private SMLPOSControl._designer._posDesignXML _designXML;
        /// <summary>รหัสสมาชิก</summary>
        private string _memberCode = "";
        /// <summary>รหัสลูกหนี้</summary>
        private string _custCode = "";
        /// <summary>ชื่อลูกหนี้</summary>
        private string _custName = "";
        /// <summary>รหัสพนักงานขาย</summary>
        private string _saleCode = "";
        /// <summary>ชื่อพนักงานขาย</summary>
        private string _saleName = "";
        /// <summary>Barcode สุดท้ายที่ป้อนเข้าระบบ</summary>
        private string _lastBarcode = "";
        /// <summary>ItemCode สุดท้ายที่ป้อนเข้าระบบ</summary>
        private string _lastItemCode = "";
        /// <summary>จอค้นหา</summary>
        private MyLib._searchDataFull _searchItem;
        /// <summary>แยกจอค้นหาสินค้าออกมาเพื่อความเร็ว</summary>
        private MyLib._searchDataFull _searchIC;
        /// <summary>หน้าจอค้นหา Serial</summary>
        private MyLib._searchDataFull _searchSerial;
        /// <summary>เป็นพนักงานหรือไม่</summary>
        private Boolean _isStaff = false;
        /// <summary>Option สำหรับเลือกประมวลผล Promotion หรือไม่</summary>
        public Boolean _isProcessPromotion = true;
        /// <summary>ซื้อล่าสุดเมื่อ</summary>
        private string _lastBuy = "";
        /// <summary>จอเงินทอน</summary>
        _posFinishForm _finishForm = null;
        /// <summary>ห้ามขายสินค้าติดลบ</summary>
        private Boolean _balance_control = false;
        /// <summary>แสดงรูปภาพจากบาร์โค้ด</summary>
        private Boolean _show_barcode_picture = false;
        /// <summary>ไม่พิมพ์รายการสูตรลงในใบเสร็จ</summary>
        private Boolean _print_item_set_detail = false;
        /// <summary>ถามรหัสผ่านทุกครั้งที่เปิดลิ้นชัก</summary>
        private Boolean _cashdrawer_open_password = false;
        /// <summary>เช็คสิทธิ์แสดงยอดขาย POS (ค่าเริ่มต้น)</summary>
        private Boolean _pos_show_total_balance = false;
        /// <summary>ปิดระบบตรวจสอบยอดค้างส่งเงิน</summary>
        private Boolean _pos__disabled_check_send_money = false;
        /// <summary>ใช้ระบบส่งเงินมัดจำ</summary>
        private Boolean _pos_send_deposit_money = false;
        /// <summary>ห้ามยกเลิกบิลหลังปิดกะ</summary>
        private Boolean _disable_cancel_order_outshift = false;
        /// <summary>เลือกลูกค้าทุกครั้งก่อนขาย</summary>
        private Boolean _warning_select_cust = false;
        /// <summary>
        /// ขายสินค้าชุด
        /// </summary>
        private Boolean _use_item_set = false;
        /// <summary>
        /// ตรวจสอบลิ้นชัำ
        /// </summary>
        private Boolean _check_cash_drawer = false;

        /// <summary>
        /// อนุญาติให้ขายเงินเชื่อ
        /// </summary>
        private Boolean _use_credit_sale = false;

        /// <summary>
        /// แสดงรายละเอียดการสั่งอาหาร
        /// </summary>
        private Boolean _show_order_detail = false;

        private Boolean _show_order_detail_copy_Only = false;

        private Boolean _usePointBirthDay = false;
        private decimal _pointMultiplyBirthDay = 0M;

        private Boolean _usePointMonthBirth = false;
        private decimal _pointMultiplyMonthBirth = 0M;

        private decimal _pointSpecialDayMultiply = 0M;

        private Boolean _isBirthDayMember = false;
        private Boolean _isBirthMonthMember = false;

        SMLERPControl._icBalanceForm _balanceForm = null;
        SMLERPControl._getPicture _getPictureControl = null;

        /// <summary>ฟอร์มค้นหาตาม level</summary>
        _itemSearchLevelForm _searchLevelForm = null;
        /// <summary>focus อยู่ตำแหน่งพร้อมรับคำสั่งหรือไม่</summary>
        bool _inputFocus = false;
        /// <summary>จอชำระเงิน</summary>
        private Form _posPayForm;

        /// <summary>รายการสินค้า</summary>
        private List<_posClientItemClass> _itemList = new List<_posClientItemClass>();
        /// <summary>รายการสินค้าที่ Process แล้ว</summary>
        private List<_posClientItemClass> _itemProcess;

        private DataTable _promotionFormula;
        private DataTable _promotionFormulaCondition;
        private DataTable _promotionFormulaPriceAndDiscount;
        private DataTable _promotionFormulaAction;
        private DataTable _promotionFormulaGroup;

        // posConfig
        /// <summary>รหัสลูกค้าเริ่มต้น</summary>
        string _posDefaultCust = "";
        /// <summary>รหัสผู้ใช้งาน POS</summary>
        string _posLoginCode = "";
        /// <summary>รหัสผ่านผู้ใช้งาน POS</summary>
        string _posLoginPassword = "";
        /// <summary>ชื่อผู้ใช้งาน POS</summary>
        string _posLoginName = "";
        /// <summary>ข้อความหัวใบเสร็จ</summary>
        string _posHeader = "";
        /// <summary>ชนิดใบเสร็จ</summary>
        string _posBillType = "";

        /// <summary>ชนิดใบเสร็จ(ขายเงินเชื่อ)</summary>
        string _creditSaleBillType = "";

        /// <summary>ข้อความส่วนท้ายบิล</summary>
        string _posFooter = "";
        /// <summary>สามารถแก้ไขส่วนลด</summary>
        bool _posChangeDiscount = false;
        /// <summary>สามารถแก้ไขราคา</summary>
        bool _posChangePrice = false;
        /// <summary>อนุญาติยกเลิกบิล</summary>
        bool _posCancelBill = false;
        /// <summary>ยกเลิกบิลข้ามวัน</summary>
        bool _posCancelBillOtherDate = true;
        /// <summary>แสดงคำอธิบายสัญลักษณ์ ( V=Vat E=Except Vat)</summary>
        bool _showShortDescription = true;
        /// <summary>แสดงรายละเอียดภาษี</summary>
        bool _showTaxDetail = true;
        /// <summary>เป็นจอเภสัชหรือไม่</summary>
        public bool _isPharmacist = false;
        /// <summary>เตือนเปิดกะ</summary>
        bool _warning_peroid_open = false;
        /// <summary>ปิดช่องส่วนลดท้ายบิล</summary>
        bool _close_discount_bill = false;
        /// <summary>POS Config</summary>
        SMLPOSControl._posScreenConfig _posConfig = new SMLPOSControl._posScreenConfig();
        /// <summary>ยอดรวมทั้งสิ้น</summary>
        decimal _totalAmount = 0M;
        /// <summary>ยอดรวมสินค้ามีภาษี</summary>
        decimal _totalAmountVat = 0M;
        /// <summary>ยอดรวมสินค้ายกเว้นภาษี</summary>
        decimal _totalAmountExceptVat = 0M;
        /// <summary>รวมส่วนลดพิเศษ</summary>
        decimal _totalExtraDiscountAmount = 0M;
        /// <summary>ยอดรวมอาหาร</summary>
        decimal _totalFoodAmount = 0M;
        /// <summary>ยอดรวมเครื่องดื่ม</summary>
        decimal _totalDrinkAmount = 0M;
        /// <summary>ยอดโปรโมชั่น</summary>
        decimal _totalPromotionAmount = 0M;
        /// <summary>ยอดปัดเศษ</summary>
        decimal _diffAmount = 0M;
        /// <summary>ยอดรวมสุทธิ</summary>
        decimal _finalBalance = 0M;
        // ส่วนลด
        /// <summary>ส่วนลดท้ายบิล</summary>
        public string _discountWord = "";
        /// <summary>มูลค่าส่วนลดท้ายบิล</summary>
        decimal _discountAmount = 0M;
        /// <summary>ยอดรวมทั้งสิ้น (สำหรับเอาไปคำณวนส่วนลด)</summary>
        decimal _totalAmoutForCalcDiscount = 0M;
        /// <summary>ภาษีมูลค่าเพิ่ม (กรณีแยกนอก)</summary>
        decimal _vatExcludeAmount = 0M;

        DateTime __openPeroidDate = DateTime.Now;


        /// <summary>มูลค่าส่วนลดอาหาร</summary>
        public string _foodDiscountWord = "";
        /// <summary>ส่วนลดอาหาร</summary>
        decimal _foodDiscountAmount = 0M;

        /// <summary>มูลค่า Service Charge</summary>
        public string _serviceChargeWord = "";

        decimal _serviceChargeAmount = 0M;

        /// <summary>จำนวนเงินสูงสุดในเครื่อง POS</summary>
        decimal _maxPosMoney = 0M;

        ///<summary>เก็บ config ฉลากยา</summary>
        _labelConfigClass _labelConfig = null;
        /// <summary>พักบิล</summary>
        private List<_holdBillClass> _holdBill = new List<_holdBillClass>();

        private DataTable _pointConditionTable = null;
        private DataTable _pointPeriodTable = null;
        private Boolean _pointBirthDay = false;
        private decimal _pintBirthDayMultiple = 0M;
        private Boolean _pointBirthMonth = false;
        private decimal _pointBirthMonthMultiple = 0M;
        private decimal _pointDivAmount = 0M;
        /// <summary>
        /// ยอดแต้มยกมา
        /// </summary>
        private decimal _pointBalance = 0M;
        /// <summary>
        /// ยอดแต้มที่คำนวณได้
        /// </summary>
        private decimal _pointSum = 0M;
        /// <summary>
        /// ใช้ระบบพิมพ์ใบเสร็จหลายภาษา
        /// </summary>
        private Boolean _print_multilanguage_slip = false;
        /// <summary>
        /// ไม่แสดงข้อความท้ายใบสงเงิน
        /// </summary>
        private Boolean _no_remark_sendmoney = false;

        /// <summary>label เวลา</summary>
        private List<control._posLabelShadow> __dateTimeLabel = new List<control._posLabelShadow>();
        /// <summary>
        /// หมายเลข SMS
        /// </summary>
        private string _sms_phoenumber = "";
        /// <summary>
        /// ตรวจสอบการรับเงินทอน
        /// </summary>
        private Boolean _checkFloatMoney = false;

        /// <summary>
        /// ชนิดใบกำกับที่พิมพ์
        /// </summary>
        private int _pos_type_invoice = 0;

        private string _department_code = "";
        public string _configFileName
        {
            get
            {
                //string __configFileName = _savePosScreenConfigFileName + MyLib._myGlobal._databaseName + ".xml";
                //string __path = Path.GetTempPath() + "\\" + __configFileName.ToLower();
                string __localpath = string.Format(@"c:\\smlsoft\\{3}-{0}-{1}-{2}.xml", MyLib._myGlobal._encapeStringForFilePath(MyLib._myGlobal._getFirstWebServiceServer), MyLib._myGlobal._providerCode, MyLib._myGlobal._databaseName, _savePosScreenConfigFileName);
                return __localpath;
            }
        }

        public string _configOldPath
        {
            get
            {
                string __configFileName = _savePosScreenConfigFileName + MyLib._myGlobal._databaseName + ".xml";
                string __path = Path.GetTempPath() + "\\" + __configFileName.ToLower();
                return __path;
            }
        }

        private bool _check_delete_item = false;

        private string _lastApproveCode = "";

        public bool _point_member_only = false;
        public bool _check_member_expire = false;

        #endregion

        #region TomYumgoong Variable

        private SMLPOSControl._tableSearchLevelMenuControl _table = null;
        private string _tableNumberSelect = "";
        private string _tableNameSelect = "";
        private string _trans_guid = "";

        /// <summary>เป็นการ insert รายการสินค้าแบบ auto หรือไม่</summary>
        private bool _autoInsertItem = false;
        /// <summary>เป็นจอปิดโต๊ะ หรือไม่</summary>
        bool _isScreenCloseTable = false;

        /// <summary>รายละเอียดการตั้งค่าเครื่องสั่งอาหาร</summary>
        SMLPOSControl._orderDeviceXMLConfig _orderDeviceConfig = null;

        /// <summary>เป็นการคิดเงินจากโต๊ะหรือไม่้</summary>
        bool _isTableCheckOut = false;
        /// <summary>ลำดับแบบฟอร์มปิดโต๊ะ</summary>
        int _closeTableSlipNumber = 0;
        /// <summary>เวลาเปิดโต๊ะ</summary>
        string _openTableTime = "";
        /// <summary>เวลาปิดโต๊ะ</summary>
        string _closeTableTime = "";
        /// <summary>เก็บเลขที่ Order</summary>
        List<string> _orderList = new List<string>();
        /// <summary>
        /// GUID กะ
        /// </summary>
        private string _periodGuid = "";


        public Boolean _lock_edit_order = false;

        public string _change_currency_code = "";
        public decimal _exchangeRate = 1;

        #endregion

        #region Print Label Font And Config

        string _labelBarCodeFontName = "Tahoma";
        float _labelBarCodeFotnSize = 9;
        string _labelHeaderFontName = "Tahoma";
        float _labelHeaderFotnSize = 9;
        string _labelDetailFontName = "Tahoma";
        float _labelDetailFotnSize = 9;
        string _labelPrinterName = "";
        Boolean _useBarcodeFont = false;

        #endregion

        public bool _print_sale_daily_item = false;
        public event afterClosePosClientForm _afterCloseForm;

        /// <summary>จอเสริม</summary>
        List<_posExtendForm> _extendFormList = new List<_posExtendForm>();

        private bool _show_item_location_only = false;
        #region POS Construct

        /// <summary>
        /// Construct สำหรับ จอหลังปิดโต๊ะ
        /// </summary>
        /// <param name="userCode"></param>
        public _posClientForm(string userCode)
        {
            InitializeComponent();
            this._posLoginCode = userCode;
            _isScreenCloseTable = true;
            //this._build();
            this._loadLabelConfig();
            _setPrePayScreen();
            _setXMLDesign();
            _TimerDate.Start();
            this._newData();
            this.Disposed += _posClientForm_Disposed;
        }

        /// <summary>
        /// Constructor สำหรับ จอแยก
        /// </summary>
        /// <param name="userCode"></param>
        /// <param name="userPassword"></param>
        /// <param name="__formXmlName"></param>
        public _posClientForm(string userCode, string userPassword, string __formXmlName)
        {
            InitializeComponent();
            this._posLoginCode = userCode;
            this._posLoginPassword = userPassword;
            _posScreenCode = __formXmlName;
            this._build();
            this._loadLabelConfig();
            _TimerDate.Start();
        }

        void _loadLabelConfig()
        {
            if (this._isPharmacist || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLPOSMED)
            {
                // load label config
                string __labelConfigFileName = string.Format(MyLib._myGlobal._smlConfigFile + "{2}-{0}-{1}-LabelConfig.xml", MyLib._myGlobal._encapeStringForFilePath(MyLib._myGlobal._getFirstWebServiceServer), MyLib._myGlobal._providerCode, MyLib._myGlobal._databaseName).ToLower();

                if (System.IO.File.Exists(__labelConfigFileName))
                {
                    try
                    {
                        TextReader readFile = new StreamReader(__labelConfigFileName);
                        XmlSerializer __xsLoad = new XmlSerializer(typeof(_labelConfigClass));
                        _labelConfig = (_labelConfigClass)__xsLoad.Deserialize(readFile);
                        readFile.Close();
                    }
                    catch (Exception ex)
                    {
                        MessageBox.Show(ex.ToString(), "Error");
                    }

                    try
                    {
                        if (_labelConfig._barcodeFontName.Trim().Length > 0)
                        {
                            this._labelBarCodeFontName = _labelConfig._barcodeFontName;
                            this._labelBarCodeFotnSize = _labelConfig._barcodeFontSize;
                        }
                        if (_labelConfig._headerFontName.Trim().Length > 0)
                        {
                            this._labelHeaderFontName = _labelConfig._headerFontName;
                            this._labelHeaderFotnSize = _labelConfig._headerFontSize;
                        }
                        if (_labelConfig._detailFontName.Trim().Length > 0)
                        {
                            this._labelDetailFontName = _labelConfig._detailFontName;
                            this._labelDetailFotnSize = _labelConfig._detailFontSize;
                        }

                        this._labelPrinterName = _labelConfig._printerName;
                        this._useBarcodeFont = _labelConfig._useBarcodeFont;
                    }
                    catch
                    {
                    }
                }
            }
        }

        /// <summary>
        /// Constructor สำหรับ จอจ่ายยา
        /// </summary>
        /// <param name="__formXmlName"></param>
        /// <param name="__isPharmacist"></param>
        /// <param name="userCode"></param>
        /// <param name="userPassword"></param>
        public _posClientForm(string __formXmlName, Boolean __isPharmacist, string userCode, string userPassword)
        {
            InitializeComponent();
            this._posLoginCode = userCode;
            this._posLoginPassword = userPassword;
            _posScreenCode = __formXmlName;
            this._isPharmacist = __isPharmacist;
            this._build();

            _loadLabelConfig();
            _TimerDate.Start();
        }

        /// <summary>
        /// Counstructor หลัก ที่ผ่านการ Login
        /// </summary>
        /// <param name="userCode"></param>
        /// <param name="userPassword"></param>
        public _posClientForm(string userCode, string userPassword)
        {
            InitializeComponent();
            this._posLoginCode = userCode;
            this._posLoginPassword = userPassword;

            this.Load += new EventHandler(_posClientForm_Load);
            this._loadLabelConfig();
            this.Disposed += _posClientForm_Disposed;
            /*
                        this.Load += new EventHandler(_posClientForm_Load);
                        this._menuFlowLayoutPanel.Visible = false;
                        this._cancelBillControl.Visible = false;
                        this.vistaButton13.Click += new EventHandler(vistaButton13_Click);
                        this.vistaButton4.Click += new EventHandler(vistaButton4_Click);
                         * */
        }

        private void _posClientForm_Disposed(object sender, EventArgs e)
        {
            if (this._customerDisplayPort != null)
            {
                if (this._customerDisplayPort.IsOpen)
                {
                    this._customerDisplayPort.Close();
                    this._customerDisplayPort.Dispose();
                }
            }
        }

        /*
        protected override void OnClosing(CancelEventArgs e)
        {
            if(this._customerDisplayPort != null)
            {
                if (this._customerDisplayPort.IsOpen)
                {
                    this._customerDisplayPort.Close();
                    this._customerDisplayPort.Dispose();
                }
            }
            base.OnClosing(e);
        }*/


        void _posClientForm_Load(object sender, EventArgs e)
        {
            Screen __scrn = Screen.FromControl(this);
            if (__scrn.Primary == true)
            {
                _loadXMLScreenConfig();
                _loadScreen();
            }
            else
            {
                // load config งง ว่าทำไมโหลดซ้ำ

                try
                {
                    // ลองอ่านที่ใหม่

                    TextReader readFile = new StreamReader(_configFileName);
                    XmlSerializer __xsLoad = new XmlSerializer(typeof(SMLPOSControl._posScreenConfig));
                    this._posConfig = (SMLPOSControl._posScreenConfig)__xsLoad.Deserialize(readFile);
                    readFile.Close();
                    //
                }
                catch
                {
                    // ไม่ได้ให้ไปอ่านที่เก่า
                    try
                    {
                        TextReader readFile = new StreamReader(_configOldPath);
                        XmlSerializer __xsLoad = new XmlSerializer(typeof(SMLPOSControl._posScreenConfig));
                        this._posConfig = (SMLPOSControl._posScreenConfig)__xsLoad.Deserialize(readFile);
                        readFile.Close();
                        //
                    }
                    catch
                    {
                    }
                }

            }

            try
            {
                if (this._posConfig._pos_slip_header_fontname.Trim().Length > 0)
                {
                    this._fontHeaderName = this._posConfig._pos_slip_header_fontname;
                    this._fontHeaderSize = this._posConfig._pos_slip_header_fontsize;
                }
                if (this._posConfig._pos_slip_detail_fontname.Trim().Length > 0)
                {
                    this._fontDetailName = this._posConfig._pos_slip_detail_fontname;
                    this._fontDetailSize = this._posConfig._pos_slip_detail_fontsize;
                }
                if (this._posConfig._pos_slip_footer_fontname.Trim().Length > 0)
                {
                    this._fontFooterName = this._posConfig._pos_slip_footer_fontname;
                    this._fontFooterSize = this._posConfig._pos_slip_footer_fontsize;
                }
            }
            catch
            {
            }
            //
            this._loadMaster();
            //
            this._newData();
            _TimerDate.Start();

            if (this._posConfig._android_customer_display)
            {
                _androidCustomerScreen._setConfig(this._posConfig);
            }
        }

        #endregion

        #region Print Slip

        #region พิมพ์ สรุปยอดขาย
        /// <summary>พิมพ์รายการสรุปยอดขาย</summary>
        void _printSummarySaleDaily(string saleDate)
        {
            // query data
            string __fieldCancel = "cancel_amount";
            string __fieldCashAmount = "cash_amount";
            string __fieldCreditCardAmount = "credit_card_amount";
            string __fieldCouponAmount = "coupon_amount";
            string __fieldDiffAmount = "diff_amount";

            string __fieldInvoiceCount = "invoice_count";
            // process query 
            MyLib._myFrameWork __myFrameWork = new MyLib._myFrameWork();
            StringBuilder __query = new StringBuilder(MyLib._myGlobal._xmlHeader);
            __query.Append("<node>");

            // 1.สรุปยอดขาย รายได้ ส่วนลด รับเงินสด บัตรเครดิต คูปอง มูลค่าภาษี มูลค่ายกเว้นภาษี่
            __query.Append(MyLib._myUtil._convertTextToXmlForQuery("select " +
                    " count(" + _g.d.ic_trans._doc_no + " ) as " + __fieldInvoiceCount +
                    " , sum(" + _g.d.ic_trans._total_value + ") as " + _g.d.ic_trans._total_value +
                    " , sum(" + _g.d.ic_trans._total_amount + ") as " + _g.d.ic_trans._total_amount +
                    " , sum(" + _g.d.ic_trans._total_discount + ") as " + _g.d.ic_trans._total_discount +
                    " , (sum(" + _g.d.ic_trans._total_amount + ") - sum(" + _g.d.ic_trans._total_discount + ")) as " + _g.d.ic_trans._total_after_discount +
                    " , sum(" + _g.d.ic_trans._total_before_vat + ") as " + _g.d.ic_trans._total_before_vat +
                    " , sum(" + _g.d.ic_trans._total_vat_value + ") as " + _g.d.ic_trans._total_vat_value +
                    " , sum(" + _g.d.ic_trans._total_except_vat + ") as " + _g.d.ic_trans._total_except_vat +
                    " , sum(" + __fieldCancel + ") as " + __fieldCancel +
                    " , sum(" + __fieldCashAmount + ") as " + __fieldCashAmount +
                    " , sum(" + __fieldCreditCardAmount + ") as " + __fieldCreditCardAmount +
                    " , sum(" + __fieldCouponAmount + ") as " + __fieldCouponAmount +
                    " , sum(" + __fieldDiffAmount + ") as " + __fieldDiffAmount +
                " from ( " +
                " select  " + _g.d.ic_trans._doc_no +
                " , " + _g.d.ic_trans._pos_id +
                    " , ( case when " + _g.d.ic_trans._last_status + "=1 then 0 else " + _g.d.ic_trans._total_value + " end ) as " + _g.d.ic_trans._total_value +
                    " , ( case when " + _g.d.ic_trans._last_status + "=1 then 0 else " + _g.d.ic_trans._total_amount + " end) as " + _g.d.ic_trans._total_amount +
                    " , ( case when " + _g.d.ic_trans._last_status + "=1 then 0 else " + _g.d.ic_trans._total_discount + " end ) as " + _g.d.ic_trans._total_discount +
                    " , ( case when " + _g.d.ic_trans._last_status + "=1 then 0 else " + _g.d.ic_trans._total_vat_value + " end ) as " + _g.d.ic_trans._total_vat_value +
                    " , ( case when " + _g.d.ic_trans._last_status + "=1 then 0 else " + _g.d.ic_trans._total_before_vat + " end ) as " + _g.d.ic_trans._total_before_vat +
                    " , ( case when " + _g.d.ic_trans._last_status + "=1 then 0 else " + _g.d.ic_trans._total_except_vat + " end ) as " + _g.d.ic_trans._total_except_vat +
                    " , ( case when " + _g.d.ic_trans._last_status + "=1 then " + _g.d.ic_trans._total_amount + " else 0 end ) as " + __fieldCancel +
                    " , ( case when " + _g.d.ic_trans._last_status + "=1 then 0 else (select sum(" + _g.d.cb_trans._cash_amount + ") from " + _g.d.cb_trans._table + " where " + _g.d.cb_trans._table + "." + _g.d.cb_trans._doc_no + "=" + _g.d.ic_trans._table + "." + _g.d.ic_trans._doc_no + ") end ) as " + _g.d.cb_trans._cash_amount +
                    " , ( case when " + _g.d.ic_trans._last_status + "=1 then 0 else (select sum(" + _g.d.cb_trans._card_amount + ") from " + _g.d.cb_trans._table + " where " + _g.d.cb_trans._table + "." + _g.d.cb_trans._doc_no + "=" + _g.d.ic_trans._table + "." + _g.d.ic_trans._doc_no + ") end ) as " + __fieldCreditCardAmount +
                    " , ( case when " + _g.d.ic_trans._last_status + "=1 then 0 else (select sum(" + _g.d.cb_trans._coupon_amount + ") from " + _g.d.cb_trans._table + " where " + _g.d.cb_trans._table + "." + _g.d.cb_trans._doc_no + "=" + _g.d.ic_trans._table + "." + _g.d.ic_trans._doc_no + ") end ) as " + _g.d.cb_trans._coupon_amount +
                    " , ( case when " + _g.d.ic_trans._last_status + "=1 then 0 else (select sum(" + _g.d.cb_trans._total_income_amount + ") from " + _g.d.cb_trans._table + " where " + _g.d.cb_trans._table + "." + _g.d.cb_trans._doc_no + "=" + _g.d.ic_trans._table + "." + _g.d.ic_trans._doc_no + ") end ) as " + __fieldDiffAmount +
                " from " + _g.d.ic_trans._table +
                " where " + _g.d.ic_trans._trans_flag + "=44 " +
                " and " + _g.d.ic_trans._is_pos + "=1 " +
                " and " + _g.d.ic_trans._pos_id + "='" + this._posConfig._posid + "' " +
                " and " + _g.d.ic_trans._doc_date + "=" + saleDate +
                " and coalesce(" + _g.d.ic_trans._doc_ref + ", \'\') = \'\' " +
                " ) as table1"));
            // 2.รับเงินทอน
            string __fillMoneyQuery = "select sum(" + _g.d.POSCashierSettle._CashAmount + ") as " + _g.d.POSCashierSettle._CashAmount + " from " + _g.d.POSCashierSettle._table + " where " + _g.d.POSCashierSettle._MACHINECODE + "=\'" + this._posConfig._posid + "\' and " + _g.d.POSCashierSettle._DocDate + " = " + saleDate + " and " + _g.d.POSCashierSettle._trans_type + "=1";
            __query.Append(MyLib._myUtil._convertTextToXmlForQuery(__fillMoneyQuery));
            // 3.ส่งเงินสด บัตรเครดิต คูปอง
            string __sendMoneyQuery = "select  " + _g.d.POSCashierSettle._doc_time + ", " + _g.d.POSCashierSettle._CashAmount + "," + _g.d.POSCashierSettle._CreditCardAmount + "," + _g.d.POSCashierSettle._CoupongAmount + " from " + _g.d.POSCashierSettle._table + " where " + _g.d.POSCashierSettle._MACHINECODE + "=\'" + this._posConfig._posid + "\' and " + _g.d.POSCashierSettle._DocDate + " = " + saleDate + "  and " + _g.d.POSCashierSettle._trans_type + "=2";
            __query.Append(MyLib._myUtil._convertTextToXmlForQuery(__sendMoneyQuery));
            // 4.ส่งเงินสด บัตรเครดิต คูปอง
            string __summarySendMondyQuery = "select sum(" + _g.d.POSCashierSettle._CashAmount + ") as " + _g.d.POSCashierSettle._CashAmount + ",sum(" + _g.d.POSCashierSettle._CreditCardAmount + ") as " + _g.d.POSCashierSettle._CreditCardAmount + ",sum(" + _g.d.POSCashierSettle._CoupongAmount + ") as " + _g.d.POSCashierSettle._CoupongAmount + " from " + _g.d.POSCashierSettle._table + " where " + _g.d.POSCashierSettle._MACHINECODE + "=\'" + this._posConfig._posid + "\' and " + _g.d.POSCashierSettle._DocDate + " = " + saleDate + "  and " + _g.d.POSCashierSettle._trans_type + "=2";
            __query.Append(MyLib._myUtil._convertTextToXmlForQuery(__summarySendMondyQuery));

            // 5 รายละเอียดบิลขาย
            string __queryTrans = "select " +
                "(select " + _g.d.POS_ID._POS_ID + " from " + _g.d.POS_ID._table + " where " + _g.d.POS_ID._MACHINECODE + "=\'" + this._posConfig._posid + "\') as " + _g.d.POS_ID._POS_ID + "," +
                " coalesce((select count(" + _g.d.ic_trans._doc_no + ")  from " + _g.d.ic_trans._table + " where " + _g.d.ic_trans._trans_flag + "=44 and " + _g.d.ic_trans._is_pos + "=1 and " + _g.d.ic_trans._pos_id + "=\'" + this._posConfig._posid + "\' and doc_date = " + saleDate + " and coalesce(" + _g.d.ic_trans._doc_ref + ", '') = \'\' ), 0) as invoice_count," +
                " coalesce((select sum(" + _g.d.ic_trans._total_discount + ")  from " + _g.d.ic_trans._table + " where " + _g.d.ic_trans._trans_flag + "=44 and " + _g.d.ic_trans._is_pos + "=1 and " + _g.d.ic_trans._pos_id + "=\'" + this._posConfig._posid + "\' and doc_date = " + saleDate + " and coalesce(" + _g.d.ic_trans._doc_ref + ", '') = \'\' ), 0) as total_discount," +
                " coalesce((select " + _g.d.ic_trans._doc_no + " from " + _g.d.ic_trans._table + " where " + _g.d.ic_trans._trans_flag + "=44 and " + _g.d.ic_trans._is_pos + "=1 and " + _g.d.ic_trans._pos_id + "=\'" + this._posConfig._posid + "\' and doc_date = " + saleDate + " and coalesce(" + _g.d.ic_trans._doc_ref + ", '') = \'\' order by " + _g.d.ic_trans._doc_no + " limit 1), '') as begin_invoice," +
                " coalesce((select " + _g.d.ic_trans._doc_no + " from " + _g.d.ic_trans._table + " where " + _g.d.ic_trans._trans_flag + "=44 and " + _g.d.ic_trans._is_pos + "=1 and " + _g.d.ic_trans._pos_id + "=\'" + this._posConfig._posid + "\' and doc_date = " + saleDate + " and coalesce(" + _g.d.ic_trans._doc_ref + ", '') = \'\' order by " + _g.d.ic_trans._doc_no + " desc limit 1), '') as end_invoice," +
                " coalesce((select " + _g.d.ic_trans._doc_no + " from " + _g.d.ic_trans._table + " where " + _g.d.ic_trans._trans_flag + "=45 and " + _g.d.ic_trans._is_pos + "=1 and " + _g.d.ic_trans._pos_id + "=\'" + this._posConfig._posid + "\' and doc_date = " + saleDate + " order by " + _g.d.ic_trans._doc_no + " limit 1), '') as _begin_cn," +
                " coalesce((select " + _g.d.ic_trans._doc_no + " from " + _g.d.ic_trans._table + " where " + _g.d.ic_trans._trans_flag + "=45 and " + _g.d.ic_trans._is_pos + "=1 and " + _g.d.ic_trans._pos_id + "=\'" + this._posConfig._posid + "\' and doc_date = " + saleDate + " order by " + _g.d.ic_trans._doc_no + " desc limit 1), '') as _end_cn";
            __query.Append(MyLib._myUtil._convertTextToXmlForQuery(__queryTrans));

            __query.Append("</node>");

            string __debug_query = __query.ToString();

            ArrayList _getData = __myFrameWork._queryListGetData(MyLib._myGlobal._databaseName, __query.ToString());

            // draw print
            try
            {
                switch (this._posConfig._print_method)
                {
                    case 0:
                        // Driver Printer
                        {
                            //MyLib._myGlobal._writeLogFile(@"C:\smlsoft\poslog.txt", DateTime.Now.ToString() + " : Start Print By Driver", false);

                            try
                            {
                                PrintDocument __pd = new PrintDocument();
                                __pd.PrinterSettings.PrinterName = this._posConfig._pos_printer_name;
                                __pd.PrintController = new StandardPrintController();
                                __pd.PrintPage += (s1, e1) =>
                                {
                                    // แบบเดิม
                                    this._drawSummarySaleDaily(e1.Graphics, _getData, saleDate);
                                };
                                __pd.Print();
                            }
                            catch (Exception __ex)
                            {
                                MessageBox.Show(__ex.Message);
                            }
                        }
                        break;
                    case 1:
                        // Raw Print
                        {
                            try
                            {
                                MyLib._printRaw __pd = new _printRaw((float)this._posConfig._pos_slip_width);
                                __pd._height = this._drawSummarySaleDaily(__pd._g, _getData, saleDate);
                                // eJournal
                                //
                                __pd._print(this._posConfig._pos_printer_name);
                                __pd._print(this._posConfig._pos_printer_name, new byte[] { 29, 86, 66, 10 });
                                __pd._dispose();
                            }
                            catch (Exception __ex)
                            {
                                MessageBox.Show(__ex.Message);
                            }
                        }
                        break;
                    case 2:
                        // Tcp/IP
                        {
                            try
                            {
                                IPEndPoint __ip = new IPEndPoint(IPAddress.Parse(this._posConfig._printerPort), 9100);
                                Socket __socket = new Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);
                                __socket.Connect(__ip);
                                __socket.Send(new byte[] { 27, 64 }); // Initialize printer
                                MyLib._printRaw __pd = new _printRaw((float)this._posConfig._pos_slip_width);
                                __pd._height = this._drawSummarySaleDaily(__pd._g, _getData, saleDate);

                                __socket.Send(__pd._getDataBytes());
                                __socket.Send(new byte[] { 10 });
                                __socket.Send(new byte[] { 29, 86, 66, 10 }); // Cut
                                __socket.Shutdown(SocketShutdown.Both);
                                __socket.Close();
                                __pd._dispose();
                            }
                            catch (Exception __ex)
                            {
                                MessageBox.Show(__ex.Message);
                            }
                        }
                        break;
                }
            }
            catch (Exception __ex)
            {
                MessageBox.Show(__ex.Message.ToString());
            }
        }

        float _drawSummarySaleDaily(Graphics __g, ArrayList _getData, string selectDate)
        {
            string __fieldCancel = "cancel_amount";
            string __fieldCashAmount = "cash_amount";
            string __fieldCreditCardAmount = "credit_card_amount";
            string __fieldCouponAmount = "coupon_amount";

            string __fieldDiffAmount = "diff_amount";


            float __y = 0F;
            float __tmpWidth = 0F;

            DataTable __dt1 = ((DataSet)_getData[0]).Tables[0];
            DataTable __dt2 = ((DataSet)_getData[1]).Tables[0];
            DataTable __dt3 = ((DataSet)_getData[2]).Tables[0];
            DataTable __dt4 = ((DataSet)_getData[3]).Tables[0];
            DataTable __dt5 = ((DataSet)_getData[4]).Tables[0];

            // gentext
            decimal _totalSale = MyLib._myGlobal._decimalPhase(__dt1.Rows[0][_g.d.ic_trans._total_amount].ToString()); // เป็นยอดขายหลังหักส่วนลดแล้ว

            decimal _totalDiscount = MyLib._myGlobal._decimalPhase(__dt1.Rows[0][_g.d.ic_trans._total_discount].ToString()); // จาก ส่วนลดท้ายบิล + ลด byitem
            decimal __totalAfterDiscount = MyLib._myGlobal._decimalPhase(__dt1.Rows[0][_g.d.ic_trans._total_after_discount].ToString()); // จาก ส่วนลดท้ายบิล + ลด byitem

            decimal _totalCancel = MyLib._myGlobal._decimalPhase(__dt1.Rows[0][__fieldCancel].ToString());

            decimal __diffAmount = MyLib._myGlobal._decimalPhase(__dt1.Rows[0][__fieldDiffAmount].ToString());
            decimal _totalCashAmount = MyLib._myGlobal._decimalPhase(__dt1.Rows[0][__fieldCashAmount].ToString()); // เงินเข้า หัก คืน เป็น ยอดเงินสด
            decimal _totalCreditCardAmount = MyLib._myGlobal._decimalPhase(__dt1.Rows[0][__fieldCreditCardAmount].ToString());
            decimal _totalCouponAmount = MyLib._myGlobal._decimalPhase(__dt1.Rows[0][__fieldCouponAmount].ToString());


            decimal _totalSalevalue = _totalSale + _totalDiscount; // ยอดขายยังไม่หักส่วนลด
            decimal _totalAmount = MyLib._myGlobal._decimalPhase(__dt1.Rows[0][_g.d.ic_trans._total_amount].ToString());//  _totalSale - _totalCancel;
            decimal _totalImcome = _totalCashAmount + _totalCreditCardAmount + _totalCouponAmount + __diffAmount;

            decimal _moneyIn = MyLib._myGlobal._decimalPhase(__dt2.Rows[0][_g.d.POSCashierSettle._CashAmount].ToString());
            decimal _moneyOut = MyLib._myGlobal._decimalPhase(__dt4.Rows[0][_g.d.POSCashierSettle._CashAmount].ToString());
            decimal _creditCardOut = MyLib._myGlobal._decimalPhase(__dt4.Rows[0][_g.d.POSCashierSettle._CreditCardAmount].ToString());
            decimal _couponOut = MyLib._myGlobal._decimalPhase(__dt4.Rows[0][_g.d.POSCashierSettle._CoupongAmount].ToString());

            decimal _moneyTotalAmount = (_moneyIn + _totalCashAmount) - _moneyOut;
            decimal _totalOut = _moneyOut + _creditCardOut + _couponOut;

            decimal _totalVatValue = MyLib._myGlobal._decimalPhase(__dt1.Rows[0][_g.d.ic_trans._total_vat_value].ToString());
            decimal _totalExceptVat = MyLib._myGlobal._decimalPhase(__dt1.Rows[0][_g.d.ic_trans._total_except_vat].ToString());
            decimal __total_before_vat = MyLib._myGlobal._decimalPhase(__dt1.Rows[0][_g.d.ic_trans._total_before_vat].ToString());

            string __ltdName = "";
            string __ltdAddress = "";
            string __ltdTel = "";
            string __ltdFax = "";
            string __ltdTax = "";

            if (MyLib._myGlobal._ltdName != null && MyLib._myGlobal._ltdAddress != null)
            {
                __ltdName = MyLib._myGlobal._ltdName;
                __ltdAddress = MyLib._myGlobal._ltdAddress;
                __ltdTel = MyLib._myGlobal._ltdTel;
                __ltdFax = MyLib._myGlobal._ltdFax;
                __ltdTax = MyLib._myGlobal._ltdTax;
            }
            else
            {
                __ltdName = "Company Name";
                __ltdAddress = "Company Address";
            }
            //begin draw

            Boolean __haveLogo = false;

            string __logoFileName = @"c:\smlsoft\logopos.jpg";
            if (File.Exists(__logoFileName))
            {
                __haveLogo = true;
            }



            __g.CompositingQuality = System.Drawing.Drawing2D.CompositingQuality.HighQuality;
            __g.InterpolationMode = System.Drawing.Drawing2D.InterpolationMode.HighQualityBicubic;
            __g.SmoothingMode = System.Drawing.Drawing2D.SmoothingMode.HighQuality;
            __g.PixelOffsetMode = System.Drawing.Drawing2D.PixelOffsetMode.HighQuality;
            __g.PageUnit = GraphicsUnit.Pixel;
            float __width = __g.VisibleClipBounds.Width - 10;// (float)__pd.PrinterSettings.DefaultPageSettings.PaperSize.Width;

            #region Logo
            if (__haveLogo)
            {
                Image __logo = Image.FromFile(__logoFileName);
                float __persent = __width / __logo.Width;
                __g.DrawImage(__logo, 0, (int)__y, __logo.Width * __persent, __logo.Height * __persent);
                __y += (__logo.Height * __persent) + 10;
            }

            #endregion

            #region ส่วนหัว แสดงข้อมูลบริษัท

            if (this._posHeader.Trim().Length > 0)
            {
                __y += this._printSlipText(__g, __width, __width, 0, __y, this._posHeader, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Left, false);
            }
            else
            {
                __y += this._printSlipText(__g, __width, __width, 0, __y, __ltdName, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                __y += this._printSlipText(__g, __width, __width, 0, __y, MyLib._myGlobal._ltdAddress, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                string __telephone = "";
                if (__ltdTel.Trim().Length > 0)
                {
                    __telephone = "โทรศัพท์" + ":" + __ltdTel.Trim();
                }
                if (__ltdFax.Trim().Length > 0)
                {
                    __telephone = __telephone + " " + "โทรสาร" + ":" + __ltdFax.Trim();
                }
                if (__telephone.Length > 0)
                {
                    __y += this._printSlipText(__g, __width, __width, 0, __y, __telephone, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                }
                //

                if (__ltdTax != null && __ltdTax.Trim().Length > 0)
                {
                    __y += this._printSlipText(__g, __width, __width, 0, __y, "เลขประจำตัวผู้เสียภาษีอากร" + " : " + __ltdTax, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                }
            }

            #endregion

            string _viewDate = MyLib._myGlobal._convertDateFromQuery(selectDate.Replace("'", string.Empty)).ToString("dd/MM/yyyy");
            string _printDate = DateTime.Now.ToString("dd/MM/yyyy", new CultureInfo("th-TH"));

            // วันที่สรุปการขาย
            __tmpWidth = this._printSlipText(__g, __width, __width, 0, __y, "วันที่ : " + _viewDate, new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            //this._printSlipText(__g, __width, __width, 250, __y, _viewDate, new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            __y += __tmpWidth;

            // วันที่ทำรายการ
            //__tmpWidth = this._printSlipText(__g, __width, __width, 0, __y, "วันที่ทำรายการ : " + _printDate, new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            ////this._printSlipText(__g, __width, __width, 250, __y, _printDate, new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            //__y += __tmpWidth;
            __y += this._printSlipText(__g, __width, __width, 0, __y, "POS ID : " + __dt5.Rows[0][_g.d.POS_ID._POS_ID].ToString(), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);

            __y += 20;

            __y += this._printSlipText(__g, __width, __width, 50, __y, "รายการขาย :", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            __tmpWidth = this._printSlipText(__g, __width, __width, 0, __y, "ใบเสร็จเริ่มต้น", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, __dt5.Rows[0]["begin_invoice"].ToString(), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __tmpWidth;

            __tmpWidth = this._printSlipText(__g, __width, __width, 0, __y, "ใบเสร็จสิ้นสุด", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, __dt5.Rows[0]["end_invoice"].ToString(), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __tmpWidth;


            // ยอดขาย ส่วนลด ยอดขายหักส่วนลด หักรับคืน ยอดขายสุทธิ ยอดขายสุทธิรวม 
            __y += this._printSlipText(__g, __width, __width, 50, __y, "สรุปยอดขาย :", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);

            __tmpWidth = this._printSlipText(__g, __width, __width, 0, __y, "จำนวนบิลขาย", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, MyLib._myGlobal._intPhase(__dt5.Rows[0]["invoice_count"].ToString()).ToString(), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __tmpWidth;

            __tmpWidth = this._printSlipText(__g, __width, __width, 0, __y, "ยอดขาย", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, _totalSalevalue.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __tmpWidth;

            __tmpWidth = this._printSlipText(__g, __width, __width, 0, __y, "ส่วนลด", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, _totalDiscount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __tmpWidth;

            __tmpWidth = this._printSlipText(__g, __width, __width, 0, __y, "ยอดขายหักส่วนลด", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, __totalAfterDiscount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __tmpWidth;

            //__tmpWidth = this._printSlipText(__g, __width, __width, 0, __y, "หักรับคืน", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            //this._printSlipText(__g, __width, __width, 0, __y, _totalCancel.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            //__y += __tmpWidth;

            //__content.Append(_getTextLine("ยอดขายสุทธิ", 0M));
            __y += this._printSlipText(__g, __width, __width, 0, __y, "----------------------", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);

            __tmpWidth = this._printSlipText(__g, __width, __width, 0, __y, "ยอดขายสุทธิรวม", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, _totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __tmpWidth;

            __y += this._printSlipText(__g, __width, __width, 0, __y, "----------------------", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);

            __y += this._printSlipText(__g, __width, __width, 50, __y, "สรุปภาษี :", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);

            __tmpWidth = this._printSlipText(__g, __width, __width, 0, __y, "มูลค่ายกเว้นภาษี", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, _totalExceptVat.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __tmpWidth;

            __tmpWidth = this._printSlipText(__g, __width, __width, 0, __y, "มูลค่าฐานภาษี", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, __total_before_vat.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __tmpWidth;

            __tmpWidth = this._printSlipText(__g, __width, __width, 0, __y, "ภาษีมูลค่าเพิ่ม", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, _totalVatValue.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __tmpWidth;

            // สรุปการรับเงิน 
            // เงินสด เครดิตการ์ด คูปอง รวมรับเงินทั้งสิ้น 
            __y += this._printSlipText(__g, __width, __width, 50, __y, "สรุปการรับเงิน :", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);

            __tmpWidth = this._printSlipText(__g, __width, __width, 0, __y, "เงินสด", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, _totalCashAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __tmpWidth;

            __tmpWidth = this._printSlipText(__g, __width, __width, 0, __y, "เครดิตการ์ด", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, _totalCreditCardAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __tmpWidth;

            __tmpWidth = this._printSlipText(__g, __width, __width, 0, __y, "คูปอง", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, _totalCouponAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __tmpWidth;

            __tmpWidth = this._printSlipText(__g, __width, __width, 0, __y, "ปัดเศษ", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, __diffAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __tmpWidth;

            __y += this._printSlipText(__g, __width, __width, 0, __y, "----------------------", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);

            __tmpWidth = this._printSlipText(__g, __width, __width, 0, __y, "รวมรับเงินทั้งสิ้น", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, _totalImcome.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __tmpWidth;

            __y += this._printSlipText(__g, __width, __width, 0, __y, "----------------------", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);

            // สรุปยอดเงินสดในลิ้นชัก 
            // นำเงินสดเข้า รับจาการขาย นำเงินสดออก เงินคงเหลือในลิ้นชัก 
            __y += this._printSlipText(__g, __width, __width, 50, __y, "สรุปยอดเงินสดในลิ้นชัก :", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);

            __tmpWidth = this._printSlipText(__g, __width, __width, 0, __y, "นำเงินสดเข้า", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, _moneyIn.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __tmpWidth;

            __tmpWidth = this._printSlipText(__g, __width, __width, 0, __y, "รับจากการขาย", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, _totalCashAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __tmpWidth;

            __tmpWidth = this._printSlipText(__g, __width, __width, 0, __y, "นำเงินสดออก", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, _moneyOut.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __tmpWidth;

            __y += this._printSlipText(__g, __width, __width, 0, __y, "----------------------", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);

            __tmpWidth = this._printSlipText(__g, __width, __width, 0, __y, "เงินคงเหลือในลิ้นชัก", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, _moneyTotalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __tmpWidth;

            __y += this._printSlipText(__g, __width, __width, 0, __y, "----------------------", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);

            // สรุปยอดเงินส่ง
            if (__dt3.Rows.Count > 0)
            {
                __y += this._printSlipText(__g, __width, __width, 50, __y, "สรุปยอดส่งเงิน :", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);

                for (int __row = 0; __row < __dt3.Rows.Count; __row++)
                {
                    __y += this._printSlipText(__g, __width, __width, 0, __y, "ครั้งที่ " + (__row + 1) + " เวลา " + __dt3.Rows[__row][_g.d.POSCashierSettle._doc_time].ToString(), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                    //__content.Append(_getTextLine("ครั้งที่ " + (__row + 1) + " เวลา " + __dt3.Rows[__row][_g.d.POSCashierSettle._doc_time].ToString(), -1));

                    __tmpWidth = this._printSlipText(__g, __width, __width, 50, __y, "เงินสด", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                    this._printSlipText(__g, __width, __width, 0, __y, MyLib._myGlobal._decimalPhase(__dt3.Rows[__row][_g.d.POSCashierSettle._CashAmount].ToString()).ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                    __y += __tmpWidth;

                    decimal __creditCard = MyLib._myGlobal._decimalPhase(__dt3.Rows[__row][_g.d.POSCashierSettle._CreditCardAmount].ToString());
                    if (__creditCard > 0)
                    {
                        __tmpWidth = this._printSlipText(__g, __width, __width, 50, __y, "บัตรเครดิต", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                        this._printSlipText(__g, __width, __width, 0, __y, __creditCard.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                        __y += __tmpWidth;
                    }

                    decimal __coupon = MyLib._myGlobal._decimalPhase(__dt3.Rows[__row][_g.d.POSCashierSettle._CoupongAmount].ToString());
                    if (__coupon > 0)
                    {
                        __tmpWidth = this._printSlipText(__g, __width, __width, 50, __y, "คูปอง", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                        this._printSlipText(__g, __width, __width, 0, __y, __coupon.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                        __y += __tmpWidth;

                    }
                }

                __y += this._printSlipText(__g, __width, __width, 0, __y, "----------------------", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);

                __tmpWidth = this._printSlipText(__g, __width, __width, 0, __y, "รวมสุทธิ", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                this._printSlipText(__g, __width, __width, 0, __y, _totalOut.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                __y += __tmpWidth;

                __y += this._printSlipText(__g, __width, __width, 0, __y, "----------------------", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            }

            // สรุปภาษี 
            // ยกเว้นภาษี มีภาษี หักภาษีแล้ว ภาษีมูลค่าเพิ่ม 
            //__y += this._printSlipText(__g, __width, __width, 50, __y, "สรุปภาษี :", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);

            //__tmpWidth = this._printSlipText(__g, __width, __width, 0, __y, "ยกเว้นภาษี", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            //this._printSlipText(__g, __width, __width, 0, __y, _totalExceptVat.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            //__y += __tmpWidth;

            //__tmpWidth = this._printSlipText(__g, __width, __width, 0, __y, "มีภาษี", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            //this._printSlipText(__g, __width, __width, 0, __y, _totalVatValue.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            //__y += __tmpWidth;

            return __y;
        }

        #endregion

        #region พิมพ์สรุปการขายสินค้า

        /// <summary>พิมพ์รายการสรุปการขายสินค้า</summary>
        void _printSummaryItemSaleDaily(string saleDate)
        {
            // query
            // process query 
            MyLib._myFrameWork __myFrameWork = new MyLib._myFrameWork();
            StringBuilder __query = new StringBuilder(MyLib._myGlobal._xmlHeader);
            __query.Append("<node>");

            string __queryItemSummary = "select " + _g.d.ic_trans_detail._item_code + "," + _g.d.ic_trans_detail._item_name + ", sum(" + _g.d.ic_trans_detail._qty + ") as " + _g.d.ic_trans_detail._qty + ", sum(" + _g.d.ic_trans_detail._sum_amount + ") as " + _g.d.ic_trans_detail._sum_amount + " from " + _g.d.ic_trans_detail._table + " where " + _g.d.ic_trans_detail._is_pos + " = 1 and " + _g.d.ic_trans_detail._last_status + " = 0 and " + _g.d.ic_trans_detail._doc_date + " = " + saleDate + " and (select " + _g.d.ic_trans._table + "." + _g.d.ic_trans._pos_id + " from " + _g.d.ic_trans._table + " where " + _g.d.ic_trans._table + "." + _g.d.ic_trans._doc_no + " = " + _g.d.ic_trans_detail._table + "." + _g.d.ic_trans_detail._doc_no + ") = \'" + this._posConfig._posid + "\' and ( (select " + _g.d.ic_trans._table + "." + _g.d.ic_trans._doc_ref + " from " + _g.d.ic_trans._table + " where " + _g.d.ic_trans._table + "." + _g.d.ic_trans._doc_no + " = " + _g.d.ic_trans_detail._table + "." + _g.d.ic_trans_detail._doc_no + " and " + _g.d.ic_trans._is_pos + "=1 and " + _g.d.ic_trans._trans_flag + "=" + _g.g._transFlagGlobal._transFlag(_g.g._transControlTypeEnum.ขาย_ขายสินค้าและบริการ) + ") is null or  (select " + _g.d.ic_trans._table + "." + _g.d.ic_trans._doc_ref + " from " + _g.d.ic_trans._table + " where " + _g.d.ic_trans._table + "." + _g.d.ic_trans._doc_no + " = " + _g.d.ic_trans_detail._table + "." + _g.d.ic_trans_detail._doc_no + " and " + _g.d.ic_trans._is_pos + "=1 and " + _g.d.ic_trans._trans_flag + "=" + _g.g._transFlagGlobal._transFlag(_g.g._transControlTypeEnum.ขาย_ขายสินค้าและบริการ) + ") = \'\' ) group by " + _g.d.ic_trans_detail._item_code + ", " + _g.d.ic_trans_detail._item_name + " order by " + _g.d.ic_trans_detail._item_code;
            __query.Append(MyLib._myUtil._convertTextToXmlForQuery(__queryItemSummary));

            string __queyrTotalItem = "select sum(" + _g.d.ic_trans_detail._qty + ") as " + _g.d.ic_trans_detail._qty + ", sum(" + _g.d.ic_trans_detail._sum_amount + ") as " + _g.d.ic_trans_detail._sum_amount + " from " + _g.d.ic_trans_detail._table + " where " + _g.d.ic_trans_detail._is_pos + " = 1 and " + _g.d.ic_trans_detail._last_status + " = 0 and " + _g.d.ic_trans_detail._doc_date + " = " + saleDate + " and (select " + _g.d.ic_trans._table + "." + _g.d.ic_trans._pos_id + " from " + _g.d.ic_trans._table + " where " + _g.d.ic_trans._table + "." + _g.d.ic_trans._doc_no + " = " + _g.d.ic_trans_detail._table + "." + _g.d.ic_trans_detail._doc_no + ") = \'" + this._posConfig._posid + "\' and ((select " + _g.d.ic_trans._table + "." + _g.d.ic_trans._doc_ref + " from " + _g.d.ic_trans._table + " where " + _g.d.ic_trans._table + "." + _g.d.ic_trans._doc_no + " = " + _g.d.ic_trans_detail._table + "." + _g.d.ic_trans_detail._doc_no + " and " + _g.d.ic_trans._is_pos + "=1 and " + _g.d.ic_trans._trans_flag + "=" + _g.g._transFlagGlobal._transFlag(_g.g._transControlTypeEnum.ขาย_ขายสินค้าและบริการ) + ") is null or (select " + _g.d.ic_trans._table + "." + _g.d.ic_trans._doc_ref + " from " + _g.d.ic_trans._table + " where " + _g.d.ic_trans._table + "." + _g.d.ic_trans._doc_no + " = " + _g.d.ic_trans_detail._table + "." + _g.d.ic_trans_detail._doc_no + "  and " + _g.d.ic_trans._is_pos + "=1 and " + _g.d.ic_trans._trans_flag + "=" + _g.g._transFlagGlobal._transFlag(_g.g._transControlTypeEnum.ขาย_ขายสินค้าและบริการ) + ") = \'\' ) ";
            __query.Append(MyLib._myUtil._convertTextToXmlForQuery(__queyrTotalItem));
            __query.Append("</node>");

            string __debug_query = __query.ToString();

            ArrayList _getData = __myFrameWork._queryListGetData(MyLib._myGlobal._databaseName, __query.ToString());

            // draw print
            try
            {
                switch (this._posConfig._print_method)
                {
                    case 0:
                        // Driver Printer
                        {
                            //MyLib._myGlobal._writeLogFile(@"C:\smlsoft\poslog.txt", DateTime.Now.ToString() + " : Start Print By Driver", false);

                            try
                            {
                                PrintDocument __pd = new PrintDocument();
                                __pd.PrinterSettings.PrinterName = this._posConfig._pos_printer_name;
                                __pd.PrintController = new StandardPrintController();
                                __pd.PrintPage += (s1, e1) =>
                                {
                                    // แบบเดิม
                                    this._drawSummaryItemSaleDaily(e1.Graphics, _getData, saleDate);
                                };
                                __pd.Print();
                            }
                            catch (Exception __ex)
                            {
                                MessageBox.Show(__ex.Message);
                            }
                        }
                        break;
                    case 1:
                        // Raw Print
                        {
                            try
                            {
                                MyLib._printRaw __pd = new _printRaw((float)this._posConfig._pos_slip_width);
                                __pd._height = this._drawSummaryItemSaleDaily(__pd._g, _getData, saleDate);
                                // eJournal
                                //
                                __pd._print(this._posConfig._pos_printer_name);
                                __pd._print(this._posConfig._pos_printer_name, new byte[] { 29, 86, 66, 10 });
                                __pd._dispose();
                            }
                            catch (Exception __ex)
                            {
                                MessageBox.Show(__ex.Message);
                            }
                        }
                        break;
                    case 2:
                        // Tcp/IP
                        {
                            try
                            {
                                IPEndPoint __ip = new IPEndPoint(IPAddress.Parse(this._posConfig._printerPort), 9100);
                                Socket __socket = new Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);
                                __socket.Connect(__ip);
                                __socket.Send(new byte[] { 27, 64 }); // Initialize printer
                                MyLib._printRaw __pd = new _printRaw((float)this._posConfig._pos_slip_width);
                                __pd._height = this._drawSummaryItemSaleDaily(__pd._g, _getData, saleDate);

                                __socket.Send(__pd._getDataBytes());
                                __socket.Send(new byte[] { 10 });
                                __socket.Send(new byte[] { 29, 86, 66, 10 }); // Cut
                                __socket.Shutdown(SocketShutdown.Both);
                                __socket.Close();
                                __pd._dispose();
                            }
                            catch (Exception __ex)
                            {
                                MessageBox.Show(__ex.Message);
                            }
                        }
                        break;
                }
            }
            catch (Exception __ex)
            {
                MessageBox.Show(__ex.Message.ToString());
            }
        }

        private float _drawSummaryItemSaleDaily(Graphics __g, ArrayList getData, string selectDate)
        {
            DataTable __dt1 = ((DataSet)getData[0]).Tables[0];
            DataTable __dt2 = ((DataSet)getData[1]).Tables[0];

            float __y = 0F;
            float __tmpWidth = 0F;
            Boolean __haveLogo = false;

            string __logoFileName = @"c:\smlsoft\logopos.jpg";
            if (File.Exists(__logoFileName))
            {
                __haveLogo = true;
            }

            __g.CompositingQuality = System.Drawing.Drawing2D.CompositingQuality.HighQuality;
            __g.InterpolationMode = System.Drawing.Drawing2D.InterpolationMode.HighQualityBicubic;
            __g.SmoothingMode = System.Drawing.Drawing2D.SmoothingMode.HighQuality;
            __g.PixelOffsetMode = System.Drawing.Drawing2D.PixelOffsetMode.HighQuality;
            __g.PageUnit = GraphicsUnit.Pixel;
            float __width = __g.VisibleClipBounds.Width - 10;// (float)__pd.PrinterSettings.DefaultPageSettings.PaperSize.Width;

            string __ltdName = "";
            string __ltdAddress = "";
            string __ltdTel = "";
            string __ltdFax = "";
            string __ltdTax = "";

            if (MyLib._myGlobal._ltdName != null && MyLib._myGlobal._ltdAddress != null)
            {
                __ltdName = MyLib._myGlobal._ltdName;
                __ltdAddress = MyLib._myGlobal._ltdAddress;
                __ltdTel = MyLib._myGlobal._ltdTel;
                __ltdFax = MyLib._myGlobal._ltdFax;
                __ltdTax = MyLib._myGlobal._ltdTax;
            }
            else
            {
                __ltdName = "Company Name";
                __ltdAddress = "Company Address";
            }

            #region Logo
            if (__haveLogo)
            {
                Image __logo = Image.FromFile(__logoFileName);
                float __persent = __width / __logo.Width;
                __g.DrawImage(__logo, 0, (int)__y, __logo.Width * __persent, __logo.Height * __persent);
                __y += (__logo.Height * __persent) + 10;
            }

            #endregion

            #region ส่วนหัว แสดงข้อมูลบริษัท

            if (this._posHeader.Trim().Length > 0)
            {
                __y += this._printSlipText(__g, __width, __width, 0, __y, this._posHeader, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Left, false);
            }
            else
            {
                __y += this._printSlipText(__g, __width, __width, 0, __y, __ltdName, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                __y += this._printSlipText(__g, __width, __width, 0, __y, MyLib._myGlobal._ltdAddress, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                string __telephone = "";
                if (__ltdTel.Trim().Length > 0)
                {
                    __telephone = "โทรศัพท์" + ":" + __ltdTel.Trim();
                }
                if (__ltdFax.Trim().Length > 0)
                {
                    __telephone = __telephone + " " + "โทรสาร" + ":" + __ltdFax.Trim();
                }
                if (__telephone.Length > 0)
                {
                    __y += this._printSlipText(__g, __width, __width, 0, __y, __telephone, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                }
                //

                if (__ltdTax != null && __ltdTax.Trim().Length > 0)
                {
                    __y += this._printSlipText(__g, __width, __width, 0, __y, "เลขประจำตัวผู้เสียภาษีอากร" + " : " + __ltdTax, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                }
            }

            #endregion

            string _viewDate = MyLib._myGlobal._convertDateFromQuery(selectDate.Replace("'", string.Empty)).ToString("dd/MM/yyyy");
            string _printDate = DateTime.Now.ToString("dd/MM/yyyy", new CultureInfo("th-TH"));

            // วันที่สรุปการขาย
            __tmpWidth = this._printSlipText(__g, __width, __width, 0, __y, "วันที่สรุปการขาย : " + _viewDate, new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            //this._printSlipText(__g, __width, __width, 250, __y, _viewDate, new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            __y += __tmpWidth;

            // วันที่ทำรายการ
            __tmpWidth = this._printSlipText(__g, __width, __width, 0, __y, "วันที่ทำรายการ : " + _printDate, new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            //this._printSlipText(__g, __width, __width, 250, __y, _printDate, new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            __y += __tmpWidth;

            __y += 20;

            // รายละเอียดสินค้า
            for (int __row = 0; __row < __dt1.Rows.Count; __row++)
            {
                //__content.Append(_getTextLine(__dt1.Rows[__row][_g.d.ic_trans_detail._item_code].ToString(), MyLib._myGlobal._decimalPhase(__dt1.Rows[__row][_g.d.ic_trans_detail._qty].ToString()), "left"));
                //__content.Append(_getTextLine(__dt1.Rows[__row][_g.d.ic_trans_detail._item_name].ToString(), MyLib._myGlobal._decimalPhase(__dt1.Rows[__row][_g.d.ic_trans_detail._sum_amount].ToString())));

                //  รหัสสินค้า 60% จำนวน 40%
                __tmpWidth = this._printSlipText(__g, __width, __width * 0.6f, 0, __y, __dt1.Rows[__row][_g.d.ic_trans_detail._item_code].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                this._printSlipText(__g, __width * 0.8f, __width * 0.8f, 0, __y, MyLib._myGlobal._decimalPhase(__dt1.Rows[__row][_g.d.ic_trans_detail._qty].ToString()).ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                __y += __tmpWidth;

                // ชื่อ 80% ราคา 20%
                __tmpWidth = this._printSlipText(__g, __width, __width * 0.8f, 0, __y, __dt1.Rows[__row][_g.d.ic_trans_detail._item_name].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                this._printSlipText(__g, __width, __width, 0, __y, MyLib._myGlobal._decimalPhase(__dt1.Rows[__row][_g.d.ic_trans_detail._sum_amount].ToString()).ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                __y += __tmpWidth;
            }

            __y += 20;
            // รวม
            //__content.Append(_getTextLine("รวม", MyLib._myGlobal._decimalPhase(__dt2.Rows[0][_g.d.ic_trans_detail._qty].ToString()), "left")); // รวมจำนวน
            //__content.Append(_getTextLine("", MyLib._myGlobal._decimalPhase(__dt2.Rows[0][_g.d.ic_trans_detail._sum_amount].ToString()))); // รวมราคา
            __tmpWidth = this._printSlipText(__g, __width, __width * 0.6f, 0, __y, "รวม", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, true);
            this._printSlipText(__g, __width * 0.8f, __width * 0.8f, 0, __y, MyLib._myGlobal._decimalPhase(__dt2.Rows[0][_g.d.ic_trans_detail._qty].ToString()).ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __tmpWidth;

            //this._printSlipText(__g, __width - 15, __width - 10, 0, __y, __amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += this._printSlipText(__g, __width, __width, 0, __y, MyLib._myGlobal._decimalPhase(__dt2.Rows[0][_g.d.ic_trans_detail._sum_amount].ToString()).ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, true);

            return __y;
        }

        #endregion

        #region Print Pre Sale slip

        void _printPreCash()
        {
            if ((this._orderDeviceConfig != null && this._orderDeviceConfig._print_close_table == 1) || _isScreenCloseTable == false)
            {
                int __printMethod = (_isScreenCloseTable) ? this._orderDeviceConfig._print_mode : this._posConfig._print_method;

                if (this._tableNameSelect.Length == 0)
                {
                    MessageBox.Show("ไม่พบรายการคิดเงิน กรุณาเลือกโต๊ะก่อน", "ผิดพลาด", MessageBoxButtons.OK, MessageBoxIcon.Error);
                    return;
                }

                int _languageSelect = 0;
                if (_print_multilanguage_slip == true)
                {
                    _languageSelect = _selectLanguage();
                }

                switch (__printMethod)
                {
                    case 0:
                        {

                            try
                            {
                                PrintDocument __pd = new PrintDocument();
                                __pd.PrinterSettings.PrinterName = (_isScreenCloseTable) ? this._orderDeviceConfig._printer_name : this._posConfig._pos_printer_name;
                                __pd.PrinterSettings.DefaultPageSettings.Margins = new Margins(0, 0, 0, 0);
                                __pd.PrintController = new StandardPrintController();
                                __pd.PrintPage += (s1, e1) =>
                                {
                                    this._drawPreCashPrint(e1.Graphics, _languageSelect);
                                };

                                __pd.Print();
                            }
                            catch
                            {
                            }

                        }
                        break;
                    case 1:
                        // Raw Print
                        {
                            try
                            {
                                MyLib._printRaw __pd = new _printRaw((float)((_isScreenCloseTable) ? ((this._orderDeviceConfig._pos_slip_width == 0) ? 575 : this._orderDeviceConfig._pos_slip_width) : this._posConfig._pos_slip_width));
                                __pd._height = this._drawPreCashPrint(__pd._g, _languageSelect);
                                __pd._print(((_isScreenCloseTable) ? this._orderDeviceConfig._printer_name : this._posConfig._pos_printer_name));
                                __pd._print(((_isScreenCloseTable) ? this._orderDeviceConfig._printer_name : this._posConfig._pos_printer_name), new byte[] { 29, 86, 66, 10 });
                                __pd._dispose();
                            }
                            catch (Exception __ex)
                            {
                                MessageBox.Show(__ex.Message);
                            }
                        }
                        break;
                    case 2:
                        // Tcp/IP
                        {
                            try
                            {
                                IPEndPoint __ip = new IPEndPoint(IPAddress.Parse(((_isScreenCloseTable) ? this._orderDeviceConfig._printer_name : this._posConfig._printerPort)), 9100);
                                Socket __socket = new Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);
                                __socket.Connect(__ip);
                                __socket.Send(new byte[] { 27, 64 }); // Initialize printer
                                MyLib._printRaw __pd = new _printRaw((float)((_isScreenCloseTable) ? ((this._orderDeviceConfig._pos_slip_width == 0) ? 575 : this._orderDeviceConfig._pos_slip_width) : this._posConfig._pos_slip_width));
                                __pd._height = this._drawPreCashPrint(__pd._g, _languageSelect);
                                __socket.Send(__pd._getDataBytes());
                                __socket.Send(new byte[] { 10 });
                                __socket.Send(new byte[] { 29, 86, 66, 10 }); // Cut
                                __socket.Shutdown(SocketShutdown.Both);
                                __socket.Close();

                                __pd._dispose();
                            }
                            catch (Exception __ex)
                            {
                                MessageBox.Show(__ex.Message);
                            }
                        }
                        break;
                }
                //}
            }
            //else if (_isScreenCloseTable == false)
            //{
            //    try
            //    {
            //        PrintDocument __pd = new PrintDocument();
            //        __pd.PrinterSettings.PrinterName = this._orderDeviceConfig._printer_name;
            //        __pd.PrintController = new StandardPrintController();
            //        __pd.PrintPage += (s1, e1) =>
            //        {
            //            _drawPreCashPrint(e1.Graphics);
            //        };
            //        __pd.Print();
            //    }
            //    catch
            //    {
            //    }
            //    //// กรณี สั่งพิมพ์จาก หน้า pos
            //    //Form __formTable = new Form();
            //    //__formTable.StartPosition = FormStartPosition.CenterScreen;
            //    //__formTable.Size = new System.Drawing.Size(700, 600);
            //    //__formTable.Text = "เก็บเงินโต๊ะ";

            //    //SMLPOSControl._tableSearchLevelControl __tableSelect = new SMLPOSControl._tableSearchLevelControl();
            //    //__tableSelect.Dock = DockStyle.Fill;
            //    //__tableSelect._menuTableClick += (s1, e1) =>
            //    //{
            //    //    SMLPOSControl._tableSearchLevelMenuControl __table = (SMLPOSControl._tableSearchLevelMenuControl)s1;
            //    //    switch (__table._status)
            //    //    {
            //    //        case 0: MessageBox.Show("โต๊ะนี้ยังไม่เปิด");
            //    //            break;
            //    //        case 1: MessageBox.Show("โต๊ะนี้ยังไม่มีการปิดโต๊ะ");
            //    //            break;
            //    //        case 2:
            //    //            {
            //    //                // เรียก order มา
            //    //                this._isTableCheckOut = true;
            //    //                _getTableOrderForPay(__table);
            //    //                __formTable.Close();

            //    //            };
            //    //            break;
            //    //    }
            //    //};
            //    //__formTable.Controls.Add(__tableSelect);
            //    //__formTable.ShowDialog(MyLib._myGlobal._mainForm);
            //    //_sendMessage("clear:textbox,input", null, "");
            //}

        }

        float _drawPreCashPrint(Graphics __g, int languageIndex)
        {
            string __docDate = DateTime.Now.ToString(_dateFormat, new CultureInfo("en-US"));
            string __docTime = DateTime.Now.ToString("HH:mm");

            float __y = 0;
            // draw หัว
            Boolean __haveLogo = false;
            float _tmpHeight = 0f;

            float __width = __g.VisibleClipBounds.Width - 10;// (float)__pd.PrinterSettings.DefaultPageSettings.PaperSize.Width;

            string __logoFileName = @"c:\smlsoft\logopos.jpg";
            if (File.Exists(__logoFileName))
            {
                __haveLogo = true;
            }
            string __ltdName = "";
            string __ltdAddress = "";
            string __ltdTel = "";
            string __ltdFax = "";
            string __ltdTax = "";

            if (MyLib._myGlobal._ltdName != null && MyLib._myGlobal._ltdAddress != null)
            {
                __ltdName = MyLib._myGlobal._ltdName;
                __ltdAddress = MyLib._myGlobal._ltdAddress;
                __ltdTel = MyLib._myGlobal._ltdTel;
                __ltdFax = MyLib._myGlobal._ltdFax;
                __ltdTax = MyLib._myGlobal._ltdTax;
            }
            else
            {
                __ltdName = "Company Name";
                __ltdAddress = "Company Address";
            }

            switch (this._closeTableSlipNumber)
            {
                case 0:
                case 1:
                    {
                        #region ใบปิดโต๊ะ แบบ 1

                        #region Logo
                        if (__haveLogo)
                        {
                            Image __logo = Image.FromFile(__logoFileName);
                            float __persent = __width / __logo.Width;
                            __g.DrawImage(__logo, 0, (int)__y, __logo.Width * __persent, __logo.Height * __persent);
                            __y += (__logo.Height * __persent) + 10;
                        }

                        __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ใบสรุปรายการ", languageIndex), new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                        __y += 10;

                        #endregion

                        #region ส่วนหัว แสดงข้อมูลบริษัท

                        __y += this._printSlipText(__g, __width, __width, 0, __y, __ltdName, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                        __y += this._printSlipText(__g, __width, __width, 0, __y, MyLib._myGlobal._ltdAddress, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                        string __telephone = "";
                        if (__ltdTel.Trim().Length > 0)
                        {
                            __telephone = _getResource("โทรศัพท์", languageIndex) + ":" + __ltdTel.Trim();
                        }
                        if (__ltdFax.Trim().Length > 0)
                        {
                            __telephone = __telephone + " " + _getResource("โทรสาร", languageIndex) + ":" + __ltdFax.Trim();
                        }
                        if (__telephone.Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __telephone, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                        }
                        //
                        if (__ltdTax != null && __ltdTax.Trim().Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขประจำตัวผู้เสียภาษีอากร", languageIndex) + " : " + __ltdTax, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                        }

                        #endregion

                        #region หัวโต๊ะ พนักงาน เครื่อง

                        _tmpHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("โต๊ะ", languageIndex) + " : " + this._tableNumberSelect + "/" + this._tableNameSelect, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        __y += _tmpHeight;

                        // พนักงาน / เครื่อง
                        StringBuilder __saleCodeDeviceCode = new StringBuilder(_getResource("พนักงาน", languageIndex) + " : " + this._saleCode + "/" + this._saleName);

                        if (this._orderDeviceConfig != null && this._orderDeviceConfig._device_id != null && this._isScreenCloseTable)
                        {
                            __saleCodeDeviceCode.Append(" " + _getResource("เครื่อง", languageIndex) + " : " + this._orderDeviceConfig._device_id);
                        }
                        else
                        {
                            // cashier / pos id
                            __saleCodeDeviceCode.Append(" " + _getResource("เครื่อง", languageIndex) + " : " + this._posConfig._posid);
                        }

                        _tmpHeight = this._printSlipText(__g, __width, __width, 0, __y, __saleCodeDeviceCode.ToString(), new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        __y += _tmpHeight;

                        _tmpHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("วันที่", languageIndex) + " : " + __docDate + " " + _getResource("เวลา", languageIndex) + " : " + __docTime, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        __y += _tmpHeight;

                        //__y += this._printSlipText(__g, __width, __width, 0, __y, "ใบสรุปรายการ", new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);

                        __y += this._printSlipLine(__g, __width, __y);

                        #endregion

                        #region รายการสินค้า

                        int __transCount = 0;
                        decimal __itemQtyCount = 0;
                        decimal __saveAmount = 0;

                        for (int __row = 0; __row < this._itemProcess.Count; __row++)
                        {
                            __transCount++;
                            _posClientItemClass __item = this._itemProcess[__row];

                            __itemQtyCount += __item._qty;

                            string __qtyStr = (__item._qty == Math.Round(__item._qty, 0)) ? __item._qty.ToString(this._formatNumber2) : __item._qty.ToString(this._formatNumber1);

                            // จำนวน
                            this._printSlipText(__g, 30, 30, 0, __y, __qtyStr, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                            StringBuilder __detail = new StringBuilder();

                            if (languageIndex == 0 || __item._itemNameEng.Length == 0)
                            {
                                __detail.Append(__item._itemName);

                            }
                            else
                            {
                                __detail.Append(__item._itemNameEng);

                            }

                            __detail.Append(" @" + __item._price.ToString(this._formatNumber1));

                            float __lineHeight = this._printSlipText(__g, __width, __width * 0.7f, 40, __y, __detail.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);


                            this._printSlipText(__g, __width - 15, __width - 10, 0, __y, __item._amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                            __y += __lineHeight;

                        }

                        #endregion

                        #region ยอดรวม
                        // draw ยอดรวม
                        __y += this._printSlipLine(__g, __width, __y);

                        string __footer1 = __transCount.ToString() + " " + _getResource("รายการ", languageIndex) + " " + __itemQtyCount.ToString(this._formatNumber1) + " " + _getResource("ชิ้น", languageIndex);

                        _tmpHeight = this._printSlipText(__g, __width, __width, 0, __y, __footer1, new Font(this._fontFooterName, this._fontFooterSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                        //__y += this._printSlipText(__g, __width, __width, 0, __y, this._totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                        __y += _tmpHeight;

                        __y += this._printSlipLine(__g, __width, __y);

                        // footer 
                        float _foodPriceLineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("อาหาร", languageIndex), new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        this._printSlipText(__g, __width - 15, __width - 10, 0, __y, this._totalFoodAmount.ToString(this._formatNumber1), new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Right, false);
                        __y += _foodPriceLineHeight;

                        float __drinkPriceLineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("เครื่องดื่ม", languageIndex), new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        this._printSlipText(__g, __width - 15, __width - 10, 0, __y, this._totalDrinkAmount.ToString(this._formatNumber1), new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Right, false);
                        __y += __drinkPriceLineHeight;

                        if (this._foodDiscountWord.Length > 0 || this._totalExtraDiscountAmount > 0)
                        {
                            decimal _totalFoodDrink = _totalFoodAmount + _totalDrinkAmount;
                            _tmpHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("รวม", languageIndex), new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            this._printSlipText(__g, __width - 15, __width - 10, 0, __y, _totalFoodDrink.ToString(this._formatNumber1), new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += _tmpHeight;

                        }
                        if (this._foodDiscountWord.Length > 0)
                        {

                            float __discountFood = this._printSlipText(__g, __width, __width, 0, __y, _getResource("ส่วนลด", languageIndex) + ((this._foodDiscountWord.IndexOf("%") != -1) ? " " + this._foodDiscountWord : ""), new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            this._printSlipText(__g, __width - 15, __width - 10, 0, __y, this._foodDiscountAmount.ToString(this._formatNumber1), new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += __discountFood;
                        }

                        if (this._totalExtraDiscountAmount > 0)
                        {
                            //decimal __tmpValue = this._totalExtraDiscountAmount * -1;
                            float __discountPro = this._printSlipText(__g, __width, __width, 0, __y, _getResource("ส่วนลดโปรโมชั่น", languageIndex), new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            this._printSlipText(__g, __width - 15, __width - 10, 0, __y, this._totalExtraDiscountAmount.ToString(this._formatNumber1), new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += __discountPro;
                        }
                        // 
                        //if (this._finalBalance != 0M)
                        //{
                        //    _tmpHeight = this._printSlipText(__g, __width, __width, 0, __y, "ยอดปัดเศษ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        //    this._printSlipText(__g, __width - 15, __width - 10, 0, __y, this._diffAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                        //    __y += _tmpHeight;
                        //}

                        if (this._serviceChargeAmount > 0)
                        {
                            float __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, "Service Charge " + ((this._serviceChargeWord.IndexOf("%") != -1) ? this._serviceChargeWord : "") + " : ", new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            this._printSlipText(__g, __width - 15, __width - 10, 0, __y, this._serviceChargeAmount.ToString(this._formatNumber1), new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += __lineHeight;
                        }

                        if (this._posConfig._pos_vat_type == 1)
                        {
                            float __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("ภาษีมูลค่าเพิ่ม ", languageIndex) + " : " + _g.g._companyProfile._vat_rate + "%", new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            this._printSlipText(__g, __width - 15, __width - 10, 0, __y, this._vatExcludeAmount.ToString(this._formatNumber1), new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += __lineHeight;

                        }


                        // จำนวน
                        //this._printSlipText(__g, __width - 160, __width - 150, 0, __y, __qtyStr, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                        __y += this._printSlipLine(__g, __width, __y);
                        _tmpHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("รวมสุทธิ", languageIndex), new Font(this._fontFooterName, this._fontFooterSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                        __y += this._printSlipText(__g, __width, __width, 0, __y, this._finalBalance.ToString(this._formatNumber1), new Font(this._fontFooterName, this._fontFooterSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                        __y += this._printSlipLine(__g, __width, __y);

                        #endregion

                        #endregion

                    }
                    break;
                case 2:
                    {
                        #region ใบปิดโต๊ะ แบบ 2

                        #region Logo

                        if (__haveLogo)
                        {
                            Image __logo = Image.FromFile(__logoFileName);
                            float __persent = __width / __logo.Width;
                            __g.DrawImage(__logo, 0, (int)__y, __logo.Width * __persent, __logo.Height * __persent);
                            __y += (__logo.Height * __persent) + 10;
                        }

                        __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ใบสรุปรายการ", languageIndex), new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                        __y += 10;

                        #endregion

                        #region ส่วนหัว แสดงข้อมูลบริษัท

                        __y += this._printSlipText(__g, __width, __width, 0, __y, __ltdName, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                        __y += this._printSlipText(__g, __width, __width, 0, __y, MyLib._myGlobal._ltdAddress, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                        string __telephone = "";
                        if (__ltdTel.Trim().Length > 0)
                        {
                            __telephone = _getResource("โทรศัพท์", languageIndex) + ":" + __ltdTel.Trim();
                        }
                        if (__ltdFax.Trim().Length > 0)
                        {
                            __telephone = __telephone + " " + _getResource("โทรสาร", languageIndex) + ":" + __ltdFax.Trim();
                        }
                        if (__telephone.Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __telephone, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                        }
                        //
                        if (__ltdTax != null && __ltdTax.Trim().Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขประจำตัวผู้เสียภาษีอากร", languageIndex) + " : " + __ltdTax, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                        }

                        #endregion

                        #region หัวโต๊ะ เครื่อง

                        _tmpHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("โต๊ะ", languageIndex) + " : " + this._tableNumberSelect + "/" + this._tableNameSelect, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        __y += _tmpHeight;

                        // พนักงาน / เครื่อง
                        StringBuilder __saleCodeDeviceCode = new StringBuilder(_getResource("พนักงาน", languageIndex) + " : " + this._saleCode + "/" + this._saleName);

                        if (this._orderDeviceConfig != null && this._orderDeviceConfig._device_id != null && this._isScreenCloseTable)
                        {
                            __saleCodeDeviceCode.Append(" " + _getResource("เครื่อง", languageIndex) + " : " + this._orderDeviceConfig._device_id);
                        }
                        else
                        {
                            // cashier / pos id
                            __saleCodeDeviceCode.Append(" " + _getResource("เครื่อง", languageIndex) + " : " + this._posConfig._posid);
                        }

                        _tmpHeight = this._printSlipText(__g, __width, __width, 0, __y, __saleCodeDeviceCode.ToString(), new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        __y += _tmpHeight;

                        _tmpHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("วันที่", languageIndex) + " : " + __docDate + " " + _getResource("เวลา", languageIndex) + " : " + __docTime, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        __y += _tmpHeight;

                        __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เวลาเข้า", languageIndex) + " : " + this._openTableTime + " " + _getResource("เวลาออก", languageIndex) + " : " + this._closeTableTime, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        __y += this._printSlipLine(__g, __width, __y);

                        #endregion

                        #region รายการ
                        // draw รายการ
                        int __transCount = 0;
                        decimal __itemQtyCount = 0;

                        for (int __row = 0; __row < this._itemProcess.Count; __row++)
                        {
                            /*
                            __transCount++;
                            _posClientItemClass __item = this._itemProcess[__row];

                            __itemQtyCount += __item._qty;

                            string __qtyStr = (__item._qty == Math.Round(__item._qty, 0)) ? __item._qty.ToString(this._formatNumber2) : __item._qty.ToString(this._formatNumber1);

                            float __lineHeight = this._printSlipText(__g, __width, __width * 0.7f, 0, __y, ((languageIndex == 0 || __item._itemNameEng.Length == 0)) ? __item._itemName : __item._itemNameEng, new Font(this._fontDetailName, 9), SMLPOSControl._printSlipTextStyle.Left, false);
                            this._printSlipText(__g, __width, 30, __width * 0.8f, __y, __qtyStr, new Font(this._fontDetailName, 9), SMLPOSControl._printSlipTextStyle.Center, false);
                            this._printSlipText(__g, __width - 15, __width - 10, 0, __y, __item._amount.ToString(this._formatNumber1), new Font(this._fontDetailName, 9), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += __lineHeight;
                            */
                            __transCount++;
                            _posClientItemClass __item = this._itemProcess[__row];

                            __itemQtyCount += __item._qty;

                            string __qtyStr = (__item._qty == Math.Round(__item._qty, 0)) ? __item._qty.ToString(this._formatNumber2) : __item._qty.ToString(this._formatNumber1);

                            float __lineHeight = this._printSlipText(__g, __width, __width * 0.6f, 0, __y, ((languageIndex == 0 || __item._itemNameEng.Length == 0)) ? __item._itemName : __item._itemNameEng, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);

                            this._printSlipText(__g, (__width * 0.75f), (__width * 0.75f), __width * 0.15f, __y, __qtyStr, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            this._printSlipText(__g, __width - 15, __width - 10, 0, __y, __item._amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += __lineHeight;


                        }

                        #endregion

                        #region ยอดรวม
                        // draw ยอดรวม
                        __y += this._printSlipLine(__g, __width, __y);

                        if (this._serviceChargeAmount > 0)
                        {
                            float __lineHeight = this._printSlipText(__g, (float)(__width * 0.6), (float)(__width * 0.6), 0, __y, "Service Charge " + ((this._serviceChargeWord.IndexOf("%") != -1) ? this._serviceChargeWord : "") + " : ", new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            this._printSlipText(__g, __width, __width, 0, __y, this._serviceChargeAmount.ToString(this._formatNumber1), new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += __lineHeight;
                        }

                        // footer 
                        float _foodPriceLineHeight = this._printSlipText(__g, (float)(__width * 0.6), (float)(__width * 0.6), 0, __y, _getResource("อาหาร", languageIndex), new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Right, false);
                        this._printSlipText(__g, __width, __width, 0, __y, this._totalFoodAmount.ToString(this._formatNumber1), new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Right, false);
                        __y += _foodPriceLineHeight;

                        float __drinkPriceLineHeight = this._printSlipText(__g, (float)(__width * 0.6), (float)(__width * 0.6), 0, __y, _getResource("เครื่องดื่ม", languageIndex), new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Right, false);
                        this._printSlipText(__g, __width, __width, 0, __y, this._totalDrinkAmount.ToString(this._formatNumber1), new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Right, false);
                        __y += __drinkPriceLineHeight;

                        decimal _totalFoodDrink = _totalFoodAmount + _totalDrinkAmount;
                        _tmpHeight = this._printSlipText(__g, (float)(__width * 0.6), (float)(__width * 0.6), 0, __y, _getResource("รวม", languageIndex), new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Right, false);
                        this._printSlipText(__g, __width, __width, 0, __y, _totalFoodDrink.ToString(this._formatNumber1), new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Right, false);
                        __y += _tmpHeight;

                        if (this._foodDiscountWord.Length > 0)
                        {
                            decimal __tmpValue = this._foodDiscountAmount * -1;
                            float __discountFood = this._printSlipText(__g, (float)(__width * 0.6), (float)(__width * 0.6), 0, __y, _getResource("ส่วนลดอาหาร", languageIndex) + ((this._foodDiscountWord.IndexOf("%") != -1) ? " " + this._foodDiscountWord : ""), new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            this._printSlipText(__g, __width, __width, 0, __y, __tmpValue.ToString(this._formatNumber1), new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += __discountFood;
                        }

                        if (this._totalExtraDiscountAmount > 0)
                        {
                            decimal __tmpValue = this._totalExtraDiscountAmount * -1;
                            float __discountFood = this._printSlipText(__g, (float)(__width * 0.6), (float)(__width * 0.6), 0, __y, _getResource("ส่วนลดโปรโมชั่น", languageIndex), new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            this._printSlipText(__g, __width, __width, 0, __y, __tmpValue.ToString(this._formatNumber1), new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += __discountFood;
                        }

                        if (this._diffAmount != 0M)
                        {
                            //_tmpHeight = this._printSlipText(__g, (float)(__width * 0.6), (float)(__width * 0.6), 0, __y, "ยอดปัดเศษ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            //this._printSlipText(__g, __width, __width, 0, __y, this._diffAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            //__y += _tmpHeight;
                        }

                        if (this._posConfig._pos_vat_type == 1)
                        {
                            float __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("ภาษีมูลค่าเพิ่ม", languageIndex) + " : " + _g.g._companyProfile._vat_rate + "%", new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            this._printSlipText(__g, __width - 15, __width - 10, 0, __y, this._vatExcludeAmount.ToString(this._formatNumber1), new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += __lineHeight;

                        }

                        // จำนวน
                        //this._printSlipText(__g, __width - 160, __width - 150, 0, __y, __qtyStr, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                        __y += this._printSlipLine(__g, __width, __y);
                        _tmpHeight = this._printSlipText(__g, (float)(__width * 0.6), (float)(__width * 0.6), 0, __y, _getResource("รวมสุทธิ", languageIndex), new Font(this._fontFooterName, this._fontFooterSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                        __y += this._printSlipText(__g, __width, __width, 0, __y, this._finalBalance.ToString(this._formatNumber1), new Font(this._fontFooterName, this._fontFooterSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);

                        __y += 20;
                        __y += this._printSlipLine(__g, __width, __y);
                        _tmpHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระ", languageIndex), new Font(this._fontFooterName, 17, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                        __y += this._printSlipText(__g, __width, __width, 0, __y, this._finalBalance.ToString(this._formatNumber1), new Font(this._fontFooterName, 17, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);

                        __y += this._printSlipLine(__g, __width, __y);

                        #endregion

                        #endregion

                    }
                    break;
                case 3:
                    {
                        #region ใบปิดโต๊ะ แบบ 3

                        #region Logo

                        if (__haveLogo)
                        {
                            Image __logo = Image.FromFile(__logoFileName);
                            float __persent = __width / __logo.Width;
                            __g.DrawImage(__logo, 0, (int)__y, __logo.Width * __persent, __logo.Height * __persent);
                            __y += (__logo.Height * __persent) + 10;
                        }

                        __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ใบสรุปรายการ", languageIndex), new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                        __y += 10;

                        #endregion

                        #region ส่วนหัว แสดงข้อมูลบริษัท

                        __y += this._printSlipText(__g, __width, __width, 0, __y, __ltdName, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                        __y += this._printSlipText(__g, __width, __width, 0, __y, MyLib._myGlobal._ltdAddress, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                        string __telephone = "";
                        if (__ltdTel.Trim().Length > 0)
                        {
                            __telephone = _getResource("โทรศัพท์", languageIndex) + ":" + __ltdTel.Trim();
                        }
                        if (__ltdFax.Trim().Length > 0)
                        {
                            __telephone = __telephone + " " + _getResource("โทรสาร", languageIndex) + ":" + __ltdFax.Trim();
                        }
                        if (__telephone.Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __telephone, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                        }
                        //
                        if (__ltdTax != null && __ltdTax.Trim().Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขประจำตัวผู้เสียภาษีอากร", languageIndex) + " : " + __ltdTax, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                        }

                        #endregion

                        #region หัวโต๊ะ เครื่อง

                        _tmpHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("โต๊ะ", languageIndex) + " : " + this._tableNumberSelect + "/" + this._tableNameSelect, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        __y += _tmpHeight;

                        // พนักงาน / เครื่อง
                        _tmpHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("พนักงาน", languageIndex) + " : " + this._saleCode + "/" + this._saleName, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        __y += _tmpHeight;

                        if (this._orderDeviceConfig != null && this._orderDeviceConfig._device_id != null && this._isScreenCloseTable)
                        {
                            _tmpHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("เครื่อง", languageIndex) + " : " + this._orderDeviceConfig._device_id, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += _tmpHeight;
                        }
                        else
                        {
                            _tmpHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("เครื่อง", languageIndex) + " : " + this._posConfig._posid, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += _tmpHeight;
                        }


                        _tmpHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("วันที่", languageIndex) + " : " + __docDate + " " + _getResource("เวลา", languageIndex) + " : " + __docTime, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        __y += _tmpHeight;

                        __y += this._printSlipLine(__g, __width, __y);
                        #endregion

                        #region รายการ
                        int __transCount = 0;
                        decimal __itemQtyCount = 0;
                        decimal __saveAmount = 0;

                        for (int __row = 0; __row < this._itemProcess.Count; __row++)
                        {
                            __transCount++;
                            _posClientItemClass __item = this._itemProcess[__row];

                            __itemQtyCount += __item._qty;

                            string __qtyStr = (__item._qty == Math.Round(__item._qty, 0)) ? __item._qty.ToString(this._formatNumber2) : __item._qty.ToString(this._formatNumber1);

                            // จำนวน
                            this._printSlipText(__g, 30, 30, 0, __y, __qtyStr, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                            StringBuilder __detail = new StringBuilder();

                            if (languageIndex == 0 || __item._itemNameEng.Length == 0)
                            {
                                __detail.Append(__item._itemName);

                            }
                            else
                            {
                                __detail.Append(__item._itemNameEng);

                            }

                            // __detail.Append(" @" + __item._price.ToString(this._formatNumber1));

                            float __lineHeight = this._printSlipText(__g, __width, __width * 0.7f, 40, __y, __detail.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);

                            this._printSlipText(__g, __width - 15, __width - 10, 0, __y, __item._amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                            __y += __lineHeight;

                        }

                        #endregion

                        #region ยอดรวม
                        // draw ยอดรวม
                        __y += this._printSlipLine(__g, __width, __y);

                        string __footer1 = __transCount.ToString() + " " + _getResource("รายการ", languageIndex) + " " + __itemQtyCount.ToString(this._formatNumber1) + " " + _getResource("ชิ้น", languageIndex);

                        _tmpHeight = this._printSlipText(__g, __width, __width, 0, __y, __footer1, new Font(this._fontFooterName, this._fontFooterSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                        //__y += this._printSlipText(__g, __width, __width, 0, __y, this._totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                        __y += _tmpHeight;

                        __y += this._printSlipLine(__g, __width, __y);

                        // footer 
                        float _foodPriceLineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("อาหาร", languageIndex), new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        this._printSlipText(__g, __width - 15, __width - 10, 0, __y, this._totalFoodAmount.ToString(this._formatNumber1), new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Right, false);
                        __y += _foodPriceLineHeight;

                        float __drinkPriceLineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("เครื่องดื่ม", languageIndex), new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        this._printSlipText(__g, __width - 15, __width - 10, 0, __y, this._totalDrinkAmount.ToString(this._formatNumber1), new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Right, false);
                        __y += __drinkPriceLineHeight;

                        if (this._foodDiscountWord.Length > 0 || this._totalExtraDiscountAmount > 0)
                        {
                            decimal _totalFoodDrink = _totalFoodAmount + _totalDrinkAmount;
                            _tmpHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("รวม", languageIndex), new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            this._printSlipText(__g, __width - 15, __width - 10, 0, __y, _totalFoodDrink.ToString(this._formatNumber1), new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += _tmpHeight;

                        }
                        if (this._foodDiscountWord.Length > 0)
                        {
                            float __discountFood = this._printSlipText(__g, __width, __width, 0, __y, _getResource("ส่วนลด", languageIndex) + ((this._foodDiscountWord.IndexOf("%") != -1) ? " " + this._foodDiscountWord : ""), new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            this._printSlipText(__g, __width - 15, __width - 10, 0, __y, this._foodDiscountAmount.ToString(this._formatNumber1), new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += __discountFood;
                        }

                        if (this._totalExtraDiscountAmount > 0)
                        {
                            //decimal __tmpValue = this._totalExtraDiscountAmount * -1;
                            float __discountPro = this._printSlipText(__g, __width, __width, 0, __y, _getResource("ส่วนลดโปรโมชั่น", languageIndex), new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            this._printSlipText(__g, __width - 15, __width - 10, 0, __y, this._totalExtraDiscountAmount.ToString(this._formatNumber1), new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += __discountPro;
                        }

                        if (this._serviceChargeAmount > 0)
                        {
                            float __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, "Service Charge " + ((this._serviceChargeWord.IndexOf("%") != -1) ? this._serviceChargeWord : "") + " : ", new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            this._printSlipText(__g, __width - 15, __width - 10, 0, __y, this._serviceChargeAmount.ToString(this._formatNumber1), new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += __lineHeight;
                        }

                        if (this._posConfig._pos_vat_type == 1)
                        {
                            float __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("ภาษีมูลค่าเพิ่ม ", languageIndex) + " : " + _g.g._companyProfile._vat_rate + "%", new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            this._printSlipText(__g, __width - 15, __width - 10, 0, __y, this._vatExcludeAmount.ToString(this._formatNumber1), new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += __lineHeight;
                        }

                        // จำนวน
                        //this._printSlipText(__g, __width - 160, __width - 150, 0, __y, __qtyStr, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                        __y += this._printSlipLine(__g, __width, __y);
                        _tmpHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("รวมสุทธิ", languageIndex), new Font(this._fontFooterName, this._fontFooterSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                        __y += this._printSlipText(__g, __width, __width, 0, __y, this._finalBalance.ToString(this._formatNumber1), new Font(this._fontFooterName, this._fontFooterSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                        __y += this._printSlipLine(__g, __width, __y);

                        #endregion

                        #endregion

                    }
                    break;
            }
            if ((this._orderDeviceConfig != null && this._orderDeviceConfig._printer_manual_feed == true) || (this._isScreenCloseTable == false && this._posConfig._printer_manual_feed == true))
            {
                //__g.DrawString("", new Font(this._fontHeaderName, this._fontHeaderSize), Brushes.Black, new RectangleF(0, __y, 150, 150));
                if ((this._orderDeviceConfig != null && this._orderDeviceConfig._print_mode == 0) || (this._isScreenCloseTable == false && this._posConfig._print_method == 0))
                {
                    this._printSlipText(__g, __width, __width, 0, __y, ".\n.\n.\n.\n.", new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Left, true);
                }
                __y += 150;

            }

            return __y;
        }

        #endregion

        #region Print Slip

        int __icTransTableIndex = -1;
        int __icTransDetailTableIndex = -1;
        int __icTransDetailPromotionTableIndex = -1;
        int __cbTransTableIndex = -1;
        int __creditCardTableIndex = -1;
        int __advanceMoneyTableIndex = -1;
        int __icTransSerialNumberTableIndex = -1;
        int __tableTransTableIndex = -1;
        int __tableOrderDetailIndex = -1;
        int __tableOrderCencelIndex = -1;
        //int __tablePayCouponIndex = -1;

        void _printSlip(_printSlipMode mode, string docNo, string refDocNo, string header, string headerSlip, Boolean displayChange, Boolean drawerActive, int languageSelectIndex)
        {
            // toe กรณี config พิมพ์อย่างเต็มไว้


            try
            {
                int __transFlag = (headerSlip == "ใบเสร็จรับเงิน/ใบกำกับภาษี") ? _g.g._transFlagGlobal._transFlag(_g.g._transControlTypeEnum.ขาย_ใบกำกับภาษีอย่างเต็มออกแทน) : _g.g._transFlagGlobal._transFlag(_g.g._transControlTypeEnum.ขาย_ขายสินค้าและบริการ);

                MyLib._myFrameWork __myFrameWork = new _myFrameWork();

                int __tableIndex = 0;
                StringBuilder __queryList = new StringBuilder();
                __queryList.Append(MyLib._myGlobal._xmlHeader + "<node>");
                __queryList.Append(MyLib._myUtil._convertTextToXmlForQuery("select * " +
                    ", (select " + _g.d.erp_user._name_1 + " from " + _g.d.erp_user._table + " where " + _g.d.erp_user._table + "." + _g.d.erp_user._code + "=" + _g.d.ic_trans._cashier_code + ") as cashier_name" +
                    ", (select " + _g.d.ar_customer._name_1 + " from " + _g.d.ar_customer._table + " where " + _g.d.ar_customer._table + "." + _g.d.ar_customer._code + "=" + _g.d.ic_trans._table + "." + _g.d.ic_trans._cust_code + ") as " + _g.d.ic_trans._cust_name +
                    ", (select " + _g.d.ar_customer._name_eng_1 + " from " + _g.d.ar_customer._table + " where " + _g.d.ar_customer._table + "." + _g.d.ar_customer._code + "=" + _g.d.ic_trans._table + "." + _g.d.ic_trans._cust_code + ") as " + _g.d.ic_trans._cust_name_en +
                    ", (select " + _g.d.ar_customer._address + " from " + _g.d.ar_customer._table + " where " + _g.d.ar_customer._table + "." + _g.d.ar_customer._code + "=" + _g.d.ic_trans._table + "." + _g.d.ic_trans._cust_code + ") as cust_address" +

                    ", (select " + _g.d.ar_customer_detail._tax_id + " from " + _g.d.ar_customer_detail._table + " where " + _g.d.ar_customer_detail._table + "." + _g.d.ar_customer_detail._ar_code + "=" + _g.d.ic_trans._table + "." + _g.d.ic_trans._cust_code + ") as " + _g.d.ar_customer_detail._tax_id +
                     ", (select " + _g.d.ar_customer_detail._card_id + " from " + _g.d.ar_customer_detail._table + " where " + _g.d.ar_customer_detail._table + "." + _g.d.ar_customer_detail._ar_code + "=" + _g.d.ic_trans._table + "." + _g.d.ic_trans._cust_code + ") as " + _g.d.ar_customer_detail._card_id +
                   ", (select " + _g.d.ar_customer_detail._branch_type + " from " + _g.d.ar_customer_detail._table + " where " + _g.d.ar_customer_detail._table + "." + _g.d.ar_customer_detail._ar_code + "=" + _g.d.ic_trans._table + "." + _g.d.ic_trans._cust_code + ") as " + _g.d.ar_customer_detail._branch_type +
                    ", (select " + _g.d.ar_customer_detail._branch_code + " from " + _g.d.ar_customer_detail._table + " where " + _g.d.ar_customer_detail._table + "." + _g.d.ar_customer_detail._ar_code + "=" + _g.d.ic_trans._table + "." + _g.d.ic_trans._cust_code + ") as  branch_no" +

                    ", (select " + _g.d.POS_ID._POS_ID + " from " + _g.d.POS_ID._table + " where " + _g.d.POS_ID._table + "." + _g.d.POS_ID._MACHINECODE + "=" + _g.d.ic_trans._table + "." + _g.d.ic_trans._pos_id + ") as pos_id_desc" +
                    ", (select " + _g.d.ic_trans._table + "." + _g.d.ic_trans._doc_no + " from " + _g.d.ic_trans._table + " where " + _g.d.ic_trans._table + "." + _g.d.ic_trans._doc_no + " = \'" + refDocNo + "\' and " + _g.d.ic_trans._table + "." + _g.d.ic_trans._trans_flag + " = " + _g.g._transFlagGlobal._transFlag(_g.g._transControlTypeEnum.ขาย_ขายสินค้าและบริการ_ยกเลิก).ToString() + " ) as cancel_doc_no" +
                    ", (select " + _g.d.ic_trans._table + "." + _g.d.ic_trans._doc_date + " from " + _g.d.ic_trans._table + " where " + _g.d.ic_trans._table + "." + _g.d.ic_trans._doc_no + " = \'" + refDocNo + "\' and " + _g.d.ic_trans._table + "." + _g.d.ic_trans._trans_flag + " = " + _g.g._transFlagGlobal._transFlag(_g.g._transControlTypeEnum.ขาย_ขายสินค้าและบริการ_ยกเลิก).ToString() + " ) as cancel_doc_date" +
                    ", (select " + _g.d.table_master._name_1 + " from  " + _g.d.table_master._table + " where " + _g.d.ic_trans._table + "." + _g.d.ic_trans._table_number + " = " + _g.d.table_master._table + "." + _g.d.table_master._number + ") as table_name " +
                    " from " + _g.d.ic_trans._table +
                    " where " + _g.d.ic_trans._doc_no + "=\'" + docNo.ToString() + "\' and " + _g.d.ic_trans._trans_flag + "=" + __transFlag.ToString()));
                __icTransTableIndex = __tableIndex;
                __tableIndex++;

                __queryList.Append(MyLib._myUtil._convertTextToXmlForQuery("select *" +
                    ", (select " + _g.d.ic_inventory_barcode._table + "." + _g.d.ic_inventory_barcode._hidden_text + " from " + _g.d.ic_inventory_barcode._table + " where " + _g.d.ic_inventory_barcode._table + "." + _g.d.ic_inventory_barcode._ic_code + " =" + _g.d.ic_trans_detail._table + "." + _g.d.ic_trans_detail._item_code + " and " + _g.d.ic_inventory_barcode._table + "." + _g.d.ic_inventory_barcode._barcode + " = " + _g.d.ic_trans_detail._table + "." + _g.d.ic_trans_detail._barcode + " and " + _g.d.ic_inventory_barcode._table + "." + _g.d.ic_inventory_barcode._unit_code + " = " + _g.d.ic_trans_detail._table + "." + _g.d.ic_trans_detail._unit_code + " limit 1) as " + _g.d.ic_inventory_barcode._hidden_text + ", (select " + _g.d.ic_unit._table + "." + _g.d.ic_unit._name_1 + " from " + _g.d.ic_unit._table + " where " + _g.d.ic_unit._table + "." + _g.d.ic_unit._code + " = " + _g.d.ic_trans_detail._table + "." + _g.d.ic_trans_detail._unit_code + " ) as " + _g.d.ic_trans_detail._unit_name + ", (select " + _g.d.ic_inventory._drink_type + " from " + _g.d.ic_inventory._table + " where " + _g.d.ic_inventory._table + "." + _g.d.ic_inventory._code + " = " + _g.d.ic_trans_detail._table + "." + _g.d.ic_trans_detail._item_code + ") as " + _g.d.ic_inventory._drink_type + ", (select ic_inventory.name_eng_1 from ic_inventory where ic_inventory.code = ic_trans_detail.item_code ) as " + _g.d.ic_trans_detail._item_name_en + ", (select ic_unit.name_2 from ic_unit where ic_unit.code = ic_trans_detail.unit_code) as " + _g.d.ic_trans_detail._unit_name_en +
                    ", ((price_default*qty)-sum_amount) as member_discount " +
                    " from " + _g.d.ic_trans_detail._table + " where " + _g.d.ic_trans_detail._doc_no + "=\'" + docNo.ToString() + "\'  and " + _g.d.ic_trans_detail._trans_flag + "=" + __transFlag.ToString() + " order by " + _g.d.ic_trans_detail._line_number));
                __icTransDetailTableIndex = __tableIndex;
                __tableIndex++;

                __queryList.Append(MyLib._myUtil._convertTextToXmlForQuery("select * from " + _g.d.ic_trans_detail_promotion._table + " where " + _g.d.ic_trans_detail_promotion._doc_no + "=\'" + docNo.ToString() + "\'  and " + _g.d.ic_trans_detail_promotion._trans_flag + "=" + __transFlag.ToString() + " order by " + _g.d.ic_trans_detail_promotion._line_number));
                __icTransDetailPromotionTableIndex = __tableIndex;
                __tableIndex++;

                __queryList.Append(MyLib._myUtil._convertTextToXmlForQuery("select * from " + _g.d.cb_trans._table + " where " + _g.d.cb_trans._doc_no + "=\'" + docNo.ToString() + "\' and " + _g.d.cb_trans._trans_flag + "=" + __transFlag.ToString()));
                __cbTransTableIndex = __tableIndex;
                __tableIndex++;

                __queryList.Append(MyLib._myUtil._convertTextToXmlForQuery("select * from " + _g.d.cb_trans_detail._table + " where " + _g.d.cb_trans_detail._doc_no + "=\'" + docNo.ToString() + "\' and " + _g.d.cb_trans_detail._doc_type + "=3 and " + _g.d.cb_trans_detail._trans_flag + "=" + __transFlag.ToString()));
                __creditCardTableIndex = __tableIndex;
                __tableIndex++;

                __queryList.Append(MyLib._myUtil._convertTextToXmlForQuery("select * from " + _g.d.cb_trans_detail._table + " where " + _g.d.cb_trans_detail._doc_no + "=\'" + docNo.ToString() + "\' and " + _g.d.cb_trans_detail._doc_type + "=6 and " + _g.d.cb_trans_detail._trans_flag + "=" + __transFlag.ToString()));
                __advanceMoneyTableIndex = __tableIndex;
                __tableIndex++;

                __queryList.Append(MyLib._myUtil._convertTextToXmlForQuery("select * from " + _g.d.ic_trans_serial_number._table + " where " + _g.d.ic_trans_serial_number._doc_no + "=\'" + docNo.ToString() + "\' and " + _g.d.ic_trans_serial_number._trans_flag + "=" + __transFlag.ToString()));
                __icTransSerialNumberTableIndex = __tableIndex;
                __tableIndex++;


                // toe เพิ่ม กรณี พิมพ์บิลโต๊ะ อาหาร query เอาโต๊ะ มาด้วย
                if (MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro)
                {
                    __queryList.Append(MyLib._myUtil._convertTextToXmlForQuery("select *, (select " + _g.d.table_master._table + "." + _g.d.table_master._name_1 + " from " + _g.d.table_master._table + " where " + _g.d.table_master._table + "." + _g.d.table_master._number + " = " + _g.d.table_trans._table + "." + _g.d.table_trans._table_number + ") as " + _g.d.table_master._name_1 + " from " + _g.d.table_trans._table + " where " + _g.d.table_trans._cashier_doc_no + "=\'" + docNo.ToString() + "\' "));
                    __tableTransTableIndex = __tableIndex;
                    __tableIndex++;

                    if (this._show_order_detail == true)
                    {
                        __queryList.Append(MyLib._myUtil._convertTextToXmlForQuery("select * from " + _g.d.table_order_doc._table + " where " + _g.d.table_order_doc._cashier_doc_no + "='" + docNo.ToString() + "' "));
                        __tableOrderDetailIndex = __tableIndex;
                        __tableIndex++;

                        __queryList.Append(MyLib._myUtil._convertTextToXmlForQuery("select *, (select name_1 from ic_inventory where ic_inventory.code = table_order_cancel.item_code) as " + _g.d.table_order_cancel._item_name + " from " + _g.d.table_order_cancel._table + " where guid_line in ( select guid_line from table_order where doc_no in ( select doc_no from table_order_doc where cashier_doc_no = '" + docNo.ToString() + "' ) ) "));
                        __tableOrderCencelIndex = __tableIndex;
                        __tableIndex++;
                    }

                }

                // coupon
                /*__queryList.Append(MyLib._myUtil._convertTextToXmlForQuery("select * from " + _g.d.cb_trans_detail._table + " where " + _g.d.cb_trans_detail._doc_no + "=\'" + docNo.ToString() + "\' and " + _g.d.cb_trans_detail._doc_type + "=9 and " + _g.d.cb_trans_detail._trans_flag + "=" + __transFlag.ToString()));
                __tablePayCouponIndex = __tableIndex;
                __tableIndex++;*/


                __queryList.Append("</node>");

                //MyLib._myGlobal._writeLogFile(@"C:\smlsoft\poslog.txt", DateTime.Now.ToString() + " : After Pack Query Print", false);

                ArrayList _getData = __myFrameWork._queryListGetData(MyLib._myGlobal._databaseName, __queryList.ToString());

                //MyLib._myGlobal._writeLogFile(@"C:\smlsoft\poslog.txt", DateTime.Now.ToString() + " : After Query Print", false);
                if (this._pos_type_invoice == 1)
                {
                    mode = _printSlipMode.ใบกำกับภาษีอย่างเต็ม;
                    if (refDocNo.Length == 0)
                    {
                        headerSlip = "ใบเสร็จรับเงิน/ใบกำกับภาษี";
                    }
                }

                switch (this._posConfig._print_method)
                {
                    case 0:
                        // Driver Printer
                        {
                            //MyLib._myGlobal._writeLogFile(@"C:\smlsoft\poslog.txt", DateTime.Now.ToString() + " : Start Print By Driver", false);

                            try
                            {
                                if (drawerActive)
                                {
                                    this._openCashDrawer();
                                }
                                PrintDocument __pd = new PrintDocument();

                                __pd.PrinterSettings.PrinterName = this._posConfig._pos_printer_name;
                                __pd.PrintController = new StandardPrintController();

                                float __height = 0f;

                                __pd.BeginPrint += (s2, e2) =>
                                {
                                    if (this._posConfig._printerPort.ToUpper().Equals("ZEBRA-MZ320"))
                                    {
                                        PrintDocument __currentPrint = (PrintDocument)s2;

                                        Graphics g2 = __currentPrint.PrinterSettings.CreateMeasurementGraphics();
                                        __height = this._printSlipDraw(g2, _getData, mode, header, headerSlip, languageSelectIndex);

                                        __currentPrint.DefaultPageSettings.PaperSize = new PaperSize("Custom", 283, (int)(__height / 2) + 20);

                                    }
                                };

                                __pd.PrintPage += (s1, e1) =>
                                {
                                    // แบบเดิม
                                    __height = this._printSlipDraw(e1.Graphics, _getData, mode, header, headerSlip, languageSelectIndex);
                                };
                                __pd.Print();
                                // e-journal
                                if (this._pos_eJournal == 1)
                                {
                                    MyLib._printRaw __pd2 = new _printRaw((int)this._posConfig._pos_slip_width, (int)__height);
                                    __pd2._height = this._printSlipDraw(__pd2._g, _getData, mode, header, headerSlip, languageSelectIndex);
                                    //if (this._posConfig._printer_manual_feed == true)
                                    //{
                                    //    __pd2._height += 150;
                                    //}
                                    this._save_eJournal(docNo, __pd2._bitmap, (int)__pd2._width, (int)__pd2._height);
                                    __pd2._dispose();

                                }
                                __pd.Dispose();
                            }
                            catch (Exception __ex)
                            {
                                MessageBox.Show(__ex.Message);
                            }
                        }
                        break;
                    case 1:
                        // Raw Print
                        {
                            try
                            {
                                if (drawerActive)
                                {
                                    this._openCashDrawer();
                                }
                                MyLib._printRaw __pd = new _printRaw((float)this._posConfig._pos_slip_width);
                                __pd._height = this._printSlipDraw(__pd._g, _getData, mode, header, headerSlip, languageSelectIndex);
                                //if (this._posConfig._printer_manual_feed == true)
                                //{
                                //    __pd._height += 150;
                                //}

                                // eJournal
                                this._save_eJournal(docNo, __pd._bitmap, (int)__pd._width, (int)__pd._height);
                                //
                                __pd._print(this._posConfig._pos_printer_name);
                                __pd._print(this._posConfig._pos_printer_name, new byte[] { 29, 86, 66, 10 });
                                __pd._dispose();
                            }
                            catch (Exception __ex)
                            {
                                MessageBox.Show(__ex.Message);
                            }
                        }
                        break;
                    case 2:
                        // Tcp/IP
                        {
                            try
                            {
                                if (drawerActive)
                                {
                                    this._openCashDrawer();
                                }
                                IPEndPoint __ip = new IPEndPoint(IPAddress.Parse(this._posConfig._printerPort), 9100);
                                Socket __socket = new Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);
                                //__socket.NoDelay = true;

                                __socket.Connect(__ip);
                                __socket.Send(new byte[] { 27, 64 }); // Initialize printer
                                MyLib._printRaw __pd = new _printRaw((float)this._posConfig._pos_slip_width);
                                __pd._height = this._printSlipDraw(__pd._g, _getData, mode, header, headerSlip, languageSelectIndex);
                                //if (this._posConfig._printer_manual_feed == true)
                                //{
                                //    __pd._height += 150;
                                //}

                                // eJournal
                                this._save_eJournal(docNo, __pd._bitmap, (int)__pd._width, (int)__pd._height);
                                //
                                __socket.Send(__pd._getDataBytes());
                                __socket.Send(new byte[] { 10 });
                                __socket.Send(new byte[] { 29, 86, 66, 10 }); // Cut
                                __socket.Shutdown(SocketShutdown.Both);
                                __socket.Close();

                                __pd._dispose();
                            }
                            catch (Exception __ex)
                            {
                                MessageBox.Show(__ex.Message);
                            }
                        }
                        break;
                }

            }
            catch (Exception __ex)
            {
                MessageBox.Show(__ex.Message.ToString());
            }
        }

        private float _printSlipDraw(Graphics __g, ArrayList _getData, _printSlipMode mode, string header, string headerSlip, int languageSelectIndex)
        {
            return this._printSlipDraw(__g, _getData, mode, header, headerSlip, languageSelectIndex, 0);
        }

        public string _getResource(string name, int languageIndex)
        {
            if (languageIndex != 0)
            {
                string __result = MyLib._myResource._findResource("pos_slip_" + name, name, true, languageIndex)._str;

                if (__result.Equals(name))
                {
                    return MyLib._myGlobal._resource(name, _languageEnum.English);
                }

                return __result;

            }
            else
            {
                return MyLib._myGlobal._resource(name);
            }

            return name;
        }

        private float _printSlipDraw(Graphics __g, ArrayList _getData, _printSlipMode mode, string header, string headerSlip, int languageSelectIndex, float startYPos)
        {
            return _printSlipDraw(__g, _getData, mode, header, headerSlip, languageSelectIndex, startYPos, false);
        }

        private float _printSlipDraw(Graphics __g, ArrayList _getData, _printSlipMode mode, string header, string headerSlip, int languageSelectIndex, float startYPos, bool manualfeed)
        {
            float __y = startYPos;
            decimal __totalAmount = 0M;
            decimal __moneyChange = 0M;
            decimal __payCash = 0M;
            decimal __payCreditCard = 0M;
            decimal __payCoupon = 0M;
            decimal __payPoint = 0M;
            decimal __promotionAmount = 0M;

            decimal __currentPoint = 0M;

            Boolean __haveLogo = false;

            string __logoFileName = @"c:\smlsoft\logopos.jpg";
            if (File.Exists(__logoFileName))
            {
                __haveLogo = true;
            }

            DataTable __trans = ((DataSet)_getData[__icTransTableIndex]).Tables[0];
            DataTable __transDetail = ((DataSet)_getData[__icTransDetailTableIndex]).Tables[0];
            DataTable __transDetailPromotion = ((DataSet)_getData[__icTransDetailPromotionTableIndex]).Tables[0];
            DataTable __payDetail = ((DataSet)_getData[__cbTransTableIndex]).Tables[0];
            DataTable __creditCardDetail = (((DataSet)_getData[__creditCardTableIndex]).Tables.Count > 0) ? ((DataSet)_getData[__creditCardTableIndex]).Tables[0] : null;
            DataTable __advanceMoneyDetail = (((DataSet)_getData[__advanceMoneyTableIndex]).Tables.Count > 0) ? ((DataSet)_getData[__advanceMoneyTableIndex]).Tables[0] : null;
            DataTable __serialNumberTable = (((DataSet)_getData[__icTransSerialNumberTableIndex]).Tables.Count > 0) ? ((DataSet)_getData[__icTransSerialNumberTableIndex]).Tables[0] : null;
            DataTable __table_trans = null;
            DataTable __tableOrderDetail = null;
            DataTable __tableOrderCancel = null;

            if (MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro)
            {
                __table_trans = ((DataSet)_getData[__tableTransTableIndex]).Tables[0];

                if (this._show_order_detail == true)
                {
                    __tableOrderDetail = ((DataSet)_getData[__tableOrderDetailIndex]).Tables[0];
                    __tableOrderCancel = ((DataSet)_getData[__tableOrderCencelIndex]).Tables[0];
                }
            }

            //e1.PageSettings.PaperSize = new PaperSize("Customer", 375, 10000);
            //__pd.PrinterSettings.DefaultPageSettings.PaperSize.Height = 1000;
            string __memberCode = __trans.Rows[0][_g.d.ic_trans._member_code].ToString();
            string __cust_code = __trans.Rows[0][_g.d.ic_trans._cust_code].ToString();
            string __memberName = __trans.Rows[0][_g.d.ic_trans._cust_name].ToString();
            string __memberAddress = __trans.Rows[0]["cust_address"].ToString();
            string __cust_taxid = __trans.Rows[0][_g.d.ar_customer_detail._tax_id].ToString();
            string __branch_type = __trans.Rows[0][_g.d.ar_customer_detail._branch_type].ToString();
            string __branch_code = __trans.Rows[0]["branch_no"].ToString();
            //
            //Font __font1 = new Font(this._fontHeaderName, 10);
            __g.CompositingQuality = System.Drawing.Drawing2D.CompositingQuality.HighQuality;
            __g.InterpolationMode = System.Drawing.Drawing2D.InterpolationMode.HighQualityBicubic;
            __g.SmoothingMode = System.Drawing.Drawing2D.SmoothingMode.HighQuality;
            __g.PixelOffsetMode = System.Drawing.Drawing2D.PixelOffsetMode.HighQuality;
            __g.PageUnit = GraphicsUnit.Pixel;

            float __width = __g.VisibleClipBounds.Width - 10;// (float)__pd.PrinterSettings.DefaultPageSettings.PaperSize.Width;
            if (__haveLogo)
            {
                Image __logo = Image.FromFile(__logoFileName);
                float __persent = __width / __logo.Width;
                __g.DrawImage(__logo, 0, (int)__y, __logo.Width * __persent, __logo.Height * __persent);
                __y += (__logo.Height * __persent) + 10;
            }
            string __docGuid = "";
            int __formNumber = this._posConfigSlipNumber;

            __currentPoint = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._sum_point].ToString());
            decimal __totalAdvanceMoney = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._advance_amount].ToString());

            string __ltdName = "";
            string __ltdAddress = "";
            string __ltdTel = "";
            string __ltdFax = "";
            string __ltdTax = "";

            if (MyLib._myGlobal._ltdName != null && MyLib._myGlobal._ltdAddress != null)
            {
                __ltdName = MyLib._myGlobal._ltdName;
                __ltdAddress = MyLib._myGlobal._ltdAddress;
                __ltdTel = MyLib._myGlobal._ltdTel;
                __ltdFax = MyLib._myGlobal._ltdFax;
                __ltdTax = MyLib._myGlobal._ltdTax;
            }
            else
            {
                MessageBox.Show(MyLib._myGlobal._resource("ไม่พบรายละเอียดบริษัท"), MyLib._myGlobal._resource("เตือน"));

                __ltdName = "Company Name";
                __ltdAddress = "Company Address";
            }
            string __headquatreStr = _getResource("สำนักงานใหญ่", languageSelectIndex);
            string __branchStr = _getResource("สาขา", languageSelectIndex);

            string __customer_phone = (__trans.Rows[0][_g.d.ic_trans._point_telephone].ToString().Length > 0) ? MyLib._myGlobal._resource("หมายเลขโทรศัพท์") + " : " + __trans.Rows[0][_g.d.ic_trans._point_telephone].ToString() : "";


            decimal __diff_amount = (__payDetail.Rows.Count > 0) ? MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._total_income_amount].ToString()) : 0M;
            __payCash = (__payDetail.Rows.Count > 0) ? MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._pay_cash_amount].ToString()) : 0M;
            __payCoupon = (__payDetail.Rows.Count > 0) ? MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._coupon_amount].ToString()) : 0M;
            __payPoint = (__payDetail.Rows.Count > 0) ? MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._point_amount].ToString()) : 0M;
            __moneyChange = (__payDetail.Rows.Count > 0) ? MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._money_change].ToString()) : 0M;
            bool __isCreditSale = (MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._inquiry_type].ToString()) == 0) ? true : false;

            // header slip
            if (_posBillType.Length > 0)
            {
                headerSlip = _posBillType;
            }
            if (__isCreditSale == true && this._creditSaleBillType.Length > 0)
            {
                headerSlip = this._creditSaleBillType;
            }

            string __tableNumberStr = "";

            // เลขโต๊ะ
            if (MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro)
            {
                if (__table_trans.Rows.Count > 0)
                    __tableNumberStr = __table_trans.Rows[0][_g.d.table_trans._table_number].ToString() + "/" + __table_trans.Rows[0][_g.d.table_master._name_1].ToString();

                if (__tableNumberStr.Length == 0)
                    __tableNumberStr = __trans.Rows[0][_g.d.ic_trans._table_number].ToString() + "/" + __trans.Rows[0]["table_name"].ToString();

            }


            switch (__formNumber)
            {
                #region ใบเสร็จแบบที่ 0 ห้ามแก้ไข โดยเด็ดขาด
                case 0:
                case 1:
                    {

                        #region ข้อมูลบริษัท

                        if (this._posHeader.Trim().Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, this._posHeader, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false, true);
                        }
                        else
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __ltdName, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __ltdAddress, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            string __telephone = "";
                            if (__ltdTel.Trim().Length > 0)
                            {
                                __telephone = _getResource("โทรศัพท์", languageSelectIndex) + ":" + __ltdTel.Trim();
                            }
                            if (__ltdFax.Trim().Length > 0)
                            {
                                __telephone = __telephone + " " + _getResource("โทรสาร", languageSelectIndex) + ":" + __ltdFax.Trim();
                            }
                            if (__telephone.Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __telephone, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            }
                            //

                            if (__ltdTax != null && __ltdTax.Trim().Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขประจำตัวผู้เสียภาษีอากร", languageSelectIndex) + " : " + __ltdTax, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            }
                        }

                        #endregion

                        #region ส่วนหัว แสดงข้อมูลลูกค้า

                        if (header.Length > 0)
                        {
                            // ข้อความเพิ่มเติม
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource(header, languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Center, false);
                        }
                        __y += this._fontHeaderSize;
                        // toe change headerSlip 
                        // ย้ายไปข้างบน
                        //if (_posBillType.Length > 0)
                        //{
                        //    headerSlip = _posBillType;
                        //}

                        __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource(headerSlip, languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Center, false);
                        __y += this._fontHeaderSize;
                        this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขเครื่อง", languageSelectIndex) + " : " + __trans.Rows[0]["pos_id_desc"].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        string __cashierName = "";
                        try
                        {
                            __cashierName = __trans.Rows[0]["cashier_name"].ToString().Split(' ')[0].ToString().Trim();
                        }
                        catch
                        {
                        }
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            __cashierName = __trans.Rows[0][_g.d.ic_trans._cashier_code].ToString();
                        }

                        __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("พนักงาน", languageSelectIndex) + " : " + __cashierName, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                        if (header.IndexOf("ยกเลิก") != -1)
                        {
                            string __cancelDocNo = __trans.Rows[0]["cancel_doc_no"].ToString();
                            string __cancelDocDate = MyLib._myGlobal._convertDateFromQuery(__trans.Rows[0]["cancel_doc_date"].ToString()).ToString("dd-MM-yyyy", new CultureInfo("th-TH"));

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขที่เอกสารยกเลิก", languageSelectIndex) + ":" + __cancelDocNo, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("วันที่", languageSelectIndex) + ":" + __cancelDocDate, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }

                        // เลขที่เอกสาร วันที่ เวลา
                        string __docDate = MyLib._myGlobal._convertDateFromQuery(__trans.Rows[0][_g.d.ic_trans._doc_date].ToString()).ToString("dd-MM-yyyy", new CultureInfo("th-TH"));
                        string __docNo = __trans.Rows[0][_g.d.ic_trans._doc_no].ToString();
                        string __docRefNo = __trans.Rows[0][_g.d.ic_trans._doc_ref].ToString();
                        __docGuid = __trans.Rows[0][_g.d.ic_trans._doc_no_guid].ToString().Trim();
                        //


                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขที่", languageSelectIndex) + ":" + __docNo, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขที่อ้างอิง", languageSelectIndex) + ":" + __docRefNo, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("วันที่", languageSelectIndex) + ":" + __docDate + "@" + __trans.Rows[0][_g.d.ic_trans._doc_time].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ลูกค้า", languageSelectIndex) + " : " + __memberName, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขประจำตัวผู้เสียภาษี", languageSelectIndex) + " : " + __cust_taxid, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, ((__branch_type == "1") ? " [   ] " + __headquatreStr + " [ x ] " + __branchStr + " " + __branch_code : " [ x ] " + __headquatreStr + " [   ] " + __branchStr), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ที่อยู่", languageSelectIndex) + " : " + __memberAddress, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                        }
                        else
                        {
                            if (__memberCode.Trim().Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("สมาชิก", languageSelectIndex) + " : " + __memberName + " (" + __memberCode + ")", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            }


                            // พิมพ์โต๊ะ
                            if (__tableNumberStr.Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("หมายเลขโต๊ะ", languageSelectIndex) + " : " + __tableNumberStr, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            }

                            if ((MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro) && __table_trans.Rows.Count > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เวลาเข้า", languageSelectIndex) + " : " + __table_trans.Rows[0][_g.d.table_trans._open_doc_time].ToString() + _getResource(" เวลาออก", languageSelectIndex) + " : " + __table_trans.Rows[0][_g.d.table_trans._close_doc_time].ToString(), new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            }
                        }

                        if (__customer_phone.Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __customer_phone, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }

                        __y += this._printSlipLine(__g, __width, __y);

                        #endregion

                        #region รายการสินค้า
                        //
                        //Font __fontDetail1 = new Font(this._fontHeaderName, 10);
                        //Font __fontDetail2 = new Font(this._fontHeaderName, 10, FontStyle.Italic);
                        int __transCount = 0;
                        decimal __itemQtyCount = 0;
                        decimal __saveAmount = 0;
                        decimal __sumFood = 0M;
                        decimal __sumDrink = 0M;
                        for (int __row = 0; __row < __transDetail.Rows.Count; __row++)
                        {
                            DataRow __data = __transDetail.Rows[__row];
                            if (__data[_g.d.ic_trans_detail._item_type].ToString().Equals("3"))
                            {
                                // สินค้าชุด ข้ามไป
                                continue;
                            }

                            decimal __amount = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._sum_amount].ToString());

                            if (MyLib._myGlobal._decimalPhase(__data[_g.d.ic_inventory_barcode._hidden_text].ToString()) == 0)
                            {
                                __transCount++;
                                decimal __price = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._price].ToString());
                                decimal __qty = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._qty].ToString());
                                decimal __priceDefault = ((__data[_g.d.ic_trans_detail._ref_row].ToString().Equals("-1") && __data[_g.d.ic_trans_detail._item_code_main].ToString().Length > 0)) ? __amount : MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._price_default].ToString());
                                __itemQtyCount += ((__data[_g.d.ic_trans_detail._item_type].ToString().Equals("3")) ? 0 : __qty);
                                string __discountWord = __data[_g.d.ic_trans_detail._discount].ToString();
                                string __priceInfo = __data[_g.d.ic_trans_detail._remark].ToString();
                                decimal __discountAmount = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._discount_amount].ToString());
                                // มูลค่าสินค้า+vat
                                string __extraWord = "";
                                int __taxType = (int)MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._tax_type].ToString());


                                // toe แก้ extraword เอา case 0 ออก                            
                                switch (__taxType)
                                {
                                    case 0:
                                        __extraWord = "V";
                                        break;
                                }
                                // รายละเอียดสินค้า
                                StringBuilder __detail = new StringBuilder();


                                if (languageSelectIndex == 0)
                                {
                                    __detail.Append(__data[_g.d.ic_trans_detail._item_name].ToString().Trim());
                                }
                                else
                                {
                                    string __itemNameEn = __data[_g.d.ic_trans_detail._item_name_en].ToString().Trim();
                                    if (__itemNameEn.Length > 0)
                                    {
                                        __detail.Append(__itemNameEn);
                                    }
                                    else
                                    {
                                        __detail.Append(__data[_g.d.ic_trans_detail._item_name].ToString().Trim());
                                    }
                                }

                                if (__priceDefault != __amount && __priceDefault != 0)
                                {
                                    __detail.Append(" " + "@" + __priceDefault.ToString(this._formatNumber1));
                                }
                                float __lineHeight = this._printSlipText(__g, __width, (__memberCode.Trim().Length == 0) ? __width * 0.8f : __width, 0, __y, __detail.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                                // ราคาสามาชิก
                                if (__memberCode.Trim().Length > 0)
                                {
                                    decimal __newPrice = __amount / __qty;
                                    string __qtyStr = (__qty == Math.Round(__qty, 0)) ? __qty.ToString(this._formatNumber2) : __qty.ToString(this._formatNumber1);
                                    string __priceStr = __newPrice.ToString(this._formatNumber1);
                                    StringBuilder __memberPrice = new StringBuilder(_getResource("ราคาสมาชิก", languageSelectIndex) + " " + "@" + __priceStr);
                                    if (__qty > 1)
                                    {
                                        __memberPrice.Append("x");
                                        __memberPrice.Append(__qtyStr);
                                    }
                                    __y += __lineHeight;
                                    __lineHeight = this._printSlipText(__g, __width, __width, 5, __y, __memberPrice.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                }
                                // ส่วนลด
                                if (__discountAmount != 0)
                                {
                                    //StringBuilder __discountStr = new StringBuilder("ราคาปรกติ" + " : " + __priceDefault.ToString(this._formatNumber1) + " " + "บาท");
                                    //__y += this._printSlipText(__g, __width, __width, 5, __y, __discountStr.ToString(), new Font(this._fontDetailName, this._fontDetailSize * 0.8f), SMLPOSControl._printSlipTextStyle.Left);
                                    __saveAmount += __discountAmount;
                                    /*StringBuilder __discountStr = new StringBuilder();
                                    __discountStr.Append(__priceInfo + " " + "ลด");
                                    __discountStr.Append(" " + __discountAmount.ToString(this._formatNumber1) + " " + "บาท");
                                    if (__priceDefault != 0)
                                    {
                                        __discountStr.Append(" " + "จาก" + " " + __priceDefault.ToString(this._formatNumber1) + " " + "บาท");
                                    }
                                    __y += this._printSlipText(__g, __width, __width, 5, __y, __discountStr.ToString(), new Font(this._fontDetailName, this._fontDetailSize * 0.8f), SMLPOSControl._printSlipTextStyle.Left);
                                    __saveAmount += __discountAmount;
                                     */
                                }
                                this._printSlipText(__g, __width - 15, __width - 10, 0, __y, __amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                                if (this._showTaxDetail)
                                {
                                    this._printSlipText(__g, __width, __width, 0, __y, __extraWord, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                }
                                __y += __lineHeight;
                                if (__serialNumberTable != null && __serialNumberTable.Rows.Count > 0)
                                {
                                    // Serial Number
                                    DataRow[] __serial = __serialNumberTable.Select(_g.d.ic_trans_serial_number._doc_line_number + "=\'" + (__row).ToString() + "\'");
                                    for (int __serialLoop = 0; __serialLoop < __serial.Length; __serialLoop++)
                                    {
                                        __y += this._printSlipText(__g, __width, __width, 0, __y, "S/N:" + __serial[__serialLoop][_g.d.ic_trans_serial_number._serial_number].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                    }
                                }
                            }

                            if (__data[_g.d.ic_inventory._drink_type].ToString().Equals("1"))
                            {
                                __sumDrink += __amount;
                            }
                            else
                            {
                                __sumFood += __amount;
                            }
                        }

                        #endregion

                        #region รายการ promotion
                        for (int __row = 0; __row < __transDetailPromotion.Rows.Count; __row++)
                        {
                            DataRow __data = __transDetailPromotion.Rows[__row];
                            decimal __amount = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail_promotion._sum_amount].ToString());

                            //__transCount++;
                            decimal __price = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail_promotion._price].ToString());
                            decimal __qty = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail_promotion._qty].ToString());

                            //__itemQtyCount += __qty;

                            StringBuilder __detail = new StringBuilder();
                            __detail.Append(__data[_g.d.ic_trans_detail_promotion._promotion_name].ToString().Trim());

                            float __lineHeight = this._printSlipText(__g, __width, __width * 0.8f, 0, __y, __detail.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                            // ราคาสามาชิก
                            //if (__memberCode.Trim().Length > 0)
                            //{
                            //    decimal __newPrice = __amount / __qty;
                            //    string __qtyStr = (__qty == Math.Round(__qty, 0)) ? __qty.ToString(this._formatNumber2) : __qty.ToString(this._formatNumber1);
                            //    string __priceStr = __newPrice.ToString(this._formatNumber1);
                            //    StringBuilder __memberPrice = new StringBuilder("ราคาสมาชิก" + " " + "@" + __priceStr);
                            //    if (__qty > 1)
                            //    {
                            //        __memberPrice.Append("x");
                            //        __memberPrice.Append(__qtyStr);
                            //    }
                            //    __y += __lineHeight;
                            //    __lineHeight = this._printSlipText(__g, __width, __width, 5, __y, __memberPrice.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            //}
                            // ส่วนลด
                            //if (__discountAmount != 0)
                            //{
                            //    //StringBuilder __discountStr = new StringBuilder("ราคาปรกติ" + " : " + __priceDefault.ToString(this._formatNumber1) + " " + "บาท");
                            //    //__y += this._printSlipText(__g, __width, __width, 5, __y, __discountStr.ToString(), new Font(this._fontDetailName, this._fontDetailSize * 0.8f), SMLPOSControl._printSlipTextStyle.Left);
                            //    __saveAmount += __discountAmount;
                            //    /*StringBuilder __discountStr = new StringBuilder();
                            //    __discountStr.Append(__priceInfo + " " + "ลด");
                            //    __discountStr.Append(" " + __discountAmount.ToString(this._formatNumber1) + " " + "บาท");
                            //    if (__priceDefault != 0)
                            //    {
                            //        __discountStr.Append(" " + "จาก" + " " + __priceDefault.ToString(this._formatNumber1) + " " + "บาท");
                            //    }
                            //    __y += this._printSlipText(__g, __width, __width, 5, __y, __discountStr.ToString(), new Font(this._fontDetailName, this._fontDetailSize * 0.8f), SMLPOSControl._printSlipTextStyle.Left);
                            //    __saveAmount += __discountAmount;
                            //     */
                            //}
                            this._printSlipText(__g, __width - 15, __width - 10, 0, __y, __amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                            //if (this._showTaxDetail)
                            //{
                            //    this._printSlipText(__g, __width, __width, 0, __y, __extraWord, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            //}
                            __y += __lineHeight;

                        }

                        #endregion

                        #region ส่วนท้ายบิล

                        decimal __discountFooter = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_discount].ToString());
                        decimal __serviceChargeAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_service_charge].ToString());

                        // ท้ายบิล 
                        // โต๋ ดุให้ดี ๆ นะ มีผลกระทบต่อ ที่อื่นนะ 
                        // ถ้เาป็นค่าลบ เอายอดปัดเศษ มาโชวในส่วนลดด้วย
                        // ถ้าปัดขึนทำไงให้ดุดี
                        __totalAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_amount].ToString()) + __discountFooter + __totalAdvanceMoney;
                        __y += this._printSlipLine(__g, __width, __y);
                        string __footer1 = __transCount.ToString() + " " + _getResource("รายการ", languageSelectIndex) + " " + __itemQtyCount.ToString(this._formatNumber1) + " " + _getResource("ชิ้น", languageSelectIndex);
                        this._printSlipText(__g, __width, __width, 0, __y, __footer1, new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                        __y += this._printSlipText(__g, __width, __width, 0, __y, (__totalAmount - __serviceChargeAmount).ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                        // ส่วนลดท้ายบิล

                        // tomyumgoong ยอดอาหาร เครื่องดิ่ม
                        if (MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro)
                        {
                            float __lineHeight = 0;

                            if (__serviceChargeAmount > 0)
                            {
                                string __serviceChargeText = __trans.Rows[0][_g.d.ic_trans._service_charge_word].ToString();
                                __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("Service Charge", languageSelectIndex) + " " + ((__serviceChargeText.IndexOf("%") != -1) ? __serviceChargeText : ""), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                this._printSlipText(__g, __width, __width, 0, __y, __serviceChargeAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                __y += __lineHeight;
                            }

                            __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("อาหาร", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            this._printSlipText(__g, __width, __width, 0, __y, __sumFood.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += __lineHeight;

                            __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("เครื่องดื่ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            this._printSlipText(__g, __width, __width, 0, __y, __sumDrink.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += __lineHeight;

                            __y += this._printSlipLine(__g, __width, __y);
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("รวมทั้งสิ้น", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += this._printSlipLine(__g, __width, __y);

                        }

                        // เงินมัดจำ
                        if (__totalAdvanceMoney > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, "เงินมัดจำ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            for (int __row = 0; __row < __advanceMoneyDetail.Rows.Count; __row++)
                            {

                                string __detail = string.Format("{0}:{1}", __advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._trans_number].ToString(), MyLib._myGlobal._convertDateFromQuery(__advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._doc_date_ref].ToString()).ToString("dd-MM-yyyy", new CultureInfo("th-TH")));
                                decimal __advanceAmount = MyLib._myGlobal._decimalPhase(__advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._amount].ToString());

                                this._printSlipText(__g, __width, __width, 0, __y, __detail, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __advanceAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                        }

                        if (__discountFooter != 0)
                        {
                            string __discountWord2 = _getResource("ส่วนลดพิเศษ", languageSelectIndex);
                            string __discountWord = __trans.Rows[0][_g.d.ic_trans._discount_word].ToString().Trim();
                            if (__discountWord.Length > 0)
                            {
                                __discountWord2 = __discountWord2 + " : " + __discountWord;
                            }
                            this._printSlipText(__g, __width, __width, 0, __y, __discountWord2, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __discountFooter.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __saveAmount += __discountFooter;
                            // คงเหลือ
                            __totalAmount -= __discountFooter;
                        }

                        // ผลต่างปัดเศษ
                        //decimal __diffAmount = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._total_income_amount].ToString());
                        if (__diff_amount != 0)
                        {
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("ผลต่างการปัดเศษ", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __diff_amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __saveAmount += (__diff_amount);
                            __totalAmount += (__diff_amount * -1);
                        }

                        if (__discountFooter != 0 || __diff_amount != 0)
                        {
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("คงเหลือยอดชำระ", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                        }

                        // ภาษีมูลค่าเพิ่ม
                        decimal __beforeVatAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_before_vat].ToString());
                        decimal __exceptVatAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_except_vat].ToString());
                        decimal __vatAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_vat_value].ToString());
                        decimal __vatRate = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._vat_rate].ToString());

                        // toe เพิ่ม option แสดงรายละเอียดภาษี
                        if (this._showTaxDetail && _g.g._companyProfile._vat_rate > 0)
                        {

                            __y += this._printSlipLine(__g, __width, __y);
                            // สินค้ายกเว้นภาษี
                            if (__exceptVatAmount != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("มูลค่าสินค้ายกเว้นภาษีมูลค่าเพิ่ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __exceptVatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                            //
                            if (__beforeVatAmount != 0 || __vatAmount != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("มูลค่าสินค้ามีภาษีมูลค่าเพิ่ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __beforeVatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                //
                                string __vatRateStr = (__vatRate == Math.Round(__vatRate, 0)) ? __vatRate.ToString(this._formatNumber2) : __vatRate.ToString(this._formatNumber1);
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ภาษีมูลค่าเพิ่ม", languageSelectIndex) + " : " + __vatRateStr + "%", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __vatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                __y += this._printSlipLine(__g, __width, __y);
                            }
                        }
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("รวมเงิน", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                            SMLReport._formReport._moneyToText __moneyToText = new SMLReport._formReport._moneyToText();
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __moneyToText._toText(__totalAmount), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipLine(__g, __width, __y);
                        }
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างย่อ)
                        {
                            // ประหยัด
                            if (__saveAmount != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("คุณประหยัดครั้งนี้", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __saveAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                            __y += this._printSlipLine(__g, __width, __y);
                            // ยอดชำระ
                            //__payCash = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._pay_cash_amount].ToString());
                            if (__payCash != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระด้วยเงินสด", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __payCash.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                            if (__creditCardDetail != null)
                            {
                                for (int __row = 0; __row < __creditCardDetail.Rows.Count; __row++)
                                {
                                    decimal __creditCardTotalAmount = MyLib._myGlobal._decimalPhase(__creditCardDetail.Rows[__row][_g.d.cb_trans_detail._sum_amount].ToString());
                                    decimal __creditCardChargeAmount = MyLib._myGlobal._decimalPhase(__creditCardDetail.Rows[__row][_g.d.cb_trans_detail._charge].ToString());
                                    if (__creditCardTotalAmount != 0)
                                    {
                                        string __creditCardType = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._credit_card_type].ToString();
                                        string __creditCardNumber = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._trans_number].ToString();
                                        for (int __loop = 0; __loop < __creditCardNumber.Length - 4; __loop++)
                                        {
                                            __creditCardNumber = __creditCardNumber.Remove(__loop, 1);
                                            __creditCardNumber = __creditCardNumber.Insert(__loop, "*");
                                        }
                                        //
                                        this._printSlipText(__g, __width, __width, 0, __y, __creditCardType + " " + __creditCardNumber, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                        __y += this._printSlipText(__g, __width, __width, 0, __y, __creditCardTotalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                        //
                                        if (__creditCardChargeAmount != 0)
                                        {
                                            __y += this._printSlipText(__g, __width, __width, 10, __y, _getResource("Charge", languageSelectIndex) + " : " + __creditCardChargeAmount.ToString(this._formatNumber1) + " " + _getResource("บาท", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Italic), SMLPOSControl._printSlipTextStyle.Left, false);
                                        }
                                        //
                                        string __creditCardApproved = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._no_approved].ToString();
                                        __y += this._printSlipText(__g, __width, __width, 10, __y, _getResource("Approval", languageSelectIndex) + " : " + __creditCardApproved, new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Italic), SMLPOSControl._printSlipTextStyle.Left, false);
                                    }
                                }
                            }

                            // ชำระด้วยคูปอง
                            //__payCoupon = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._coupon_amount].ToString());
                            if (__payCoupon != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระด้วยคูปอง", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __payCoupon.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                            // ชำระด้วยแต้ม
                            //__payPoint = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._point_amount].ToString());
                            if (__payPoint != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระด้วยแต้ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __payPoint.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                            // เงินทอน
                            //__moneyChange = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._money_change].ToString());
                            if (__moneyChange != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("เงินทอน", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __moneyChange.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                            //
                            __y += this._printSlipLine(__g, __width, __y);

                            if ((MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro) && this._show_order_detail && (this._show_order_detail_copy_Only == false || (this._show_order_detail_copy_Only == true && header == "- สำเนา -")))
                            {
                                // order detail
                                for (int __orderRow = 0; __orderRow < __tableOrderDetail.Rows.Count; __orderRow++)
                                {
                                    __y += this._printSlipText(__g, __width, __width, 0, __y, "ใบสั่ง : " + __tableOrderDetail.Rows[__orderRow][_g.d.table_order_doc._doc_no].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                }

                                // order cancel
                                for (int __cancelRow = 0; __cancelRow < __tableOrderCancel.Rows.Count; __cancelRow++)
                                {
                                    decimal __cancelAmount = MyLib._myGlobal._decimalPhase(__tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._sum_amount].ToString());

                                    __y += this._printSlipText(__g, __width, __width, 0, __y, (__tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._cancel_flag].ToString().Equals("1") ? "ย้ายออก " + __tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._table_number_2].ToString() + " : " : "ยกเลิก : ") + __tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._item_name].ToString() + " " + __cancelAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                }
                                __y += this._printSlipLine(__g, __width, __y);

                            }
                        }


                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างย่อ)
                        {
                            string __docNoAndTime = _getResource("เลขที่", languageSelectIndex) + ":" + __docNo + " " + _getResource("วันที่", languageSelectIndex) + ":" + __docDate + "@" + __trans.Rows[0][_g.d.ic_trans._doc_time].ToString();
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __docNoAndTime, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);

                            if (__currentPoint > 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("แต้มครั้งนี้", languageSelectIndex) + ":", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __currentPoint.ToString(this._formatNumber2), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                                SMLProcess._posProcess __process = new SMLProcess._posProcess();
                                decimal __currentPointBalance = __process._pointBalance(__cust_code, true);

                                // แต้มสะสม
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("แต้มสะสมถึง", languageSelectIndex) + " " + __docDate, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __currentPointBalance.ToString(this._formatNumber2), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                            }
                        }

                        //
                        if (this._showShortDescription && _g.g._companyProfile._vat_rate > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, "V=" + _getResource("สินค้ามีภาษีมูลค่าเพิ่ม", languageSelectIndex) + " " + "E=" + _getResource("สินค้ายกเว้นภาษี", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            //
                        }
                        string __saleCode = __trans.Rows[0][_g.d.ic_trans._sale_code].ToString();
                        string __cashierCode = __trans.Rows[0][_g.d.ic_trans._cashier_code].ToString();
                        string __saleName = ""; // __trans.Rows[0][_g.d.ic_trans._sale_name].ToString();
                        if (__cashierCode.Equals(__saleCode) == false && mode == _printSlipMode.ใบกำกับภาษีอย่างย่อ)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("พนักงานขาย", languageSelectIndex) + " : " + __saleCode, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }
                        //
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            __y += 15f;
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ผู้รับเงิน", languageSelectIndex) + "................................................................" + __saleCode, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);

                            // remark
                            if (__trans.Rows[0][_g.d.ic_trans._remark].ToString().Length > 0)
                            {
                                __y += 15;
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("หมายเหตุ", languageSelectIndex) + " ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __trans.Rows[0][_g.d.ic_trans._remark].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                                __y += 15;
                            }
                        }
                        if (this._posFooter.Trim().Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, this._posFooter, new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }
                        #endregion

                    }
                    break;
                #endregion
                #region ใบเสร็จแบบที่ 2 จำนวน ชื่อสินค้า ราคา รวม
                case 2:
                    {

                        #region ส่วนหัว แสดงข้อมูลบริษัท

                        if (this._posHeader.Trim().Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, this._posHeader, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false, true);
                        }
                        else
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __ltdName, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __ltdAddress, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            string __telephone = "";
                            if (__ltdTel.Trim().Length > 0)
                            {
                                __telephone = _getResource("โทรศัพท์", languageSelectIndex) + ":" + __ltdTel.Trim();
                            }
                            if (__ltdFax.Trim().Length > 0)
                            {
                                __telephone = __telephone + " " + _getResource("โทรสาร", languageSelectIndex) + ":" + __ltdFax.Trim();
                            }
                            if (__telephone.Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __telephone, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            }
                            //
                            if (__ltdTax != null && __ltdTax.Trim().Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขประจำตัวผู้เสียภาษีอากร", languageSelectIndex) + " : " + __ltdTax, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            }
                        }

                        #endregion

                        #region ส่วนหัว แสดงข้อมูล เครือง POS และลูกค้า

                        // ข้อความเพิ่มเติม
                        if (header.Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource(header, languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Center, false);
                        }
                        __y += this._fontHeaderSize;

                        // ย้ายไปข้างบน
                        //if (_posBillType.Length > 0)
                        //{
                        //    headerSlip = _posBillType;
                        //}

                        __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource(headerSlip, languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Center, false);
                        __y += this._fontHeaderSize;
                        this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขเครื่อง", languageSelectIndex) + " : " + __trans.Rows[0]["pos_id_desc"].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        string __cashierName = "";
                        try
                        {
                            __cashierName = __trans.Rows[0]["cashier_name"].ToString().Split(' ')[0].ToString().Trim();
                        }
                        catch
                        {
                        }
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            __cashierName = __trans.Rows[0][_g.d.ic_trans._cashier_code].ToString();
                        }

                        __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("พนักงาน", languageSelectIndex) + " : " + __cashierName, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                        if (header.IndexOf("ยกเลิก") != -1)
                        {
                            string __cancelDocNo = __trans.Rows[0]["cancel_doc_no"].ToString();
                            string __cancelDocDate = MyLib._myGlobal._convertDateFromQuery(__trans.Rows[0]["cancel_doc_date"].ToString()).ToString("dd-MM-yyyy", new CultureInfo("th-TH"));

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขที่เอกสารยกเลิก", languageSelectIndex) + ":" + __cancelDocNo, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("วันที่", languageSelectIndex) + ":" + __cancelDocDate, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }

                        // เลขที่เอกสาร วันที่ เวลา
                        string __docDate = MyLib._myGlobal._convertDateFromQuery(__trans.Rows[0][_g.d.ic_trans._doc_date].ToString()).ToString("dd-MM-yyyy", new CultureInfo("th-TH"));
                        string __docNo = __trans.Rows[0][_g.d.ic_trans._doc_no].ToString();
                        string __docRefNo = __trans.Rows[0][_g.d.ic_trans._doc_ref].ToString();
                        __docGuid = __trans.Rows[0][_g.d.ic_trans._doc_no_guid].ToString().Trim();
                        //
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขที่", languageSelectIndex) + ":" + __docNo, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขที่อ้างอิง", languageSelectIndex) + ":" + __docRefNo, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("วันที่", languageSelectIndex) + ":" + __docDate + "@" + __trans.Rows[0][_g.d.ic_trans._doc_time].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ลูกค้า", languageSelectIndex) + " : " + __memberName, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขประจำตัวผู้เสียภาษี", languageSelectIndex) + " : " + __cust_taxid, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, ((__branch_type == "1") ? " [   ] " + __headquatreStr + " [ x ] " + __branchStr + " " + __branch_code : " [ x ] " + __headquatreStr + " [   ] " + __branchStr), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ที่อยู่", languageSelectIndex) + " : " + __memberAddress, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                        }
                        else
                        {
                            if (__memberCode.Trim().Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("สมาชิก", languageSelectIndex) + " : " + __memberName + " (" + __memberCode + ")", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            }

                            // พิมพ์โต๊ะ
                            if (__tableNumberStr.Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("หมายเลขโต๊ะ", languageSelectIndex) + " : " + __tableNumberStr, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            }

                            if ((MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro) && __table_trans.Rows.Count > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เวลาเข้า", languageSelectIndex) + " : " + __table_trans.Rows[0][_g.d.table_trans._open_doc_time].ToString() + " " + _getResource("เวลาออก", languageSelectIndex) + " : " + __table_trans.Rows[0][_g.d.table_trans._close_doc_time].ToString(), new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Left, false);

                            }

                        }

                        if (__customer_phone.Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __customer_phone, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }
                        __y += this._printSlipLine(__g, __width, __y);

                        #endregion

                        #region รายการสินค้า

                        int __transCount = 0;
                        decimal __itemQtyCount = 0;
                        decimal __saveAmount = 0;
                        decimal __sumFood = 0M;
                        decimal __sumDrink = 0M;

                        for (int __row = 0; __row < __transDetail.Rows.Count; __row++)
                        {
                            DataRow __data = __transDetail.Rows[__row];

                            if (__data[_g.d.ic_trans_detail._item_type].ToString().Equals("3"))
                            {
                                // สินค้าชุด ข้ามไป
                                continue;
                            }

                            decimal __amount = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._sum_amount].ToString());

                            if (MyLib._myGlobal._decimalPhase(__data[_g.d.ic_inventory_barcode._hidden_text].ToString()) == 0)
                            {
                                __transCount++;
                                decimal __price = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._price].ToString());
                                decimal __qty = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._qty].ToString());
                                decimal __priceDefault = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._price_default].ToString());
                                __itemQtyCount += __qty;
                                string __discountWord = __data[_g.d.ic_trans_detail._discount].ToString();
                                string __priceInfo = __data[_g.d.ic_trans_detail._remark].ToString();
                                decimal __discountAmount = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._discount_amount].ToString());
                                // มูลค่าสินค้า+vat
                                string __extraWord = "";
                                int __taxType = (int)MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._tax_type].ToString());
                                string __qtyStr = (__qty == Math.Round(__qty, 0)) ? __qty.ToString(this._formatNumber2) : __qty.ToString(this._formatNumber1);

                                // toe แก้ extraword case 0 = สินค้ามี Vat                         
                                switch (__taxType)
                                {
                                    case 0:
                                        __extraWord = "V";
                                        break;
                                }

                                // จำนวน
                                this._printSlipText(__g, 40, 40, 0, __y, __qtyStr, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                                // ชื่อสินค้า
                                StringBuilder __detail = new StringBuilder();
                                if (languageSelectIndex == 0)
                                {
                                    __detail.Append(__data[_g.d.ic_trans_detail._item_name].ToString().Trim());
                                }
                                else
                                {
                                    string __itemNameEn = __data[_g.d.ic_trans_detail._item_name_en].ToString().Trim();
                                    if (__itemNameEn.Length > 0)
                                    {
                                        __detail.Append(__itemNameEn);
                                    }
                                    else
                                    {
                                        __detail.Append(__data[_g.d.ic_trans_detail._item_name].ToString().Trim());
                                    }
                                }

                                float __lineHeight = this._printSlipText(__g, __width, (__memberCode.Trim().Length == 0) ? __width * 0.8f : __width, 50, __y, __detail.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);

                                // ราคาสามาชิก
                                //if (__memberCode.Trim().Length > 0)
                                //{
                                //    decimal __newPrice = __amount / __qty;
                                //    string __qtyStr = (__qty == Math.Round(__qty, 0)) ? __qty.ToString(this._formatNumber2) : __qty.ToString(this._formatNumber1);
                                //    string __priceStr = __newPrice.ToString(this._formatNumber1);
                                //    StringBuilder __memberPrice = new StringBuilder("ราคาสมาชิก" + " " + "@" + __priceStr);
                                //    if (__qty > 1)
                                //    {
                                //        __memberPrice.Append("x");
                                //        __memberPrice.Append(__qtyStr);
                                //    }
                                //    __y += __lineHeight;
                                //    __lineHeight = this._printSlipText(__g, __width, __width, 5, __y, __memberPrice.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                //}
                                // ส่วนลด

                                if (__discountAmount != 0)
                                {
                                    __saveAmount += __discountAmount;
                                }
                                this._printSlipText(__g, __width - 15, __width - 10, 0, __y, __amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                                if (this._showTaxDetail && _g.g._companyProfile._vat_rate > 0)
                                {
                                    this._printSlipText(__g, __width, __width, 0, __y, __extraWord, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                }
                                __y += __lineHeight;
                                if (__serialNumberTable != null && __serialNumberTable.Rows.Count > 0)
                                {
                                    // Serial Number
                                    DataRow[] __serial = __serialNumberTable.Select(_g.d.ic_trans_serial_number._doc_line_number + "=\'" + (__row).ToString() + "\'");
                                    for (int __serialLoop = 0; __serialLoop < __serial.Length; __serialLoop++)
                                    {
                                        __y += this._printSlipText(__g, __width, __width, 0, __y, "S/N:" + __serial[__serialLoop][_g.d.ic_trans_serial_number._serial_number].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                    }
                                }
                            }

                            if (__data[_g.d.ic_inventory._drink_type].ToString().Equals("1"))
                            {
                                __sumDrink += __amount;
                            }
                            else
                            {
                                __sumFood += __amount;
                            }

                        }

                        #endregion

                        #region รายการ promotion
                        for (int __row = 0; __row < __transDetailPromotion.Rows.Count; __row++)
                        {
                            DataRow __data = __transDetailPromotion.Rows[__row];
                            decimal __amount = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail_promotion._sum_amount].ToString());

                            //__transCount++;
                            decimal __price = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail_promotion._price].ToString());
                            decimal __qty = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail_promotion._qty].ToString());

                            //__itemQtyCount += __qty;

                            StringBuilder __detail = new StringBuilder();
                            __detail.Append(__data[_g.d.ic_trans_detail_promotion._promotion_name].ToString().Trim());

                            float __lineHeight = this._printSlipText(__g, __width, __width * 0.8f, 0, __y, __detail.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                            // ราคาสามาชิก
                            //if (__memberCode.Trim().Length > 0)
                            //{
                            //    decimal __newPrice = __amount / __qty;
                            //    string __qtyStr = (__qty == Math.Round(__qty, 0)) ? __qty.ToString(this._formatNumber2) : __qty.ToString(this._formatNumber1);
                            //    string __priceStr = __newPrice.ToString(this._formatNumber1);
                            //    StringBuilder __memberPrice = new StringBuilder("ราคาสมาชิก" + " " + "@" + __priceStr);
                            //    if (__qty > 1)
                            //    {
                            //        __memberPrice.Append("x");
                            //        __memberPrice.Append(__qtyStr);
                            //    }
                            //    __y += __lineHeight;
                            //    __lineHeight = this._printSlipText(__g, __width, __width, 5, __y, __memberPrice.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            //}
                            // ส่วนลด
                            //if (__discountAmount != 0)
                            //{
                            //    //StringBuilder __discountStr = new StringBuilder("ราคาปรกติ" + " : " + __priceDefault.ToString(this._formatNumber1) + " " + "บาท");
                            //    //__y += this._printSlipText(__g, __width, __width, 5, __y, __discountStr.ToString(), new Font(this._fontDetailName, this._fontDetailSize * 0.8f), SMLPOSControl._printSlipTextStyle.Left);
                            //    __saveAmount += __discountAmount;
                            //    /*StringBuilder __discountStr = new StringBuilder();
                            //    __discountStr.Append(__priceInfo + " " + "ลด");
                            //    __discountStr.Append(" " + __discountAmount.ToString(this._formatNumber1) + " " + "บาท");
                            //    if (__priceDefault != 0)
                            //    {
                            //        __discountStr.Append(" " + "จาก" + " " + __priceDefault.ToString(this._formatNumber1) + " " + "บาท");
                            //    }
                            //    __y += this._printSlipText(__g, __width, __width, 5, __y, __discountStr.ToString(), new Font(this._fontDetailName, this._fontDetailSize * 0.8f), SMLPOSControl._printSlipTextStyle.Left);
                            //    __saveAmount += __discountAmount;
                            //     */
                            //}
                            this._printSlipText(__g, __width - 15, __width - 10, 0, __y, __amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                            //if (this._showTaxDetail)
                            //{
                            //    this._printSlipText(__g, __width, __width, 0, __y, __extraWord, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            //}
                            __y += __lineHeight;

                        }

                        #endregion

                        #region ส่วนท้ายบิล

                        decimal __discountFooter = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_discount].ToString());
                        decimal __serviceChargeAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_service_charge].ToString());

                        // ท้ายบิล
                        __totalAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_amount].ToString()) + __discountFooter + __totalAdvanceMoney;
                        __y += this._printSlipLine(__g, __width, __y);
                        string __footer1 = __transCount.ToString() + " " + _getResource("รายการ", languageSelectIndex) + " " + __itemQtyCount.ToString(this._formatNumber1) + " " + _getResource("ชิ้น", languageSelectIndex);
                        this._printSlipText(__g, __width, __width, 0, __y, __footer1, new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                        __y += this._printSlipText(__g, __width, __width, 0, __y, (__totalAmount - __serviceChargeAmount).ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);

                        // tomyumgoong ยอดอาหาร เครื่องดิ่ม
                        if (MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro)
                        {
                            float __lineHeight = 0;
                            if (__serviceChargeAmount > 0)
                            {
                                string __serviceChargeText = __trans.Rows[0][_g.d.ic_trans._service_charge_word].ToString();
                                __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("Service Charge", languageSelectIndex) + " " + ((__serviceChargeText.IndexOf("%") != -1) ? __serviceChargeText : ""), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                this._printSlipText(__g, __width, __width, 0, __y, __serviceChargeAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                __y += __lineHeight;
                            }

                            __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("อาหาร", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            this._printSlipText(__g, __width, __width, 0, __y, __sumFood.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += __lineHeight;

                            __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("เครื่องดื่ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            this._printSlipText(__g, __width, __width, 0, __y, __sumDrink.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += __lineHeight;

                            __y += this._printSlipLine(__g, __width, __y);
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("รวมทั้งสิ้น", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += this._printSlipLine(__g, __width, __y);

                        }

                        // เงินมัดจำ
                        if (__advanceMoneyDetail != null)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, "เงินมัดจำ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            for (int __row = 0; __row < __advanceMoneyDetail.Rows.Count; __row++)
                            {

                                string __detail = string.Format("{0}:{1}", __advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._trans_number].ToString(), MyLib._myGlobal._convertDateFromQuery(__advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._doc_date_ref].ToString()).ToString("dd-MM-yyyy", new CultureInfo("th-TH")));
                                decimal __advanceAmount = MyLib._myGlobal._decimalPhase(__advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._amount].ToString());

                                this._printSlipText(__g, __width, __width, 0, __y, __detail, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __advanceAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                        }

                        // ส่วนลดท้ายบิล
                        if (__discountFooter != 0)
                        {
                            string __discountWord2 = _getResource("ส่วนลดพิเศษ", languageSelectIndex);
                            string __discountWord = __trans.Rows[0][_g.d.ic_trans._discount_word].ToString().Trim();
                            if (__discountWord.Length > 0)
                            {
                                __discountWord2 = __discountWord2 + " : " + __discountWord;
                            }
                            this._printSlipText(__g, __width, __width, 0, __y, __discountWord2, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __discountFooter.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __saveAmount += __discountFooter;
                            // คงเหลือ
                            __totalAmount -= __discountFooter;
                        }

                        //decimal __diffAmount = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._total_income_amount].ToString());
                        // ปัดเศษ
                        if (__diff_amount != 0)
                        {
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("ส่วนลดจากการปัดเศษ", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __diff_amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __saveAmount += (__diff_amount);
                            __totalAmount += (__diff_amount * -1);

                        }

                        if (__discountFooter != 0 || __diff_amount != 0)
                        {
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("คงเหลือยอดชำระ", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);

                        }

                        // ภาษีมูลค่าเพิ่ม
                        decimal __beforeVatAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_before_vat].ToString());
                        decimal __exceptVatAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_except_vat].ToString());
                        decimal __vatAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_vat_value].ToString());
                        decimal __vatRate = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._vat_rate].ToString());

                        // toe เพิ่ม option แสดงรายละเอียดภาษี
                        if (this._showTaxDetail && _g.g._companyProfile._vat_rate > 0)
                        {

                            __y += this._printSlipLine(__g, __width, __y);
                            // สินค้ายกเว้นภาษี
                            if (__exceptVatAmount != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("มูลค่าสินค้ายกเว้นภาษีมูลค่าเพิ่ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __exceptVatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                            //
                            if (__beforeVatAmount != 0 || __vatAmount != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("มูลค่าสินค้ามีภาษีมูลค่าเพิ่ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __beforeVatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                //
                                string __vatRateStr = (__vatRate == Math.Round(__vatRate, 0)) ? __vatRate.ToString(this._formatNumber2) : __vatRate.ToString(this._formatNumber1);
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ภาษีมูลค่าเพิ่ม", languageSelectIndex) + " : " + __vatRateStr + "%", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __vatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                        }
                        __y += this._printSlipLine(__g, __width, __y);
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("รวมเงิน", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                            SMLReport._formReport._moneyToText __moneyToText = new SMLReport._formReport._moneyToText();
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __moneyToText._toText(__totalAmount), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipLine(__g, __width, __y);
                        }
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างย่อ)
                        {
                            // ประหยัด
                            if (__saveAmount != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("คุณประหยัดครั้งนี้", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __saveAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                            __y += this._printSlipLine(__g, __width, __y);
                            // ยอดชำระ
                            //__payCash = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._pay_cash_amount].ToString());
                            if (__payCash != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระด้วยเงินสด", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __payCash.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                            if (__creditCardDetail != null)
                            {
                                for (int __row = 0; __row < __creditCardDetail.Rows.Count; __row++)
                                {
                                    decimal __creditCardTotalAmount = MyLib._myGlobal._decimalPhase(__creditCardDetail.Rows[__row][_g.d.cb_trans_detail._sum_amount].ToString());
                                    decimal __creditCardChargeAmount = MyLib._myGlobal._decimalPhase(__creditCardDetail.Rows[__row][_g.d.cb_trans_detail._charge].ToString());
                                    if (__creditCardTotalAmount != 0)
                                    {
                                        string __creditCardType = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._credit_card_type].ToString();
                                        string __creditCardNumber = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._trans_number].ToString();
                                        for (int __loop = 0; __loop < __creditCardNumber.Length - 4; __loop++)
                                        {
                                            __creditCardNumber = __creditCardNumber.Remove(__loop, 1);
                                            __creditCardNumber = __creditCardNumber.Insert(__loop, "*");
                                        }
                                        //
                                        this._printSlipText(__g, __width, __width, 0, __y, __creditCardType + " " + __creditCardNumber, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                        __y += this._printSlipText(__g, __width, __width, 0, __y, __creditCardTotalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                        //
                                        if (__creditCardChargeAmount != 0)
                                        {
                                            __y += this._printSlipText(__g, __width, __width, 10, __y, _getResource("Charge", languageSelectIndex) + " : " + __creditCardChargeAmount.ToString(this._formatNumber1) + " บาท", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Italic), SMLPOSControl._printSlipTextStyle.Left, false);
                                        }
                                        //
                                        string __creditCardApproved = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._no_approved].ToString();
                                        __y += this._printSlipText(__g, __width, __width, 10, __y, _getResource("Approval", languageSelectIndex) + " : " + __creditCardApproved, new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Italic), SMLPOSControl._printSlipTextStyle.Left, false);
                                    }
                                }
                            }

                            // ชำระด้วยคูปอง
                            //__payCoupon = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._coupon_amount].ToString());
                            if (__payCoupon != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระด้วยคูปอง", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __payCoupon.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                            // ชำระด้วยแต้ม
                            //__payPoint = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._point_amount].ToString());
                            if (__payPoint != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระด้วยแต้ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __payPoint.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                            // เงินทอน
                            //__moneyChange = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._money_change].ToString());
                            if (__moneyChange != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("เงินทอน", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __moneyChange.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                            //
                            __y += this._printSlipLine(__g, __width, __y);

                            // order detail
                            if ((MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro) && this._show_order_detail && (this._show_order_detail_copy_Only == false || (this._show_order_detail_copy_Only == true && header == "- สำเนา -")))
                            {
                                // order detail
                                for (int __orderRow = 0; __orderRow < __tableOrderDetail.Rows.Count; __orderRow++)
                                {
                                    __y += this._printSlipText(__g, __width, __width, 0, __y, "ใบสั่ง : " + __tableOrderDetail.Rows[__orderRow][_g.d.table_order_doc._doc_no].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                }

                                // order cancel
                                for (int __cancelRow = 0; __cancelRow < __tableOrderCancel.Rows.Count; __cancelRow++)
                                {
                                    decimal __cancelAmount = MyLib._myGlobal._decimalPhase(__tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._sum_amount].ToString());

                                    __y += this._printSlipText(__g, __width, __width, 0, __y, (__tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._cancel_flag].ToString().Equals("1") ? "ย้ายออก " + __tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._table_number_2].ToString() + " : " : "ยกเลิก : ") + __tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._item_name].ToString() + " " + __cancelAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                }
                                __y += this._printSlipLine(__g, __width, __y);

                            }
                        }
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างย่อ)
                        {
                            string __docNoAndTime = _getResource("เลขที่", languageSelectIndex) + ":" + __docNo + " " + _getResource("วันที่", languageSelectIndex) + ":" + __docDate + "@" + __trans.Rows[0][_g.d.ic_trans._doc_time].ToString();
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __docNoAndTime, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);

                            if (__currentPoint > 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("แต้มครั้งนี้", languageSelectIndex) + ":", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __currentPoint.ToString(this._formatNumber2), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                                SMLProcess._posProcess __process = new SMLProcess._posProcess();
                                decimal __currentPointBalance = __process._pointBalance(__cust_code, true);

                                // แต้มสะสม
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("แต้มสะสมถึง", languageSelectIndex) + " " + __docDate, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __currentPointBalance.ToString(this._formatNumber2), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                            }
                        }

                        //
                        if (this._showShortDescription && _g.g._companyProfile._vat_rate > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, "V=" + _getResource("สินค้ามีภาษีมูลค่าเพิ่ม", languageSelectIndex) + " " + "E=" + _getResource("สินค้ายกเว้นภาษี", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            //
                        }
                        string __saleCode = __trans.Rows[0][_g.d.ic_trans._sale_code].ToString();
                        string __cashierCode = __trans.Rows[0][_g.d.ic_trans._cashier_code].ToString();
                        if (__cashierCode.Equals(__saleCode) == false && mode == _printSlipMode.ใบกำกับภาษีอย่างย่อ)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("พนักงานขาย", languageSelectIndex) + " : " + __saleCode, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }
                        //
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            __y += 15f;
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ผู้รับเงิน", languageSelectIndex) + "................................................................" + __saleCode, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);

                            // remark
                            if (__trans.Rows[0][_g.d.ic_trans._remark].ToString().Length > 0)
                            {
                                __y += 15;
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("หมายเหตุ", languageSelectIndex) + " ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __trans.Rows[0][_g.d.ic_trans._remark].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                                __y += 15;
                            }

                        }
                        if (this._posFooter.Trim().Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, this._posFooter, new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }

                        #endregion

                    }
                    break;
                #endregion
                #region ใบเสร็จแบบที่ 3 บรรทัดแรก รายการ บรรทัดที่สอง ราคา จำนวน รวม
                case 3:
                    {

                        #region ส่วนหัว แสดงข้อมูลบริษัท

                        if (this._posHeader.Trim().Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, this._posHeader, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false, true);
                        }
                        else
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __ltdName, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __ltdAddress, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            string __telephone = "";
                            if (__ltdTel.Trim().Length > 0)
                            {
                                __telephone = _getResource("โทรศัพท์", languageSelectIndex) + ":" + __ltdTel.Trim();
                            }
                            if (__ltdFax.Trim().Length > 0)
                            {
                                __telephone = __telephone + " " + _getResource("โทรสาร", languageSelectIndex) + ":" + __ltdFax.Trim();
                            }
                            if (__telephone.Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __telephone, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            }

                            //
                            if (__ltdTax != null && __ltdTax.Trim().Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขประจำตัวผู้เสียภาษีอากร", languageSelectIndex) + " : " + __ltdTax, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            }
                        }

                        #endregion

                        #region ส่วนหัว แสดงข้อมูล เครือง POS และลูกค้า

                        // ข้อความเพิ่มเติม
                        if (header.Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource(header, languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Center, false);
                        }
                        __y += this._fontHeaderSize;

                        // ย้ายไปข้างบน
                        //if (_posBillType.Length > 0)
                        //{
                        //    headerSlip = _posBillType;
                        //}

                        __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource(headerSlip, languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Center, false);
                        __y += this._fontHeaderSize;
                        this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขเครื่อง", languageSelectIndex) + " : " + __trans.Rows[0]["pos_id_desc"].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        string __cashierName = "";
                        try
                        {
                            __cashierName = __trans.Rows[0]["cashier_name"].ToString().Split(' ')[0].ToString().Trim();
                        }
                        catch
                        {
                        }
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            __cashierName = __trans.Rows[0][_g.d.ic_trans._cashier_code].ToString();
                        }

                        __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("พนักงาน", languageSelectIndex) + " : " + __cashierName, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                        if (header.IndexOf("ยกเลิก") != -1)
                        {
                            string __cancelDocNo = __trans.Rows[0]["cancel_doc_no"].ToString();
                            string __cancelDocDate = MyLib._myGlobal._convertDateFromQuery(__trans.Rows[0]["cancel_doc_date"].ToString()).ToString("dd-MM-yyyy", new CultureInfo("th-TH"));

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขที่เอกสารยกเลิก", languageSelectIndex) + ":" + __cancelDocNo, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("วันที่", languageSelectIndex) + ":" + __cancelDocDate, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }
                        // เลขที่เอกสาร วันที่ เวลา
                        string __docDate = MyLib._myGlobal._convertDateFromQuery(__trans.Rows[0][_g.d.ic_trans._doc_date].ToString()).ToString("dd-MM-yyyy", new CultureInfo("th-TH"));
                        string __docNo = __trans.Rows[0][_g.d.ic_trans._doc_no].ToString();
                        string __docRefNo = __trans.Rows[0][_g.d.ic_trans._doc_ref].ToString();
                        __docGuid = __trans.Rows[0][_g.d.ic_trans._doc_no_guid].ToString().Trim();
                        //
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขที่", languageSelectIndex) + ":" + __docNo, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขที่อ้างอิง", languageSelectIndex) + ":" + __docRefNo, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("วันที่", languageSelectIndex) + ":" + __docDate + "@" + __trans.Rows[0][_g.d.ic_trans._doc_time].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ลูกค้า", languageSelectIndex) + " : " + __memberName, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขประจำตัวผู้เสียภาษี", languageSelectIndex) + " : " + __cust_taxid, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, ((__branch_type == "1") ? " [   ] " + __headquatreStr + " [ x ] " + __branchStr + " " + __branch_code : " [ x ] " + __headquatreStr + " [   ] " + __branchStr), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ที่อยู่", languageSelectIndex) + " : " + __memberAddress, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                        }
                        else
                        {
                            if (__memberCode.Trim().Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("สมาชิก", languageSelectIndex) + " : " + __memberName + " (" + __memberCode + ")", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            }

                            // พิมพ์โต๊ะ
                            if (__tableNumberStr.Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("หมายเลขโต๊ะ", languageSelectIndex) + " : " + __tableNumberStr, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            }

                            if ((MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro) && __table_trans.Rows.Count > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เวลาเข้า", languageSelectIndex) + " : " + __table_trans.Rows[0][_g.d.table_trans._open_doc_time].ToString() + " " + _getResource("เวลาออก", languageSelectIndex) + " : " + __table_trans.Rows[0][_g.d.table_trans._close_doc_time].ToString(), new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Left, false);

                            }

                        }

                        if (__customer_phone.Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __customer_phone, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }

                        __y += this._printSlipLine(__g, __width, __y);

                        #endregion

                        #region รายการสินค้า

                        int __transCount = 0;
                        decimal __itemQtyCount = 0;
                        decimal __saveAmount = 0;
                        decimal __sumFood = 0M;
                        decimal __sumDrink = 0M;

                        for (int __row = 0; __row < __transDetail.Rows.Count; __row++)
                        {
                            DataRow __data = __transDetail.Rows[__row];

                            if (__data[_g.d.ic_trans_detail._item_type].ToString().Equals("3"))
                            {
                                // สินค้าชุด ข้ามไป
                                continue;
                            }

                            decimal __amount = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._sum_amount].ToString());

                            if (MyLib._myGlobal._decimalPhase(__data[_g.d.ic_inventory_barcode._hidden_text].ToString()) == 0)
                            {
                                __transCount++;

                                decimal __price = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._price].ToString());
                                decimal __qty = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._qty].ToString());
                                decimal __priceDefault = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._price_default].ToString());
                                __itemQtyCount += __qty;
                                string __discountWord = __data[_g.d.ic_trans_detail._discount].ToString();
                                string __priceInfo = __data[_g.d.ic_trans_detail._remark].ToString();
                                decimal __discountAmount = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._discount_amount].ToString());
                                // มูลค่าสินค้า+vat
                                string __extraWord = "";
                                int __taxType = (int)MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._tax_type].ToString());
                                string __qtyStr = (__qty == Math.Round(__qty, 0)) ? __qty.ToString(this._formatNumber2) : __qty.ToString(this._formatNumber1);

                                // toe แก้ extraword case 0 = สินค้ามี Vat                         
                                switch (__taxType)
                                {
                                    case 0:
                                        __extraWord = "V";
                                        break;
                                }


                                // ชื่อสินค้า
                                StringBuilder __detail = new StringBuilder();
                                if (languageSelectIndex == 0)
                                {
                                    __detail.Append(__data[_g.d.ic_trans_detail._item_name].ToString().Trim());
                                }
                                else
                                {
                                    string __itemNameEn = __data[_g.d.ic_trans_detail._item_name_en].ToString().Trim();
                                    if (__itemNameEn.Length > 0)
                                    {
                                        __detail.Append(__itemNameEn);
                                    }
                                    else
                                    {
                                        __detail.Append(__data[_g.d.ic_trans_detail._item_name].ToString().Trim());
                                    }
                                }

                                float __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, __detail.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);

                                __y += __lineHeight;
                                if (__serialNumberTable != null && __serialNumberTable.Rows.Count > 0)
                                {
                                    // Serial Number
                                    DataRow[] __serial = __serialNumberTable.Select(_g.d.ic_trans_serial_number._doc_line_number + "=\'" + (__row).ToString() + "\'");
                                    for (int __serialLoop = 0; __serialLoop < __serial.Length; __serialLoop++)
                                    {
                                        __y += this._printSlipText(__g, __width, __width, 0, __y, "S/N:" + __serial[__serialLoop][_g.d.ic_trans_serial_number._serial_number].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                    }
                                }


                                if (__discountAmount != 0)
                                {
                                    __saveAmount += __discountAmount;
                                }

                                StringBuilder __priceQtyStr = new StringBuilder();
                                __priceQtyStr.Append(__price.ToString(this._formatNumber1) + " X " + __qtyStr + ((__discountAmount != 0) ? " ลด " + __discountAmount.ToString(this._formatNumber1) : ""));
                                //  ราคา จำนวน รวม
                                float _qtyLineHeight = this._printSlipText(__g, __width, __width, 0, __y, __priceQtyStr.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);

                                // จำนวน
                                //this._printSlipText(__g, __width - 160, __width - 150, 0, __y, __qtyStr, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                                this._printSlipText(__g, __width - 15, __width - 10, 0, __y, __amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                                if (this._showTaxDetail && _g.g._companyProfile._vat_rate > 0)
                                {
                                    this._printSlipText(__g, __width, __width, 0, __y, __extraWord, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                }

                                __y += _qtyLineHeight;
                            }

                            if (__data[_g.d.ic_inventory._drink_type].ToString().Equals("1"))
                            {
                                __sumDrink += __amount;
                            }
                            else
                            {
                                __sumFood += __amount;
                            }
                        }

                        #endregion

                        #region รายการ promotion
                        for (int __row = 0; __row < __transDetailPromotion.Rows.Count; __row++)
                        {
                            DataRow __data = __transDetailPromotion.Rows[__row];
                            decimal __amount = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail_promotion._sum_amount].ToString());

                            //__transCount++;
                            decimal __price = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail_promotion._price].ToString());
                            decimal __qty = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail_promotion._qty].ToString());

                            //__itemQtyCount += __qty;

                            StringBuilder __detail = new StringBuilder();
                            __detail.Append(__data[_g.d.ic_trans_detail_promotion._promotion_name].ToString().Trim());

                            float __lineHeight = this._printSlipText(__g, __width, __width * 0.8f, 0, __y, __detail.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                            // ราคาสามาชิก
                            //if (__memberCode.Trim().Length > 0)
                            //{
                            //    decimal __newPrice = __amount / __qty;
                            //    string __qtyStr = (__qty == Math.Round(__qty, 0)) ? __qty.ToString(this._formatNumber2) : __qty.ToString(this._formatNumber1);
                            //    string __priceStr = __newPrice.ToString(this._formatNumber1);
                            //    StringBuilder __memberPrice = new StringBuilder("ราคาสมาชิก" + " " + "@" + __priceStr);
                            //    if (__qty > 1)
                            //    {
                            //        __memberPrice.Append("x");
                            //        __memberPrice.Append(__qtyStr);
                            //    }
                            //    __y += __lineHeight;
                            //    __lineHeight = this._printSlipText(__g, __width, __width, 5, __y, __memberPrice.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            //}
                            // ส่วนลด
                            //if (__discountAmount != 0)
                            //{
                            //    //StringBuilder __discountStr = new StringBuilder("ราคาปรกติ" + " : " + __priceDefault.ToString(this._formatNumber1) + " " + "บาท");
                            //    //__y += this._printSlipText(__g, __width, __width, 5, __y, __discountStr.ToString(), new Font(this._fontDetailName, this._fontDetailSize * 0.8f), SMLPOSControl._printSlipTextStyle.Left);
                            //    __saveAmount += __discountAmount;
                            //    /*StringBuilder __discountStr = new StringBuilder();
                            //    __discountStr.Append(__priceInfo + " " + "ลด");
                            //    __discountStr.Append(" " + __discountAmount.ToString(this._formatNumber1) + " " + "บาท");
                            //    if (__priceDefault != 0)
                            //    {
                            //        __discountStr.Append(" " + "จาก" + " " + __priceDefault.ToString(this._formatNumber1) + " " + "บาท");
                            //    }
                            //    __y += this._printSlipText(__g, __width, __width, 5, __y, __discountStr.ToString(), new Font(this._fontDetailName, this._fontDetailSize * 0.8f), SMLPOSControl._printSlipTextStyle.Left);
                            //    __saveAmount += __discountAmount;
                            //     */
                            //}
                            this._printSlipText(__g, __width - 15, __width - 10, 0, __y, __amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                            //if (this._showTaxDetail)
                            //{
                            //    this._printSlipText(__g, __width, __width, 0, __y, __extraWord, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            //}
                            __y += __lineHeight;

                        }

                        #endregion

                        #region ส่วนท้ายบิล

                        decimal __discountFooter = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_discount].ToString());
                        decimal __serviceChargeAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_service_charge].ToString());

                        decimal __total_value = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_value].ToString());
                        // ท้ายบิล
                        __totalAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_amount].ToString()) + __discountFooter + __totalAdvanceMoney;
                        __y += this._printSlipLine(__g, __width, __y);
                        string __footer1 = __transCount.ToString() + " " + _getResource("รายการ", languageSelectIndex) + " " + __itemQtyCount.ToString(this._formatNumber1) + " " + _getResource("ชิ้น", languageSelectIndex);
                        this._printSlipText(__g, __width, __width, 0, __y, __footer1, new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                        __y += this._printSlipText(__g, __width, __width, 0, __y, __total_value.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);

                        // tomyumgoong ยอดอาหาร เครื่องดิ่ม
                        if (MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro)
                        {
                            float __lineHeight = 0;

                            if (__serviceChargeAmount > 0)
                            {
                                string __serviceChargeText = __trans.Rows[0][_g.d.ic_trans._service_charge_word].ToString();
                                __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("Service Charge", languageSelectIndex) + " " + ((__serviceChargeText.IndexOf("%") != -1) ? __serviceChargeText : ""), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                this._printSlipText(__g, __width, __width, 0, __y, __serviceChargeAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                __y += __lineHeight;
                            }

                            __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("อาหาร", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            this._printSlipText(__g, __width, __width, 0, __y, __sumFood.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += __lineHeight;

                            __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("เครื่องดื่ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            this._printSlipText(__g, __width, __width, 0, __y, __sumDrink.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += __lineHeight;

                            __y += this._printSlipLine(__g, __width, __y);
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("รวมทั้งสิ้น", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += this._printSlipLine(__g, __width, __y);

                        }

                        // เงินมัดจำ
                        if (__totalAdvanceMoney > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, "เงินมัดจำ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            for (int __row = 0; __row < __advanceMoneyDetail.Rows.Count; __row++)
                            {

                                string __detail = string.Format("{0}:{1}", __advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._trans_number].ToString(), MyLib._myGlobal._convertDateFromQuery(__advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._doc_date_ref].ToString()).ToString("dd-MM-yyyy", new CultureInfo("th-TH")));
                                decimal __advanceAmount = MyLib._myGlobal._decimalPhase(__advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._amount].ToString());

                                this._printSlipText(__g, __width, __width, 0, __y, __detail, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __advanceAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                        }

                        // ส่วนลดท้ายบิล
                        if (__discountFooter != 0)
                        {
                            string __discountWord2 = _getResource("ส่วนลดพิเศษ", languageSelectIndex);
                            string __discountWord = __trans.Rows[0][_g.d.ic_trans._discount_word].ToString().Trim();
                            if (__discountWord.Length > 0)
                            {
                                __discountWord2 = __discountWord2 + " : " + __discountWord;
                            }
                            this._printSlipText(__g, __width, __width, 0, __y, __discountWord2, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __discountFooter.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __saveAmount += __discountFooter;
                            // คงเหลือ
                            __totalAmount -= __discountFooter;
                        }

                        //decimal __diffAmount = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._total_income_amount].ToString());
                        // ปัดเศษ
                        if (__diff_amount != 0)
                        {
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("ส่วนลดจากการปัดเศษ", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __diff_amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __saveAmount += (__diff_amount);
                            __totalAmount += (__diff_amount * -1);

                        }

                        if (__discountFooter != 0 || __diff_amount != 0)
                        {
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("คงเหลือยอดชำระ", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);

                        }

                        // ภาษีมูลค่าเพิ่ม
                        decimal __beforeVatAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_before_vat].ToString());
                        decimal __exceptVatAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_except_vat].ToString());
                        decimal __vatAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_vat_value].ToString());
                        decimal __vatRate = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._vat_rate].ToString());

                        // toe เพิ่ม option แสดงรายละเอียดภาษี
                        if (this._showTaxDetail && _g.g._companyProfile._vat_rate > 0)
                        {

                            __y += this._printSlipLine(__g, __width, __y);
                            // สินค้ายกเว้นภาษี
                            if (__exceptVatAmount != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("มูลค่าสินค้ายกเว้นภาษีมูลค่าเพิ่ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __exceptVatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                            //
                            if (__beforeVatAmount != 0 || __vatAmount != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("มูลค่าสินค้ามีภาษีมูลค่าเพิ่ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __beforeVatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                //
                                string __vatRateStr = (__vatRate == Math.Round(__vatRate, 0)) ? __vatRate.ToString(this._formatNumber2) : __vatRate.ToString(this._formatNumber1);
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ภาษีมูลค่าเพิ่ม", languageSelectIndex) + " : " + __vatRateStr + "%", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __vatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                        }
                        __y += this._printSlipLine(__g, __width, __y);
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("รวมเงิน", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                            SMLReport._formReport._moneyToText __moneyToText = new SMLReport._formReport._moneyToText();
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __moneyToText._toText(__totalAmount), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipLine(__g, __width, __y);
                        }
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างย่อ)
                        {
                            // ประหยัด
                            if (__saveAmount != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("คุณประหยัดครั้งนี้", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __saveAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                            __y += this._printSlipLine(__g, __width, __y);
                            // ยอดชำระ
                            //__payCash = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._pay_cash_amount].ToString());
                            if (__payCash != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระด้วยเงินสด", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __payCash.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                            if (__creditCardDetail != null)
                            {
                                for (int __row = 0; __row < __creditCardDetail.Rows.Count; __row++)
                                {
                                    decimal __creditCardTotalAmount = MyLib._myGlobal._decimalPhase(__creditCardDetail.Rows[__row][_g.d.cb_trans_detail._sum_amount].ToString());
                                    decimal __creditCardChargeAmount = MyLib._myGlobal._decimalPhase(__creditCardDetail.Rows[__row][_g.d.cb_trans_detail._charge].ToString());
                                    if (__creditCardTotalAmount != 0)
                                    {
                                        string __creditCardType = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._credit_card_type].ToString();
                                        string __creditCardNumber = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._trans_number].ToString();
                                        for (int __loop = 0; __loop < __creditCardNumber.Length - 4; __loop++)
                                        {
                                            __creditCardNumber = __creditCardNumber.Remove(__loop, 1);
                                            __creditCardNumber = __creditCardNumber.Insert(__loop, "*");
                                        }
                                        //
                                        this._printSlipText(__g, __width, __width, 0, __y, __creditCardType + " " + __creditCardNumber, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                        __y += this._printSlipText(__g, __width, __width, 0, __y, __creditCardTotalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                        //
                                        if (__creditCardChargeAmount != 0)
                                        {
                                            __y += this._printSlipText(__g, __width, __width, 10, __y, _getResource("Charge", languageSelectIndex) + " : " + __creditCardChargeAmount.ToString(this._formatNumber1) + " บาท", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Italic), SMLPOSControl._printSlipTextStyle.Left, false);
                                        }
                                        //
                                        string __creditCardApproved = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._no_approved].ToString();
                                        __y += this._printSlipText(__g, __width, __width, 10, __y, _getResource("Approval", languageSelectIndex) + " : " + __creditCardApproved, new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Italic), SMLPOSControl._printSlipTextStyle.Left, false);
                                    }
                                }
                            }

                            // ชำระด้วยคูปอง
                            //__payCoupon = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._coupon_amount].ToString());
                            if (__payCoupon != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระด้วยคูปอง", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __payCoupon.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                            // ชำระด้วยแต้ม
                            //__payPoint = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._point_amount].ToString());
                            if (__payPoint != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระด้วยแต้ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __payPoint.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                            // เงินทอน
                            //__moneyChange = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._money_change].ToString());
                            if (__moneyChange != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("เงินทอน", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __moneyChange.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                            //
                            __y += this._printSlipLine(__g, __width, __y);

                            // order detail
                            if ((MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro) && this._show_order_detail && (this._show_order_detail_copy_Only == false || (this._show_order_detail_copy_Only == true && header == "- สำเนา -")))
                            {
                                // order detail
                                for (int __orderRow = 0; __orderRow < __tableOrderDetail.Rows.Count; __orderRow++)
                                {
                                    __y += this._printSlipText(__g, __width, __width, 0, __y, "ใบสั่ง : " + __tableOrderDetail.Rows[__orderRow][_g.d.table_order_doc._doc_no].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                }

                                // order cancel
                                for (int __cancelRow = 0; __cancelRow < __tableOrderCancel.Rows.Count; __cancelRow++)
                                {
                                    decimal __cancelAmount = MyLib._myGlobal._decimalPhase(__tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._sum_amount].ToString());

                                    __y += this._printSlipText(__g, __width, __width, 0, __y, (__tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._cancel_flag].ToString().Equals("1") ? "ย้ายออก " + __tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._table_number_2].ToString() + " : " : "ยกเลิก : ") + __tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._item_name].ToString() + " " + __cancelAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                }
                                __y += this._printSlipLine(__g, __width, __y);

                            }
                        }
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างย่อ)
                        {
                            string __docNoAndTime = _getResource("เลขที่", languageSelectIndex) + ":" + __docNo;
                            string __docTime = _getResource("วันที่", languageSelectIndex) + ":" + __docDate + "@" + __trans.Rows[0][_g.d.ic_trans._doc_time].ToString();

                            __y += this._printSlipText(__g, __width, __width, 0, __y, __docNoAndTime, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __docTime, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);

                            if (__currentPoint > 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("แต้มครั้งนี้", languageSelectIndex) + ":", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __currentPoint.ToString(this._formatNumber2), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                                SMLProcess._posProcess __process = new SMLProcess._posProcess();
                                decimal __currentPointBalance = __process._pointBalance(__cust_code, true);

                                // แต้มสะสม
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("แต้มสะสมถึง", languageSelectIndex) + " " + __docDate, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __currentPointBalance.ToString(this._formatNumber2), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                            }

                        }

                        //
                        if (this._showShortDescription && _g.g._companyProfile._vat_rate > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, "V=" + _getResource("สินค้ามีภาษีมูลค่าเพิ่ม", languageSelectIndex) + " " + "E=" + _getResource("สินค้ายกเว้นภาษี", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            //
                        }
                        string __saleCode = __trans.Rows[0][_g.d.ic_trans._sale_code].ToString();
                        string __cashierCode = __trans.Rows[0][_g.d.ic_trans._cashier_code].ToString();
                        if (__cashierCode.Equals(__saleCode) == false && mode == _printSlipMode.ใบกำกับภาษีอย่างย่อ)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("พนักงานขาย", languageSelectIndex) + " : " + __saleCode, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }
                        //
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            __y += 15f;
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ผู้รับเงิน", languageSelectIndex) + "................................................................" + __saleCode, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);

                            // remark
                            if (__trans.Rows[0][_g.d.ic_trans._remark].ToString().Length > 0)
                            {
                                __y += 15;
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("หมายเหตุ", languageSelectIndex) + " ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __trans.Rows[0][_g.d.ic_trans._remark].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                                __y += 15;
                            }

                        }
                        if (this._posFooter.Trim().Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, this._posFooter, new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }

                        #endregion

                    }
                    break;
                #endregion
                #region ใบเสร็จแบบที่ 4 บรรทัดแรก รายการ บรรทัดที่สอง ราคา x จำนวน หน่วย รวม
                case 4:
                    {

                        #region ส่วนหัว แสดงข้อมูลบริษัท

                        if (this._posHeader.Trim().Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, this._posHeader, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false, true);
                        }
                        else
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __ltdName, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __ltdAddress, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            string __telephone = "";
                            if (__ltdTel.Trim().Length > 0)
                            {
                                __telephone = _getResource("โทรศัพท์", languageSelectIndex) + ":" + __ltdTel.Trim();
                            }
                            if (__ltdFax.Trim().Length > 0)
                            {
                                __telephone = __telephone + " " + _getResource("โทรสาร", languageSelectIndex) + ":" + __ltdFax.Trim();
                            }
                            if (__telephone.Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __telephone, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            }

                            //
                            if (__ltdTax != null && __ltdTax.Trim().Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขประจำตัวผู้เสียภาษีอากร", languageSelectIndex) + " : " + __ltdTax, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            }
                        }

                        #endregion

                        #region ส่วนหัว แสดงข้อมูล เครือง POS และลูกค้า

                        // ข้อความเพิ่มเติม
                        if (header.Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource(header, languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Center, false);
                        }
                        __y += this._fontHeaderSize;

                        // ย้ายไปข้างบน
                        //if (_posBillType.Length > 0)
                        //{
                        //    headerSlip = _posBillType;
                        //}

                        __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource(headerSlip, languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Center, false);
                        __y += this._fontHeaderSize;
                        this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขเครื่อง", languageSelectIndex) + " : " + __trans.Rows[0]["pos_id_desc"].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        string __cashierName = "";
                        try
                        {
                            __cashierName = __trans.Rows[0]["cashier_name"].ToString().Split(' ')[0].ToString().Trim();
                        }
                        catch
                        {
                        }
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            __cashierName = __trans.Rows[0][_g.d.ic_trans._cashier_code].ToString();
                        }

                        __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("พนักงาน", languageSelectIndex) + " : " + __cashierName, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                        if (header.IndexOf("ยกเลิก") != -1)
                        {
                            string __cancelDocNo = __trans.Rows[0]["cancel_doc_no"].ToString();
                            string __cancelDocDate = MyLib._myGlobal._convertDateFromQuery(__trans.Rows[0]["cancel_doc_date"].ToString()).ToString("dd-MM-yyyy", new CultureInfo("th-TH"));

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขที่เอกสารยกเลิก", languageSelectIndex) + ":" + __cancelDocNo, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("วันที่", languageSelectIndex) + ":" + __cancelDocDate, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }

                        // เลขที่เอกสาร วันที่ เวลา
                        string __docDate = MyLib._myGlobal._convertDateFromQuery(__trans.Rows[0][_g.d.ic_trans._doc_date].ToString()).ToString("dd-MM-yyyy", new CultureInfo("th-TH"));
                        string __docNo = __trans.Rows[0][_g.d.ic_trans._doc_no].ToString();
                        string __docRefNo = __trans.Rows[0][_g.d.ic_trans._doc_ref].ToString();
                        __docGuid = __trans.Rows[0][_g.d.ic_trans._doc_no_guid].ToString().Trim();
                        //
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขที่", languageSelectIndex) + ":" + __docNo, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขที่อ้างอิง", languageSelectIndex) + ":" + __docRefNo, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("วันที่", languageSelectIndex) + ":" + __docDate + "@" + __trans.Rows[0][_g.d.ic_trans._doc_time].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ลูกค้า", languageSelectIndex) + " : " + __memberName, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขประจำตัวผู้เสียภาษี", languageSelectIndex) + " : " + __cust_taxid, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, ((__branch_type == "1") ? " [   ] " + __headquatreStr + " [ x ] " + __branchStr + " " + __branch_code : " [ x ] " + __headquatreStr + " [   ] " + __branchStr), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ที่อยู่", languageSelectIndex) + " : " + __memberAddress, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                        }
                        else
                        {
                            if (__memberCode.Trim().Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("สมาชิก", languageSelectIndex) + " : " + __memberName + " (" + __memberCode + ")", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            }

                            // พิมพ์โต๊ะ
                            if (__tableNumberStr.Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("หมายเลขโต๊ะ", languageSelectIndex) + " : " + __tableNumberStr, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            }

                            if ((MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro) && __table_trans.Rows.Count > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เวลาเข้า", languageSelectIndex) + " : " + __table_trans.Rows[0][_g.d.table_trans._open_doc_time].ToString() + " " + _getResource("เวลาออก", languageSelectIndex) + " : " + __table_trans.Rows[0][_g.d.table_trans._close_doc_time].ToString(), new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Left, false);

                            }

                        }

                        if (__customer_phone.Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __customer_phone, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }

                        __y += this._printSlipLine(__g, __width, __y);

                        #endregion

                        #region รายการสินค้า

                        int __transCount = 0;
                        decimal __itemQtyCount = 0;
                        decimal __saveAmount = 0;
                        decimal __sumFood = 0M;
                        decimal __sumDrink = 0M;

                        for (int __row = 0; __row < __transDetail.Rows.Count; __row++)
                        {
                            DataRow __data = __transDetail.Rows[__row];
                            if (__data[_g.d.ic_trans_detail._item_type].ToString().Equals("3"))
                            {
                                // สินค้าชุด ข้ามไป
                                continue;
                            }

                            decimal __amount = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._sum_amount].ToString());

                            if (MyLib._myGlobal._decimalPhase(__data[_g.d.ic_inventory_barcode._hidden_text].ToString()) == 0)
                            {
                                __transCount++;

                                decimal __price = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._price].ToString());
                                decimal __qty = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._qty].ToString());
                                decimal __priceDefault = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._price_default].ToString());
                                __itemQtyCount += __qty;
                                string __discountWord = __data[_g.d.ic_trans_detail._discount].ToString();
                                string __priceInfo = __data[_g.d.ic_trans_detail._remark].ToString();
                                decimal __discountAmount = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._discount_amount].ToString());
                                // มูลค่าสินค้า+vat
                                string __extraWord = "";
                                int __taxType = (int)MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._tax_type].ToString());
                                string __qtyStr = (__qty == Math.Round(__qty, 0)) ? __qty.ToString(this._formatNumber2) : __qty.ToString(this._formatNumber1);
                                string _unit_name = __data[_g.d.ic_trans_detail._unit_name].ToString();

                                if (languageSelectIndex > 0)
                                {
                                    string __unit_name_en = __data[_g.d.ic_trans_detail._unit_name_en].ToString();

                                    if (__unit_name_en.Length > 0)
                                    {
                                        _unit_name = __unit_name_en;
                                    }
                                }


                                // toe แก้ extraword case 0 = สินค้ามี Vat                         
                                switch (__taxType)
                                {
                                    case 0:
                                        __extraWord = "V";
                                        break;
                                }


                                // ชื่อสินค้า
                                StringBuilder __detail = new StringBuilder();
                                if (languageSelectIndex == 0)
                                {
                                    __detail.Append(__data[_g.d.ic_trans_detail._item_name].ToString().Trim());
                                }
                                else
                                {
                                    string __itemNameEn = __data[_g.d.ic_trans_detail._item_name_en].ToString().Trim();
                                    if (__itemNameEn.Length > 0)
                                    {
                                        __detail.Append(__itemNameEn);
                                    }
                                    else
                                    {
                                        __detail.Append(__data[_g.d.ic_trans_detail._item_name].ToString().Trim());
                                    }
                                }


                                float __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, __detail.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);

                                __y += __lineHeight;
                                if (__serialNumberTable != null && __serialNumberTable.Rows.Count > 0)
                                {
                                    // Serial Number
                                    DataRow[] __serial = __serialNumberTable.Select(_g.d.ic_trans_serial_number._doc_line_number + "=\'" + (__row).ToString() + "\'");
                                    for (int __serialLoop = 0; __serialLoop < __serial.Length; __serialLoop++)
                                    {
                                        __y += this._printSlipText(__g, __width, __width, 0, __y, "S/N:" + __serial[__serialLoop][_g.d.ic_trans_serial_number._serial_number].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                    }
                                }


                                if (__discountAmount != 0)
                                {
                                    __saveAmount += __discountAmount;
                                }

                                StringBuilder __priceQtyStr = new StringBuilder();
                                __priceQtyStr.Append(__price.ToString(this._formatNumber1) + " X " + __qtyStr + " " + _unit_name + ((__discountAmount != 0) ? " " + _getResource("ลด", languageSelectIndex) + " " + __discountAmount.ToString(this._formatNumber1) : ""));
                                //  ราคา จำนวน รวม
                                float _qtyLineHeight = this._printSlipText(__g, __width, __width, 0, __y, __priceQtyStr.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);

                                // จำนวน
                                //this._printSlipText(__g, __width - 160, __width - 150, 0, __y, __qtyStr, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                                this._printSlipText(__g, __width - 15, __width - 10, 0, __y, __amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                                if (this._showTaxDetail && _g.g._companyProfile._vat_rate > 0)
                                {
                                    this._printSlipText(__g, __width, __width, 0, __y, __extraWord, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                }

                                __y += _qtyLineHeight;
                            }

                            if (__data[_g.d.ic_inventory._drink_type].ToString().Equals("1"))
                            {
                                __sumDrink += __amount;
                            }
                            else
                            {
                                __sumFood += __amount;
                            }
                        }

                        #endregion

                        #region รายการ promotion
                        for (int __row = 0; __row < __transDetailPromotion.Rows.Count; __row++)
                        {
                            DataRow __data = __transDetailPromotion.Rows[__row];
                            decimal __amount = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail_promotion._sum_amount].ToString());

                            //__transCount++;
                            decimal __price = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail_promotion._price].ToString());
                            decimal __qty = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail_promotion._qty].ToString());

                            //__itemQtyCount += __qty;

                            StringBuilder __detail = new StringBuilder();
                            __detail.Append(__data[_g.d.ic_trans_detail_promotion._promotion_name].ToString().Trim());

                            float __lineHeight = this._printSlipText(__g, __width, __width * 0.8f, 0, __y, __detail.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                            this._printSlipText(__g, __width - 15, __width - 10, 0, __y, __amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                            __y += __lineHeight;

                        }

                        #endregion

                        #region ส่วนท้ายบิล

                        decimal __discountFooter = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_discount].ToString());
                        decimal __serviceChargeAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_service_charge].ToString());

                        // ท้ายบิล
                        __totalAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_amount].ToString()) + __discountFooter + __totalAdvanceMoney;
                        __y += this._printSlipLine(__g, __width, __y);
                        string __footer1 = __transCount.ToString() + " " + _getResource("รายการ", languageSelectIndex) + " " + __itemQtyCount.ToString("#,###.##") + " " + _getResource("ชิ้น", languageSelectIndex);
                        this._printSlipText(__g, __width, __width, 0, __y, __footer1, new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                        __y += this._printSlipText(__g, __width, __width, 0, __y, (__totalAmount - __serviceChargeAmount).ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);

                        // tomyumgoong ยอดอาหาร เครื่องดิ่ม
                        if (MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro)
                        {
                            float __lineHeight = 0;

                            if (__serviceChargeAmount > 0)
                            {
                                string __serviceChargeText = __trans.Rows[0][_g.d.ic_trans._service_charge_word].ToString();
                                __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("Service Charge", languageSelectIndex) + " " + ((__serviceChargeText.IndexOf("%") != -1) ? __serviceChargeText : ""), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                this._printSlipText(__g, __width, __width, 0, __y, __serviceChargeAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                __y += __lineHeight;
                            }

                            __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("อาหาร", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            this._printSlipText(__g, __width, __width, 0, __y, __sumFood.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += __lineHeight;

                            __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("เครื่องดื่ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            this._printSlipText(__g, __width, __width, 0, __y, __sumDrink.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += __lineHeight;

                            __y += this._printSlipLine(__g, __width, __y);
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("รวมทั้งสิ้น", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += this._printSlipLine(__g, __width, __y);


                        }

                        // เงินมัดจำ
                        if (__totalAdvanceMoney > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, "เงินมัดจำ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            for (int __row = 0; __row < __advanceMoneyDetail.Rows.Count; __row++)
                            {

                                string __detail = string.Format("{0}:{1}", __advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._trans_number].ToString(), MyLib._myGlobal._convertDateFromQuery(__advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._doc_date_ref].ToString()).ToString("dd-MM-yyyy", new CultureInfo("th-TH")));
                                decimal __advanceAmount = MyLib._myGlobal._decimalPhase(__advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._amount].ToString());

                                this._printSlipText(__g, __width, __width, 0, __y, __detail, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __advanceAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                        }

                        // ส่วนลดท้ายบิล
                        if (__discountFooter != 0)
                        {
                            string __discountWord2 = _getResource("ส่วนลดพิเศษ", languageSelectIndex);
                            string __discountWord = __trans.Rows[0][_g.d.ic_trans._discount_word].ToString().Trim();
                            if (__discountWord.Length > 0)
                            {
                                __discountWord2 = __discountWord2 + " : " + __discountWord;
                            }
                            this._printSlipText(__g, __width, __width, 0, __y, __discountWord2, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __discountFooter.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __saveAmount += __discountFooter;
                            // คงเหลือ
                            __totalAmount -= __discountFooter;
                        }

                        //decimal __diffAmount = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._total_income_amount].ToString());
                        // ปัดเศษ
                        if (__diff_amount != 0)
                        {
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("ส่วนลดจากการปัดเศษ", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __diff_amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __saveAmount += (__diff_amount);
                            __totalAmount += (__diff_amount * -1);
                        }

                        if (__discountFooter != 0 || __diff_amount != 0)
                        {
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("คงเหลือยอดชำระ", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                        }

                        // ภาษีมูลค่าเพิ่ม
                        decimal __beforeVatAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_before_vat].ToString());
                        decimal __exceptVatAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_except_vat].ToString());
                        decimal __vatAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_vat_value].ToString());
                        decimal __vatRate = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._vat_rate].ToString());

                        // toe เพิ่ม option แสดงรายละเอียดภาษี
                        if (this._showTaxDetail && _g.g._companyProfile._vat_rate > 0)
                        {

                            __y += this._printSlipLine(__g, __width, __y);
                            // สินค้ายกเว้นภาษี
                            if (__exceptVatAmount != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("มูลค่าสินค้ายกเว้นภาษีมูลค่าเพิ่ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __exceptVatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                            //
                            if (__beforeVatAmount != 0 || __vatAmount != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("มูลค่าสินค้ามีภาษีมูลค่าเพิ่ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __beforeVatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                //
                                string __vatRateStr = (__vatRate == Math.Round(__vatRate, 0)) ? __vatRate.ToString(this._formatNumber2) : __vatRate.ToString(this._formatNumber1);
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ภาษีมูลค่าเพิ่ม", languageSelectIndex) + " : " + __vatRateStr + "%", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __vatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                        }
                        __y += this._printSlipLine(__g, __width, __y);
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("รวมเงิน", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                            SMLReport._formReport._moneyToText __moneyToText = new SMLReport._formReport._moneyToText();
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __moneyToText._toText(__totalAmount), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipLine(__g, __width, __y);
                        }
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างย่อ)
                        {
                            // ประหยัด
                            if (__saveAmount != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("คุณประหยัดครั้งนี้", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __saveAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                            __y += this._printSlipLine(__g, __width, __y);
                            // ยอดชำระ
                            //__payCash = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._pay_cash_amount].ToString());
                            if (__payCash != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระด้วยเงินสด", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __payCash.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                            if (__creditCardDetail != null)
                            {
                                for (int __row = 0; __row < __creditCardDetail.Rows.Count; __row++)
                                {
                                    decimal __creditCardTotalAmount = MyLib._myGlobal._decimalPhase(__creditCardDetail.Rows[__row][_g.d.cb_trans_detail._sum_amount].ToString());
                                    decimal __creditCardChargeAmount = MyLib._myGlobal._decimalPhase(__creditCardDetail.Rows[__row][_g.d.cb_trans_detail._charge].ToString());
                                    if (__creditCardTotalAmount != 0)
                                    {
                                        string __creditCardType = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._credit_card_type].ToString();
                                        string __creditCardNumber = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._trans_number].ToString();
                                        for (int __loop = 0; __loop < __creditCardNumber.Length - 4; __loop++)
                                        {
                                            __creditCardNumber = __creditCardNumber.Remove(__loop, 1);
                                            __creditCardNumber = __creditCardNumber.Insert(__loop, "*");
                                        }
                                        //
                                        this._printSlipText(__g, __width, __width, 0, __y, __creditCardType + " " + __creditCardNumber, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                        __y += this._printSlipText(__g, __width, __width, 0, __y, __creditCardTotalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                        //
                                        if (__creditCardChargeAmount != 0)
                                        {
                                            __y += this._printSlipText(__g, __width, __width, 10, __y, _getResource("Charge", languageSelectIndex) + " : " + __creditCardChargeAmount.ToString(this._formatNumber1) + " บาท", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Italic), SMLPOSControl._printSlipTextStyle.Left, false);
                                        }
                                        //
                                        string __creditCardApproved = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._no_approved].ToString();
                                        __y += this._printSlipText(__g, __width, __width, 10, __y, _getResource("Approval", languageSelectIndex) + " : " + __creditCardApproved, new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Italic), SMLPOSControl._printSlipTextStyle.Left, false);
                                    }
                                }
                            }

                            // ชำระด้วยคูปอง
                            //__payCoupon = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._coupon_amount].ToString());
                            if (__payCoupon != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระด้วยคูปอง", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __payCoupon.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                            // ชำระด้วยแต้ม
                            //__payPoint = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._point_amount].ToString());
                            if (__payPoint != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระด้วยแต้ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __payPoint.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                            // เงินทอน
                            //__moneyChange = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._money_change].ToString());
                            if (__moneyChange != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("เงินทอน", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __moneyChange.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                            //
                            __y += this._printSlipLine(__g, __width, __y);

                            // order detail
                            if ((MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro) && this._show_order_detail && (this._show_order_detail_copy_Only == false || (this._show_order_detail_copy_Only == true && header == "- สำเนา -")))
                            {
                                // order detail
                                for (int __orderRow = 0; __orderRow < __tableOrderDetail.Rows.Count; __orderRow++)
                                {
                                    __y += this._printSlipText(__g, __width, __width, 0, __y, "ใบสั่ง : " + __tableOrderDetail.Rows[__orderRow][_g.d.table_order_doc._doc_no].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                }

                                // order cancel
                                for (int __cancelRow = 0; __cancelRow < __tableOrderCancel.Rows.Count; __cancelRow++)
                                {
                                    decimal __cancelAmount = MyLib._myGlobal._decimalPhase(__tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._sum_amount].ToString());

                                    __y += this._printSlipText(__g, __width, __width, 0, __y, (__tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._cancel_flag].ToString().Equals("1") ? "ย้ายออก " + __tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._table_number_2].ToString() + " : " : "ยกเลิก : ") + __tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._item_name].ToString() + " " + __cancelAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                }
                                __y += this._printSlipLine(__g, __width, __y);

                            }
                        }
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างย่อ)
                        {
                            string __docNoAndTime = _getResource("เลขที่", languageSelectIndex) + ":" + __docNo;
                            string __docTime = _getResource("วันที่", languageSelectIndex) + ":" + __docDate + "@" + __trans.Rows[0][_g.d.ic_trans._doc_time].ToString();

                            __y += this._printSlipText(__g, __width, __width, 0, __y, __docNoAndTime, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __docTime, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);

                            if (__currentPoint > 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("แต้มครั้งนี้", languageSelectIndex) + ":", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __currentPoint.ToString(this._formatNumber2), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                                SMLProcess._posProcess __process = new SMLProcess._posProcess();
                                decimal __currentPointBalance = __process._pointBalance(__cust_code, true);

                                // แต้มสะสม
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("แต้มสะสมถึง", languageSelectIndex) + " " + __docDate, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __currentPointBalance.ToString(this._formatNumber2), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                            }
                        }

                        //
                        if (this._showShortDescription && _g.g._companyProfile._vat_rate > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, "V=" + _getResource("สินค้ามีภาษีมูลค่าเพิ่ม", languageSelectIndex) + " " + "E=" + _getResource("สินค้ายกเว้นภาษี", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            //
                        }
                        string __saleCode = __trans.Rows[0][_g.d.ic_trans._sale_code].ToString();
                        string __cashierCode = __trans.Rows[0][_g.d.ic_trans._cashier_code].ToString();
                        if (__cashierCode.Equals(__saleCode) == false && mode == _printSlipMode.ใบกำกับภาษีอย่างย่อ)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("พนักงานขาย", languageSelectIndex) + " : " + __saleCode, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }
                        //
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            __y += 15f;
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ผู้รับเงิน", languageSelectIndex) + "................................................................" + __saleCode, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);

                            // remark
                            if (__trans.Rows[0][_g.d.ic_trans._remark].ToString().Length > 0)
                            {
                                __y += 15;
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("หมายเหตุ", languageSelectIndex) + " ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __trans.Rows[0][_g.d.ic_trans._remark].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                                __y += 15;
                            }

                        }
                        if (this._posFooter.Trim().Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, this._posFooter, new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }

                        #endregion

                    }
                    break;
                #endregion
                #region ใบเสร็จแบบที่ 5 รายการ  จำนวน รวม
                case 5:
                    {

                        #region ส่วนหัว แสดงข้อมูลบริษัท

                        if (this._posHeader.Trim().Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, this._posHeader, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false, true);
                        }
                        else
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __ltdName, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __ltdAddress, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            string __telephone = "";
                            if (__ltdTel.Trim().Length > 0)
                            {
                                __telephone = _getResource("โทรศัพท์", languageSelectIndex) + ":" + __ltdTel.Trim();
                            }
                            if (__ltdFax.Trim().Length > 0)
                            {
                                __telephone = __telephone + " " + _getResource("โทรสาร", languageSelectIndex) + ":" + __ltdFax.Trim();
                            }
                            if (__telephone.Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __telephone, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            }

                            //
                            if (__ltdTax != null && __ltdTax.Trim().Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขประจำตัวผู้เสียภาษีอากร", languageSelectIndex) + " : " + __ltdTax, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            }
                        }

                        #endregion

                        #region ส่วนหัว แสดงข้อมูล เครือง POS และลูกค้า

                        // ข้อความเพิ่มเติม
                        if (header.Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource(header, languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Center, false);
                        }
                        __y += this._fontHeaderSize;

                        // ย้ายไปข้างบน
                        //if (_posBillType.Length > 0)
                        //{
                        //    headerSlip = _posBillType;
                        //}

                        __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource(headerSlip, languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Center, false);
                        __y += this._fontHeaderSize;
                        this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขเครื่อง", languageSelectIndex) + " : " + __trans.Rows[0]["pos_id_desc"].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        string __cashierName = "";
                        try
                        {
                            __cashierName = __trans.Rows[0]["cashier_name"].ToString().Split(' ')[0].ToString().Trim();
                        }
                        catch
                        {
                        }
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            __cashierName = __trans.Rows[0][_g.d.ic_trans._cashier_code].ToString();
                        }

                        __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("พนักงาน", languageSelectIndex) + " : " + __cashierName, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                        if (header.IndexOf("ยกเลิก") != -1)
                        {
                            string __cancelDocNo = __trans.Rows[0]["cancel_doc_no"].ToString();
                            string __cancelDocDate = MyLib._myGlobal._convertDateFromQuery(__trans.Rows[0]["cancel_doc_date"].ToString()).ToString("dd-MM-yyyy", new CultureInfo("th-TH"));

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขที่เอกสารยกเลิก", languageSelectIndex) + ":" + __cancelDocNo, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("วันที่", languageSelectIndex) + ":" + __cancelDocDate, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }

                        // เลขที่เอกสาร วันที่ เวลา
                        string __docDate = MyLib._myGlobal._convertDateFromQuery(__trans.Rows[0][_g.d.ic_trans._doc_date].ToString()).ToString("dd-MM-yyyy", new CultureInfo("th-TH"));
                        string __docNo = __trans.Rows[0][_g.d.ic_trans._doc_no].ToString();
                        string __docRefNo = __trans.Rows[0][_g.d.ic_trans._doc_ref].ToString();
                        __docGuid = __trans.Rows[0][_g.d.ic_trans._doc_no_guid].ToString().Trim();
                        //
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขที่", languageSelectIndex) + ":" + __docNo, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขที่อ้างอิง", languageSelectIndex) + ":" + __docRefNo, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("วันที่", languageSelectIndex) + ":" + __docDate + "@" + __trans.Rows[0][_g.d.ic_trans._doc_time].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ลูกค้า", languageSelectIndex) + " : " + __memberName, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขประจำตัวผู้เสียภาษี", languageSelectIndex) + " : " + __cust_taxid, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, ((__branch_type == "1") ? " [   ] " + __headquatreStr + " [ x ] " + __branchStr + " " + __branch_code : " [ x ] " + __headquatreStr + " [   ] " + __branchStr), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ที่อยู่", languageSelectIndex) + " : " + __memberAddress, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                        }
                        else
                        {
                            if (__memberCode.Trim().Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, "สมาชิก" + " : " + __memberName + " (" + __memberCode + ")", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            }

                            // พิมพ์โต๊ะ
                            if (__tableNumberStr.Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("หมายเลขโต๊ะ", languageSelectIndex) + " : " + __tableNumberStr, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            }

                            if ((MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro) && __table_trans.Rows.Count > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เวลาเข้า", languageSelectIndex) + " : " + __table_trans.Rows[0][_g.d.table_trans._open_doc_time].ToString() + " " + _getResource("เวลาออก", languageSelectIndex) + " : " + __table_trans.Rows[0][_g.d.table_trans._close_doc_time].ToString(), new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            }

                        }

                        if (__customer_phone.Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __customer_phone, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }

                        __y += this._printSlipLine(__g, __width, __y, 3);

                        #endregion

                        #region รายการสินค้า

                        int __transCount = 0;
                        decimal __itemQtyCount = 0;
                        decimal __saveAmount = 0;
                        decimal __sumFood = 0M;
                        decimal __sumDrink = 0M;

                        for (int __row = 0; __row < __transDetail.Rows.Count; __row++)
                        {
                            DataRow __data = __transDetail.Rows[__row];

                            if (__data[_g.d.ic_trans_detail._item_type].ToString().Equals("3"))
                            {
                                // สินค้าชุด ข้ามไป
                                continue;
                            }

                            decimal __amount = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._sum_amount].ToString());

                            if (MyLib._myGlobal._decimalPhase(__data[_g.d.ic_inventory_barcode._hidden_text].ToString()) == 0)
                            {
                                __transCount++;

                                decimal __price = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._price].ToString());
                                decimal __qty = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._qty].ToString());
                                decimal __priceDefault = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._price_default].ToString());
                                __itemQtyCount += __qty;
                                string __discountWord = __data[_g.d.ic_trans_detail._discount].ToString();
                                string __priceInfo = __data[_g.d.ic_trans_detail._remark].ToString();
                                decimal __discountAmount = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._discount_amount].ToString());
                                // มูลค่าสินค้า+vat
                                string __extraWord = "";
                                int __taxType = (int)MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._tax_type].ToString());
                                string __qtyStr = (__qty == Math.Round(__qty, 0)) ? __qty.ToString(this._formatNumber2) : __qty.ToString(this._formatNumber1);
                                string _unit_name = __data[_g.d.ic_trans_detail._unit_name].ToString();

                                if (languageSelectIndex > 0)
                                {
                                    string __unit_name_en = __data[_g.d.ic_trans_detail._unit_name_en].ToString();

                                    if (__unit_name_en.Length > 0)
                                    {
                                        _unit_name = __unit_name_en;
                                    }
                                }

                                // toe แก้ extraword case 0 = สินค้ามี Vat                         
                                switch (__taxType)
                                {
                                    case 0:
                                        __extraWord = "V";
                                        break;
                                }


                                // ชื่อสินค้า
                                StringBuilder __detail = new StringBuilder();
                                if (languageSelectIndex == 0)
                                {
                                    __detail.Append(__data[_g.d.ic_trans_detail._item_name].ToString().Trim());
                                }
                                else
                                {
                                    string __itemNameEn = __data[_g.d.ic_trans_detail._item_name_en].ToString().Trim();
                                    if (__itemNameEn.Length > 0)
                                    {
                                        __detail.Append(__itemNameEn);
                                    }
                                    else
                                    {
                                        __detail.Append(__data[_g.d.ic_trans_detail._item_name].ToString().Trim());
                                    }
                                }


                                float __lineHeight = this._printSlipText(__g, __width, __width * 0.7f, 0, __y, __detail.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);

                                if (__discountAmount != 0)
                                {
                                    __saveAmount += __discountAmount;
                                }

                                //  จำนวน
                                float _qtyLineHeight = this._printSlipText(__g, __width, 30, __width * 0.8f, __y, __qtyStr, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Center, false);

                                // รวม
                                this._printSlipText(__g, __width - 15, __width - 10, 0, __y, __amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                                if (this._showTaxDetail && _g.g._companyProfile._vat_rate > 0)
                                {
                                    this._printSlipText(__g, __width, __width, 0, __y, __extraWord, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                }

                                if (__serialNumberTable != null && __serialNumberTable.Rows.Count > 0)
                                {
                                    // Serial Number
                                    DataRow[] __serial = __serialNumberTable.Select(_g.d.ic_trans_serial_number._doc_line_number + "=\'" + (__row).ToString() + "\'");
                                    for (int __serialLoop = 0; __serialLoop < __serial.Length; __serialLoop++)
                                    {
                                        __y += this._printSlipText(__g, __width, __width, 0, __y, "S/N:" + __serial[__serialLoop][_g.d.ic_trans_serial_number._serial_number].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                    }
                                }

                                __y += __lineHeight;
                            }

                            if (__data[_g.d.ic_inventory._drink_type].ToString().Equals("1"))
                            {
                                __sumDrink += __amount;
                            }
                            else
                            {
                                __sumFood += __amount;
                            }
                        }

                        #endregion

                        #region รายการ promotion
                        for (int __row = 0; __row < __transDetailPromotion.Rows.Count; __row++)
                        {
                            DataRow __data = __transDetailPromotion.Rows[__row];
                            decimal __amount = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail_promotion._sum_amount].ToString());

                            //__transCount++;
                            decimal __price = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail_promotion._price].ToString());
                            decimal __qty = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail_promotion._qty].ToString());

                            //__itemQtyCount += __qty;

                            StringBuilder __detail = new StringBuilder();
                            __detail.Append(__data[_g.d.ic_trans_detail_promotion._promotion_name].ToString().Trim());

                            float __lineHeight = this._printSlipText(__g, __width, __width * 0.7f, 0, __y, __detail.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                            string __qtyStr = (__qty == Math.Round(__qty, 0)) ? __qty.ToString(this._formatNumber2) : __qty.ToString(this._formatNumber1);

                            float _qtyLineHeight = this._printSlipText(__g, __width, 30, __width * 0.8f, __y, __qtyStr, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Center, false);

                            this._printSlipText(__g, __width - 15, __width - 10, 0, __y, __amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                            __promotionAmount += (__amount);
                            __y += __lineHeight;



                        }

                        #endregion

                        #region ส่วนท้ายบิล

                        decimal __discountFooter = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_discount].ToString());
                        decimal __serviceChargeAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_service_charge].ToString());

                        // ท้ายบิล
                        __totalAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_amount].ToString()) + __discountFooter + __totalAdvanceMoney;

                        __y += this._printSlipLine(__g, __width, __y, 3);


                        // tomyumgoong ยอดอาหาร เครื่องดิ่ม
                        if (MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro)
                        {
                            float __lineHeight = 0;

                            if (__serviceChargeAmount > 0)
                            {
                                string __serviceChargeText = __trans.Rows[0][_g.d.ic_trans._service_charge_word].ToString();
                                __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("Service Charge", languageSelectIndex) + " " + ((__serviceChargeText.IndexOf("%") != -1) ? __serviceChargeText : ""), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                this._printSlipText(__g, __width, __width, 0, __y, __serviceChargeAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                __y += __lineHeight;
                            }

                            __lineHeight = this._printSlipText(__g, (float)(__width * 0.6), (float)(__width * 0.6), 0, __y, _getResource("อาหาร", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            this._printSlipText(__g, __width, __width, 0, __y, __sumFood.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += __lineHeight;

                            __lineHeight = this._printSlipText(__g, (float)(__width * 0.6), (float)(__width * 0.6), 0, __y, _getResource("เครื่องดื่ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            this._printSlipText(__g, __width, __width, 0, __y, __sumDrink.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += __lineHeight;

                            /* toe 20150312
                             * decimal __totalValue = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_value].ToString());
                            __lineHeight = this._printSlipText(__g, (float)(__width * 0.6), (float)(__width * 0.6), 0, __y, _getResource("รวม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            this._printSlipText(__g, __width, __width, 0, __y, __totalValue.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += __lineHeight;
                             */
                            __y += this._printSlipLine(__g, __width, __y);
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("รวมทั้งสิ้น", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += this._printSlipLine(__g, __width, __y);



                            // เงินมัดจำ
                            if (__totalAdvanceMoney > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, "เงินมัดจำ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                for (int __row = 0; __row < __advanceMoneyDetail.Rows.Count; __row++)
                                {

                                    string __detail = string.Format("{0}:{1}", __advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._trans_number].ToString(), MyLib._myGlobal._convertDateFromQuery(__advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._doc_date_ref].ToString()).ToString("dd-MM-yyyy", new CultureInfo("th-TH")));
                                    decimal __advanceAmount = MyLib._myGlobal._decimalPhase(__advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._amount].ToString());

                                    this._printSlipText(__g, __width, __width, 0, __y, __detail, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                    __y += this._printSlipText(__g, __width, __width, 0, __y, __advanceAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                }

                            }

                            if (__discountFooter != 0)
                            {
                                decimal __discountFooterShow = (-1 * (__discountFooter - (-1 * __promotionAmount)));
                                float __discountFood = this._printSlipText(__g, (float)(__width * 0.6), (float)(__width * 0.6), 0, __y, _getResource("ส่วนลดอาหาร", languageSelectIndex) + ((this._discountWord.IndexOf("%") != -1) ? " " + this._discountWord : ""), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                this._printSlipText(__g, __width, __width, 0, __y, __discountFooterShow.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                __y += __discountFood;

                                __saveAmount += __discountFooter;
                                // คงเหลือ
                                __totalAmount -= __discountFooter;

                            }

                            if (__promotionAmount != 0)
                            {
                                float __discountFood = this._printSlipText(__g, (float)(__width * 0.6), (float)(__width * 0.6), 0, __y, _getResource("ส่วนลดโปรโมชั่น", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                this._printSlipText(__g, __width, __width, 0, __y, __promotionAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                __y += __discountFood;
                            }


                            //decimal __diffAmount = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._total_income_amount].ToString());
                            // ปัดเศษ
                            if (__diff_amount != 0)
                            {
                                __saveAmount += (__diff_amount);
                                __totalAmount += (__diff_amount * -1);

                                //__lineHeight = this._printSlipText(__g, (float)(__width * 0.6), (float)(__width * 0.6), 0, __y, "ยอดปัดเศษ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                //this._printSlipText(__g, __width, __width, 0, __y, __diffAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                //__y += __lineHeight;
                            }



                        }
                        else
                        {
                            // เงินมัดจำ
                            if (__totalAdvanceMoney > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, "เงินมัดจำ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                for (int __row = 0; __row < __advanceMoneyDetail.Rows.Count; __row++)
                                {

                                    string __detail = string.Format("{0}:{1}", __advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._trans_number].ToString(), MyLib._myGlobal._convertDateFromQuery(__advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._doc_date_ref].ToString()).ToString("dd-MM-yyyy", new CultureInfo("th-TH")));
                                    decimal __advanceAmount = MyLib._myGlobal._decimalPhase(__advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._amount].ToString());

                                    this._printSlipText(__g, __width, __width, 0, __y, __detail, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                    __y += this._printSlipText(__g, __width, __width, 0, __y, __advanceAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                }

                            }

                            // ส่วนลดท้ายบิล
                            if (__discountFooter != 0)
                            {
                                string __discountWord2 = _getResource("ส่วนลดพิเศษ", languageSelectIndex);
                                string __discountWord = __trans.Rows[0][_g.d.ic_trans._discount_word].ToString().Trim();
                                if (__discountWord.Length > 0)
                                {
                                    __discountWord2 = __discountWord2 + " : " + __discountWord;
                                }
                                this._printSlipText(__g, __width, __width, 0, __y, __discountWord2, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __discountFooter.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                __saveAmount += __discountFooter;
                                // คงเหลือ
                                __totalAmount -= __discountFooter;
                            }

                            //decimal __diffAmount = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._total_income_amount].ToString());
                            // ปัดเศษ
                            if (__diff_amount != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ส่วนลดจากการปัดเศษ", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __diff_amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                __saveAmount += (__diff_amount);
                                __totalAmount += (__diff_amount * -1);
                            }

                            if (__discountFooter != 0 || __diff_amount != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("รวมสุทธิ", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                        }

                        __y += 30;
                        __y += this._printSlipLine(__g, __width, __y, 3);
                        this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระ", languageSelectIndex), new Font(this._fontDetailName, 17, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                        __y += this._printSlipText(__g, __width, __width, 0, __y, __totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, 17, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);

                        __y += this._printSlipLine(__g, __width, __y, 3);
                        __y += 30;


                        // ภาษีมูลค่าเพิ่ม
                        decimal __beforeVatAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_before_vat].ToString());
                        decimal __exceptVatAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_except_vat].ToString());
                        decimal __vatAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_vat_value].ToString());
                        decimal __vatRate = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._vat_rate].ToString());

                        // toe เพิ่ม option แสดงรายละเอียดภาษี
                        if (this._showTaxDetail && _g.g._companyProfile._vat_rate > 0)
                        {

                            // สินค้ายกเว้นภาษี
                            if (__exceptVatAmount != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("มูลค่าสินค้ายกเว้นภาษีมูลค่าเพิ่ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __exceptVatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                            //
                            if (__beforeVatAmount != 0 || __vatAmount != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("มูลค่าสินค้ามีภาษีมูลค่าเพิ่ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __beforeVatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                //
                                string __vatRateStr = (__vatRate == Math.Round(__vatRate, 0)) ? __vatRate.ToString(this._formatNumber2) : __vatRate.ToString(this._formatNumber1);
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ภาษีมูลค่าเพิ่ม", languageSelectIndex) + " : " + __vatRateStr + "%", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __vatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                            __y += this._printSlipLine(__g, __width, __y);

                        }

                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("รวมเงิน", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                            SMLReport._formReport._moneyToText __moneyToText = new SMLReport._formReport._moneyToText();
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __moneyToText._toText(__totalAmount), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipLine(__g, __width, __y);
                        }
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างย่อ)
                        {
                            // ประหยัด
                            if (__saveAmount != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("คุณประหยัดครั้งนี้", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __saveAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                            __y += this._printSlipLine(__g, __width, __y);
                            // ยอดชำระ
                            //__payCash = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._pay_cash_amount].ToString());
                            if (__payCash != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระด้วยเงินสด", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __payCash.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                            if (__creditCardDetail != null)
                            {
                                for (int __row = 0; __row < __creditCardDetail.Rows.Count; __row++)
                                {
                                    decimal __creditCardTotalAmount = MyLib._myGlobal._decimalPhase(__creditCardDetail.Rows[__row][_g.d.cb_trans_detail._sum_amount].ToString());
                                    decimal __creditCardChargeAmount = MyLib._myGlobal._decimalPhase(__creditCardDetail.Rows[__row][_g.d.cb_trans_detail._charge].ToString());
                                    if (__creditCardTotalAmount != 0)
                                    {
                                        string __creditCardType = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._credit_card_type].ToString();
                                        string __creditCardNumber = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._trans_number].ToString();
                                        for (int __loop = 0; __loop < __creditCardNumber.Length - 4; __loop++)
                                        {
                                            __creditCardNumber = __creditCardNumber.Remove(__loop, 1);
                                            __creditCardNumber = __creditCardNumber.Insert(__loop, "*");
                                        }
                                        //
                                        this._printSlipText(__g, __width, __width, 0, __y, __creditCardType + " " + __creditCardNumber, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                        __y += this._printSlipText(__g, __width, __width, 0, __y, __creditCardTotalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                        //
                                        if (__creditCardChargeAmount != 0)
                                        {
                                            __y += this._printSlipText(__g, __width, __width, 10, __y, _getResource("Charge", languageSelectIndex) + " : " + __creditCardChargeAmount.ToString(this._formatNumber1) + " บาท", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Italic), SMLPOSControl._printSlipTextStyle.Left, false);
                                        }
                                        //
                                        string __creditCardApproved = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._no_approved].ToString();
                                        __y += this._printSlipText(__g, __width, __width, 10, __y, _getResource("Approval", languageSelectIndex) + " : " + __creditCardApproved, new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Italic), SMLPOSControl._printSlipTextStyle.Left, false);
                                    }
                                }
                            }

                            // ชำระด้วยคูปอง
                            //__payCoupon = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._coupon_amount].ToString());
                            if (__payCoupon != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระด้วยคูปอง", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __payCoupon.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                            // ชำระด้วยแต้ม
                            //__payPoint = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._point_amount].ToString());
                            if (__payPoint != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระด้วยแต้ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __payPoint.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                            // เงินทอน
                            //__moneyChange = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._money_change].ToString());
                            if (__moneyChange != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("เงินทอน", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __moneyChange.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                            //
                            __y += this._printSlipLine(__g, __width, __y);

                            // order detail
                            if ((MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro) && this._show_order_detail && (this._show_order_detail_copy_Only == false || (this._show_order_detail_copy_Only == true && header == "- สำเนา -")))
                            {
                                // order detail
                                for (int __orderRow = 0; __orderRow < __tableOrderDetail.Rows.Count; __orderRow++)
                                {
                                    __y += this._printSlipText(__g, __width, __width, 0, __y, "ใบสั่ง : " + __tableOrderDetail.Rows[__orderRow][_g.d.table_order_doc._doc_no].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                }

                                // order cancel
                                for (int __cancelRow = 0; __cancelRow < __tableOrderCancel.Rows.Count; __cancelRow++)
                                {
                                    decimal __cancelAmount = MyLib._myGlobal._decimalPhase(__tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._sum_amount].ToString());

                                    __y += this._printSlipText(__g, __width, __width, 0, __y, (__tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._cancel_flag].ToString().Equals("1") ? "ย้ายออก " + __tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._table_number_2].ToString() + " : " : "ยกเลิก : ") + __tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._item_name].ToString() + " " + __cancelAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                }
                                __y += this._printSlipLine(__g, __width, __y);

                            }
                        }
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างย่อ)
                        {
                            string __docNoAndTime = _getResource("เลขที่", languageSelectIndex) + ":" + __docNo;
                            string __docTime = _getResource("วันที่", languageSelectIndex) + ":" + __docDate + "@" + __trans.Rows[0][_g.d.ic_trans._doc_time].ToString();

                            __y += this._printSlipText(__g, __width, __width, 0, __y, __docNoAndTime, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __docTime, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);

                            if (__currentPoint > 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("แต้มครั้งนี้", languageSelectIndex) + ":", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __currentPoint.ToString(this._formatNumber2), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                                SMLProcess._posProcess __process = new SMLProcess._posProcess();
                                decimal __currentPointBalance = __process._pointBalance(__cust_code, true);

                                // แต้มสะสม
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("แต้มสะสมถึง", languageSelectIndex) + " " + __docDate, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __currentPointBalance.ToString(this._formatNumber2), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                            }
                        }

                        //
                        if (this._showShortDescription && _g.g._companyProfile._vat_rate > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, "V=" + _getResource("สินค้ามีภาษีมูลค่าเพิ่ม", languageSelectIndex) + " " + "E=" + _getResource("สินค้ายกเว้นภาษี", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            //
                        }
                        string __saleCode = __trans.Rows[0][_g.d.ic_trans._sale_code].ToString();
                        string __cashierCode = __trans.Rows[0][_g.d.ic_trans._cashier_code].ToString();
                        if (__cashierCode.Equals(__saleCode) == false && mode == _printSlipMode.ใบกำกับภาษีอย่างย่อ)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("พนักงานขาย", languageSelectIndex) + " : " + __saleCode, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }
                        //
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            __y += 15f;
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ผู้รับเงิน", languageSelectIndex) + "................................................................" + __saleCode, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);

                            // remark
                            if (__trans.Rows[0][_g.d.ic_trans._remark].ToString().Length > 0)
                            {
                                __y += 15;
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("หมายเหตุ", languageSelectIndex) + " ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __trans.Rows[0][_g.d.ic_trans._remark].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                                __y += 15;
                            }

                        }
                        if (this._posFooter.Trim().Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, this._posFooter, new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }

                        #endregion

                    }
                    break;
                #endregion
                #region ใบเสร็จแบบที่ 6 สำหรับกระดาษ 58 มม.
                case 6:
                    {

                        #region ข้อมูลบริษัท

                        if (this._posHeader.Trim().Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, this._posHeader, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false, true);
                        }
                        else
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __ltdName, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __ltdAddress, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            string __telephone = "";
                            if (__ltdTel.Trim().Length > 0)
                            {
                                __telephone = _getResource("โทรศัพท์", languageSelectIndex) + ":" + __ltdTel.Trim();
                            }
                            if (__ltdFax.Trim().Length > 0)
                            {
                                __telephone = __telephone + " " + _getResource("โทรสาร", languageSelectIndex) + ":" + __ltdFax.Trim();
                            }
                            if (__telephone.Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __telephone, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            }
                            //

                            if (__ltdTax != null && __ltdTax.Trim().Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขประจำตัวผู้เสียภาษีอากร", languageSelectIndex) + " : " + __ltdTax, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            }
                        }

                        #endregion

                        #region ส่วนหัว แสดงข้อมูลลูกค้า

                        if (header.Length > 0)
                        {
                            // ข้อความเพิ่มเติม
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource(header, languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Center, false);
                        }
                        __y += this._fontHeaderSize;
                        // toe change headerSlip 
                        // ย้ายไปข้างบน
                        //if (_posBillType.Length > 0)
                        //{
                        //    headerSlip = _posBillType;
                        //}

                        __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource(headerSlip, languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Center, false);
                        __y += this._fontHeaderSize;
                        __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขเครื่อง", languageSelectIndex) + " : " + __trans.Rows[0]["pos_id_desc"].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        string __cashierName = "";
                        try
                        {
                            __cashierName = __trans.Rows[0]["cashier_name"].ToString().Split(' ')[0].ToString().Trim();
                        }
                        catch
                        {
                        }
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            __cashierName = __trans.Rows[0][_g.d.ic_trans._cashier_code].ToString();
                        }

                        __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("พนักงาน", languageSelectIndex) + " : " + __cashierName, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);

                        if (header.IndexOf("ยกเลิก") != -1)
                        {
                            string __cancelDocNo = __trans.Rows[0]["cancel_doc_no"].ToString();
                            string __cancelDocDate = MyLib._myGlobal._convertDateFromQuery(__trans.Rows[0]["cancel_doc_date"].ToString()).ToString("dd-MM-yyyy", new CultureInfo("th-TH"));

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขที่เอกสารยกเลิก", languageSelectIndex) + ":" + __cancelDocNo, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("วันที่", languageSelectIndex) + ":" + __cancelDocDate, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }

                        // เลขที่เอกสาร วันที่ เวลา
                        string __docDate = MyLib._myGlobal._convertDateFromQuery(__trans.Rows[0][_g.d.ic_trans._doc_date].ToString()).ToString("dd-MM-yyyy", new CultureInfo("th-TH"));
                        string __docNo = __trans.Rows[0][_g.d.ic_trans._doc_no].ToString();
                        string __docRefNo = __trans.Rows[0][_g.d.ic_trans._doc_ref].ToString();
                        __docGuid = __trans.Rows[0][_g.d.ic_trans._doc_no_guid].ToString().Trim();
                        //


                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขที่", languageSelectIndex) + ":" + __docNo, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขที่อ้างอิง", languageSelectIndex) + ":" + __docRefNo, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("วันที่", languageSelectIndex) + ":" + __docDate + "@" + __trans.Rows[0][_g.d.ic_trans._doc_time].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ลูกค้า", languageSelectIndex) + " : " + __memberName, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขประจำตัวผู้เสียภาษี", languageSelectIndex) + " : " + __cust_taxid, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, ((__branch_type == "1") ? " [   ] " + __headquatreStr + " [ x ] " + __branchStr + " " + __branch_code : " [ x ] " + __headquatreStr + " [   ] " + __branchStr), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ที่อยู่", languageSelectIndex) + " : " + __memberAddress, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                        }
                        else
                        {
                            if (__memberCode.Trim().Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("สมาชิก", languageSelectIndex) + " : " + __memberName + " (" + __memberCode + ")", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            }

                            // พิมพ์โต๊ะ
                            if (__tableNumberStr.Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("หมายเลขโต๊ะ", languageSelectIndex) + " : " + __tableNumberStr, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            }

                            if ((MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro) && __table_trans.Rows.Count > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เวลาเข้า", languageSelectIndex) + " : " + __table_trans.Rows[0][_g.d.table_trans._open_doc_time].ToString() + " " + _getResource("เวลาออก", languageSelectIndex) + " : " + __table_trans.Rows[0][_g.d.table_trans._close_doc_time].ToString(), new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Left, false);

                            }
                        }

                        if (__customer_phone.Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __customer_phone, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }

                        __y += this._printSlipLine(__g, __width, __y);


                        #endregion

                        #region รายการสินค้า
                        //
                        //Font __fontDetail1 = new Font(this._fontHeaderName, 10);
                        //Font __fontDetail2 = new Font(this._fontHeaderName, 10, FontStyle.Italic);
                        int __transCount = 0;
                        decimal __itemQtyCount = 0;
                        decimal __saveAmount = 0;
                        decimal __sumFood = 0M;
                        decimal __sumDrink = 0M;
                        for (int __row = 0; __row < __transDetail.Rows.Count; __row++)
                        {
                            DataRow __data = __transDetail.Rows[__row];
                            if (__data[_g.d.ic_trans_detail._item_type].ToString().Equals("3"))
                            {
                                // สินค้าชุด ข้ามไป
                                continue;
                            }

                            decimal __amount = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._sum_amount].ToString());

                            if (MyLib._myGlobal._decimalPhase(__data[_g.d.ic_inventory_barcode._hidden_text].ToString()) == 0)
                            {
                                __transCount++;
                                decimal __price = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._price].ToString());
                                decimal __qty = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._qty].ToString());
                                decimal __priceDefault = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._price_default].ToString());
                                __itemQtyCount += __qty;
                                string __discountWord = __data[_g.d.ic_trans_detail._discount].ToString();
                                string __priceInfo = __data[_g.d.ic_trans_detail._remark].ToString();
                                decimal __discountAmount = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._discount_amount].ToString());
                                // มูลค่าสินค้า+vat
                                string __extraWord = "";
                                int __taxType = (int)MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._tax_type].ToString());

                                // toe แก้ extraword เอา case 0 ออก                            
                                switch (__taxType)
                                {
                                    case 0:
                                        __extraWord = "V";
                                        break;
                                }
                                // รายละเอียดสินค้า
                                StringBuilder __detail = new StringBuilder();
                                if (languageSelectIndex == 0)
                                {
                                    __detail.Append(__data[_g.d.ic_trans_detail._item_name].ToString().Trim());
                                }
                                else
                                {
                                    string __itemNameEn = __data[_g.d.ic_trans_detail._item_name_en].ToString().Trim();
                                    if (__itemNameEn.Length > 0)
                                    {
                                        __detail.Append(__itemNameEn);
                                    }
                                    else
                                    {
                                        __detail.Append(__data[_g.d.ic_trans_detail._item_name].ToString().Trim());
                                    }
                                }
                                if (__priceDefault != __amount)
                                {
                                    __detail.Append(" " + "@" + __priceDefault.ToString(this._formatNumber1));
                                }
                                float __lineHeight = this._printSlipText(__g, __width, (__memberCode.Trim().Length == 0) ? __width * 0.8f : __width, 0, __y, __detail.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                                // ราคาสามาชิก
                                if (__memberCode.Trim().Length > 0)
                                {
                                    decimal __newPrice = __amount / __qty;
                                    string __qtyStr = (__qty == Math.Round(__qty, 0)) ? __qty.ToString(this._formatNumber2) : __qty.ToString(this._formatNumber1);
                                    string __priceStr = __newPrice.ToString(this._formatNumber1);
                                    StringBuilder __memberPrice = new StringBuilder(_getResource("ราคาสมาชิก", languageSelectIndex) + " " + "@" + __priceStr);
                                    if (__qty > 1)
                                    {
                                        __memberPrice.Append("x");
                                        __memberPrice.Append(__qtyStr);
                                    }
                                    __y += __lineHeight;
                                    __lineHeight = this._printSlipText(__g, __width, __width, 5, __y, __memberPrice.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                }
                                // ส่วนลด
                                if (__discountAmount != 0)
                                {
                                    //StringBuilder __discountStr = new StringBuilder("ราคาปรกติ" + " : " + __priceDefault.ToString(this._formatNumber1) + " " + "บาท");
                                    //__y += this._printSlipText(__g, __width, __width, 5, __y, __discountStr.ToString(), new Font(this._fontDetailName, this._fontDetailSize * 0.8f), SMLPOSControl._printSlipTextStyle.Left);
                                    __saveAmount += __discountAmount;
                                    /*StringBuilder __discountStr = new StringBuilder();
                                    __discountStr.Append(__priceInfo + " " + "ลด");
                                    __discountStr.Append(" " + __discountAmount.ToString(this._formatNumber1) + " " + "บาท");
                                    if (__priceDefault != 0)
                                    {
                                        __discountStr.Append(" " + "จาก" + " " + __priceDefault.ToString(this._formatNumber1) + " " + "บาท");
                                    }
                                    __y += this._printSlipText(__g, __width, __width, 5, __y, __discountStr.ToString(), new Font(this._fontDetailName, this._fontDetailSize * 0.8f), SMLPOSControl._printSlipTextStyle.Left);
                                    __saveAmount += __discountAmount;
                                     */
                                }
                                this._printSlipText(__g, __width - 15, __width - 10, 0, __y, __amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                                if (this._showTaxDetail && _g.g._companyProfile._vat_rate > 0)
                                {
                                    this._printSlipText(__g, __width, __width, 0, __y, __extraWord, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                }
                                __y += __lineHeight;
                                if (__serialNumberTable != null && __serialNumberTable.Rows.Count > 0)
                                {
                                    // Serial Number
                                    DataRow[] __serial = __serialNumberTable.Select(_g.d.ic_trans_serial_number._doc_line_number + "=\'" + (__row).ToString() + "\'");
                                    for (int __serialLoop = 0; __serialLoop < __serial.Length; __serialLoop++)
                                    {
                                        __y += this._printSlipText(__g, __width, __width, 0, __y, "S/N:" + __serial[__serialLoop][_g.d.ic_trans_serial_number._serial_number].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                    }
                                }
                            }

                            if (__data[_g.d.ic_inventory._drink_type].ToString().Equals("1"))
                            {
                                __sumDrink += __amount;
                            }
                            else
                            {
                                __sumFood += __amount;
                            }
                        }

                        #endregion

                        #region รายการ promotion
                        for (int __row = 0; __row < __transDetailPromotion.Rows.Count; __row++)
                        {
                            DataRow __data = __transDetailPromotion.Rows[__row];
                            decimal __amount = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail_promotion._sum_amount].ToString());

                            //__transCount++;
                            decimal __price = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail_promotion._price].ToString());
                            decimal __qty = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail_promotion._qty].ToString());

                            //__itemQtyCount += __qty;

                            StringBuilder __detail = new StringBuilder();
                            __detail.Append(__data[_g.d.ic_trans_detail_promotion._promotion_name].ToString().Trim());

                            float __lineHeight = this._printSlipText(__g, __width, __width * 0.8f, 0, __y, __detail.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                            // ราคาสามาชิก
                            //if (__memberCode.Trim().Length > 0)
                            //{
                            //    decimal __newPrice = __amount / __qty;
                            //    string __qtyStr = (__qty == Math.Round(__qty, 0)) ? __qty.ToString(this._formatNumber2) : __qty.ToString(this._formatNumber1);
                            //    string __priceStr = __newPrice.ToString(this._formatNumber1);
                            //    StringBuilder __memberPrice = new StringBuilder("ราคาสมาชิก" + " " + "@" + __priceStr);
                            //    if (__qty > 1)
                            //    {
                            //        __memberPrice.Append("x");
                            //        __memberPrice.Append(__qtyStr);
                            //    }
                            //    __y += __lineHeight;
                            //    __lineHeight = this._printSlipText(__g, __width, __width, 5, __y, __memberPrice.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            //}
                            // ส่วนลด
                            //if (__discountAmount != 0)
                            //{
                            //    //StringBuilder __discountStr = new StringBuilder("ราคาปรกติ" + " : " + __priceDefault.ToString(this._formatNumber1) + " " + "บาท");
                            //    //__y += this._printSlipText(__g, __width, __width, 5, __y, __discountStr.ToString(), new Font(this._fontDetailName, this._fontDetailSize * 0.8f), SMLPOSControl._printSlipTextStyle.Left);
                            //    __saveAmount += __discountAmount;
                            //    /*StringBuilder __discountStr = new StringBuilder();
                            //    __discountStr.Append(__priceInfo + " " + "ลด");
                            //    __discountStr.Append(" " + __discountAmount.ToString(this._formatNumber1) + " " + "บาท");
                            //    if (__priceDefault != 0)
                            //    {
                            //        __discountStr.Append(" " + "จาก" + " " + __priceDefault.ToString(this._formatNumber1) + " " + "บาท");
                            //    }
                            //    __y += this._printSlipText(__g, __width, __width, 5, __y, __discountStr.ToString(), new Font(this._fontDetailName, this._fontDetailSize * 0.8f), SMLPOSControl._printSlipTextStyle.Left);
                            //    __saveAmount += __discountAmount;
                            //     */
                            //}
                            this._printSlipText(__g, __width - 15, __width - 10, 0, __y, __amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                            //if (this._showTaxDetail)
                            //{
                            //    this._printSlipText(__g, __width, __width, 0, __y, __extraWord, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            //}
                            __y += __lineHeight;

                        }

                        #endregion

                        #region ส่วนท้ายบิล

                        decimal __discountFooter = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_discount].ToString());
                        //decimal __diff_amount = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._total_income_amount].ToString());
                        decimal __serviceChargeAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_service_charge].ToString());

                        // ท้ายบิล 
                        // โต๋ ดุให้ดี ๆ นะ มีผลกระทบต่อ ที่อื่นนะ 
                        // ถ้เาป็นค่าลบ เอายอดปัดเศษ มาโชวในส่วนลดด้วย
                        // ถ้าปัดขึนทำไงให้ดุดี
                        __totalAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_amount].ToString()) + __discountFooter + __totalAdvanceMoney;
                        __y += this._printSlipLine(__g, __width, __y);
                        string __footer1 = __transCount.ToString() + " " + _getResource("รายการ", languageSelectIndex) + " " + __itemQtyCount.ToString(this._formatNumber1) + " " + _getResource("ชิ้น", languageSelectIndex);
                        this._printSlipText(__g, __width, __width, 0, __y, __footer1, new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                        __y += this._printSlipText(__g, __width, __width, 0, __y, (__totalAmount - __serviceChargeAmount).ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                        // ส่วนลดท้ายบิล

                        // tomyumgoong ยอดอาหาร เครื่องดิ่ม
                        if (MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro)
                        {
                            float __lineHeight = 0;

                            if (__serviceChargeAmount > 0)
                            {
                                string __serviceChargeText = __trans.Rows[0][_g.d.ic_trans._service_charge_word].ToString();
                                __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("Service Charge", languageSelectIndex) + " " + ((__serviceChargeText.IndexOf("%") != -1) ? __serviceChargeText : ""), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                this._printSlipText(__g, __width, __width, 0, __y, __serviceChargeAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                __y += __lineHeight;
                            }

                            __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("อาหาร", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            this._printSlipText(__g, __width, __width, 0, __y, __sumFood.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += __lineHeight;

                            __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("เครื่องดื่ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            this._printSlipText(__g, __width, __width, 0, __y, __sumDrink.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += __lineHeight;

                            __y += this._printSlipLine(__g, __width, __y);
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("รวมทั้งสิ้น", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += this._printSlipLine(__g, __width, __y);

                        }

                        // เงินมัดจำ
                        if (__totalAdvanceMoney > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, "เงินมัดจำ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            for (int __row = 0; __row < __advanceMoneyDetail.Rows.Count; __row++)
                            {

                                string __detail = string.Format("{0}:{1}", __advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._trans_number].ToString(), MyLib._myGlobal._convertDateFromQuery(__advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._doc_date_ref].ToString()).ToString("dd-MM-yyyy", new CultureInfo("th-TH")));
                                decimal __advanceAmount = MyLib._myGlobal._decimalPhase(__advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._amount].ToString());

                                this._printSlipText(__g, __width, __width, 0, __y, __detail, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __advanceAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                        }

                        if (__discountFooter != 0)
                        {
                            string __discountWord2 = _getResource("ส่วนลดพิเศษ", languageSelectIndex);
                            string __discountWord = __trans.Rows[0][_g.d.ic_trans._discount_word].ToString().Trim();
                            if (__discountWord.Length > 0)
                            {
                                __discountWord2 = __discountWord2 + " : " + __discountWord;
                            }
                            this._printSlipText(__g, __width, __width, 0, __y, __discountWord2, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __discountFooter.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __saveAmount += __discountFooter;
                            // คงเหลือ
                            __totalAmount -= __discountFooter;
                        }

                        // ผลต่างปัดเศษ
                        //decimal __diffAmount = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._total_income_amount].ToString());
                        if (__diff_amount != 0)
                        {
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("ผลต่างการปัดเศษ", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __diff_amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __saveAmount += (__diff_amount);
                            __totalAmount += (__diff_amount * -1);
                        }

                        if (__discountFooter != 0 || __diff_amount != 0)
                        {
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("คงเหลือยอดชำระ", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                        }

                        // ภาษีมูลค่าเพิ่ม
                        decimal __beforeVatAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_before_vat].ToString());
                        decimal __exceptVatAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_except_vat].ToString());
                        decimal __vatAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_vat_value].ToString());
                        decimal __vatRate = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._vat_rate].ToString());

                        // toe เพิ่ม option แสดงรายละเอียดภาษี
                        if (this._showTaxDetail && _g.g._companyProfile._vat_rate > 0)
                        {

                            __y += this._printSlipLine(__g, __width, __y);
                            // สินค้ายกเว้นภาษี
                            if (__exceptVatAmount != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("มูลค่าสินค้ายกเว้นภาษีมูลค่าเพิ่ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __exceptVatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                            //
                            if (__beforeVatAmount != 0 || __vatAmount != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("มูลค่าสินค้ามีภาษีมูลค่าเพิ่ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __beforeVatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                //
                                string __vatRateStr = (__vatRate == Math.Round(__vatRate, 0)) ? __vatRate.ToString(this._formatNumber2) : __vatRate.ToString(this._formatNumber1);
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ภาษีมูลค่าเพิ่ม", languageSelectIndex) + " : " + __vatRateStr + "%", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __vatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                        }
                        __y += this._printSlipLine(__g, __width, __y);
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("รวมเงิน", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                            SMLReport._formReport._moneyToText __moneyToText = new SMLReport._formReport._moneyToText();
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __moneyToText._toText(__totalAmount), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipLine(__g, __width, __y);
                        }
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างย่อ)
                        {
                            // ประหยัด
                            if (__saveAmount != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("คุณประหยัดครั้งนี้", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __saveAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                            __y += this._printSlipLine(__g, __width, __y);
                            // ยอดชำระ
                            //__payCash = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._pay_cash_amount].ToString());
                            if (__payCash != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระด้วยเงินสด", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __payCash.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                            if (__creditCardDetail != null)
                            {
                                for (int __row = 0; __row < __creditCardDetail.Rows.Count; __row++)
                                {
                                    decimal __creditCardTotalAmount = MyLib._myGlobal._decimalPhase(__creditCardDetail.Rows[__row][_g.d.cb_trans_detail._sum_amount].ToString());
                                    decimal __creditCardChargeAmount = MyLib._myGlobal._decimalPhase(__creditCardDetail.Rows[__row][_g.d.cb_trans_detail._charge].ToString());
                                    if (__creditCardTotalAmount != 0)
                                    {
                                        string __creditCardType = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._credit_card_type].ToString();
                                        string __creditCardNumber = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._trans_number].ToString();
                                        for (int __loop = 0; __loop < __creditCardNumber.Length - 4; __loop++)
                                        {
                                            __creditCardNumber = __creditCardNumber.Remove(__loop, 1);
                                            __creditCardNumber = __creditCardNumber.Insert(__loop, "*");
                                        }
                                        //
                                        this._printSlipText(__g, __width, __width, 0, __y, __creditCardType + " " + __creditCardNumber, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                        __y += this._printSlipText(__g, __width, __width, 0, __y, __creditCardTotalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                        //
                                        if (__creditCardChargeAmount != 0)
                                        {
                                            __y += this._printSlipText(__g, __width, __width, 10, __y, _getResource("Charge", languageSelectIndex) + " : " + __creditCardChargeAmount.ToString(this._formatNumber1) + " บาท", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Italic), SMLPOSControl._printSlipTextStyle.Left, false);
                                        }
                                        //
                                        string __creditCardApproved = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._no_approved].ToString();
                                        __y += this._printSlipText(__g, __width, __width, 10, __y, _getResource("Approval", languageSelectIndex) + " : " + __creditCardApproved, new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Italic), SMLPOSControl._printSlipTextStyle.Left, false);
                                    }
                                }
                            }

                            // ชำระด้วยคูปอง
                            //__payCoupon = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._coupon_amount].ToString());
                            if (__payCoupon != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระด้วยคูปอง", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __payCoupon.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                            // ชำระด้วยแต้ม
                            //__payPoint = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._point_amount].ToString());
                            if (__payPoint != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระด้วยแต้ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __payPoint.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                            // เงินทอน
                            //__moneyChange = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._money_change].ToString());
                            if (__moneyChange != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("เงินทอน", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __moneyChange.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                            //
                            __y += this._printSlipLine(__g, __width, __y);

                            // order detail
                            if ((MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro) && this._show_order_detail && (this._show_order_detail_copy_Only == false || (this._show_order_detail_copy_Only == true && header == "- สำเนา -")))
                            {
                                // order detail
                                for (int __orderRow = 0; __orderRow < __tableOrderDetail.Rows.Count; __orderRow++)
                                {
                                    __y += this._printSlipText(__g, __width, __width, 0, __y, "ใบสั่ง : " + __tableOrderDetail.Rows[__orderRow][_g.d.table_order_doc._doc_no].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                }

                                // order cancel
                                for (int __cancelRow = 0; __cancelRow < __tableOrderCancel.Rows.Count; __cancelRow++)
                                {
                                    decimal __cancelAmount = MyLib._myGlobal._decimalPhase(__tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._sum_amount].ToString());

                                    __y += this._printSlipText(__g, __width, __width, 0, __y, (__tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._cancel_flag].ToString().Equals("1") ? "ย้ายออก " + __tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._table_number_2].ToString() + " : " : "ยกเลิก : ") + __tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._item_name].ToString() + " " + __cancelAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                }
                                __y += this._printSlipLine(__g, __width, __y);

                            }
                        }
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างย่อ)
                        {
                            string __docNoAndTime = "เลขที่" + ":" + __docNo;
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __docNoAndTime, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("วันที่", languageSelectIndex) + ":" + __docDate, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เวลา", languageSelectIndex) + ":" + __trans.Rows[0][_g.d.ic_trans._doc_time].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);

                            if (__currentPoint > 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("แต้มครั้งนี้", languageSelectIndex) + ":", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __currentPoint.ToString(this._formatNumber2), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                                SMLProcess._posProcess __process = new SMLProcess._posProcess();
                                decimal __currentPointBalance = __process._pointBalance(__cust_code, true);

                                // แต้มสะสม
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("แต้มสะสมถึง", languageSelectIndex) + " " + __docDate, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __currentPointBalance.ToString(this._formatNumber2), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                            }
                        }

                        //
                        if (this._showShortDescription && _g.g._companyProfile._vat_rate > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, "V=" + _getResource("สินค้ามีภาษีมูลค่าเพิ่ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, "E=" + _getResource("สินค้ายกเว้นภาษี", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            //
                        }
                        string __saleCode = __trans.Rows[0][_g.d.ic_trans._sale_code].ToString();
                        string __cashierCode = __trans.Rows[0][_g.d.ic_trans._cashier_code].ToString();
                        if (__cashierCode.Equals(__saleCode) == false && mode == _printSlipMode.ใบกำกับภาษีอย่างย่อ)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("พนักงานขาย", languageSelectIndex) + " : " + __saleCode, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }
                        //
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            __y += 15f;
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ผู้รับเงิน", languageSelectIndex) + "................................................................" + __saleCode, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);

                            // remark
                            if (__trans.Rows[0][_g.d.ic_trans._remark].ToString().Length > 0)
                            {
                                __y += 15;
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("หมายเหตุ", languageSelectIndex) + " ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __trans.Rows[0][_g.d.ic_trans._remark].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                                __y += 15;
                            }
                        }
                        if (this._posFooter.Trim().Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, this._posFooter, new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }
                        #endregion

                    }
                    break;
                #endregion
                #region ใบเสร็จแบบที่ 7 บรรทัดแรก รายการ หน่วย ราคารวม กรณี มีมากกว่า 1 ชิ้นแสดง บรรทัด 2 แสดง จำนวน x ราคาต่อหน่วย // Somkid : slip เบอร์ 7 ขยับหน่วยนับ ไปข้างหน้าอีก 4 เคาะ เพราะไปชนกับยอดเงิน
                case 7:
                    {

                        #region ข้อมูลบริษัท

                        if (this._posHeader.Trim().Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, this._posHeader, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false, true);
                        }
                        else
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __ltdName, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __ltdAddress, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            string __telephone = "";
                            if (__ltdTel.Trim().Length > 0)
                            {
                                __telephone = _getResource("โทรศัพท์", languageSelectIndex) + ":" + __ltdTel.Trim();
                            }
                            if (__ltdFax.Trim().Length > 0)
                            {
                                __telephone = __telephone + " " + _getResource("โทรสาร", languageSelectIndex) + ":" + __ltdFax.Trim();
                            }
                            if (__telephone.Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __telephone, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            }
                            //

                            if (__ltdTax != null && __ltdTax.Trim().Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขประจำตัวผู้เสียภาษีอากร", languageSelectIndex) + " : " + __ltdTax, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            }
                        }

                        #endregion

                        #region ส่วนหัว แสดงข้อมูลลูกค้า

                        if (header.Length > 0)
                        {
                            // ข้อความเพิ่มเติม
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource(header, languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Center, false);
                        }
                        __y += this._fontHeaderSize;
                        // toe change headerSlip 
                        // ย้ายไปข้างบน
                        //if (_posBillType.Length > 0)
                        //{
                        //    headerSlip = _posBillType;
                        //}

                        __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource(headerSlip, languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Center, false);
                        __y += this._fontHeaderSize;
                        this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขเครื่อง", languageSelectIndex) + " : " + __trans.Rows[0]["pos_id_desc"].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        string __cashierName = "";
                        try
                        {
                            __cashierName = __trans.Rows[0]["cashier_name"].ToString().Split(' ')[0].ToString().Trim();
                        }
                        catch
                        {
                        }
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            __cashierName = __trans.Rows[0][_g.d.ic_trans._cashier_code].ToString();
                        }

                        __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("พนักงาน", languageSelectIndex) + " : " + __cashierName, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                        if (header.IndexOf("ยกเลิก") != -1)
                        {
                            string __cancelDocNo = __trans.Rows[0]["cancel_doc_no"].ToString();
                            string __cancelDocDate = MyLib._myGlobal._convertDateFromQuery(__trans.Rows[0]["cancel_doc_date"].ToString()).ToString("dd-MM-yyyy", new CultureInfo("th-TH"));

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขที่เอกสารยกเลิก", languageSelectIndex) + ":" + __cancelDocNo, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("วันที่", languageSelectIndex) + ":" + __cancelDocDate, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }

                        // เลขที่เอกสาร วันที่ เวลา
                        string __docDate = MyLib._myGlobal._convertDateFromQuery(__trans.Rows[0][_g.d.ic_trans._doc_date].ToString()).ToString("dd-MM-yyyy", new CultureInfo("th-TH"));
                        string __docNo = __trans.Rows[0][_g.d.ic_trans._doc_no].ToString();
                        string __docRefNo = __trans.Rows[0][_g.d.ic_trans._doc_ref].ToString();
                        __docGuid = __trans.Rows[0][_g.d.ic_trans._doc_no_guid].ToString().Trim();
                        //


                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขที่", languageSelectIndex) + ":" + __docNo, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขที่อ้างอิง", languageSelectIndex) + ":" + __docRefNo, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("วันที่", languageSelectIndex) + ":" + __docDate + "@" + __trans.Rows[0][_g.d.ic_trans._doc_time].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ลูกค้า", languageSelectIndex) + " : " + __memberName, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขประจำตัวผู้เสียภาษี", languageSelectIndex) + " : " + __cust_taxid, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, ((__branch_type == "1") ? " [   ] " + __headquatreStr + " [ x ] " + __branchStr + " " + __branch_code : " [ x ] " + __headquatreStr + " [   ] " + __branchStr), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ที่อยู่", languageSelectIndex) + " : " + __memberAddress, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                        }
                        else
                        {
                            if (__memberCode.Trim().Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("สมาชิก", languageSelectIndex) + " : " + __memberName + " (" + __memberCode + ")", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            }

                            // พิมพ์โต๊ะ
                            if (__tableNumberStr.Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("หมายเลขโต๊ะ", languageSelectIndex) + " : " + __tableNumberStr, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            }

                            if ((MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro) && __table_trans.Rows.Count > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เวลาเข้า", languageSelectIndex) + " : " + __table_trans.Rows[0][_g.d.table_trans._open_doc_time].ToString() + " " + _getResource("เวลาออก", languageSelectIndex) + " : " + __table_trans.Rows[0][_g.d.table_trans._close_doc_time].ToString(), new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Left, false);

                            }
                        }

                        if (__customer_phone.Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __customer_phone, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }

                        __y += this._printSlipLine(__g, __width, __y);


                        #endregion

                        #region รายการสินค้า
                        //
                        //Font __fontDetail1 = new Font(this._fontHeaderName, 10);
                        //Font __fontDetail2 = new Font(this._fontHeaderName, 10, FontStyle.Italic);
                        int __transCount = 0;
                        decimal __itemQtyCount = 0;
                        decimal __saveAmount = 0;
                        decimal __sumFood = 0M;
                        decimal __sumDrink = 0M;
                        for (int __row = 0; __row < __transDetail.Rows.Count; __row++)
                        {
                            DataRow __data = __transDetail.Rows[__row];
                            if (__data[_g.d.ic_trans_detail._item_type].ToString().Equals("3"))
                            {
                                // สินค้าชุด ข้ามไป
                                continue;
                            }

                            decimal __amount = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._sum_amount].ToString());

                            if (MyLib._myGlobal._decimalPhase(__data[_g.d.ic_inventory_barcode._hidden_text].ToString()) == 0)
                            {
                                __transCount++;
                                decimal __price = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._price].ToString());
                                decimal __qty = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._qty].ToString());
                                decimal __priceDefault = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._price_default].ToString());
                                __itemQtyCount += __qty;
                                string __discountWord = __data[_g.d.ic_trans_detail._discount].ToString();
                                string __priceInfo = __data[_g.d.ic_trans_detail._remark].ToString();
                                decimal __discountAmount = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._discount_amount].ToString());
                                // มูลค่าสินค้า+vat
                                string __extraWord = "";
                                int __taxType = (int)MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._tax_type].ToString());

                                // toe แก้ extraword เอา case 0 ออก                            
                                switch (__taxType)
                                {
                                    case 0:
                                        __extraWord = "V";
                                        break;
                                }
                                // รายละเอียดสินค้า
                                StringBuilder __detail = new StringBuilder();
                                if (languageSelectIndex == 0)
                                {
                                    __detail.Append(__data[_g.d.ic_trans_detail._item_name].ToString().Trim());
                                }
                                else
                                {
                                    string __itemNameEn = __data[_g.d.ic_trans_detail._item_name_en].ToString().Trim();
                                    if (__itemNameEn.Length > 0)
                                    {
                                        __detail.Append(__itemNameEn);
                                    }
                                    else
                                    {
                                        __detail.Append(__data[_g.d.ic_trans_detail._item_name].ToString().Trim());
                                    }
                                }

                                //if (__priceDefault != __amount)
                                //{
                                //    __detail.Append(" " + "@" + __priceDefault.ToString(this._formatNumber1));
                                //}
                                float __lineHeight = this._printSlipText(__g, __width, __width * 0.5f, 0, __y, __detail.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);

                                // หน่วย
                                string _unit_name = __data[_g.d.ic_trans_detail._unit_name].ToString();

                                if (languageSelectIndex > 0)
                                {
                                    string __unit_name_en = __data[_g.d.ic_trans_detail._unit_name_en].ToString();

                                    if (__unit_name_en.Length > 0)
                                    {
                                        _unit_name = __unit_name_en;
                                    }
                                }

                                this._printSlipText(__g, __width, __width * 0.2f, (__width * 0.5f), __y, _unit_name, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);

                                // ราคารวม
                                this._printSlipText(__g, __width - 15, __width - 10, 0, __y, __amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                if (this._showTaxDetail && _g.g._companyProfile._vat_rate > 0)
                                {
                                    this._printSlipText(__g, __width, __width, 0, __y, __extraWord, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                }

                                // กรณี มีจำนวนมากกว่า 1
                                if (__qty > 1)
                                {
                                    decimal __newPrice = __amount / __qty;
                                    string __qtyStr = (__qty == Math.Round(__qty, 0)) ? __qty.ToString(this._formatNumber2) : __qty.ToString(this._formatNumber1);
                                    string __priceStr = __price.ToString(this._formatNumber1);
                                    StringBuilder __memberPrice = new StringBuilder(__qtyStr + " x " + "@" + __priceStr);

                                    __y += __lineHeight;
                                    __lineHeight = this._printSlipText(__g, __width, __width, 5, __y, __memberPrice.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                }
                                // ส่วนลด
                                if (__discountAmount != 0)
                                {
                                    //StringBuilder __discountStr = new StringBuilder("ราคาปรกติ" + " : " + __priceDefault.ToString(this._formatNumber1) + " " + "บาท");
                                    //__y += this._printSlipText(__g, __width, __width, 5, __y, __discountStr.ToString(), new Font(this._fontDetailName, this._fontDetailSize * 0.8f), SMLPOSControl._printSlipTextStyle.Left);
                                    __saveAmount += __discountAmount;
                                    /*StringBuilder __discountStr = new StringBuilder();
                                    __discountStr.Append(__priceInfo + " " + "ลด");
                                    __discountStr.Append(" " + __discountAmount.ToString(this._formatNumber1) + " " + "บาท");
                                    if (__priceDefault != 0)
                                    {
                                        __discountStr.Append(" " + "จาก" + " " + __priceDefault.ToString(this._formatNumber1) + " " + "บาท");
                                    }
                                    __y += this._printSlipText(__g, __width, __width, 5, __y, __discountStr.ToString(), new Font(this._fontDetailName, this._fontDetailSize * 0.8f), SMLPOSControl._printSlipTextStyle.Left);
                                    __saveAmount += __discountAmount;
                                     */
                                }

                                __y += __lineHeight;
                                if (__serialNumberTable != null && __serialNumberTable.Rows.Count > 0)
                                {
                                    // Serial Number
                                    DataRow[] __serial = __serialNumberTable.Select(_g.d.ic_trans_serial_number._doc_line_number + "=\'" + (__row).ToString() + "\'");
                                    for (int __serialLoop = 0; __serialLoop < __serial.Length; __serialLoop++)
                                    {
                                        __y += this._printSlipText(__g, __width, __width, 0, __y, "S/N:" + __serial[__serialLoop][_g.d.ic_trans_serial_number._serial_number].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                    }
                                }
                            }

                            if (__data[_g.d.ic_inventory._drink_type].ToString().Equals("1"))
                            {
                                __sumDrink += __amount;
                            }
                            else
                            {
                                __sumFood += __amount;
                            }
                        }

                        #endregion

                        #region รายการ promotion
                        for (int __row = 0; __row < __transDetailPromotion.Rows.Count; __row++)
                        {
                            DataRow __data = __transDetailPromotion.Rows[__row];
                            decimal __amount = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail_promotion._sum_amount].ToString());

                            //__transCount++;
                            decimal __price = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail_promotion._price].ToString());
                            decimal __qty = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail_promotion._qty].ToString());

                            //__itemQtyCount += __qty;

                            StringBuilder __detail = new StringBuilder();
                            __detail.Append(__data[_g.d.ic_trans_detail_promotion._promotion_name].ToString().Trim());

                            float __lineHeight = this._printSlipText(__g, __width, __width * 0.8f, 0, __y, __detail.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                            // ราคาสามาชิก
                            //if (__memberCode.Trim().Length > 0)
                            //{
                            //    decimal __newPrice = __amount / __qty;
                            //    string __qtyStr = (__qty == Math.Round(__qty, 0)) ? __qty.ToString(this._formatNumber2) : __qty.ToString(this._formatNumber1);
                            //    string __priceStr = __newPrice.ToString(this._formatNumber1);
                            //    StringBuilder __memberPrice = new StringBuilder("ราคาสมาชิก" + " " + "@" + __priceStr);
                            //    if (__qty > 1)
                            //    {
                            //        __memberPrice.Append("x");
                            //        __memberPrice.Append(__qtyStr);
                            //    }
                            //    __y += __lineHeight;
                            //    __lineHeight = this._printSlipText(__g, __width, __width, 5, __y, __memberPrice.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            //}
                            // ส่วนลด
                            //if (__discountAmount != 0)
                            //{
                            //    //StringBuilder __discountStr = new StringBuilder("ราคาปรกติ" + " : " + __priceDefault.ToString(this._formatNumber1) + " " + "บาท");
                            //    //__y += this._printSlipText(__g, __width, __width, 5, __y, __discountStr.ToString(), new Font(this._fontDetailName, this._fontDetailSize * 0.8f), SMLPOSControl._printSlipTextStyle.Left);
                            //    __saveAmount += __discountAmount;
                            //    /*StringBuilder __discountStr = new StringBuilder();
                            //    __discountStr.Append(__priceInfo + " " + "ลด");
                            //    __discountStr.Append(" " + __discountAmount.ToString(this._formatNumber1) + " " + "บาท");
                            //    if (__priceDefault != 0)
                            //    {
                            //        __discountStr.Append(" " + "จาก" + " " + __priceDefault.ToString(this._formatNumber1) + " " + "บาท");
                            //    }
                            //    __y += this._printSlipText(__g, __width, __width, 5, __y, __discountStr.ToString(), new Font(this._fontDetailName, this._fontDetailSize * 0.8f), SMLPOSControl._printSlipTextStyle.Left);
                            //    __saveAmount += __discountAmount;
                            //     */
                            //}
                            this._printSlipText(__g, __width - 15, __width - 10, 0, __y, __amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                            //if (this._showTaxDetail)
                            //{
                            //    this._printSlipText(__g, __width, __width, 0, __y, __extraWord, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            //}
                            __y += __lineHeight;

                        }

                        #endregion

                        #region ส่วนท้ายบิล

                        decimal __discountFooter = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_discount].ToString());
                        //decimal __diff_amount = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._total_income_amount].ToString());
                        decimal __serviceChargeAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_service_charge].ToString());

                        // ท้ายบิล 
                        // โต๋ ดุให้ดี ๆ นะ มีผลกระทบต่อ ที่อื่นนะ 
                        // ถ้เาป็นค่าลบ เอายอดปัดเศษ มาโชวในส่วนลดด้วย
                        // ถ้าปัดขึนทำไงให้ดุดี
                        __totalAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_amount].ToString()) + __discountFooter + __totalAdvanceMoney;
                        __y += this._printSlipLine(__g, __width, __y);
                        string __footer1 = __transCount.ToString() + " " + _getResource("รายการ", languageSelectIndex) + " " + __itemQtyCount.ToString(this._formatNumber1) + " " + _getResource("ชิ้น", languageSelectIndex);
                        this._printSlipText(__g, __width, __width, 0, __y, __footer1, new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                        __y += this._printSlipText(__g, __width, __width, 0, __y, (__totalAmount - __serviceChargeAmount).ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                        // ส่วนลดท้ายบิล

                        // tomyumgoong ยอดอาหาร เครื่องดิ่ม
                        if (MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro)
                        {
                            float __lineHeight = 0;

                            if (__serviceChargeAmount > 0)
                            {
                                string __serviceChargeText = __trans.Rows[0][_g.d.ic_trans._service_charge_word].ToString();
                                __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("Service Charge", languageSelectIndex) + " " + ((__serviceChargeText.IndexOf("%") != -1) ? __serviceChargeText : ""), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                this._printSlipText(__g, __width, __width, 0, __y, __serviceChargeAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                __y += __lineHeight;
                            }

                            __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("อาหาร", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            this._printSlipText(__g, __width, __width, 0, __y, __sumFood.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += __lineHeight;

                            __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("เครื่องดื่ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            this._printSlipText(__g, __width, __width, 0, __y, __sumDrink.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += __lineHeight;

                            __y += this._printSlipLine(__g, __width, __y);
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("รวมทั้งสิ้น", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += this._printSlipLine(__g, __width, __y);

                        }

                        // เงินมัดจำ
                        if (__totalAdvanceMoney > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, "เงินมัดจำ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            for (int __row = 0; __row < __advanceMoneyDetail.Rows.Count; __row++)
                            {

                                string __detail = string.Format("{0}:{1}", __advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._trans_number].ToString(), MyLib._myGlobal._convertDateFromQuery(__advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._doc_date_ref].ToString()).ToString("dd-MM-yyyy", new CultureInfo("th-TH")));
                                decimal __advanceAmount = MyLib._myGlobal._decimalPhase(__advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._amount].ToString());

                                this._printSlipText(__g, __width, __width, 0, __y, __detail, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __advanceAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                        }

                        if (__discountFooter != 0)
                        {
                            string __discountWord2 = _getResource("ส่วนลดพิเศษ", languageSelectIndex);
                            string __discountWord = __trans.Rows[0][_g.d.ic_trans._discount_word].ToString().Trim();
                            if (__discountWord.Length > 0)
                            {
                                __discountWord2 = __discountWord2 + " : " + __discountWord;
                            }
                            this._printSlipText(__g, __width, __width, 0, __y, __discountWord2, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __discountFooter.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __saveAmount += __discountFooter;
                            // คงเหลือ
                            __totalAmount -= __discountFooter;
                        }

                        // ผลต่างปัดเศษ
                        //decimal __diffAmount = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._total_income_amount].ToString());
                        if (__diff_amount != 0)
                        {
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("ผลต่างการปัดเศษ", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __diff_amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __saveAmount += (__diff_amount);
                            __totalAmount += (__diff_amount * -1);
                        }

                        if (__discountFooter != 0 || __diff_amount != 0)
                        {
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("คงเหลือยอดชำระ", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                        }

                        // ภาษีมูลค่าเพิ่ม
                        decimal __beforeVatAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_before_vat].ToString());
                        decimal __exceptVatAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_except_vat].ToString());
                        decimal __vatAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_vat_value].ToString());
                        decimal __vatRate = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._vat_rate].ToString());

                        // toe เพิ่ม option แสดงรายละเอียดภาษี
                        if (this._showTaxDetail && _g.g._companyProfile._vat_rate > 0)
                        {

                            __y += this._printSlipLine(__g, __width, __y);
                            // สินค้ายกเว้นภาษี
                            if (__exceptVatAmount != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("มูลค่าสินค้ายกเว้นภาษีมูลค่าเพิ่ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __exceptVatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                            //
                            if (__beforeVatAmount != 0 || __vatAmount != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("มูลค่าสินค้ามีภาษีมูลค่าเพิ่ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __beforeVatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                //
                                string __vatRateStr = (__vatRate == Math.Round(__vatRate, 0)) ? __vatRate.ToString(this._formatNumber2) : __vatRate.ToString(this._formatNumber1);
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ภาษีมูลค่าเพิ่ม", languageSelectIndex) + " : " + __vatRateStr + "%", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __vatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                        }
                        __y += this._printSlipLine(__g, __width, __y);
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("รวมเงิน", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                            SMLReport._formReport._moneyToText __moneyToText = new SMLReport._formReport._moneyToText();
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __moneyToText._toText(__totalAmount), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipLine(__g, __width, __y);
                        }
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างย่อ)
                        {
                            // ประหยัด
                            if (__saveAmount != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("คุณประหยัดครั้งนี้", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __saveAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                            __y += this._printSlipLine(__g, __width, __y);
                            // ยอดชำระ
                            //__payCash = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._pay_cash_amount].ToString());
                            if (__payCash != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระด้วยเงินสด", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __payCash.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                            if (__creditCardDetail != null)
                            {
                                for (int __row = 0; __row < __creditCardDetail.Rows.Count; __row++)
                                {
                                    decimal __creditCardTotalAmount = MyLib._myGlobal._decimalPhase(__creditCardDetail.Rows[__row][_g.d.cb_trans_detail._sum_amount].ToString());
                                    decimal __creditCardChargeAmount = MyLib._myGlobal._decimalPhase(__creditCardDetail.Rows[__row][_g.d.cb_trans_detail._charge].ToString());
                                    if (__creditCardTotalAmount != 0)
                                    {
                                        string __creditCardType = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._credit_card_type].ToString();
                                        string __creditCardNumber = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._trans_number].ToString();
                                        for (int __loop = 0; __loop < __creditCardNumber.Length - 4; __loop++)
                                        {
                                            __creditCardNumber = __creditCardNumber.Remove(__loop, 1);
                                            __creditCardNumber = __creditCardNumber.Insert(__loop, "*");
                                        }
                                        //
                                        this._printSlipText(__g, __width, __width, 0, __y, __creditCardType + " " + __creditCardNumber, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                        __y += this._printSlipText(__g, __width, __width, 0, __y, __creditCardTotalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                        //
                                        if (__creditCardChargeAmount != 0)
                                        {
                                            __y += this._printSlipText(__g, __width, __width, 10, __y, _getResource("Charge", languageSelectIndex) + " : " + __creditCardChargeAmount.ToString(this._formatNumber1) + " บาท", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Italic), SMLPOSControl._printSlipTextStyle.Left, false);
                                        }
                                        //
                                        string __creditCardApproved = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._no_approved].ToString();
                                        __y += this._printSlipText(__g, __width, __width, 10, __y, _getResource("Approval", languageSelectIndex) + " : " + __creditCardApproved, new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Italic), SMLPOSControl._printSlipTextStyle.Left, false);
                                    }
                                }
                            }

                            // ชำระด้วยคูปอง
                            //__payCoupon = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._coupon_amount].ToString());
                            if (__payCoupon != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระด้วยคูปอง", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __payCoupon.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                            // ชำระด้วยแต้ม
                            //__payPoint = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._point_amount].ToString());
                            if (__payPoint != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระด้วยแต้ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __payPoint.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                            // เงินทอน
                            //__moneyChange = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._money_change].ToString());
                            if (__moneyChange != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("เงินทอน", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __moneyChange.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                            //
                            __y += this._printSlipLine(__g, __width, __y);

                            // order detail
                            if ((MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro) && this._show_order_detail && (this._show_order_detail_copy_Only == false || (this._show_order_detail_copy_Only == true && header == "- สำเนา -")))
                            {
                                // order detail
                                for (int __orderRow = 0; __orderRow < __tableOrderDetail.Rows.Count; __orderRow++)
                                {
                                    __y += this._printSlipText(__g, __width, __width, 0, __y, "ใบสั่ง : " + __tableOrderDetail.Rows[__orderRow][_g.d.table_order_doc._doc_no].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                }

                                // order cancel
                                for (int __cancelRow = 0; __cancelRow < __tableOrderCancel.Rows.Count; __cancelRow++)
                                {
                                    decimal __cancelAmount = MyLib._myGlobal._decimalPhase(__tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._sum_amount].ToString());

                                    __y += this._printSlipText(__g, __width, __width, 0, __y, (__tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._cancel_flag].ToString().Equals("1") ? "ย้ายออก " + __tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._table_number_2].ToString() + " : " : "ยกเลิก : ") + __tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._item_name].ToString() + " " + __cancelAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                }
                                __y += this._printSlipLine(__g, __width, __y);

                            }
                        }
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างย่อ)
                        {
                            string __docNoAndTime = _getResource("เลขที่", languageSelectIndex) + ":" + __docNo + " " + _getResource("วันที่", languageSelectIndex) + ":" + __docDate + "@" + __trans.Rows[0][_g.d.ic_trans._doc_time].ToString();
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __docNoAndTime, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);

                            if (__currentPoint > 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("แต้มครั้งนี้", languageSelectIndex) + ":", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __currentPoint.ToString(this._formatNumber2), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                                SMLProcess._posProcess __process = new SMLProcess._posProcess();
                                decimal __currentPointBalance = __process._pointBalance(__cust_code, true);

                                // แต้มสะสม
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("แต้มสะสมถึง", languageSelectIndex) + " " + __docDate, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __currentPointBalance.ToString(this._formatNumber2), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                            }
                        }

                        //
                        if (this._showShortDescription && _g.g._companyProfile._vat_rate > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, "V=" + _getResource("สินค้ามีภาษีมูลค่าเพิ่ม", languageSelectIndex) + " " + "E=" + _getResource("สินค้ายกเว้นภาษี", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            //
                        }
                        string __saleCode = __trans.Rows[0][_g.d.ic_trans._sale_code].ToString();
                        string __cashierCode = __trans.Rows[0][_g.d.ic_trans._cashier_code].ToString();
                        if (__cashierCode.Equals(__saleCode) == false && mode == _printSlipMode.ใบกำกับภาษีอย่างย่อ)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("พนักงานขาย", languageSelectIndex) + " : " + __saleCode, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }
                        //
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            __y += 15f;
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ผู้รับเงิน", languageSelectIndex) + "................................................................" + __saleCode, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);

                            // remark
                            if (__trans.Rows[0][_g.d.ic_trans._remark].ToString().Length > 0)
                            {
                                __y += 15;
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("หมายเหตุ", languageSelectIndex) + " ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __trans.Rows[0][_g.d.ic_trans._remark].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                                __y += 15;
                            }
                        }
                        if (this._posFooter.Trim().Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, this._posFooter, new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }
                        #endregion

                    }
                    break;
                #endregion
                #region ใบเสร็จแบบที่ 8 บรรทัดแรก รายการ หน่วย ราคารวม กรณี มีมากกว่า 1 ชิ้นแสดง บรรทัด 2 แสดง จำนวน x ราคาต่อหน่วย // Somkid : slip เบอร์ 8 ขยับหน่วยนับ ไปข้างหน้าอีก 4 เคาะ เพราะไปชนกับยอดเงิน ขยับอีก 2 เคาะ
                case 8:
                    {

                        #region ข้อมูลบริษัท

                        if (this._posHeader.Trim().Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, this._posHeader, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false, true);
                        }
                        else
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __ltdName, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __ltdAddress, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            string __telephone = "";
                            if (__ltdTel.Trim().Length > 0)
                            {
                                __telephone = _getResource("โทรศัพท์", languageSelectIndex) + ":" + __ltdTel.Trim();
                            }
                            if (__ltdFax.Trim().Length > 0)
                            {
                                __telephone = __telephone + " " + _getResource("โทรสาร", languageSelectIndex) + ":" + __ltdFax.Trim();
                            }
                            if (__telephone.Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __telephone, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            }
                            //

                            if (__ltdTax != null && __ltdTax.Trim().Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขประจำตัวผู้เสียภาษีอากร", languageSelectIndex) + " : " + __ltdTax, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            }
                        }

                        #endregion

                        #region ส่วนหัว แสดงข้อมูลลูกค้า

                        if (header.Length > 0)
                        {
                            // ข้อความเพิ่มเติม
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource(header, languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Center, false);
                        }
                        __y += this._fontHeaderSize;
                        // toe change headerSlip 
                        // ย้ายไปข้างบน
                        //if (_posBillType.Length > 0)
                        //{
                        //    headerSlip = _posBillType;
                        //}

                        __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource(headerSlip, languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Center, false);
                        __y += this._fontHeaderSize;
                        this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขเครื่อง", languageSelectIndex) + " : " + __trans.Rows[0]["pos_id_desc"].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        string __cashierName = "";
                        try
                        {
                            __cashierName = __trans.Rows[0]["cashier_name"].ToString().Split(' ')[0].ToString().Trim();
                        }
                        catch
                        {
                        }
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            __cashierName = __trans.Rows[0][_g.d.ic_trans._cashier_code].ToString();
                        }

                        __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("พนักงาน", languageSelectIndex) + " : " + __cashierName, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                        if (header.IndexOf("ยกเลิก") != -1)
                        {
                            string __cancelDocNo = __trans.Rows[0]["cancel_doc_no"].ToString();
                            string __cancelDocDate = MyLib._myGlobal._convertDateFromQuery(__trans.Rows[0]["cancel_doc_date"].ToString()).ToString("dd-MM-yyyy", new CultureInfo("th-TH"));

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขที่เอกสารยกเลิก", languageSelectIndex) + ":" + __cancelDocNo, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("วันที่", languageSelectIndex) + ":" + __cancelDocDate, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }

                        // เลขที่เอกสาร วันที่ เวลา
                        string __docDate = MyLib._myGlobal._convertDateFromQuery(__trans.Rows[0][_g.d.ic_trans._doc_date].ToString()).ToString("dd-MM-yyyy", new CultureInfo("th-TH"));
                        string __docNo = __trans.Rows[0][_g.d.ic_trans._doc_no].ToString();
                        string __docRefNo = __trans.Rows[0][_g.d.ic_trans._doc_ref].ToString();
                        __docGuid = __trans.Rows[0][_g.d.ic_trans._doc_no_guid].ToString().Trim();
                        //


                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขที่", languageSelectIndex) + ":" + __docNo, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขที่อ้างอิง", languageSelectIndex) + ":" + __docRefNo, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("วันที่", languageSelectIndex) + ":" + __docDate + "@" + __trans.Rows[0][_g.d.ic_trans._doc_time].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ลูกค้า", languageSelectIndex) + " : " + __memberName, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขประจำตัวผู้เสียภาษี", languageSelectIndex) + " : " + __cust_taxid, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, ((__branch_type == "1") ? " [   ] " + __headquatreStr + " [ x ] " + __branchStr + " " + __branch_code : " [ x ] " + __headquatreStr + " [   ] " + __branchStr), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ที่อยู่", languageSelectIndex) + " : " + __memberAddress, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                        }
                        else
                        {
                            if (__memberCode.Trim().Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("สมาชิก", languageSelectIndex) + " : " + __memberName + " (" + __memberCode + ")", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            }

                            // พิมพ์โต๊ะ
                            if (__tableNumberStr.Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("หมายเลขโต๊ะ", languageSelectIndex) + " : " + __tableNumberStr, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            }

                            if ((MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro) && __table_trans.Rows.Count > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เวลาเข้า", languageSelectIndex) + " : " + __table_trans.Rows[0][_g.d.table_trans._open_doc_time].ToString() + " " + _getResource("เวลาออก", languageSelectIndex) + " : " + __table_trans.Rows[0][_g.d.table_trans._close_doc_time].ToString(), new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Left, false);

                            }
                        }

                        if (__customer_phone.Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __customer_phone, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }

                        __y += this._printSlipLine(__g, __width, __y);


                        #endregion

                        #region รายการสินค้า
                        //
                        //Font __fontDetail1 = new Font(this._fontHeaderName, 10);
                        //Font __fontDetail2 = new Font(this._fontHeaderName, 10, FontStyle.Italic);
                        int __transCount = 0;
                        decimal __itemQtyCount = 0;
                        decimal __saveAmount = 0;
                        decimal __sumFood = 0M;
                        decimal __sumDrink = 0M;
                        for (int __row = 0; __row < __transDetail.Rows.Count; __row++)
                        {
                            DataRow __data = __transDetail.Rows[__row];
                            if (__data[_g.d.ic_trans_detail._item_type].ToString().Equals("3"))
                            {
                                // สินค้าชุด ข้ามไป
                                continue;
                            }

                            decimal __amount = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._sum_amount].ToString());

                            if (MyLib._myGlobal._decimalPhase(__data[_g.d.ic_inventory_barcode._hidden_text].ToString()) == 0)
                            {
                                __transCount++;
                                decimal __price = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._price].ToString());
                                decimal __qty = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._qty].ToString());
                                decimal __priceDefault = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._price_default].ToString());
                                __itemQtyCount += __qty;
                                string __discountWord = __data[_g.d.ic_trans_detail._discount].ToString();
                                string __priceInfo = __data[_g.d.ic_trans_detail._remark].ToString();
                                decimal __discountAmount = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._discount_amount].ToString());
                                // มูลค่าสินค้า+vat
                                string __extraWord = "";
                                int __taxType = (int)MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._tax_type].ToString());

                                // toe แก้ extraword เอา case 0 ออก                            
                                switch (__taxType)
                                {
                                    case 0:
                                        __extraWord = "V";
                                        break;
                                }
                                // รายละเอียดสินค้า
                                StringBuilder __detail = new StringBuilder();
                                if (languageSelectIndex == 0)
                                {
                                    __detail.Append(__data[_g.d.ic_trans_detail._item_name].ToString().Trim());
                                }
                                else
                                {
                                    string __itemNameEn = __data[_g.d.ic_trans_detail._item_name_en].ToString().Trim();
                                    if (__itemNameEn.Length > 0)
                                    {
                                        __detail.Append(__itemNameEn);
                                    }
                                    else
                                    {
                                        __detail.Append(__data[_g.d.ic_trans_detail._item_name].ToString().Trim());
                                    }
                                }

                                //if (__priceDefault != __amount)
                                //{
                                //    __detail.Append(" " + "@" + __priceDefault.ToString(this._formatNumber1));
                                //}
                                float __lineHeight = this._printSlipText(__g, __width, __width * 0.45f, 0, __y, __detail.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);

                                // หน่วย
                                string _unit_name = __data[_g.d.ic_trans_detail._unit_name].ToString();

                                if (languageSelectIndex > 0)
                                {
                                    string __unit_name_en = __data[_g.d.ic_trans_detail._unit_name_en].ToString();

                                    if (__unit_name_en.Length > 0)
                                    {
                                        _unit_name = __unit_name_en;
                                    }
                                }

                                this._printSlipText(__g, __width, __width * 0.2f, (__width * 0.45f), __y, _unit_name, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);

                                // ราคารวม
                                this._printSlipText(__g, __width - 15, __width - 10, 0, __y, __amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                if (this._showTaxDetail && _g.g._companyProfile._vat_rate > 0)
                                {
                                    this._printSlipText(__g, __width, __width, 0, __y, __extraWord, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                }

                                // กรณี มีจำนวนมากกว่า 1
                                if (__qty > 1)
                                {
                                    decimal __newPrice = __amount / __qty;
                                    string __qtyStr = (__qty == Math.Round(__qty, 0)) ? __qty.ToString(this._formatNumber2) : __qty.ToString(this._formatNumber1);
                                    string __priceStr = __price.ToString(this._formatNumber1);
                                    StringBuilder __memberPrice = new StringBuilder(__qtyStr + " x " + "@" + __priceStr);

                                    __y += __lineHeight;
                                    __lineHeight = this._printSlipText(__g, __width, __width, 5, __y, __memberPrice.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                }
                                // ส่วนลด
                                if (__discountAmount != 0)
                                {
                                    //StringBuilder __discountStr = new StringBuilder("ราคาปรกติ" + " : " + __priceDefault.ToString(this._formatNumber1) + " " + "บาท");
                                    //__y += this._printSlipText(__g, __width, __width, 5, __y, __discountStr.ToString(), new Font(this._fontDetailName, this._fontDetailSize * 0.8f), SMLPOSControl._printSlipTextStyle.Left);
                                    __saveAmount += __discountAmount;
                                    /*StringBuilder __discountStr = new StringBuilder();
                                    __discountStr.Append(__priceInfo + " " + "ลด");
                                    __discountStr.Append(" " + __discountAmount.ToString(this._formatNumber1) + " " + "บาท");
                                    if (__priceDefault != 0)
                                    {
                                        __discountStr.Append(" " + "จาก" + " " + __priceDefault.ToString(this._formatNumber1) + " " + "บาท");
                                    }
                                    __y += this._printSlipText(__g, __width, __width, 5, __y, __discountStr.ToString(), new Font(this._fontDetailName, this._fontDetailSize * 0.8f), SMLPOSControl._printSlipTextStyle.Left);
                                    __saveAmount += __discountAmount;
                                     */
                                }

                                __y += __lineHeight;
                                if (__serialNumberTable != null && __serialNumberTable.Rows.Count > 0)
                                {
                                    // Serial Number
                                    DataRow[] __serial = __serialNumberTable.Select(_g.d.ic_trans_serial_number._doc_line_number + "=\'" + (__row).ToString() + "\'");
                                    for (int __serialLoop = 0; __serialLoop < __serial.Length; __serialLoop++)
                                    {
                                        __y += this._printSlipText(__g, __width, __width, 0, __y, "S/N:" + __serial[__serialLoop][_g.d.ic_trans_serial_number._serial_number].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                    }
                                }
                            }

                            if (__data[_g.d.ic_inventory._drink_type].ToString().Equals("1"))
                            {
                                __sumDrink += __amount;
                            }
                            else
                            {
                                __sumFood += __amount;
                            }
                        }

                        #endregion

                        #region รายการ promotion
                        for (int __row = 0; __row < __transDetailPromotion.Rows.Count; __row++)
                        {
                            DataRow __data = __transDetailPromotion.Rows[__row];
                            decimal __amount = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail_promotion._sum_amount].ToString());

                            //__transCount++;
                            decimal __price = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail_promotion._price].ToString());
                            decimal __qty = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail_promotion._qty].ToString());

                            //__itemQtyCount += __qty;

                            StringBuilder __detail = new StringBuilder();
                            __detail.Append(__data[_g.d.ic_trans_detail_promotion._promotion_name].ToString().Trim());

                            float __lineHeight = this._printSlipText(__g, __width, __width * 0.8f, 0, __y, __detail.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                            // ราคาสามาชิก
                            //if (__memberCode.Trim().Length > 0)
                            //{
                            //    decimal __newPrice = __amount / __qty;
                            //    string __qtyStr = (__qty == Math.Round(__qty, 0)) ? __qty.ToString(this._formatNumber2) : __qty.ToString(this._formatNumber1);
                            //    string __priceStr = __newPrice.ToString(this._formatNumber1);
                            //    StringBuilder __memberPrice = new StringBuilder("ราคาสมาชิก" + " " + "@" + __priceStr);
                            //    if (__qty > 1)
                            //    {
                            //        __memberPrice.Append("x");
                            //        __memberPrice.Append(__qtyStr);
                            //    }
                            //    __y += __lineHeight;
                            //    __lineHeight = this._printSlipText(__g, __width, __width, 5, __y, __memberPrice.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            //}
                            // ส่วนลด
                            //if (__discountAmount != 0)
                            //{
                            //    //StringBuilder __discountStr = new StringBuilder("ราคาปรกติ" + " : " + __priceDefault.ToString(this._formatNumber1) + " " + "บาท");
                            //    //__y += this._printSlipText(__g, __width, __width, 5, __y, __discountStr.ToString(), new Font(this._fontDetailName, this._fontDetailSize * 0.8f), SMLPOSControl._printSlipTextStyle.Left);
                            //    __saveAmount += __discountAmount;
                            //    /*StringBuilder __discountStr = new StringBuilder();
                            //    __discountStr.Append(__priceInfo + " " + "ลด");
                            //    __discountStr.Append(" " + __discountAmount.ToString(this._formatNumber1) + " " + "บาท");
                            //    if (__priceDefault != 0)
                            //    {
                            //        __discountStr.Append(" " + "จาก" + " " + __priceDefault.ToString(this._formatNumber1) + " " + "บาท");
                            //    }
                            //    __y += this._printSlipText(__g, __width, __width, 5, __y, __discountStr.ToString(), new Font(this._fontDetailName, this._fontDetailSize * 0.8f), SMLPOSControl._printSlipTextStyle.Left);
                            //    __saveAmount += __discountAmount;
                            //     */
                            //}
                            this._printSlipText(__g, __width - 15, __width - 10, 0, __y, __amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                            //if (this._showTaxDetail)
                            //{
                            //    this._printSlipText(__g, __width, __width, 0, __y, __extraWord, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            //}
                            __y += __lineHeight;

                        }

                        #endregion

                        #region ส่วนท้ายบิล

                        decimal __discountFooter = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_discount].ToString());
                        //decimal __diff_amount = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._total_income_amount].ToString());
                        decimal __serviceChargeAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_service_charge].ToString());

                        // ท้ายบิล 
                        // โต๋ ดุให้ดี ๆ นะ มีผลกระทบต่อ ที่อื่นนะ 
                        // ถ้เาป็นค่าลบ เอายอดปัดเศษ มาโชวในส่วนลดด้วย
                        // ถ้าปัดขึนทำไงให้ดุดี
                        __totalAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_amount].ToString()) + __discountFooter + __totalAdvanceMoney;
                        __y += this._printSlipLine(__g, __width, __y);
                        string __footer1 = __transCount.ToString() + " " + _getResource("รายการ", languageSelectIndex) + " " + __itemQtyCount.ToString(this._formatNumber1) + " " + _getResource("ชิ้น", languageSelectIndex);
                        this._printSlipText(__g, __width, __width, 0, __y, __footer1, new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                        __y += this._printSlipText(__g, __width, __width, 0, __y, (__totalAmount - __serviceChargeAmount).ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                        // ส่วนลดท้ายบิล

                        // tomyumgoong ยอดอาหาร เครื่องดิ่ม
                        if (MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro)
                        {
                            float __lineHeight = 0;

                            if (__serviceChargeAmount > 0)
                            {
                                string __serviceChargeText = __trans.Rows[0][_g.d.ic_trans._service_charge_word].ToString();
                                __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("Service Charge", languageSelectIndex) + " " + ((__serviceChargeText.IndexOf("%") != -1) ? __serviceChargeText : ""), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                this._printSlipText(__g, __width, __width, 0, __y, __serviceChargeAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                __y += __lineHeight;
                            }

                            __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("อาหาร", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            this._printSlipText(__g, __width, __width, 0, __y, __sumFood.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += __lineHeight;

                            __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("เครื่องดื่ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            this._printSlipText(__g, __width, __width, 0, __y, __sumDrink.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += __lineHeight;

                            __y += this._printSlipLine(__g, __width, __y);
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("รวมทั้งสิ้น", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += this._printSlipLine(__g, __width, __y);

                        }

                        // เงินมัดจำ
                        if (__totalAdvanceMoney > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, "เงินมัดจำ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            for (int __row = 0; __row < __advanceMoneyDetail.Rows.Count; __row++)
                            {

                                string __detail = string.Format("{0}:{1}", __advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._trans_number].ToString(), MyLib._myGlobal._convertDateFromQuery(__advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._doc_date_ref].ToString()).ToString("dd-MM-yyyy", new CultureInfo("th-TH")));
                                decimal __advanceAmount = MyLib._myGlobal._decimalPhase(__advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._amount].ToString());

                                this._printSlipText(__g, __width, __width, 0, __y, __detail, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __advanceAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                        }

                        if (__discountFooter != 0)
                        {
                            string __discountWord2 = _getResource("ส่วนลดพิเศษ", languageSelectIndex);
                            string __discountWord = __trans.Rows[0][_g.d.ic_trans._discount_word].ToString().Trim();
                            if (__discountWord.Length > 0)
                            {
                                __discountWord2 = __discountWord2 + " : " + __discountWord;
                            }
                            this._printSlipText(__g, __width, __width, 0, __y, __discountWord2, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __discountFooter.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __saveAmount += __discountFooter;
                            // คงเหลือ
                            __totalAmount -= __discountFooter;
                        }

                        // ผลต่างปัดเศษ
                        //decimal __diffAmount = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._total_income_amount].ToString());
                        if (__diff_amount != 0)
                        {
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("ผลต่างการปัดเศษ", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __diff_amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __saveAmount += (__diff_amount);
                            __totalAmount += (__diff_amount * -1);
                        }

                        if (__discountFooter != 0 || __diff_amount != 0)
                        {
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("คงเหลือยอดชำระ", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                        }

                        // ภาษีมูลค่าเพิ่ม
                        decimal __beforeVatAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_before_vat].ToString());
                        decimal __exceptVatAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_except_vat].ToString());
                        decimal __vatAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_vat_value].ToString());
                        decimal __vatRate = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._vat_rate].ToString());

                        // toe เพิ่ม option แสดงรายละเอียดภาษี
                        if (this._showTaxDetail && _g.g._companyProfile._vat_rate > 0)
                        {

                            __y += this._printSlipLine(__g, __width, __y);
                            // สินค้ายกเว้นภาษี
                            if (__exceptVatAmount != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("มูลค่าสินค้ายกเว้นภาษีมูลค่าเพิ่ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __exceptVatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                            //
                            if (__beforeVatAmount != 0 || __vatAmount != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("มูลค่าสินค้ามีภาษีมูลค่าเพิ่ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __beforeVatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                //
                                string __vatRateStr = (__vatRate == Math.Round(__vatRate, 0)) ? __vatRate.ToString(this._formatNumber2) : __vatRate.ToString(this._formatNumber1);
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ภาษีมูลค่าเพิ่ม", languageSelectIndex) + " : " + __vatRateStr + "%", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __vatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                        }
                        __y += this._printSlipLine(__g, __width, __y);
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("รวมเงิน", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                            SMLReport._formReport._moneyToText __moneyToText = new SMLReport._formReport._moneyToText();
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __moneyToText._toText(__totalAmount), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipLine(__g, __width, __y);
                        }
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างย่อ)
                        {
                            // ประหยัด
                            if (__saveAmount != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("คุณประหยัดครั้งนี้", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __saveAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                            __y += this._printSlipLine(__g, __width, __y);
                            // ยอดชำระ
                            //__payCash = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._pay_cash_amount].ToString());
                            if (__payCash != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระด้วยเงินสด", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __payCash.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                            if (__creditCardDetail != null)
                            {
                                for (int __row = 0; __row < __creditCardDetail.Rows.Count; __row++)
                                {
                                    decimal __creditCardTotalAmount = MyLib._myGlobal._decimalPhase(__creditCardDetail.Rows[__row][_g.d.cb_trans_detail._sum_amount].ToString());
                                    decimal __creditCardChargeAmount = MyLib._myGlobal._decimalPhase(__creditCardDetail.Rows[__row][_g.d.cb_trans_detail._charge].ToString());
                                    if (__creditCardTotalAmount != 0)
                                    {
                                        string __creditCardType = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._credit_card_type].ToString();
                                        string __creditCardNumber = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._trans_number].ToString();
                                        for (int __loop = 0; __loop < __creditCardNumber.Length - 4; __loop++)
                                        {
                                            __creditCardNumber = __creditCardNumber.Remove(__loop, 1);
                                            __creditCardNumber = __creditCardNumber.Insert(__loop, "*");
                                        }
                                        //
                                        this._printSlipText(__g, __width, __width, 0, __y, __creditCardType + " " + __creditCardNumber, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                        __y += this._printSlipText(__g, __width, __width, 0, __y, __creditCardTotalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                        //
                                        if (__creditCardChargeAmount != 0)
                                        {
                                            __y += this._printSlipText(__g, __width, __width, 10, __y, _getResource("Charge", languageSelectIndex) + " : " + __creditCardChargeAmount.ToString(this._formatNumber1) + " บาท", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Italic), SMLPOSControl._printSlipTextStyle.Left, false);
                                        }
                                        //
                                        string __creditCardApproved = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._no_approved].ToString();
                                        __y += this._printSlipText(__g, __width, __width, 10, __y, _getResource("Approval", languageSelectIndex) + " : " + __creditCardApproved, new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Italic), SMLPOSControl._printSlipTextStyle.Left, false);
                                    }
                                }
                            }

                            // ชำระด้วยคูปอง
                            //__payCoupon = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._coupon_amount].ToString());
                            if (__payCoupon != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระด้วยคูปอง", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __payCoupon.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                            // ชำระด้วยแต้ม
                            //__payPoint = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._point_amount].ToString());
                            if (__payPoint != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระด้วยแต้ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __payPoint.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                            // เงินทอน
                            //__moneyChange = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._money_change].ToString());
                            if (__moneyChange != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("เงินทอน", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __moneyChange.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                            //
                            __y += this._printSlipLine(__g, __width, __y);

                            // order detail
                            if ((MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro) && this._show_order_detail && (this._show_order_detail_copy_Only == false || (this._show_order_detail_copy_Only == true && header == "- สำเนา -")))
                            {
                                // order detail
                                for (int __orderRow = 0; __orderRow < __tableOrderDetail.Rows.Count; __orderRow++)
                                {
                                    __y += this._printSlipText(__g, __width, __width, 0, __y, "ใบสั่ง : " + __tableOrderDetail.Rows[__orderRow][_g.d.table_order_doc._doc_no].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                }

                                // order cancel
                                for (int __cancelRow = 0; __cancelRow < __tableOrderCancel.Rows.Count; __cancelRow++)
                                {
                                    decimal __cancelAmount = MyLib._myGlobal._decimalPhase(__tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._sum_amount].ToString());

                                    __y += this._printSlipText(__g, __width, __width, 0, __y, (__tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._cancel_flag].ToString().Equals("1") ? "ย้ายออก " + __tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._table_number_2].ToString() + " : " : "ยกเลิก : ") + __tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._item_name].ToString() + " " + __cancelAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                }
                                __y += this._printSlipLine(__g, __width, __y);

                            }
                        }
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างย่อ)
                        {
                            string __docNoAndTime = _getResource("เลขที่", languageSelectIndex) + ":" + __docNo + " " + _getResource("วันที่", languageSelectIndex) + ":" + __docDate + "@" + __trans.Rows[0][_g.d.ic_trans._doc_time].ToString();
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __docNoAndTime, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);

                            if (__currentPoint > 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("แต้มครั้งนี้", languageSelectIndex) + ":", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __currentPoint.ToString(this._formatNumber2), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                                SMLProcess._posProcess __process = new SMLProcess._posProcess();
                                decimal __currentPointBalance = __process._pointBalance(__cust_code, true);

                                // แต้มสะสม
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("แต้มสะสมถึง", languageSelectIndex) + " " + __docDate, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __currentPointBalance.ToString(this._formatNumber2), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                            }
                        }

                        //
                        if (this._showShortDescription && _g.g._companyProfile._vat_rate > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, "V=" + _getResource("สินค้ามีภาษีมูลค่าเพิ่ม", languageSelectIndex) + " " + "E=" + _getResource("สินค้ายกเว้นภาษี", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            //
                        }
                        string __saleCode = __trans.Rows[0][_g.d.ic_trans._sale_code].ToString();
                        string __cashierCode = __trans.Rows[0][_g.d.ic_trans._cashier_code].ToString();
                        if (__cashierCode.Equals(__saleCode) == false && mode == _printSlipMode.ใบกำกับภาษีอย่างย่อ)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("พนักงานขาย", languageSelectIndex) + " : " + __saleCode, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }
                        //
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            __y += 15f;
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ผู้รับเงิน", languageSelectIndex) + "................................................................" + __saleCode, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);

                            // remark
                            if (__trans.Rows[0][_g.d.ic_trans._remark].ToString().Length > 0)
                            {
                                __y += 15;
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("หมายเหตุ", languageSelectIndex) + " ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __trans.Rows[0][_g.d.ic_trans._remark].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                                __y += 15;
                            }
                        }
                        if (this._posFooter.Trim().Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, this._posFooter, new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }
                        #endregion

                    }
                    break;
                #endregion
                #region ใบเสร็จแบบที่ 9 ของ fitness first
                case 9:
                    {

                        #region ข้อมูลบริษัท

                        if (this._posHeader.Trim().Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, this._posHeader, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false, true);
                        }
                        else
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __ltdName, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __ltdAddress, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            string __telephone = "";
                            if (__ltdTel.Trim().Length > 0)
                            {
                                __telephone = _getResource("โทรศัพท์", languageSelectIndex) + ":" + __ltdTel.Trim();
                            }
                            if (__ltdFax.Trim().Length > 0)
                            {
                                __telephone = __telephone + " " + _getResource("โทรสาร", languageSelectIndex) + ":" + __ltdFax.Trim();
                            }
                            if (__telephone.Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __telephone, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            }
                            //

                            if (__ltdTax != null && __ltdTax.Trim().Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขประจำตัวผู้เสียภาษีอากร", languageSelectIndex) + " : " + __ltdTax, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            }
                        }

                        #endregion

                        #region ส่วนหัว แสดงข้อมูลลูกค้า

                        if (header.Length > 0)
                        {
                            // ข้อความเพิ่มเติม
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource(header, languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Center, false);
                        }
                        __y += this._fontHeaderSize;
                        // toe change headerSlip 
                        // ย้ายไปข้างบน
                        //if (_posBillType.Length > 0)
                        //{
                        //    headerSlip = _posBillType;
                        //}

                        __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource(headerSlip, languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Center, false);
                        __y += this._fontHeaderSize;
                        __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขเครื่อง", languageSelectIndex) + " : " + __trans.Rows[0]["pos_id_desc"].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);

                        if (header.IndexOf("ยกเลิก") != -1)
                        {
                            string __cancelDocNo = __trans.Rows[0]["cancel_doc_no"].ToString();
                            string __cancelDocDate = MyLib._myGlobal._convertDateFromQuery(__trans.Rows[0]["cancel_doc_date"].ToString()).ToString("dd-MM-yyyy", new CultureInfo("th-TH"));

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขที่เอกสารยกเลิก", languageSelectIndex) + ":" + __cancelDocNo, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("วันที่", languageSelectIndex) + ":" + __cancelDocDate, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }

                        // เลขที่เอกสาร วันที่ เวลา
                        string __docDate = MyLib._myGlobal._convertDateFromQuery(__trans.Rows[0][_g.d.ic_trans._doc_date].ToString()).ToString("dd-MM-yyyy", new CultureInfo("th-TH"));
                        string __docNo = __trans.Rows[0][_g.d.ic_trans._doc_no].ToString();
                        string __docRefNo = __trans.Rows[0][_g.d.ic_trans._doc_ref].ToString();
                        __docGuid = __trans.Rows[0][_g.d.ic_trans._doc_no_guid].ToString().Trim();
                        //


                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขที่", languageSelectIndex) + ":" + __docNo, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขที่อ้างอิง", languageSelectIndex) + ":" + __docRefNo, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("วันที่", languageSelectIndex) + ":" + __docDate + "@" + __trans.Rows[0][_g.d.ic_trans._doc_time].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ลูกค้า", languageSelectIndex) + " : " + __memberName, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขประจำตัวผู้เสียภาษี", languageSelectIndex) + " : " + __cust_taxid, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, ((__branch_type == "1") ? " [   ] " + __headquatreStr + " [ x ] " + __branchStr + " " + __branch_code : " [ x ] " + __headquatreStr + " [   ] " + __branchStr), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ที่อยู่", languageSelectIndex) + " : " + __memberAddress, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                        }
                        else
                        {
                            if (__memberCode.Trim().Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("สมาชิก", languageSelectIndex) + " : " + __memberName + " (" + __memberCode + ")", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            }

                            // พิมพ์โต๊ะ
                            if (__tableNumberStr.Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("หมายเลขโต๊ะ", languageSelectIndex) + " : " + __tableNumberStr, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            }

                            if ((MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro) && __table_trans.Rows.Count > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เวลาเข้า", languageSelectIndex) + " : " + __table_trans.Rows[0][_g.d.table_trans._open_doc_time].ToString() + _getResource(" เวลาออก", languageSelectIndex) + " : " + __table_trans.Rows[0][_g.d.table_trans._close_doc_time].ToString(), new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Left, false);

                            }
                        }

                        if (__customer_phone.Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __customer_phone, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }

                        __y += this._printSlipLine(__g, __width, __y);


                        #endregion

                        #region รายการสินค้า
                        //
                        //Font __fontDetail1 = new Font(this._fontHeaderName, 10);
                        //Font __fontDetail2 = new Font(this._fontHeaderName, 10, FontStyle.Italic);
                        int __transCount = 0;
                        decimal __itemQtyCount = 0;
                        decimal __saveAmount = 0;
                        decimal __sumFood = 0M;
                        decimal __sumDrink = 0M;
                        for (int __row = 0; __row < __transDetail.Rows.Count; __row++)
                        {
                            DataRow __data = __transDetail.Rows[__row];
                            if (__data[_g.d.ic_trans_detail._item_type].ToString().Equals("3"))
                            {
                                // สินค้าชุด ข้ามไป
                                continue;
                            }

                            decimal __amount = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._sum_amount].ToString());

                            if (MyLib._myGlobal._decimalPhase(__data[_g.d.ic_inventory_barcode._hidden_text].ToString()) == 0)
                            {
                                __transCount++;
                                decimal __price = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._price].ToString());
                                decimal __qty = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._qty].ToString());
                                decimal __priceDefault = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._price_default].ToString());
                                __itemQtyCount += __qty;
                                string __discountWord = __data[_g.d.ic_trans_detail._discount].ToString();
                                string __priceInfo = __data[_g.d.ic_trans_detail._remark].ToString();
                                decimal __discountAmount = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._discount_amount].ToString());
                                // มูลค่าสินค้า+vat
                                string __extraWord = "";
                                int __taxType = (int)MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._tax_type].ToString());

                                // toe แก้ extraword เอา case 0 ออก                            
                                switch (__taxType)
                                {
                                    case 0:
                                        __extraWord = "V";
                                        break;
                                }
                                // รายละเอียดสินค้า
                                StringBuilder __detail = new StringBuilder();
                                if (languageSelectIndex == 0)
                                {
                                    __detail.Append(__data[_g.d.ic_trans_detail._item_name].ToString().Trim());
                                }
                                else
                                {
                                    string __itemNameEn = __data[_g.d.ic_trans_detail._item_name_en].ToString().Trim();
                                    if (__itemNameEn.Length > 0)
                                    {
                                        __detail.Append(__itemNameEn);
                                    }
                                    else
                                    {
                                        __detail.Append(__data[_g.d.ic_trans_detail._item_name].ToString().Trim());
                                    }
                                }

                                if (__priceDefault != __amount)
                                {
                                    __detail.Append(" " + "@" + __priceDefault.ToString(this._formatNumber1));
                                }
                                float __lineHeight = this._printSlipText(__g, __width, (__memberCode.Trim().Length == 0) ? __width * 0.8f : __width, 0, __y, __detail.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                                // ราคาสามาชิก
                                if (__memberCode.Trim().Length > 0)
                                {
                                    decimal __newPrice = __amount / __qty;
                                    string __qtyStr = (__qty == Math.Round(__qty, 0)) ? __qty.ToString(this._formatNumber2) : __qty.ToString(this._formatNumber1);
                                    string __priceStr = __newPrice.ToString(this._formatNumber1);
                                    StringBuilder __memberPrice = new StringBuilder(_getResource("ราคาสมาชิก", languageSelectIndex) + " " + "@" + __priceStr);
                                    if (__qty > 1)
                                    {
                                        __memberPrice.Append("x");
                                        __memberPrice.Append(__qtyStr);
                                    }
                                    __y += __lineHeight;
                                    __lineHeight = this._printSlipText(__g, __width, __width, 5, __y, __memberPrice.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                }
                                // ส่วนลด
                                if (__discountAmount != 0)
                                {
                                    //StringBuilder __discountStr = new StringBuilder("ราคาปรกติ" + " : " + __priceDefault.ToString(this._formatNumber1) + " " + "บาท");
                                    //__y += this._printSlipText(__g, __width, __width, 5, __y, __discountStr.ToString(), new Font(this._fontDetailName, this._fontDetailSize * 0.8f), SMLPOSControl._printSlipTextStyle.Left);
                                    __saveAmount += __discountAmount;
                                    /*StringBuilder __discountStr = new StringBuilder();
                                    __discountStr.Append(__priceInfo + " " + "ลด");
                                    __discountStr.Append(" " + __discountAmount.ToString(this._formatNumber1) + " " + "บาท");
                                    if (__priceDefault != 0)
                                    {
                                        __discountStr.Append(" " + "จาก" + " " + __priceDefault.ToString(this._formatNumber1) + " " + "บาท");
                                    }
                                    __y += this._printSlipText(__g, __width, __width, 5, __y, __discountStr.ToString(), new Font(this._fontDetailName, this._fontDetailSize * 0.8f), SMLPOSControl._printSlipTextStyle.Left);
                                    __saveAmount += __discountAmount;
                                     */
                                }
                                this._printSlipText(__g, __width - 15, __width - 10, 0, __y, __amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                                if (this._showTaxDetail && _g.g._companyProfile._vat_rate > 0)
                                {
                                    this._printSlipText(__g, __width, __width, 0, __y, __extraWord, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                }
                                __y += __lineHeight;
                                if (__serialNumberTable != null && __serialNumberTable.Rows.Count > 0)
                                {
                                    // Serial Number
                                    DataRow[] __serial = __serialNumberTable.Select(_g.d.ic_trans_serial_number._doc_line_number + "=\'" + (__row).ToString() + "\'");
                                    for (int __serialLoop = 0; __serialLoop < __serial.Length; __serialLoop++)
                                    {
                                        __y += this._printSlipText(__g, __width, __width, 0, __y, "S/N:" + __serial[__serialLoop][_g.d.ic_trans_serial_number._serial_number].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                    }
                                }
                            }

                            if (__data[_g.d.ic_inventory._drink_type].ToString().Equals("1"))
                            {
                                __sumDrink += __amount;
                            }
                            else
                            {
                                __sumFood += __amount;
                            }
                        }

                        #endregion

                        #region รายการ promotion
                        for (int __row = 0; __row < __transDetailPromotion.Rows.Count; __row++)
                        {
                            DataRow __data = __transDetailPromotion.Rows[__row];
                            decimal __amount = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail_promotion._sum_amount].ToString());

                            //__transCount++;
                            decimal __price = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail_promotion._price].ToString());
                            decimal __qty = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail_promotion._qty].ToString());

                            //__itemQtyCount += __qty;

                            StringBuilder __detail = new StringBuilder();
                            __detail.Append(__data[_g.d.ic_trans_detail_promotion._promotion_name].ToString().Trim());

                            float __lineHeight = this._printSlipText(__g, __width, __width * 0.8f, 0, __y, __detail.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                            // ราคาสามาชิก
                            //if (__memberCode.Trim().Length > 0)
                            //{
                            //    decimal __newPrice = __amount / __qty;
                            //    string __qtyStr = (__qty == Math.Round(__qty, 0)) ? __qty.ToString(this._formatNumber2) : __qty.ToString(this._formatNumber1);
                            //    string __priceStr = __newPrice.ToString(this._formatNumber1);
                            //    StringBuilder __memberPrice = new StringBuilder("ราคาสมาชิก" + " " + "@" + __priceStr);
                            //    if (__qty > 1)
                            //    {
                            //        __memberPrice.Append("x");
                            //        __memberPrice.Append(__qtyStr);
                            //    }
                            //    __y += __lineHeight;
                            //    __lineHeight = this._printSlipText(__g, __width, __width, 5, __y, __memberPrice.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            //}
                            // ส่วนลด
                            //if (__discountAmount != 0)
                            //{
                            //    //StringBuilder __discountStr = new StringBuilder("ราคาปรกติ" + " : " + __priceDefault.ToString(this._formatNumber1) + " " + "บาท");
                            //    //__y += this._printSlipText(__g, __width, __width, 5, __y, __discountStr.ToString(), new Font(this._fontDetailName, this._fontDetailSize * 0.8f), SMLPOSControl._printSlipTextStyle.Left);
                            //    __saveAmount += __discountAmount;
                            //    /*StringBuilder __discountStr = new StringBuilder();
                            //    __discountStr.Append(__priceInfo + " " + "ลด");
                            //    __discountStr.Append(" " + __discountAmount.ToString(this._formatNumber1) + " " + "บาท");
                            //    if (__priceDefault != 0)
                            //    {
                            //        __discountStr.Append(" " + "จาก" + " " + __priceDefault.ToString(this._formatNumber1) + " " + "บาท");
                            //    }
                            //    __y += this._printSlipText(__g, __width, __width, 5, __y, __discountStr.ToString(), new Font(this._fontDetailName, this._fontDetailSize * 0.8f), SMLPOSControl._printSlipTextStyle.Left);
                            //    __saveAmount += __discountAmount;
                            //     */
                            //}
                            this._printSlipText(__g, __width - 15, __width - 10, 0, __y, __amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                            //if (this._showTaxDetail)
                            //{
                            //    this._printSlipText(__g, __width, __width, 0, __y, __extraWord, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            //}
                            __y += __lineHeight;

                        }

                        #endregion

                        #region ส่วนท้ายบิล

                        decimal __discountFooter = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_discount].ToString());
                        decimal __serviceChargeAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_service_charge].ToString());

                        // ท้ายบิล 
                        // โต๋ ดุให้ดี ๆ นะ มีผลกระทบต่อ ที่อื่นนะ 
                        // ถ้เาป็นค่าลบ เอายอดปัดเศษ มาโชวในส่วนลดด้วย
                        // ถ้าปัดขึนทำไงให้ดุดี
                        __totalAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_amount].ToString()) + __discountFooter + __totalAdvanceMoney;
                        __y += this._printSlipLine(__g, __width, __y);
                        string __footer1 = __transCount.ToString() + " " + _getResource("รายการ", languageSelectIndex) + " " + __itemQtyCount.ToString(this._formatNumber1) + " " + _getResource("ชิ้น", languageSelectIndex);
                        this._printSlipText(__g, __width, __width, 0, __y, __footer1, new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                        __y += this._printSlipText(__g, __width, __width, 0, __y, (__totalAmount - __serviceChargeAmount).ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                        // ส่วนลดท้ายบิล

                        // tomyumgoong ยอดอาหาร เครื่องดิ่ม
                        if (MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro)
                        {
                            float __lineHeight = 0;

                            if (__serviceChargeAmount > 0)
                            {
                                string __serviceChargeText = __trans.Rows[0][_g.d.ic_trans._service_charge_word].ToString();
                                __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("Service Charge", languageSelectIndex) + " " + ((__serviceChargeText.IndexOf("%") != -1) ? __serviceChargeText : ""), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                this._printSlipText(__g, __width, __width, 0, __y, __serviceChargeAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                __y += __lineHeight;
                            }

                            __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("อาหาร", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            this._printSlipText(__g, __width, __width, 0, __y, __sumFood.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += __lineHeight;

                            __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("เครื่องดื่ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            this._printSlipText(__g, __width, __width, 0, __y, __sumDrink.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += __lineHeight;

                            __y += this._printSlipLine(__g, __width, __y);
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("รวมทั้งสิ้น", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += this._printSlipLine(__g, __width, __y);

                        }

                        // เงินมัดจำ
                        if (__totalAdvanceMoney > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, "เงินมัดจำ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            for (int __row = 0; __row < __advanceMoneyDetail.Rows.Count; __row++)
                            {

                                string __detail = string.Format("{0}:{1}", __advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._trans_number].ToString(), MyLib._myGlobal._convertDateFromQuery(__advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._doc_date_ref].ToString()).ToString("dd-MM-yyyy", new CultureInfo("th-TH")));
                                decimal __advanceAmount = MyLib._myGlobal._decimalPhase(__advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._amount].ToString());

                                this._printSlipText(__g, __width, __width, 0, __y, __detail, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __advanceAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                        }

                        if (__discountFooter != 0)
                        {
                            string __discountWord2 = _getResource("ส่วนลดพิเศษ", languageSelectIndex);
                            string __discountWord = __trans.Rows[0][_g.d.ic_trans._discount_word].ToString().Trim();
                            if (__discountWord.Length > 0)
                            {
                                __discountWord2 = __discountWord2 + " : " + __discountWord;
                            }
                            this._printSlipText(__g, __width, __width, 0, __y, __discountWord2, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __discountFooter.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __saveAmount += __discountFooter;
                            // คงเหลือ
                            __totalAmount -= __discountFooter;
                        }

                        // ผลต่างปัดเศษ
                        //decimal __diffAmount = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._total_income_amount].ToString());
                        if (__diff_amount != 0)
                        {
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("ผลต่างการปัดเศษ", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __diff_amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __saveAmount += (__diff_amount);
                            __totalAmount += (__diff_amount * -1);
                        }

                        if (__discountFooter != 0 || __diff_amount != 0)
                        {
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("คงเหลือยอดชำระ", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                        }

                        // ภาษีมูลค่าเพิ่ม
                        decimal __beforeVatAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_before_vat].ToString());
                        decimal __exceptVatAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_except_vat].ToString());
                        decimal __vatAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_vat_value].ToString());
                        decimal __vatRate = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._vat_rate].ToString());

                        // toe เพิ่ม option แสดงรายละเอียดภาษี
                        if (this._showTaxDetail && _g.g._companyProfile._vat_rate > 0)
                        {

                            __y += this._printSlipLine(__g, __width, __y);
                            // สินค้ายกเว้นภาษี
                            if (__exceptVatAmount != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("มูลค่าสินค้ายกเว้นภาษีมูลค่าเพิ่ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __exceptVatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                            //
                            if (__beforeVatAmount != 0 || __vatAmount != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("มูลค่าสินค้ามีภาษีมูลค่าเพิ่ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __beforeVatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                //
                                string __vatRateStr = (__vatRate == Math.Round(__vatRate, 0)) ? __vatRate.ToString(this._formatNumber2) : __vatRate.ToString(this._formatNumber1);
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ภาษีมูลค่าเพิ่ม", languageSelectIndex) + " : " + __vatRateStr + "%", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __vatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                        }
                        __y += this._printSlipLine(__g, __width, __y);
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("รวมเงิน", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                            SMLReport._formReport._moneyToText __moneyToText = new SMLReport._formReport._moneyToText();
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __moneyToText._toText(__totalAmount), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipLine(__g, __width, __y);
                        }
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างย่อ)
                        {
                            // ประหยัด
                            if (__saveAmount != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("คุณประหยัดครั้งนี้", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __saveAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                            __y += this._printSlipLine(__g, __width, __y);
                            // ยอดชำระ
                            //__payCash = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._pay_cash_amount].ToString());
                            if (__payCash != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระด้วยเงินสด", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __payCash.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                            if (__creditCardDetail != null)
                            {
                                for (int __row = 0; __row < __creditCardDetail.Rows.Count; __row++)
                                {
                                    decimal __creditCardTotalAmount = MyLib._myGlobal._decimalPhase(__creditCardDetail.Rows[__row][_g.d.cb_trans_detail._sum_amount].ToString());
                                    decimal __creditCardChargeAmount = MyLib._myGlobal._decimalPhase(__creditCardDetail.Rows[__row][_g.d.cb_trans_detail._charge].ToString());
                                    if (__creditCardTotalAmount != 0)
                                    {
                                        string __creditCardType = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._credit_card_type].ToString();
                                        string __creditCardNumber = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._trans_number].ToString();
                                        for (int __loop = 0; __loop < __creditCardNumber.Length - 4; __loop++)
                                        {
                                            __creditCardNumber = __creditCardNumber.Remove(__loop, 1);
                                            __creditCardNumber = __creditCardNumber.Insert(__loop, "*");
                                        }
                                        //
                                        this._printSlipText(__g, __width, __width, 0, __y, __creditCardType + " " + __creditCardNumber, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                        __y += this._printSlipText(__g, __width, __width, 0, __y, __creditCardTotalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                        //
                                        if (__creditCardChargeAmount != 0)
                                        {
                                            __y += this._printSlipText(__g, __width, __width, 10, __y, _getResource("Charge", languageSelectIndex) + " : " + __creditCardChargeAmount.ToString(this._formatNumber1) + " " + _getResource("บาท", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Italic), SMLPOSControl._printSlipTextStyle.Left, false);
                                        }
                                        //
                                        string __creditCardApproved = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._no_approved].ToString();
                                        __y += this._printSlipText(__g, __width, __width, 10, __y, _getResource("Approval", languageSelectIndex) + " : " + __creditCardApproved, new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Italic), SMLPOSControl._printSlipTextStyle.Left, false);
                                    }
                                }
                            }

                            // ชำระด้วยคูปอง
                            //__payCoupon = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._coupon_amount].ToString());
                            if (__payCoupon != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระด้วยคูปอง", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __payCoupon.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                            // ชำระด้วยแต้ม
                            //__payPoint = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._point_amount].ToString());
                            if (__payPoint != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระด้วยแต้ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __payPoint.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                            // เงินทอน
                            //__moneyChange = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._money_change].ToString());
                            if (__moneyChange != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("เงินทอน", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __moneyChange.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                            //
                            __y += this._printSlipLine(__g, __width, __y);

                            // order detail
                            if ((MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro) && this._show_order_detail && (this._show_order_detail_copy_Only == false || (this._show_order_detail_copy_Only == true && header == "- สำเนา -")))
                            {
                                // order detail
                                for (int __orderRow = 0; __orderRow < __tableOrderDetail.Rows.Count; __orderRow++)
                                {
                                    __y += this._printSlipText(__g, __width, __width, 0, __y, "ใบสั่ง : " + __tableOrderDetail.Rows[__orderRow][_g.d.table_order_doc._doc_no].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                }

                                // order cancel
                                for (int __cancelRow = 0; __cancelRow < __tableOrderCancel.Rows.Count; __cancelRow++)
                                {
                                    decimal __cancelAmount = MyLib._myGlobal._decimalPhase(__tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._sum_amount].ToString());

                                    __y += this._printSlipText(__g, __width, __width, 0, __y, (__tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._cancel_flag].ToString().Equals("1") ? "ย้ายออก " + __tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._table_number_2].ToString() + " : " : "ยกเลิก : ") + __tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._item_name].ToString() + " " + __cancelAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                }
                                __y += this._printSlipLine(__g, __width, __y);

                            }
                        }
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างย่อ)
                        {
                            string __docNoAndTime = _getResource("เลขที่", languageSelectIndex) + ":" + __docNo + " " + _getResource("วันที่", languageSelectIndex) + ":" + __docDate + "@" + __trans.Rows[0][_g.d.ic_trans._doc_time].ToString();
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __docNoAndTime, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);

                            if (__currentPoint > 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("แต้มครั้งนี้", languageSelectIndex) + ":", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __currentPoint.ToString(this._formatNumber2), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                                SMLProcess._posProcess __process = new SMLProcess._posProcess();
                                decimal __currentPointBalance = __process._pointBalance(__cust_code, true);

                                // แต้มสะสม
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("แต้มสะสมถึง", languageSelectIndex) + " " + __docDate, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __currentPointBalance.ToString(this._formatNumber2), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                            }
                        }

                        string __cashierName = "";
                        try
                        {
                            __cashierName = __trans.Rows[0]["cashier_name"].ToString().Split(' ')[0].ToString().Trim();
                        }
                        catch
                        {
                        }
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            __cashierName = __trans.Rows[0][_g.d.ic_trans._cashier_code].ToString();
                        }

                        __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("พนักงาน", languageSelectIndex) + " : " + __cashierName, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);

                        //
                        if (this._showShortDescription && _g.g._companyProfile._vat_rate > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, "V=" + _getResource("สินค้ามีภาษีมูลค่าเพิ่ม", languageSelectIndex) + " " + "E=" + _getResource("สินค้ายกเว้นภาษี", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            //
                        }
                        string __saleCode = __trans.Rows[0][_g.d.ic_trans._sale_code].ToString();
                        string __cashierCode = __trans.Rows[0][_g.d.ic_trans._cashier_code].ToString();
                        if (__cashierCode.Equals(__saleCode) == false && mode == _printSlipMode.ใบกำกับภาษีอย่างย่อ)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("พนักงานขาย", languageSelectIndex) + " : " + __saleCode, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }
                        //
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            __y += 15f;
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ผู้รับเงิน", languageSelectIndex) + "................................................................" + __saleCode, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);

                            // remark
                            if (__trans.Rows[0][_g.d.ic_trans._remark].ToString().Length > 0)
                            {
                                __y += 15;
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("หมายเหตุ", languageSelectIndex) + " ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __trans.Rows[0][_g.d.ic_trans._remark].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                                __y += 15;
                            }
                        }
                        if (this._posFooter.Trim().Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, this._posFooter, new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }
                        #endregion

                    }
                    break;
                #endregion
                #region ใบเสร็จแบบที่ 10 copy มาจากแบบที่ 4 แต่พนักงานลงมาอีก 1 บรรทัด
                case 10:
                    {

                        #region ส่วนหัว แสดงข้อมูลบริษัท

                        if (this._posHeader.Trim().Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, this._posHeader, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false, true);
                        }
                        else
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __ltdName, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __ltdAddress, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            string __telephone = "";
                            if (__ltdTel.Trim().Length > 0)
                            {
                                __telephone = _getResource("โทรศัพท์", languageSelectIndex) + ":" + __ltdTel.Trim();
                            }
                            if (__ltdFax.Trim().Length > 0)
                            {
                                __telephone = __telephone + " " + _getResource("โทรสาร", languageSelectIndex) + ":" + __ltdFax.Trim();
                            }
                            if (__telephone.Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __telephone, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            }

                            //
                            if (__ltdTax != null && __ltdTax.Trim().Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขประจำตัวผู้เสียภาษีอากร", languageSelectIndex) + " : " + __ltdTax, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            }
                        }

                        #endregion

                        #region ส่วนหัว แสดงข้อมูล เครือง POS และลูกค้า

                        // ข้อความเพิ่มเติม
                        if (header.Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource(header, languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Center, false);
                        }
                        __y += this._fontHeaderSize;

                        // ย้ายไปข้างบน
                        //if (_posBillType.Length > 0)
                        //{
                        //    headerSlip = _posBillType;
                        //}

                        __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource(headerSlip, languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Center, false);
                        __y += this._fontHeaderSize;
                        __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขเครื่อง", languageSelectIndex) + " : " + __trans.Rows[0]["pos_id_desc"].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        string __cashierName = "";
                        try
                        {
                            __cashierName = __trans.Rows[0]["cashier_name"].ToString().Split(' ')[0].ToString().Trim();
                        }
                        catch
                        {
                        }
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            __cashierName = __trans.Rows[0][_g.d.ic_trans._cashier_code].ToString();
                        }

                        __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("พนักงาน", languageSelectIndex) + " : " + __cashierName, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        if (header.IndexOf("ยกเลิก") != -1)
                        {
                            string __cancelDocNo = __trans.Rows[0]["cancel_doc_no"].ToString();
                            string __cancelDocDate = MyLib._myGlobal._convertDateFromQuery(__trans.Rows[0]["cancel_doc_date"].ToString()).ToString("dd-MM-yyyy", new CultureInfo("th-TH"));

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขที่เอกสารยกเลิก", languageSelectIndex) + ":" + __cancelDocNo, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("วันที่", languageSelectIndex) + ":" + __cancelDocDate, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }

                        // เลขที่เอกสาร วันที่ เวลา
                        string __docDate = MyLib._myGlobal._convertDateFromQuery(__trans.Rows[0][_g.d.ic_trans._doc_date].ToString()).ToString("dd-MM-yyyy", new CultureInfo("th-TH"));
                        string __docNo = __trans.Rows[0][_g.d.ic_trans._doc_no].ToString();
                        string __docRefNo = __trans.Rows[0][_g.d.ic_trans._doc_ref].ToString();
                        __docGuid = __trans.Rows[0][_g.d.ic_trans._doc_no_guid].ToString().Trim();
                        //
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขที่", languageSelectIndex) + ":" + __docNo, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขที่อ้างอิง", languageSelectIndex) + ":" + __docRefNo, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("วันที่", languageSelectIndex) + ":" + __docDate + "@" + __trans.Rows[0][_g.d.ic_trans._doc_time].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ลูกค้า", languageSelectIndex) + " : " + __memberName, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขประจำตัวผู้เสียภาษี", languageSelectIndex) + " : " + __cust_taxid, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, ((__branch_type == "1") ? " [   ] " + __headquatreStr + " [ x ] " + __branchStr + " " + __branch_code : " [ x ] " + __headquatreStr + " [   ] " + __branchStr), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);


                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ที่อยู่", languageSelectIndex) + " : " + __memberAddress, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                        }
                        else
                        {
                            if (__memberCode.Trim().Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("สมาชิก", languageSelectIndex) + " : " + __memberName + " (" + __memberCode + ")", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            }

                            // พิมพ์โต๊ะ
                            if (__tableNumberStr.Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("หมายเลขโต๊ะ", languageSelectIndex) + " : " + __tableNumberStr, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            }

                            if ((MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro) && __table_trans.Rows.Count > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เวลาเข้า", languageSelectIndex) + " : " + __table_trans.Rows[0][_g.d.table_trans._open_doc_time].ToString() + " " + _getResource("เวลาออก", languageSelectIndex) + " : " + __table_trans.Rows[0][_g.d.table_trans._close_doc_time].ToString(), new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Left, false);


                            }

                        }

                        if (__customer_phone.Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __customer_phone, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }

                        __y += this._printSlipLine(__g, __width, __y);

                        #endregion

                        #region รายการสินค้า

                        int __transCount = 0;
                        decimal __itemQtyCount = 0;
                        decimal __saveAmount = 0;
                        decimal __sumFood = 0M;
                        decimal __sumDrink = 0M;

                        for (int __row = 0; __row < __transDetail.Rows.Count; __row++)
                        {
                            DataRow __data = __transDetail.Rows[__row];
                            if (__data[_g.d.ic_trans_detail._item_type].ToString().Equals("3"))
                            {
                                // สินค้าชุด ข้ามไป
                                continue;
                            }
                            decimal __amount = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._sum_amount].ToString());

                            if (MyLib._myGlobal._decimalPhase(__data[_g.d.ic_inventory_barcode._hidden_text].ToString()) == 0)
                            {
                                __transCount++;

                                decimal __price = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._price].ToString());
                                decimal __qty = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._qty].ToString());
                                decimal __priceDefault = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._price_default].ToString());
                                __itemQtyCount += __qty;
                                string __discountWord = __data[_g.d.ic_trans_detail._discount].ToString();
                                string __priceInfo = __data[_g.d.ic_trans_detail._remark].ToString();
                                decimal __discountAmount = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._discount_amount].ToString());
                                // มูลค่าสินค้า+vat
                                string __extraWord = "";
                                int __taxType = (int)MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._tax_type].ToString());
                                string __qtyStr = (__qty == Math.Round(__qty, 0)) ? __qty.ToString(this._formatNumber2) : __qty.ToString(this._formatNumber1);
                                string _unit_name = __data[_g.d.ic_trans_detail._unit_name].ToString();

                                if (languageSelectIndex > 0)
                                {
                                    string __unit_name_en = __data[_g.d.ic_trans_detail._unit_name_en].ToString();

                                    if (__unit_name_en.Length > 0)
                                    {
                                        _unit_name = __unit_name_en;
                                    }
                                }


                                // toe แก้ extraword case 0 = สินค้ามี Vat                         
                                switch (__taxType)
                                {
                                    case 0:
                                        __extraWord = "V";
                                        break;
                                }


                                // ชื่อสินค้า
                                StringBuilder __detail = new StringBuilder();
                                if (languageSelectIndex == 0)
                                {
                                    __detail.Append(__data[_g.d.ic_trans_detail._item_name].ToString().Trim());
                                }
                                else
                                {
                                    string __itemNameEn = __data[_g.d.ic_trans_detail._item_name_en].ToString().Trim();
                                    if (__itemNameEn.Length > 0)
                                    {
                                        __detail.Append(__itemNameEn);
                                    }
                                    else
                                    {
                                        __detail.Append(__data[_g.d.ic_trans_detail._item_name].ToString().Trim());
                                    }
                                }


                                float __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, __detail.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);

                                __y += __lineHeight;
                                if (__serialNumberTable != null && __serialNumberTable.Rows.Count > 0)
                                {
                                    // Serial Number
                                    DataRow[] __serial = __serialNumberTable.Select(_g.d.ic_trans_serial_number._doc_line_number + "=\'" + (__row).ToString() + "\'");
                                    for (int __serialLoop = 0; __serialLoop < __serial.Length; __serialLoop++)
                                    {
                                        __y += this._printSlipText(__g, __width, __width, 0, __y, "S/N:" + __serial[__serialLoop][_g.d.ic_trans_serial_number._serial_number].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                    }
                                }


                                if (__discountAmount != 0)
                                {
                                    __saveAmount += __discountAmount;
                                }

                                StringBuilder __priceQtyStr = new StringBuilder();
                                __priceQtyStr.Append(__price.ToString(this._formatNumber1) + " X " + __qtyStr + " " + _unit_name + ((__discountAmount != 0) ? " " + _getResource("ลด", languageSelectIndex) + " " + __discountAmount.ToString(this._formatNumber1) : ""));
                                //  ราคา จำนวน รวม
                                float _qtyLineHeight = this._printSlipText(__g, __width, __width, 0, __y, __priceQtyStr.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);

                                // จำนวน
                                //this._printSlipText(__g, __width - 160, __width - 150, 0, __y, __qtyStr, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                                this._printSlipText(__g, __width - 15, __width - 10, 0, __y, __amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                                if (this._showTaxDetail && _g.g._companyProfile._vat_rate > 0)
                                {
                                    this._printSlipText(__g, __width, __width, 0, __y, __extraWord, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                }

                                __y += _qtyLineHeight;
                            }

                            if (__data[_g.d.ic_inventory._drink_type].ToString().Equals("1"))
                            {
                                __sumDrink += __amount;
                            }
                            else
                            {
                                __sumFood += __amount;
                            }
                        }

                        #endregion

                        #region รายการ promotion
                        for (int __row = 0; __row < __transDetailPromotion.Rows.Count; __row++)
                        {
                            DataRow __data = __transDetailPromotion.Rows[__row];
                            decimal __amount = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail_promotion._sum_amount].ToString());

                            //__transCount++;
                            decimal __price = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail_promotion._price].ToString());
                            decimal __qty = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail_promotion._qty].ToString());

                            //__itemQtyCount += __qty;

                            StringBuilder __detail = new StringBuilder();
                            __detail.Append(__data[_g.d.ic_trans_detail_promotion._promotion_name].ToString().Trim());

                            float __lineHeight = this._printSlipText(__g, __width, __width * 0.8f, 0, __y, __detail.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                            this._printSlipText(__g, __width - 15, __width - 10, 0, __y, __amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                            __y += __lineHeight;

                        }

                        #endregion

                        #region ส่วนท้ายบิล

                        decimal __discountFooter = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_discount].ToString());
                        decimal __serviceChargeAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_service_charge].ToString());

                        // ท้ายบิล
                        __totalAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_amount].ToString()) + __discountFooter + __totalAdvanceMoney;
                        __y += this._printSlipLine(__g, __width, __y);
                        string __footer1 = __transCount.ToString() + " " + _getResource("รายการ", languageSelectIndex) + " " + __itemQtyCount.ToString(this._formatNumber1) + " " + _getResource("ชิ้น", languageSelectIndex);
                        __y += this._printSlipText(__g, __width, __width, 0, __y, __footer1, new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                        this._printSlipText(__g, __width, __width, 0, __y, "รวม", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                        __y += this._printSlipText(__g, __width, __width, 0, __y, (__totalAmount - __serviceChargeAmount).ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);

                        // tomyumgoong ยอดอาหาร เครื่องดิ่ม
                        if (MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro)
                        {
                            float __lineHeight = 0;

                            if (__serviceChargeAmount > 0)
                            {
                                string __serviceChargeText = __trans.Rows[0][_g.d.ic_trans._service_charge_word].ToString();
                                __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("Service Charge", languageSelectIndex) + " " + ((__serviceChargeText.IndexOf("%") != -1) ? __serviceChargeText : ""), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                this._printSlipText(__g, __width, __width, 0, __y, __serviceChargeAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                __y += __lineHeight;
                            }

                            __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("อาหาร", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            this._printSlipText(__g, __width, __width, 0, __y, __sumFood.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += __lineHeight;

                            __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("เครื่องดื่ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            this._printSlipText(__g, __width, __width, 0, __y, __sumDrink.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += __lineHeight;

                            __y += this._printSlipLine(__g, __width, __y);
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("รวมทั้งสิ้น", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += this._printSlipLine(__g, __width, __y);

                        }

                        // เงินมัดจำ
                        if (__totalAdvanceMoney > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, "เงินมัดจำ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            for (int __row = 0; __row < __advanceMoneyDetail.Rows.Count; __row++)
                            {

                                string __detail = string.Format("{0}:{1}", __advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._trans_number].ToString(), MyLib._myGlobal._convertDateFromQuery(__advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._doc_date_ref].ToString()).ToString("dd-MM-yyyy", new CultureInfo("th-TH")));
                                decimal __advanceAmount = MyLib._myGlobal._decimalPhase(__advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._amount].ToString());

                                this._printSlipText(__g, __width, __width, 0, __y, __detail, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __advanceAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                        }

                        // ส่วนลดท้ายบิล
                        if (__discountFooter != 0)
                        {
                            string __discountWord2 = _getResource("ส่วนลดพิเศษ", languageSelectIndex);
                            string __discountWord = __trans.Rows[0][_g.d.ic_trans._discount_word].ToString().Trim();
                            if (__discountWord.Length > 0)
                            {
                                __discountWord2 = __discountWord2 + " : " + __discountWord;
                            }
                            this._printSlipText(__g, __width, __width, 0, __y, __discountWord2, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __discountFooter.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __saveAmount += __discountFooter;
                            // คงเหลือ
                            __totalAmount -= __discountFooter;
                        }

                        //decimal __diffAmount = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._total_income_amount].ToString());
                        // ปัดเศษ
                        if (__diff_amount != 0)
                        {
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("ส่วนลดจากการปัดเศษ", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __diff_amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __saveAmount += (__diff_amount);
                            __totalAmount += (__diff_amount * -1);
                        }

                        if (__discountFooter != 0 || __diff_amount != 0)
                        {
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("คงเหลือยอดชำระ", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                        }

                        // ภาษีมูลค่าเพิ่ม
                        decimal __beforeVatAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_before_vat].ToString());
                        decimal __exceptVatAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_except_vat].ToString());
                        decimal __vatAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_vat_value].ToString());
                        decimal __vatRate = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._vat_rate].ToString());

                        // toe เพิ่ม option แสดงรายละเอียดภาษี
                        if (this._showTaxDetail && _g.g._companyProfile._vat_rate > 0)
                        {

                            __y += this._printSlipLine(__g, __width, __y);
                            // สินค้ายกเว้นภาษี
                            if (__exceptVatAmount != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("มูลค่าสินค้ายกเว้นภาษีมูลค่าเพิ่ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __exceptVatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                            //
                            if (__beforeVatAmount != 0 || __vatAmount != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("มูลค่าสินค้ามีภาษีมูลค่าเพิ่ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __beforeVatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                //
                                string __vatRateStr = (__vatRate == Math.Round(__vatRate, 0)) ? __vatRate.ToString(this._formatNumber2) : __vatRate.ToString(this._formatNumber1);
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ภาษีมูลค่าเพิ่ม", languageSelectIndex) + " : " + __vatRateStr + "%", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __vatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                        }
                        __y += this._printSlipLine(__g, __width, __y);
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("รวมเงิน", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                            SMLReport._formReport._moneyToText __moneyToText = new SMLReport._formReport._moneyToText();
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __moneyToText._toText(__totalAmount), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipLine(__g, __width, __y);
                        }
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างย่อ)
                        {
                            // ประหยัด
                            if (__saveAmount != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("คุณประหยัดครั้งนี้", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __saveAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                            __y += this._printSlipLine(__g, __width, __y);
                            // ยอดชำระ
                            //__payCash = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._pay_cash_amount].ToString());
                            if (__payCash != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระด้วยเงินสด", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __payCash.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                            if (__creditCardDetail != null)
                            {
                                for (int __row = 0; __row < __creditCardDetail.Rows.Count; __row++)
                                {
                                    decimal __creditCardTotalAmount = MyLib._myGlobal._decimalPhase(__creditCardDetail.Rows[__row][_g.d.cb_trans_detail._sum_amount].ToString());
                                    decimal __creditCardChargeAmount = MyLib._myGlobal._decimalPhase(__creditCardDetail.Rows[__row][_g.d.cb_trans_detail._charge].ToString());
                                    if (__creditCardTotalAmount != 0)
                                    {
                                        string __creditCardType = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._credit_card_type].ToString();
                                        string __creditCardNumber = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._trans_number].ToString();
                                        for (int __loop = 0; __loop < __creditCardNumber.Length - 4; __loop++)
                                        {
                                            __creditCardNumber = __creditCardNumber.Remove(__loop, 1);
                                            __creditCardNumber = __creditCardNumber.Insert(__loop, "*");
                                        }
                                        //
                                        this._printSlipText(__g, __width, __width, 0, __y, __creditCardType + " " + __creditCardNumber, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                        __y += this._printSlipText(__g, __width, __width, 0, __y, __creditCardTotalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                        //
                                        if (__creditCardChargeAmount != 0)
                                        {
                                            __y += this._printSlipText(__g, __width, __width, 10, __y, _getResource("Charge", languageSelectIndex) + " : " + __creditCardChargeAmount.ToString(this._formatNumber1) + " บาท", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Italic), SMLPOSControl._printSlipTextStyle.Left, false);
                                        }
                                        //
                                        string __creditCardApproved = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._no_approved].ToString();
                                        __y += this._printSlipText(__g, __width, __width, 10, __y, _getResource("Approval", languageSelectIndex) + " : " + __creditCardApproved, new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Italic), SMLPOSControl._printSlipTextStyle.Left, false);
                                    }
                                }
                            }

                            // ชำระด้วยคูปอง
                            //__payCoupon = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._coupon_amount].ToString());
                            if (__payCoupon != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระด้วยคูปอง", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __payCoupon.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                            // ชำระด้วยแต้ม
                            //__payPoint = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._point_amount].ToString());
                            if (__payPoint != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระด้วยแต้ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __payPoint.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                            // เงินทอน
                            //__moneyChange = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._money_change].ToString());
                            if (__moneyChange != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("เงินทอน", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __moneyChange.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                            //
                            __y += this._printSlipLine(__g, __width, __y);

                            // order detail
                            if ((MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro) && this._show_order_detail && (this._show_order_detail_copy_Only == false || (this._show_order_detail_copy_Only == true && header == "- สำเนา -")))
                            {
                                // order detail
                                for (int __orderRow = 0; __orderRow < __tableOrderDetail.Rows.Count; __orderRow++)
                                {
                                    __y += this._printSlipText(__g, __width, __width, 0, __y, "ใบสั่ง : " + __tableOrderDetail.Rows[__orderRow][_g.d.table_order_doc._doc_no].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                }

                                // order cancel
                                for (int __cancelRow = 0; __cancelRow < __tableOrderCancel.Rows.Count; __cancelRow++)
                                {
                                    decimal __cancelAmount = MyLib._myGlobal._decimalPhase(__tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._sum_amount].ToString());

                                    __y += this._printSlipText(__g, __width, __width, 0, __y, (__tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._cancel_flag].ToString().Equals("1") ? "ย้ายออก " + __tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._table_number_2].ToString() + " : " : "ยกเลิก : ") + __tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._item_name].ToString() + " " + __cancelAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                }
                                __y += this._printSlipLine(__g, __width, __y);

                            }
                        }
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างย่อ)
                        {
                            string __docNoAndTime = _getResource("เลขที่", languageSelectIndex) + ":" + __docNo;
                            string __docTime = _getResource("วันที่", languageSelectIndex) + ":" + __docDate + "@" + __trans.Rows[0][_g.d.ic_trans._doc_time].ToString();

                            __y += this._printSlipText(__g, __width, __width, 0, __y, __docNoAndTime, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __docTime, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);

                            if (__currentPoint > 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("แต้มครั้งนี้", languageSelectIndex) + ":", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __currentPoint.ToString(this._formatNumber2), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                                SMLProcess._posProcess __process = new SMLProcess._posProcess();
                                decimal __currentPointBalance = __process._pointBalance(__cust_code, true);

                                // แต้มสะสม
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("แต้มสะสมถึง", languageSelectIndex) + " " + __docDate, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __currentPointBalance.ToString(this._formatNumber2), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                            }
                        }

                        //
                        if (this._showShortDescription && _g.g._companyProfile._vat_rate > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, "V=" + _getResource("สินค้ามีภาษีมูลค่าเพิ่ม", languageSelectIndex) + " " + "E=" + _getResource("สินค้ายกเว้นภาษี", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            //
                        }
                        string __saleCode = __trans.Rows[0][_g.d.ic_trans._sale_code].ToString();
                        string __cashierCode = __trans.Rows[0][_g.d.ic_trans._cashier_code].ToString();
                        if (__cashierCode.Equals(__saleCode) == false && mode == _printSlipMode.ใบกำกับภาษีอย่างย่อ)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("พนักงานขาย", languageSelectIndex) + " : " + __saleCode, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }
                        //
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            __y += 15f;
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ผู้รับเงิน", languageSelectIndex) + "................................................................" + __saleCode, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);

                            // remark
                            if (__trans.Rows[0][_g.d.ic_trans._remark].ToString().Length > 0)
                            {
                                __y += 15;
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("หมายเหตุ", languageSelectIndex) + " ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __trans.Rows[0][_g.d.ic_trans._remark].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                                __y += 15;
                            }

                        }
                        if (this._posFooter.Trim().Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, this._posFooter, new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }

                        #endregion

                    }
                    break;
                #endregion
                #region ใบเสร็จแบบที่ 11 เหมือนแบบที่ 1 แต่เอาวันและเวลาลงมา อีกบรรทัด
                case 11:
                    {

                        #region ข้อมูลบริษัท

                        if (this._posHeader.Trim().Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, this._posHeader, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false, true);
                        }
                        else
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __ltdName, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __ltdAddress, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            string __telephone = "";
                            if (__ltdTel.Trim().Length > 0)
                            {
                                __telephone = _getResource("โทรศัพท์", languageSelectIndex) + ":" + __ltdTel.Trim();
                            }
                            if (__ltdFax.Trim().Length > 0)
                            {
                                __telephone = __telephone + " " + _getResource("โทรสาร", languageSelectIndex) + ":" + __ltdFax.Trim();
                            }
                            if (__telephone.Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __telephone, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            }
                            //

                            if (__ltdTax != null && __ltdTax.Trim().Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขประจำตัวผู้เสียภาษีอากร", languageSelectIndex) + " : " + __ltdTax, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            }
                        }

                        #endregion

                        #region ส่วนหัว แสดงข้อมูลลูกค้า

                        if (header.Length > 0)
                        {
                            // ข้อความเพิ่มเติม
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource(header, languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Center, false);
                        }
                        __y += this._fontHeaderSize;
                        // toe change headerSlip 
                        // ย้ายไปข้างบน
                        //if (_posBillType.Length > 0)
                        //{
                        //    headerSlip = _posBillType;
                        //}

                        __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource(headerSlip, languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Center, false);
                        __y += this._fontHeaderSize;
                        this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขเครื่อง", languageSelectIndex) + " : " + __trans.Rows[0]["pos_id_desc"].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        string __cashierName = "";
                        try
                        {
                            __cashierName = __trans.Rows[0]["cashier_name"].ToString().Split(' ')[0].ToString().Trim();
                        }
                        catch
                        {
                        }
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            __cashierName = __trans.Rows[0][_g.d.ic_trans._cashier_code].ToString();
                        }

                        __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("พนักงาน", languageSelectIndex) + " : " + __cashierName, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                        if (header.IndexOf("ยกเลิก") != -1)
                        {
                            string __cancelDocNo = __trans.Rows[0]["cancel_doc_no"].ToString();
                            string __cancelDocDate = MyLib._myGlobal._convertDateFromQuery(__trans.Rows[0]["cancel_doc_date"].ToString()).ToString("dd-MM-yyyy", new CultureInfo("th-TH"));

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขที่เอกสารยกเลิก", languageSelectIndex) + ":" + __cancelDocNo, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("วันที่", languageSelectIndex) + ":" + __cancelDocDate, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }

                        // เลขที่เอกสาร วันที่ เวลา
                        string __docDate = MyLib._myGlobal._convertDateFromQuery(__trans.Rows[0][_g.d.ic_trans._doc_date].ToString()).ToString("dd-MM-yyyy", new CultureInfo("th-TH"));
                        string __docNo = __trans.Rows[0][_g.d.ic_trans._doc_no].ToString();
                        string __docRefNo = __trans.Rows[0][_g.d.ic_trans._doc_ref].ToString();
                        __docGuid = __trans.Rows[0][_g.d.ic_trans._doc_no_guid].ToString().Trim();
                        //


                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขที่", languageSelectIndex) + ":" + __docNo, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขที่อ้างอิง", languageSelectIndex) + ":" + __docRefNo, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("วันที่", languageSelectIndex) + ":" + __docDate + "@" + __trans.Rows[0][_g.d.ic_trans._doc_time].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ลูกค้า", languageSelectIndex) + " : " + __memberName, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขประจำตัวผู้เสียภาษี", languageSelectIndex) + " : " + __cust_taxid, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, ((__branch_type == "1") ? " [   ] " + __headquatreStr + " [ x ] " + __branchStr + " " + __branch_code : " [ x ] " + __headquatreStr + " [   ] " + __branchStr), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ที่อยู่", languageSelectIndex) + " : " + __memberAddress, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                        }
                        else
                        {
                            if (__memberCode.Trim().Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("สมาชิก", languageSelectIndex) + " : " + __memberName + " (" + __memberCode + ")", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            }

                            // พิมพ์โต๊ะ
                            if (__tableNumberStr.Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("หมายเลขโต๊ะ", languageSelectIndex) + " : " + __tableNumberStr, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            }

                            if ((MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro) && __table_trans.Rows.Count > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เวลาเข้า", languageSelectIndex) + " : " + __table_trans.Rows[0][_g.d.table_trans._open_doc_time].ToString() + _getResource(" เวลาออก", languageSelectIndex) + " : " + __table_trans.Rows[0][_g.d.table_trans._close_doc_time].ToString(), new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Left, false);

                            }
                        }

                        if (__customer_phone.Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __customer_phone, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }

                        __y += this._printSlipLine(__g, __width, __y);


                        #endregion

                        #region รายการสินค้า
                        //
                        //Font __fontDetail1 = new Font(this._fontHeaderName, 10);
                        //Font __fontDetail2 = new Font(this._fontHeaderName, 10, FontStyle.Italic);
                        int __transCount = 0;
                        decimal __itemQtyCount = 0;
                        decimal __saveAmount = 0;
                        decimal __sumFood = 0M;
                        decimal __sumDrink = 0M;
                        for (int __row = 0; __row < __transDetail.Rows.Count; __row++)
                        {
                            DataRow __data = __transDetail.Rows[__row];
                            if (__data[_g.d.ic_trans_detail._item_type].ToString().Equals("3"))
                            {
                                // สินค้าชุด ข้ามไป
                                continue;
                            }

                            decimal __amount = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._sum_amount].ToString());

                            if (MyLib._myGlobal._decimalPhase(__data[_g.d.ic_inventory_barcode._hidden_text].ToString()) == 0)
                            {
                                __transCount++;
                                decimal __price = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._price].ToString());
                                decimal __qty = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._qty].ToString());
                                decimal __priceDefault = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._price_default].ToString());
                                __itemQtyCount += __qty;
                                string __discountWord = __data[_g.d.ic_trans_detail._discount].ToString();
                                string __priceInfo = __data[_g.d.ic_trans_detail._remark].ToString();
                                decimal __discountAmount = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._discount_amount].ToString());
                                // มูลค่าสินค้า+vat
                                string __extraWord = "";
                                int __taxType = (int)MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._tax_type].ToString());

                                // toe แก้ extraword เอา case 0 ออก                            
                                switch (__taxType)
                                {
                                    case 0:
                                        __extraWord = "V";
                                        break;
                                }
                                // รายละเอียดสินค้า
                                StringBuilder __detail = new StringBuilder();
                                if (languageSelectIndex == 0)
                                {
                                    __detail.Append(__data[_g.d.ic_trans_detail._item_name].ToString().Trim());
                                }
                                else
                                {
                                    string __itemNameEn = __data[_g.d.ic_trans_detail._item_name_en].ToString().Trim();
                                    if (__itemNameEn.Length > 0)
                                    {
                                        __detail.Append(__itemNameEn);
                                    }
                                    else
                                    {
                                        __detail.Append(__data[_g.d.ic_trans_detail._item_name].ToString().Trim());
                                    }
                                }

                                if (__priceDefault != __amount)
                                {
                                    __detail.Append(" " + "@" + __priceDefault.ToString(this._formatNumber1));
                                }
                                float __lineHeight = this._printSlipText(__g, __width, (__memberCode.Trim().Length == 0) ? __width * 0.8f : __width, 0, __y, __detail.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                                // ราคาสามาชิก
                                if (__memberCode.Trim().Length > 0)
                                {
                                    decimal __newPrice = __amount / __qty;
                                    string __qtyStr = (__qty == Math.Round(__qty, 0)) ? __qty.ToString(this._formatNumber2) : __qty.ToString(this._formatNumber1);
                                    string __priceStr = __newPrice.ToString(this._formatNumber1);
                                    StringBuilder __memberPrice = new StringBuilder(_getResource("ราคาสมาชิก", languageSelectIndex) + " " + "@" + __priceStr);
                                    if (__qty > 1)
                                    {
                                        __memberPrice.Append("x");
                                        __memberPrice.Append(__qtyStr);
                                    }
                                    __y += __lineHeight;
                                    __lineHeight = this._printSlipText(__g, __width, __width, 5, __y, __memberPrice.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                }
                                // ส่วนลด
                                if (__discountAmount != 0)
                                {
                                    //StringBuilder __discountStr = new StringBuilder("ราคาปรกติ" + " : " + __priceDefault.ToString(this._formatNumber1) + " " + "บาท");
                                    //__y += this._printSlipText(__g, __width, __width, 5, __y, __discountStr.ToString(), new Font(this._fontDetailName, this._fontDetailSize * 0.8f), SMLPOSControl._printSlipTextStyle.Left);
                                    __saveAmount += __discountAmount;
                                    /*StringBuilder __discountStr = new StringBuilder();
                                    __discountStr.Append(__priceInfo + " " + "ลด");
                                    __discountStr.Append(" " + __discountAmount.ToString(this._formatNumber1) + " " + "บาท");
                                    if (__priceDefault != 0)
                                    {
                                        __discountStr.Append(" " + "จาก" + " " + __priceDefault.ToString(this._formatNumber1) + " " + "บาท");
                                    }
                                    __y += this._printSlipText(__g, __width, __width, 5, __y, __discountStr.ToString(), new Font(this._fontDetailName, this._fontDetailSize * 0.8f), SMLPOSControl._printSlipTextStyle.Left);
                                    __saveAmount += __discountAmount;
                                     */
                                }
                                this._printSlipText(__g, __width - 15, __width - 10, 0, __y, __amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                                if (this._showTaxDetail && _g.g._companyProfile._vat_rate > 0)
                                {
                                    this._printSlipText(__g, __width, __width, 0, __y, __extraWord, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                }
                                __y += __lineHeight;
                                if (__serialNumberTable != null && __serialNumberTable.Rows.Count > 0)
                                {
                                    // Serial Number
                                    DataRow[] __serial = __serialNumberTable.Select(_g.d.ic_trans_serial_number._doc_line_number + "=\'" + (__row).ToString() + "\'");
                                    for (int __serialLoop = 0; __serialLoop < __serial.Length; __serialLoop++)
                                    {
                                        __y += this._printSlipText(__g, __width, __width, 0, __y, "S/N:" + __serial[__serialLoop][_g.d.ic_trans_serial_number._serial_number].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                    }
                                }
                            }

                            if (__data[_g.d.ic_inventory._drink_type].ToString().Equals("1"))
                            {
                                __sumDrink += __amount;
                            }
                            else
                            {
                                __sumFood += __amount;
                            }
                        }

                        #endregion

                        #region รายการ promotion
                        for (int __row = 0; __row < __transDetailPromotion.Rows.Count; __row++)
                        {
                            DataRow __data = __transDetailPromotion.Rows[__row];
                            decimal __amount = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail_promotion._sum_amount].ToString());

                            //__transCount++;
                            decimal __price = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail_promotion._price].ToString());
                            decimal __qty = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail_promotion._qty].ToString());

                            //__itemQtyCount += __qty;

                            StringBuilder __detail = new StringBuilder();
                            __detail.Append(__data[_g.d.ic_trans_detail_promotion._promotion_name].ToString().Trim());

                            float __lineHeight = this._printSlipText(__g, __width, __width * 0.8f, 0, __y, __detail.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                            // ราคาสามาชิก
                            //if (__memberCode.Trim().Length > 0)
                            //{
                            //    decimal __newPrice = __amount / __qty;
                            //    string __qtyStr = (__qty == Math.Round(__qty, 0)) ? __qty.ToString(this._formatNumber2) : __qty.ToString(this._formatNumber1);
                            //    string __priceStr = __newPrice.ToString(this._formatNumber1);
                            //    StringBuilder __memberPrice = new StringBuilder("ราคาสมาชิก" + " " + "@" + __priceStr);
                            //    if (__qty > 1)
                            //    {
                            //        __memberPrice.Append("x");
                            //        __memberPrice.Append(__qtyStr);
                            //    }
                            //    __y += __lineHeight;
                            //    __lineHeight = this._printSlipText(__g, __width, __width, 5, __y, __memberPrice.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            //}
                            // ส่วนลด
                            //if (__discountAmount != 0)
                            //{
                            //    //StringBuilder __discountStr = new StringBuilder("ราคาปรกติ" + " : " + __priceDefault.ToString(this._formatNumber1) + " " + "บาท");
                            //    //__y += this._printSlipText(__g, __width, __width, 5, __y, __discountStr.ToString(), new Font(this._fontDetailName, this._fontDetailSize * 0.8f), SMLPOSControl._printSlipTextStyle.Left);
                            //    __saveAmount += __discountAmount;
                            //    /*StringBuilder __discountStr = new StringBuilder();
                            //    __discountStr.Append(__priceInfo + " " + "ลด");
                            //    __discountStr.Append(" " + __discountAmount.ToString(this._formatNumber1) + " " + "บาท");
                            //    if (__priceDefault != 0)
                            //    {
                            //        __discountStr.Append(" " + "จาก" + " " + __priceDefault.ToString(this._formatNumber1) + " " + "บาท");
                            //    }
                            //    __y += this._printSlipText(__g, __width, __width, 5, __y, __discountStr.ToString(), new Font(this._fontDetailName, this._fontDetailSize * 0.8f), SMLPOSControl._printSlipTextStyle.Left);
                            //    __saveAmount += __discountAmount;
                            //     */
                            //}
                            this._printSlipText(__g, __width - 15, __width - 10, 0, __y, __amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                            //if (this._showTaxDetail)
                            //{
                            //    this._printSlipText(__g, __width, __width, 0, __y, __extraWord, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            //}
                            __y += __lineHeight;

                        }

                        #endregion

                        #region ส่วนท้ายบิล

                        decimal __discountFooter = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_discount].ToString());
                        decimal __serviceChargeAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_service_charge].ToString());

                        // ท้ายบิล 
                        // โต๋ ดุให้ดี ๆ นะ มีผลกระทบต่อ ที่อื่นนะ 
                        // ถ้เาป็นค่าลบ เอายอดปัดเศษ มาโชวในส่วนลดด้วย
                        // ถ้าปัดขึนทำไงให้ดุดี
                        __totalAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_amount].ToString()) + __discountFooter + __totalAdvanceMoney;
                        __y += this._printSlipLine(__g, __width, __y);
                        string __footer1 = __transCount.ToString() + " " + _getResource("รายการ", languageSelectIndex) + " " + __itemQtyCount.ToString(this._formatNumber1) + " " + _getResource("ชิ้น", languageSelectIndex);
                        this._printSlipText(__g, __width, __width, 0, __y, __footer1, new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                        __y += this._printSlipText(__g, __width, __width, 0, __y, (__totalAmount - __serviceChargeAmount).ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                        // ส่วนลดท้ายบิล

                        // tomyumgoong ยอดอาหาร เครื่องดิ่ม
                        if (MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro)
                        {
                            float __lineHeight = 0;

                            if (__serviceChargeAmount > 0)
                            {
                                string __serviceChargeText = __trans.Rows[0][_g.d.ic_trans._service_charge_word].ToString();
                                __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("Service Charge", languageSelectIndex) + " " + ((__serviceChargeText.IndexOf("%") != -1) ? __serviceChargeText : ""), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                this._printSlipText(__g, __width, __width, 0, __y, __serviceChargeAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                __y += __lineHeight;
                            }

                            __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("อาหาร", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            this._printSlipText(__g, __width, __width, 0, __y, __sumFood.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += __lineHeight;

                            __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("เครื่องดื่ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            this._printSlipText(__g, __width, __width, 0, __y, __sumDrink.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += __lineHeight;

                            __y += this._printSlipLine(__g, __width, __y);
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("รวมทั้งสิ้น", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += this._printSlipLine(__g, __width, __y);

                        }

                        // เงินมัดจำ
                        if (__totalAdvanceMoney > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, "เงินมัดจำ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            for (int __row = 0; __row < __advanceMoneyDetail.Rows.Count; __row++)
                            {

                                string __detail = string.Format("{0}:{1}", __advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._trans_number].ToString(), MyLib._myGlobal._convertDateFromQuery(__advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._doc_date_ref].ToString()).ToString("dd-MM-yyyy", new CultureInfo("th-TH")));
                                decimal __advanceAmount = MyLib._myGlobal._decimalPhase(__advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._amount].ToString());

                                this._printSlipText(__g, __width, __width, 0, __y, __detail, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __advanceAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                        }

                        if (__discountFooter != 0)
                        {
                            string __discountWord2 = _getResource("ส่วนลดพิเศษ", languageSelectIndex);
                            string __discountWord = __trans.Rows[0][_g.d.ic_trans._discount_word].ToString().Trim();
                            if (__discountWord.Length > 0)
                            {
                                __discountWord2 = __discountWord2 + " : " + __discountWord;
                            }
                            this._printSlipText(__g, __width, __width, 0, __y, __discountWord2, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __discountFooter.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __saveAmount += __discountFooter;
                            // คงเหลือ
                            __totalAmount -= __discountFooter;
                        }

                        // ผลต่างปัดเศษ
                        //decimal __diffAmount = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._total_income_amount].ToString());
                        if (__diff_amount != 0)
                        {
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("ผลต่างการปัดเศษ", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __diff_amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __saveAmount += (__diff_amount);
                            __totalAmount += (__diff_amount * -1);
                        }

                        if (__discountFooter != 0 || __diff_amount != 0)
                        {
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("คงเหลือยอดชำระ", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                        }

                        // ภาษีมูลค่าเพิ่ม
                        decimal __beforeVatAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_before_vat].ToString());
                        decimal __exceptVatAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_except_vat].ToString());
                        decimal __vatAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_vat_value].ToString());
                        decimal __vatRate = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._vat_rate].ToString());

                        // toe เพิ่ม option แสดงรายละเอียดภาษี
                        if (this._showTaxDetail && _g.g._companyProfile._vat_rate > 0)
                        {

                            __y += this._printSlipLine(__g, __width, __y);
                            // สินค้ายกเว้นภาษี
                            if (__exceptVatAmount != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("มูลค่าสินค้ายกเว้นภาษีมูลค่าเพิ่ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __exceptVatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                            //
                            if (__beforeVatAmount != 0 || __vatAmount != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("มูลค่าสินค้ามีภาษีมูลค่าเพิ่ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __beforeVatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                //
                                string __vatRateStr = (__vatRate == Math.Round(__vatRate, 0)) ? __vatRate.ToString(this._formatNumber2) : __vatRate.ToString(this._formatNumber1);
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ภาษีมูลค่าเพิ่ม", languageSelectIndex) + " : " + __vatRateStr + "%", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __vatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                        }
                        __y += this._printSlipLine(__g, __width, __y);
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("รวมเงิน", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                            SMLReport._formReport._moneyToText __moneyToText = new SMLReport._formReport._moneyToText();
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __moneyToText._toText(__totalAmount), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipLine(__g, __width, __y);
                        }
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างย่อ)
                        {
                            // ประหยัด
                            if (__saveAmount != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("คุณประหยัดครั้งนี้", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __saveAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                            __y += this._printSlipLine(__g, __width, __y);
                            // ยอดชำระ
                            //__payCash = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._pay_cash_amount].ToString());
                            if (__payCash != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระด้วยเงินสด", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __payCash.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                            if (__creditCardDetail != null)
                            {
                                for (int __row = 0; __row < __creditCardDetail.Rows.Count; __row++)
                                {
                                    decimal __creditCardTotalAmount = MyLib._myGlobal._decimalPhase(__creditCardDetail.Rows[__row][_g.d.cb_trans_detail._sum_amount].ToString());
                                    decimal __creditCardChargeAmount = MyLib._myGlobal._decimalPhase(__creditCardDetail.Rows[__row][_g.d.cb_trans_detail._charge].ToString());
                                    if (__creditCardTotalAmount != 0)
                                    {
                                        string __creditCardType = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._credit_card_type].ToString();
                                        string __creditCardNumber = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._trans_number].ToString();
                                        for (int __loop = 0; __loop < __creditCardNumber.Length - 4; __loop++)
                                        {
                                            __creditCardNumber = __creditCardNumber.Remove(__loop, 1);
                                            __creditCardNumber = __creditCardNumber.Insert(__loop, "*");
                                        }
                                        //
                                        this._printSlipText(__g, __width, __width, 0, __y, __creditCardType + " " + __creditCardNumber, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                        __y += this._printSlipText(__g, __width, __width, 0, __y, __creditCardTotalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                        //
                                        if (__creditCardChargeAmount != 0)
                                        {
                                            __y += this._printSlipText(__g, __width, __width, 10, __y, _getResource("Charge", languageSelectIndex) + " : " + __creditCardChargeAmount.ToString(this._formatNumber1) + " " + _getResource("บาท", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Italic), SMLPOSControl._printSlipTextStyle.Left, false);
                                        }
                                        //
                                        string __creditCardApproved = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._no_approved].ToString();
                                        __y += this._printSlipText(__g, __width, __width, 10, __y, _getResource("Approval", languageSelectIndex) + " : " + __creditCardApproved, new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Italic), SMLPOSControl._printSlipTextStyle.Left, false);
                                    }
                                }
                            }

                            // ชำระด้วยคูปอง
                            //__payCoupon = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._coupon_amount].ToString());
                            if (__payCoupon != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระด้วยคูปอง", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __payCoupon.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                            // ชำระด้วยแต้ม
                            //__payPoint = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._point_amount].ToString());
                            if (__payPoint != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระด้วยแต้ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __payPoint.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                            // เงินทอน
                            //__moneyChange = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._money_change].ToString());
                            if (__moneyChange != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("เงินทอน", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __moneyChange.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                            //
                            __y += this._printSlipLine(__g, __width, __y);

                            // order detail
                            if ((MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro) && this._show_order_detail && (this._show_order_detail_copy_Only == false || (this._show_order_detail_copy_Only == true && header == "- สำเนา -")))
                            {
                                // order detail
                                for (int __orderRow = 0; __orderRow < __tableOrderDetail.Rows.Count; __orderRow++)
                                {
                                    __y += this._printSlipText(__g, __width, __width, 0, __y, "ใบสั่ง : " + __tableOrderDetail.Rows[__orderRow][_g.d.table_order_doc._doc_no].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                }

                                // order cancel
                                for (int __cancelRow = 0; __cancelRow < __tableOrderCancel.Rows.Count; __cancelRow++)
                                {
                                    decimal __cancelAmount = MyLib._myGlobal._decimalPhase(__tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._sum_amount].ToString());

                                    __y += this._printSlipText(__g, __width, __width, 0, __y, (__tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._cancel_flag].ToString().Equals("1") ? "ย้ายออก " + __tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._table_number_2].ToString() + " : " : "ยกเลิก : ") + __tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._item_name].ToString() + " " + __cancelAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                }
                                __y += this._printSlipLine(__g, __width, __y);

                            }
                        }
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างย่อ)
                        {
                            string __docNoAndTime = _getResource("เลขที่", languageSelectIndex) + ":" + __docNo;
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __docNoAndTime, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);

                            __docNoAndTime = _getResource("วันที่", languageSelectIndex) + ":" + __docDate + "@" + __trans.Rows[0][_g.d.ic_trans._doc_time].ToString();
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __docNoAndTime, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);

                            if (__currentPoint > 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("แต้มครั้งนี้", languageSelectIndex) + ":", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __currentPoint.ToString(this._formatNumber2), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                                SMLProcess._posProcess __process = new SMLProcess._posProcess();
                                decimal __currentPointBalance = __process._pointBalance(__cust_code, true);

                                // แต้มสะสม
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("แต้มสะสมถึง", languageSelectIndex) + " " + __docDate, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __currentPointBalance.ToString(this._formatNumber2), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                            }
                        }

                        //
                        if (this._showShortDescription && _g.g._companyProfile._vat_rate > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, "V=" + _getResource("สินค้ามีภาษีมูลค่าเพิ่ม", languageSelectIndex) + " " + "E=" + _getResource("สินค้ายกเว้นภาษี", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            //
                        }
                        string __saleCode = __trans.Rows[0][_g.d.ic_trans._sale_code].ToString();
                        string __cashierCode = __trans.Rows[0][_g.d.ic_trans._cashier_code].ToString();
                        if (__cashierCode.Equals(__saleCode) == false && mode == _printSlipMode.ใบกำกับภาษีอย่างย่อ)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("พนักงานขาย", languageSelectIndex) + " : " + __saleCode, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }
                        //
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            __y += 15f;
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ผู้รับเงิน", languageSelectIndex) + "................................................................" + __saleCode, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);

                            // remark
                            if (__trans.Rows[0][_g.d.ic_trans._remark].ToString().Length > 0)
                            {
                                __y += 15;
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("หมายเหตุ", languageSelectIndex) + " ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __trans.Rows[0][_g.d.ic_trans._remark].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                                __y += 15;
                            }
                        }
                        if (this._posFooter.Trim().Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, this._posFooter, new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }
                        #endregion

                    }
                    break;
                #endregion

                #region ใบเสร็จแบบที่ 12 copy จาก 1 แต่ไม่แสดงรายการภาษี รายการสินค้า @ราคาขาย
                case 12:
                    {

                        #region ข้อมูลบริษัท

                        if (this._posHeader.Trim().Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, this._posHeader, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false, true);
                        }
                        else
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __ltdName, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __ltdAddress, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            string __telephone = "";
                            if (__ltdTel.Trim().Length > 0)
                            {
                                __telephone = _getResource("โทรศัพท์", languageSelectIndex) + ":" + __ltdTel.Trim();
                            }
                            if (__ltdFax.Trim().Length > 0)
                            {
                                __telephone = __telephone + " " + _getResource("โทรสาร", languageSelectIndex) + ":" + __ltdFax.Trim();
                            }
                            if (__telephone.Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __telephone, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            }
                            //

                            if (__ltdTax != null && __ltdTax.Trim().Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขประจำตัวผู้เสียภาษีอากร", languageSelectIndex) + " : " + __ltdTax, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            }
                        }

                        #endregion

                        #region ส่วนหัว แสดงข้อมูลลูกค้า

                        if (header.Length > 0)
                        {
                            // ข้อความเพิ่มเติม
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource(header, languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Center, false);
                        }
                        __y += this._fontHeaderSize;
                        // toe change headerSlip 
                        // ย้ายไปข้างบน
                        //if (_posBillType.Length > 0)
                        //{
                        //    headerSlip = _posBillType;
                        //}

                        __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource(headerSlip, languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Center, false);
                        __y += this._fontHeaderSize;
                        this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขเครื่อง", languageSelectIndex) + " : " + __trans.Rows[0]["pos_id_desc"].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        string __cashierName = "";
                        try
                        {
                            __cashierName = __trans.Rows[0]["cashier_name"].ToString().Split(' ')[0].ToString().Trim();
                        }
                        catch
                        {
                        }
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            __cashierName = __trans.Rows[0][_g.d.ic_trans._cashier_code].ToString();
                        }

                        __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("พนักงาน", languageSelectIndex) + " : " + __cashierName, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                        if (header.IndexOf("ยกเลิก") != -1)
                        {
                            string __cancelDocNo = __trans.Rows[0]["cancel_doc_no"].ToString();
                            string __cancelDocDate = MyLib._myGlobal._convertDateFromQuery(__trans.Rows[0]["cancel_doc_date"].ToString()).ToString("dd-MM-yyyy", new CultureInfo("th-TH"));

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขที่เอกสารยกเลิก", languageSelectIndex) + ":" + __cancelDocNo, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("วันที่", languageSelectIndex) + ":" + __cancelDocDate, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }

                        // เลขที่เอกสาร วันที่ เวลา
                        string __docDate = MyLib._myGlobal._convertDateFromQuery(__trans.Rows[0][_g.d.ic_trans._doc_date].ToString()).ToString("dd-MM-yyyy", new CultureInfo("th-TH"));
                        string __docNo = __trans.Rows[0][_g.d.ic_trans._doc_no].ToString();
                        string __docRefNo = __trans.Rows[0][_g.d.ic_trans._doc_ref].ToString();
                        __docGuid = __trans.Rows[0][_g.d.ic_trans._doc_no_guid].ToString().Trim();
                        //


                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขที่", languageSelectIndex) + ":" + __docNo, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขที่อ้างอิง", languageSelectIndex) + ":" + __docRefNo, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("วันที่", languageSelectIndex) + ":" + __docDate + "@" + __trans.Rows[0][_g.d.ic_trans._doc_time].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ลูกค้า", languageSelectIndex) + " : " + __memberName, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขประจำตัวผู้เสียภาษี", languageSelectIndex) + " : " + __cust_taxid, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, ((__branch_type == "1") ? " [   ] " + __headquatreStr + " [ x ] " + __branchStr + " " + __branch_code : " [ x ] " + __headquatreStr + " [   ] " + __branchStr), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ที่อยู่", languageSelectIndex) + " : " + __memberAddress, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                        }
                        else
                        {
                            if (__memberCode.Trim().Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("สมาชิก", languageSelectIndex) + " : " + __memberName + " (" + __memberCode + ")", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            }

                            // พิมพ์โต๊ะ
                            if (__tableNumberStr.Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("หมายเลขโต๊ะ", languageSelectIndex) + " : " + __tableNumberStr, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            }

                            if ((MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro) && __table_trans.Rows.Count > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เวลาเข้า", languageSelectIndex) + " : " + __table_trans.Rows[0][_g.d.table_trans._open_doc_time].ToString() + _getResource(" เวลาออก", languageSelectIndex) + " : " + __table_trans.Rows[0][_g.d.table_trans._close_doc_time].ToString(), new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Left, false);

                            }
                        }

                        if (__customer_phone.Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __customer_phone, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }

                        __y += this._printSlipLine(__g, __width, __y);


                        #endregion

                        #region รายการสินค้า
                        //
                        //Font __fontDetail1 = new Font(this._fontHeaderName, 10);
                        //Font __fontDetail2 = new Font(this._fontHeaderName, 10, FontStyle.Italic);
                        int __transCount = 0;
                        decimal __itemQtyCount = 0;
                        decimal __saveAmount = 0;
                        decimal __sumFood = 0M;
                        decimal __sumDrink = 0M;
                        for (int __row = 0; __row < __transDetail.Rows.Count; __row++)
                        {
                            DataRow __data = __transDetail.Rows[__row];
                            if (__data[_g.d.ic_trans_detail._item_type].ToString().Equals("3"))
                            {
                                // สินค้าชุด ข้ามไป
                                continue;
                            }
                            decimal __amount = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._sum_amount].ToString());

                            if (MyLib._myGlobal._decimalPhase(__data[_g.d.ic_inventory_barcode._hidden_text].ToString()) == 0)
                            {
                                __transCount++;
                                decimal __price = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._price].ToString());
                                decimal __qty = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._qty].ToString());
                                decimal __priceDefault = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._price_default].ToString());
                                __itemQtyCount += __qty;
                                string __discountWord = __data[_g.d.ic_trans_detail._discount].ToString();
                                string __priceInfo = __data[_g.d.ic_trans_detail._remark].ToString();
                                decimal __discountAmount = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._discount_amount].ToString());
                                // มูลค่าสินค้า+vat
                                string __extraWord = "";
                                int __taxType = (int)MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._tax_type].ToString());

                                // toe แก้ extraword เอา case 0 ออก                            
                                switch (__taxType)
                                {
                                    case 0:
                                        __extraWord = "V";
                                        break;
                                }
                                // รายละเอียดสินค้า
                                StringBuilder __detail = new StringBuilder();
                                if (languageSelectIndex == 0)
                                {
                                    __detail.Append(__data[_g.d.ic_trans_detail._item_name].ToString().Trim());
                                }
                                else
                                {
                                    string __itemNameEn = __data[_g.d.ic_trans_detail._item_name_en].ToString().Trim();
                                    if (__itemNameEn.Length > 0)
                                    {
                                        __detail.Append(__itemNameEn);
                                    }
                                    else
                                    {
                                        __detail.Append(__data[_g.d.ic_trans_detail._item_name].ToString().Trim());
                                    }
                                }

                                if (__price != __amount)
                                {
                                    __detail.Append(" " + "@" + __price.ToString(this._formatNumber1));
                                }
                                float __lineHeight = this._printSlipText(__g, __width, (__memberCode.Trim().Length == 0) ? __width * 0.8f : __width, 0, __y, __detail.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                                // ราคาสามาชิก
                                if (__memberCode.Trim().Length > 0)
                                {
                                    decimal __newPrice = __amount / __qty;
                                    string __qtyStr = (__qty == Math.Round(__qty, 0)) ? __qty.ToString(this._formatNumber2) : __qty.ToString(this._formatNumber1);
                                    string __priceStr = __newPrice.ToString(this._formatNumber1);
                                    StringBuilder __memberPrice = new StringBuilder(_getResource("ราคาสมาชิก", languageSelectIndex) + " " + "@" + __priceStr);
                                    if (__qty > 1)
                                    {
                                        __memberPrice.Append("x");
                                        __memberPrice.Append(__qtyStr);
                                    }
                                    __y += __lineHeight;
                                    __lineHeight = this._printSlipText(__g, __width, __width, 5, __y, __memberPrice.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                }
                                // ส่วนลด
                                if (__discountAmount != 0)
                                {
                                    //StringBuilder __discountStr = new StringBuilder("ราคาปรกติ" + " : " + __priceDefault.ToString(this._formatNumber1) + " " + "บาท");
                                    //__y += this._printSlipText(__g, __width, __width, 5, __y, __discountStr.ToString(), new Font(this._fontDetailName, this._fontDetailSize * 0.8f), SMLPOSControl._printSlipTextStyle.Left);
                                    __saveAmount += __discountAmount;
                                    /*StringBuilder __discountStr = new StringBuilder();
                                    __discountStr.Append(__priceInfo + " " + "ลด");
                                    __discountStr.Append(" " + __discountAmount.ToString(this._formatNumber1) + " " + "บาท");
                                    if (__priceDefault != 0)
                                    {
                                        __discountStr.Append(" " + "จาก" + " " + __priceDefault.ToString(this._formatNumber1) + " " + "บาท");
                                    }
                                    __y += this._printSlipText(__g, __width, __width, 5, __y, __discountStr.ToString(), new Font(this._fontDetailName, this._fontDetailSize * 0.8f), SMLPOSControl._printSlipTextStyle.Left);
                                    __saveAmount += __discountAmount;
                                     */
                                }
                                this._printSlipText(__g, __width - 15, __width - 10, 0, __y, __amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                                if (this._showTaxDetail && _g.g._companyProfile._vat_rate > 0)
                                {
                                    this._printSlipText(__g, __width, __width, 0, __y, __extraWord, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                }
                                __y += __lineHeight;
                                if (__serialNumberTable != null && __serialNumberTable.Rows.Count > 0)
                                {
                                    // Serial Number
                                    DataRow[] __serial = __serialNumberTable.Select(_g.d.ic_trans_serial_number._doc_line_number + "=\'" + (__row).ToString() + "\'");
                                    for (int __serialLoop = 0; __serialLoop < __serial.Length; __serialLoop++)
                                    {
                                        __y += this._printSlipText(__g, __width, __width, 0, __y, "S/N:" + __serial[__serialLoop][_g.d.ic_trans_serial_number._serial_number].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                    }
                                }
                            }

                            if (__data[_g.d.ic_inventory._drink_type].ToString().Equals("1"))
                            {
                                __sumDrink += __amount;
                            }
                            else
                            {
                                __sumFood += __amount;
                            }
                        }

                        #endregion

                        #region รายการ promotion
                        for (int __row = 0; __row < __transDetailPromotion.Rows.Count; __row++)
                        {
                            DataRow __data = __transDetailPromotion.Rows[__row];
                            decimal __amount = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail_promotion._sum_amount].ToString());

                            //__transCount++;
                            decimal __price = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail_promotion._price].ToString());
                            decimal __qty = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail_promotion._qty].ToString());

                            //__itemQtyCount += __qty;

                            StringBuilder __detail = new StringBuilder();
                            __detail.Append(__data[_g.d.ic_trans_detail_promotion._promotion_name].ToString().Trim());

                            float __lineHeight = this._printSlipText(__g, __width, __width * 0.8f, 0, __y, __detail.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                            // ราคาสามาชิก
                            //if (__memberCode.Trim().Length > 0)
                            //{
                            //    decimal __newPrice = __amount / __qty;
                            //    string __qtyStr = (__qty == Math.Round(__qty, 0)) ? __qty.ToString(this._formatNumber2) : __qty.ToString(this._formatNumber1);
                            //    string __priceStr = __newPrice.ToString(this._formatNumber1);
                            //    StringBuilder __memberPrice = new StringBuilder("ราคาสมาชิก" + " " + "@" + __priceStr);
                            //    if (__qty > 1)
                            //    {
                            //        __memberPrice.Append("x");
                            //        __memberPrice.Append(__qtyStr);
                            //    }
                            //    __y += __lineHeight;
                            //    __lineHeight = this._printSlipText(__g, __width, __width, 5, __y, __memberPrice.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            //}
                            // ส่วนลด
                            //if (__discountAmount != 0)
                            //{
                            //    //StringBuilder __discountStr = new StringBuilder("ราคาปรกติ" + " : " + __priceDefault.ToString(this._formatNumber1) + " " + "บาท");
                            //    //__y += this._printSlipText(__g, __width, __width, 5, __y, __discountStr.ToString(), new Font(this._fontDetailName, this._fontDetailSize * 0.8f), SMLPOSControl._printSlipTextStyle.Left);
                            //    __saveAmount += __discountAmount;
                            //    /*StringBuilder __discountStr = new StringBuilder();
                            //    __discountStr.Append(__priceInfo + " " + "ลด");
                            //    __discountStr.Append(" " + __discountAmount.ToString(this._formatNumber1) + " " + "บาท");
                            //    if (__priceDefault != 0)
                            //    {
                            //        __discountStr.Append(" " + "จาก" + " " + __priceDefault.ToString(this._formatNumber1) + " " + "บาท");
                            //    }
                            //    __y += this._printSlipText(__g, __width, __width, 5, __y, __discountStr.ToString(), new Font(this._fontDetailName, this._fontDetailSize * 0.8f), SMLPOSControl._printSlipTextStyle.Left);
                            //    __saveAmount += __discountAmount;
                            //     */
                            //}
                            this._printSlipText(__g, __width - 15, __width - 10, 0, __y, __amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                            //if (this._showTaxDetail)
                            //{
                            //    this._printSlipText(__g, __width, __width, 0, __y, __extraWord, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            //}
                            __y += __lineHeight;

                        }

                        #endregion

                        #region ส่วนท้ายบิล

                        decimal __discountFooter = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_discount].ToString());
                        decimal __serviceChargeAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_service_charge].ToString());

                        // ท้ายบิล 
                        // โต๋ ดุให้ดี ๆ นะ มีผลกระทบต่อ ที่อื่นนะ 
                        // ถ้เาป็นค่าลบ เอายอดปัดเศษ มาโชวในส่วนลดด้วย
                        // ถ้าปัดขึนทำไงให้ดุดี
                        __totalAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_amount].ToString()) + __discountFooter + __totalAdvanceMoney;
                        __y += this._printSlipLine(__g, __width, __y);
                        string __footer1 = __transCount.ToString() + " " + _getResource("รายการ", languageSelectIndex) + " " + __itemQtyCount.ToString(this._formatNumber1) + " " + _getResource("ชิ้น", languageSelectIndex);
                        this._printSlipText(__g, __width, __width, 0, __y, __footer1, new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                        __y += this._printSlipText(__g, __width, __width, 0, __y, (__totalAmount - __serviceChargeAmount).ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                        // ส่วนลดท้ายบิล

                        // tomyumgoong ยอดอาหาร เครื่องดิ่ม
                        if (MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro)
                        {
                            float __lineHeight = 0;

                            if (__serviceChargeAmount > 0)
                            {
                                string __serviceChargeText = __trans.Rows[0][_g.d.ic_trans._service_charge_word].ToString();
                                __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("Service Charge", languageSelectIndex) + " " + ((__serviceChargeText.IndexOf("%") != -1) ? __serviceChargeText : ""), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                this._printSlipText(__g, __width, __width, 0, __y, __serviceChargeAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                __y += __lineHeight;
                            }

                            __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("อาหาร", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            this._printSlipText(__g, __width, __width, 0, __y, __sumFood.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += __lineHeight;

                            __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("เครื่องดื่ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            this._printSlipText(__g, __width, __width, 0, __y, __sumDrink.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += __lineHeight;

                            __y += this._printSlipLine(__g, __width, __y);
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("รวมทั้งสิ้น", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += this._printSlipLine(__g, __width, __y);


                        }

                        // เงินมัดจำ
                        if (__totalAdvanceMoney > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, "เงินมัดจำ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            for (int __row = 0; __row < __advanceMoneyDetail.Rows.Count; __row++)
                            {

                                string __detail = string.Format("{0}:{1}", __advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._trans_number].ToString(), MyLib._myGlobal._convertDateFromQuery(__advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._doc_date_ref].ToString()).ToString("dd-MM-yyyy", new CultureInfo("th-TH")));
                                decimal __advanceAmount = MyLib._myGlobal._decimalPhase(__advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._amount].ToString());

                                this._printSlipText(__g, __width, __width, 0, __y, __detail, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __advanceAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                        }

                        if (__discountFooter != 0)
                        {
                            string __discountWord2 = _getResource("ส่วนลดพิเศษ", languageSelectIndex);
                            string __discountWord = __trans.Rows[0][_g.d.ic_trans._discount_word].ToString().Trim();
                            if (__discountWord.Length > 0)
                            {
                                __discountWord2 = __discountWord2 + " : " + __discountWord;
                            }
                            this._printSlipText(__g, __width, __width, 0, __y, __discountWord2, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __discountFooter.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __saveAmount += __discountFooter;
                            // คงเหลือ
                            __totalAmount -= __discountFooter;
                        }

                        // ผลต่างปัดเศษ
                        //decimal __diffAmount = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._total_income_amount].ToString());
                        if (__diff_amount != 0)
                        {
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("ผลต่างการปัดเศษ", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __diff_amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __saveAmount += (__diff_amount);
                            __totalAmount += (__diff_amount * -1);
                        }

                        if (__discountFooter != 0 || __diff_amount != 0)
                        {
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("คงเหลือยอดชำระ", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                        }

                        // ภาษีมูลค่าเพิ่ม
                        decimal __beforeVatAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_before_vat].ToString());
                        decimal __exceptVatAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_except_vat].ToString());
                        decimal __vatAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_vat_value].ToString());
                        decimal __vatRate = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._vat_rate].ToString());

                        // toe เพิ่ม option แสดงรายละเอียดภาษี
                        //if (this._showTaxDetail)
                        //{
                        //    __y += this._printSlipLine(__g, __width, __y);
                        //    // สินค้ายกเว้นภาษี
                        //    if (__exceptVatAmount != 0)
                        //    {
                        //        this._printSlipText(__g, __width, __width, 0, __y, _getResource("มูลค่าสินค้ายกเว้นภาษีมูลค่าเพิ่ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        //        __y += this._printSlipText(__g, __width, __width, 0, __y, __exceptVatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                        //    }
                        //    //
                        //    if (__beforeVatAmount != 0 || __vatAmount != 0)
                        //    {
                        //        this._printSlipText(__g, __width, __width, 0, __y, _getResource("มูลค่าสินค้ามีภาษีมูลค่าเพิ่ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        //        __y += this._printSlipText(__g, __width, __width, 0, __y, __beforeVatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                        //        //
                        //        string __vatRateStr = (__vatRate == Math.Round(__vatRate, 0)) ? __vatRate.ToString(this._formatNumber2) : __vatRate.ToString(this._formatNumber1);
                        //        this._printSlipText(__g, __width, __width, 0, __y, _getResource("ภาษีมูลค่าเพิ่ม", languageSelectIndex) + " : " + __vatRateStr + "%", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        //        __y += this._printSlipText(__g, __width, __width, 0, __y, __vatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                        //    }
                        //}
                        __y += this._printSlipLine(__g, __width, __y);
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("รวมเงิน", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                            SMLReport._formReport._moneyToText __moneyToText = new SMLReport._formReport._moneyToText();
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __moneyToText._toText(__totalAmount), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipLine(__g, __width, __y);
                        }
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างย่อ)
                        {
                            // ประหยัด
                            if (__saveAmount != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("คุณประหยัดครั้งนี้", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __saveAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                            __y += this._printSlipLine(__g, __width, __y);
                            // ยอดชำระ
                            //__payCash = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._pay_cash_amount].ToString());
                            if (__payCash != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระด้วยเงินสด", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __payCash.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                            if (__creditCardDetail != null)
                            {
                                for (int __row = 0; __row < __creditCardDetail.Rows.Count; __row++)
                                {
                                    decimal __creditCardTotalAmount = MyLib._myGlobal._decimalPhase(__creditCardDetail.Rows[__row][_g.d.cb_trans_detail._sum_amount].ToString());
                                    decimal __creditCardChargeAmount = MyLib._myGlobal._decimalPhase(__creditCardDetail.Rows[__row][_g.d.cb_trans_detail._charge].ToString());
                                    if (__creditCardTotalAmount != 0)
                                    {
                                        string __creditCardType = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._credit_card_type].ToString();
                                        string __creditCardNumber = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._trans_number].ToString();
                                        for (int __loop = 0; __loop < __creditCardNumber.Length - 4; __loop++)
                                        {
                                            __creditCardNumber = __creditCardNumber.Remove(__loop, 1);
                                            __creditCardNumber = __creditCardNumber.Insert(__loop, "*");
                                        }
                                        //
                                        this._printSlipText(__g, __width, __width, 0, __y, __creditCardType + " " + __creditCardNumber, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                        __y += this._printSlipText(__g, __width, __width, 0, __y, __creditCardTotalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                        //
                                        if (__creditCardChargeAmount != 0)
                                        {
                                            __y += this._printSlipText(__g, __width, __width, 10, __y, _getResource("Charge", languageSelectIndex) + " : " + __creditCardChargeAmount.ToString(this._formatNumber1) + " " + _getResource("บาท", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Italic), SMLPOSControl._printSlipTextStyle.Left, false);
                                        }
                                        //
                                        string __creditCardApproved = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._no_approved].ToString();
                                        __y += this._printSlipText(__g, __width, __width, 10, __y, _getResource("Approval", languageSelectIndex) + " : " + __creditCardApproved, new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Italic), SMLPOSControl._printSlipTextStyle.Left, false);
                                    }
                                }
                            }

                            // ชำระด้วยคูปอง
                            //__payCoupon = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._coupon_amount].ToString());
                            if (__payCoupon != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระด้วยคูปอง", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __payCoupon.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                            // ชำระด้วยแต้ม
                            //__payPoint = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._point_amount].ToString());
                            if (__payPoint != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระด้วยแต้ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __payPoint.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                            // เงินทอน
                            //__moneyChange = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._money_change].ToString());
                            if (__moneyChange != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("เงินทอน", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __moneyChange.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                            //
                            __y += this._printSlipLine(__g, __width, __y);

                            // order detail
                            if ((MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro) && this._show_order_detail && (this._show_order_detail_copy_Only == false || (this._show_order_detail_copy_Only == true && header == "- สำเนา -")))
                            {
                                // order detail
                                for (int __orderRow = 0; __orderRow < __tableOrderDetail.Rows.Count; __orderRow++)
                                {
                                    __y += this._printSlipText(__g, __width, __width, 0, __y, "ใบสั่ง : " + __tableOrderDetail.Rows[__orderRow][_g.d.table_order_doc._doc_no].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                }

                                // order cancel
                                for (int __cancelRow = 0; __cancelRow < __tableOrderCancel.Rows.Count; __cancelRow++)
                                {
                                    decimal __cancelAmount = MyLib._myGlobal._decimalPhase(__tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._sum_amount].ToString());

                                    __y += this._printSlipText(__g, __width, __width, 0, __y, (__tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._cancel_flag].ToString().Equals("1") ? "ย้ายออก " + __tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._table_number_2].ToString() + " : " : "ยกเลิก : ") + __tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._item_name].ToString() + " " + __cancelAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                }
                                __y += this._printSlipLine(__g, __width, __y);

                            }
                        }
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างย่อ)
                        {
                            string __docNoAndTime = _getResource("เลขที่", languageSelectIndex) + ":" + __docNo + " " + _getResource("วันที่", languageSelectIndex) + ":" + __docDate + "@" + __trans.Rows[0][_g.d.ic_trans._doc_time].ToString();
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __docNoAndTime, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);

                            if (__currentPoint > 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("แต้มครั้งนี้", languageSelectIndex) + ":", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __currentPoint.ToString(this._formatNumber2), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                                SMLProcess._posProcess __process = new SMLProcess._posProcess();
                                decimal __currentPointBalance = __process._pointBalance(__cust_code, true);

                                // แต้มสะสม
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("แต้มสะสมถึง", languageSelectIndex) + " " + __docDate, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __currentPointBalance.ToString(this._formatNumber2), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                            }
                        }

                        //
                        //if (this._showShortDescription)
                        //{
                        //    __y += this._printSlipText(__g, __width, __width, 0, __y, "V=" + _getResource("สินค้ามีภาษีมูลค่าเพิ่ม", languageSelectIndex) + " " + "E=" + _getResource("สินค้ายกเว้นภาษี", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        //    //
                        //}

                        string __saleCode = __trans.Rows[0][_g.d.ic_trans._sale_code].ToString();
                        string __cashierCode = __trans.Rows[0][_g.d.ic_trans._cashier_code].ToString();
                        if (__cashierCode.Equals(__saleCode) == false && mode == _printSlipMode.ใบกำกับภาษีอย่างย่อ)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("พนักงานขาย", languageSelectIndex) + " : " + __saleCode, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }
                        //
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            __y += 15f;
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ผู้รับเงิน", languageSelectIndex) + "................................................................" + __saleCode, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);

                            // remark
                            if (__trans.Rows[0][_g.d.ic_trans._remark].ToString().Length > 0)
                            {
                                __y += 15;
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("หมายเหตุ", languageSelectIndex) + " ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __trans.Rows[0][_g.d.ic_trans._remark].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                                __y += 15;
                            }
                        }
                        if (this._posFooter.Trim().Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, this._posFooter, new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }
                        #endregion

                    }
                    break;
                #endregion

                #region ใบเสร็จแบบที่ 1001 Earth
                case 1001:
                    {

                        #region ส่วนหัว แสดงข้อมูลบริษัท

                        if (this._posHeader.Trim().Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, this._posHeader, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false, true);
                        }
                        else
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __ltdName, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __ltdAddress, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            string __telephone = "";
                            if (__ltdTel.Trim().Length > 0)
                            {
                                __telephone = _getResource("โทรศัพท์", languageSelectIndex) + ":" + __ltdTel.Trim();
                            }
                            if (__ltdFax.Trim().Length > 0)
                            {
                                __telephone = __telephone + " " + _getResource("โทรสาร", languageSelectIndex) + ":" + __ltdFax.Trim();
                            }
                            if (__telephone.Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __telephone, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            }
                            //
                            if (header.Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource(header, languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Center, false);
                            }
                            __y += this._fontHeaderSize;

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource(headerSlip, languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Center, false);

                            __y += this._fontHeaderSize;

                            if (__ltdTax != null && __ltdTax.Trim().Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __ltdTax, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            }
                        }

                        #endregion

                        #region ส่วนหัว แสดงข้อมูล เครือง POS และลูกค้า

                        // ข้อความเพิ่มเติม

                        // ย้ายไปข้างบน
                        //if (_posBillType.Length > 0)
                        //{
                        //    headerSlip = _posBillType;
                        //}
                        string __docDate = MyLib._myGlobal._convertDateFromQuery(__trans.Rows[0][_g.d.ic_trans._doc_date].ToString()).ToString("dd/MM/yyyy", new CultureInfo("th-TH"));
                        string __docNo = __trans.Rows[0][_g.d.ic_trans._doc_no].ToString();
                        string __docRefNo = __trans.Rows[0][_g.d.ic_trans._doc_ref].ToString();
                        string __cashierName = __trans.Rows[0][_g.d.ic_trans._cashier_code].ToString();
                        string __cardId = __trans.Rows[0][_g.d.ar_customer_detail._card_id].ToString();
                        string __arCode = __trans.Rows[0][_g.d.ic_trans._member_code].ToString() + ((__trans.Rows[0][_g.d.ic_trans._member_code].ToString().Length > 0) ? "/" : "") + __trans.Rows[0][_g.d.ic_trans._cust_code].ToString();


                        this._printSlipText(__g, __width, __width, 0, __y, _getResource("Recpt", languageSelectIndex) + " : " + __docNo, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        __y += this._printSlipText(__g, __width, __width, 0, __y, __docDate, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                        __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("Card", languageSelectIndex) + " : " + __arCode, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("Cashier", languageSelectIndex) + " : " + __cashierName, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                        __y += this._printSlipText(__g, __width, __width, 0, __y, __memberName, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                        __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขบัตร", languageSelectIndex) + " : " + __cardId, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        __y += this._printSlipText(__g, __width, __width, 0, __y, __memberAddress, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);

                        //__y += this._printSlipText(__g, __width, __width, 0, __y, __docDate, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);


                        //this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขเครื่อง", languageSelectIndex) + " : " + __trans.Rows[0]["pos_id_desc"].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        /*string __cashierName = "";
                        try
                        {
                            __cashierName = __trans.Rows[0]["cashier_name"].ToString().Split(' ')[0].ToString().Trim();
                        }
                        catch
                        {
                        }
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            __cashierName = __trans.Rows[0][_g.d.ic_trans._cashier_code].ToString();
                        }*/

                        if (header.IndexOf("ยกเลิก") != -1)
                        {
                            string __cancelDocNo = __trans.Rows[0]["cancel_doc_no"].ToString();
                            string __cancelDocDate = MyLib._myGlobal._convertDateFromQuery(__trans.Rows[0]["cancel_doc_date"].ToString()).ToString("dd-MM-yyyy", new CultureInfo("th-TH"));

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขที่เอกสารยกเลิก", languageSelectIndex) + ":" + __cancelDocNo, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("วันที่", languageSelectIndex) + ":" + __cancelDocDate, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }

                        // เลขที่เอกสาร วันที่ เวลา
                        __docGuid = __trans.Rows[0][_g.d.ic_trans._doc_no_guid].ToString().Trim();
                        //
                        /*if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขที่", languageSelectIndex) + ":" + __docNo, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขที่อ้างอิง", languageSelectIndex) + ":" + __docRefNo, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("วันที่", languageSelectIndex) + ":" + __docDate + "@" + __trans.Rows[0][_g.d.ic_trans._doc_time].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ลูกค้า", languageSelectIndex) + " : " + __memberName, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขประจำตัวผู้เสียภาษี", languageSelectIndex) + " : " + __cust_taxid, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, ((__branch_type == "1") ? " [   ] " + __headquatreStr + " [ x ] " + __branchStr + " " + __branch_code : " [ x ] " + __headquatreStr + " [   ] " + __branchStr), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ที่อยู่", languageSelectIndex) + " : " + __memberAddress, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                        }
                        else
                        {
                            if (__memberCode.Trim().Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("สมาชิก", languageSelectIndex) + " : " + __memberName + " (" + __memberCode + ")", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            }

                            // พิมพ์โต๊ะ
                            if (__tableNumberStr.Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("หมายเลขโต๊ะ", languageSelectIndex) + " : " + __tableNumberStr, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            }

                            if ((MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro) && __table_trans.Rows.Count > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เวลาเข้า", languageSelectIndex) + " : " + __table_trans.Rows[0][_g.d.table_trans._open_doc_time].ToString() + " " + _getResource("เวลาออก", languageSelectIndex) + " : " + __table_trans.Rows[0][_g.d.table_trans._close_doc_time].ToString(), new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Left, false);

                            }

                        }*/

                        /*if (__customer_phone.Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __customer_phone, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }*/

                        __y += 20;
                        __y += this._printSlipLine(__g, __width, __y);

                        #endregion

                        #region รายการสินค้า

                        int __transCount = 0;
                        decimal __itemQtyCount = 0;
                        decimal __saveAmount = 0;
                        decimal __sumFood = 0M;
                        decimal __sumDrink = 0M;

                        float __columnItemCodeWidth = 0.15f;
                        float __columnItemNameWidth = 0.35f;
                        float __columnQtyWidth = 0.1f;
                        float __columnPriceWidth = 0.2f;
                        float __columnAmountWidth = 0.2f;


                        for (int __row = 0; __row < __transDetail.Rows.Count; __row++)
                        {
                            DataRow __data = __transDetail.Rows[__row];

                            if (__data[_g.d.ic_trans_detail._item_type].ToString().Equals("3"))
                            {
                                // สินค้าชุด ข้ามไป
                                continue;
                            }

                            decimal __amount = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._sum_amount].ToString());

                            if (MyLib._myGlobal._decimalPhase(__data[_g.d.ic_inventory_barcode._hidden_text].ToString()) == 0)
                            {
                                __transCount++;
                                string __itemCode = __data[_g.d.ic_trans_detail._item_code].ToString().Trim();
                                string __itemName = __data[_g.d.ic_trans_detail._item_name].ToString().Trim();
                                decimal __price = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._price].ToString());
                                decimal __qty = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._qty].ToString());
                                //decimal __priceDefault = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._price_default].ToString());
                                __itemQtyCount += __qty;
                                //string __discountWord = __data[_g.d.ic_trans_detail._discount].ToString();
                                //string __priceInfo = __data[_g.d.ic_trans_detail._remark].ToString();
                                decimal __discountAmount = MyLib._myGlobal._decimalPhase(__data["member_discount"].ToString());

                                // มูลค่าสินค้า+vat
                                string __extraWord = "";
                                int __taxType = (int)MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._tax_type].ToString());
                                string __qtyStr = (__qty == Math.Round(__qty, 0)) ? __qty.ToString(this._formatNumber2) : __qty.ToString(this._formatNumber1);

                                float __lineHeight = 0f;

                                if (languageSelectIndex != 0)
                                {
                                    string __itemNameEn = __data[_g.d.ic_trans_detail._item_name_en].ToString().Trim();
                                    if (__itemNameEn.Length > 0)
                                    {
                                        __itemName = __itemNameEn;
                                    }
                                }
                                // toe แก้ extraword case 0 = สินค้ามี Vat                         
                                switch (__taxType)
                                {
                                    case 0:
                                        __extraWord = "V";
                                        break;
                                }

                                /* if (__serialNumberTable != null && __serialNumberTable.Rows.Count > 0)
                                 {
                                     // Serial Number
                                     DataRow[] __serial = __serialNumberTable.Select(_g.d.ic_trans_serial_number._doc_line_number + "=\'" + (__row).ToString() + "\'");
                                    
                                     for (int __serialLoop = 0; __serialLoop < __serial.Length; __serialLoop++)
                                     {
                                         __y += this._printSlipText(__g, __width, __width, 0, __y, "S/N:" + __serial[__serialLoop][_g.d.ic_trans_serial_number._serial_number].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                     }
                                 }*/

                                // รหัสสินค้า
                                float __lineHeightTemp = this._printSlipText(__g, __width * __columnItemCodeWidth, __width * __columnItemCodeWidth, 0, __y, __itemCode, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                                if (__lineHeightTemp > __lineHeight)
                                    __lineHeight = __lineHeightTemp;

                                // ชื่อสินค้า
                                __lineHeightTemp = this._printSlipText(__g, __width * __columnItemNameWidth, __width * __columnItemNameWidth, __width * __columnItemCodeWidth, __y, __itemName, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true, false, 2);
                                if (__lineHeightTemp > __lineHeight)
                                    __lineHeight = __lineHeightTemp;



                                // จำนวน
                                __lineHeightTemp = this._printSlipText(__g, __width * (__columnItemCodeWidth + __columnItemNameWidth + __columnQtyWidth), __width * __columnQtyWidth, 0, __y, __qtyStr, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, true);
                                //this._printSlipText(__g, __width - 15, __width - 10, 0, __y, __amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                if (__lineHeightTemp > __lineHeight)
                                    __lineHeight = __lineHeightTemp;

                                // ราคา
                                __lineHeightTemp = this._printSlipText(__g, __width * (__columnItemCodeWidth + __columnItemNameWidth + __columnQtyWidth + __columnPriceWidth), __width * __columnPriceWidth, 0, __y, __price.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, true);
                                if (__lineHeightTemp > __lineHeight)
                                    __lineHeight = __lineHeightTemp;

                                // รวม
                                __lineHeightTemp = this._printSlipText(__g, __width, __width * __columnAmountWidth, 0, __y, __amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, true);
                                if (__lineHeightTemp > __lineHeight)
                                    __lineHeight = __lineHeightTemp;




                                // ราคาสามาชิก
                                //if (__memberCode.Trim().Length > 0)
                                //{
                                //    decimal __newPrice = __amount / __qty;
                                //    string __qtyStr = (__qty == Math.Round(__qty, 0)) ? __qty.ToString(this._formatNumber2) : __qty.ToString(this._formatNumber1);
                                //    string __priceStr = __newPrice.ToString(this._formatNumber1);
                                //    StringBuilder __memberPrice = new StringBuilder("ราคาสมาชิก" + " " + "@" + __priceStr);
                                //    if (__qty > 1)
                                //    {
                                //        __memberPrice.Append("x");
                                //        __memberPrice.Append(__qtyStr);
                                //    }
                                //    __y += __lineHeight;
                                //    __lineHeight = this._printSlipText(__g, __width, __width, 5, __y, __memberPrice.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                //}
                                // ส่วนลด

                                if (__discountAmount != 0)
                                {
                                    __saveAmount += __discountAmount;
                                }


                                /*if (this._showTaxDetail)
                                {
                                    this._printSlipText(__g, __width, __width, 0, __y, __extraWord, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                }*/
                                __y += __lineHeight;

                            }

                            if (__data[_g.d.ic_inventory._drink_type].ToString().Equals("1"))
                            {
                                __sumDrink += __amount;
                            }
                            else
                            {
                                __sumFood += __amount;
                            }

                        }

                        #endregion

                        #region รายการ promotion
                        for (int __row = 0; __row < __transDetailPromotion.Rows.Count; __row++)
                        {
                            DataRow __data = __transDetailPromotion.Rows[__row];
                            decimal __amount = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail_promotion._sum_amount].ToString());

                            //__transCount++;
                            decimal __price = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail_promotion._price].ToString());
                            decimal __qty = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail_promotion._qty].ToString());

                            //__itemQtyCount += __qty;

                            StringBuilder __detail = new StringBuilder();
                            __detail.Append(__data[_g.d.ic_trans_detail_promotion._promotion_name].ToString().Trim());

                            float __lineHeight = this._printSlipText(__g, __width, __width * 0.8f, 0, __y, __detail.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                            // ราคาสามาชิก
                            //if (__memberCode.Trim().Length > 0)
                            //{
                            //    decimal __newPrice = __amount / __qty;
                            //    string __qtyStr = (__qty == Math.Round(__qty, 0)) ? __qty.ToString(this._formatNumber2) : __qty.ToString(this._formatNumber1);
                            //    string __priceStr = __newPrice.ToString(this._formatNumber1);
                            //    StringBuilder __memberPrice = new StringBuilder("ราคาสมาชิก" + " " + "@" + __priceStr);
                            //    if (__qty > 1)
                            //    {
                            //        __memberPrice.Append("x");
                            //        __memberPrice.Append(__qtyStr);
                            //    }
                            //    __y += __lineHeight;
                            //    __lineHeight = this._printSlipText(__g, __width, __width, 5, __y, __memberPrice.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            //}
                            // ส่วนลด
                            //if (__discountAmount != 0)
                            //{
                            //    //StringBuilder __discountStr = new StringBuilder("ราคาปรกติ" + " : " + __priceDefault.ToString(this._formatNumber1) + " " + "บาท");
                            //    //__y += this._printSlipText(__g, __width, __width, 5, __y, __discountStr.ToString(), new Font(this._fontDetailName, this._fontDetailSize * 0.8f), SMLPOSControl._printSlipTextStyle.Left);
                            //    __saveAmount += __discountAmount;
                            //    /*StringBuilder __discountStr = new StringBuilder();
                            //    __discountStr.Append(__priceInfo + " " + "ลด");
                            //    __discountStr.Append(" " + __discountAmount.ToString(this._formatNumber1) + " " + "บาท");
                            //    if (__priceDefault != 0)
                            //    {
                            //        __discountStr.Append(" " + "จาก" + " " + __priceDefault.ToString(this._formatNumber1) + " " + "บาท");
                            //    }
                            //    __y += this._printSlipText(__g, __width, __width, 5, __y, __discountStr.ToString(), new Font(this._fontDetailName, this._fontDetailSize * 0.8f), SMLPOSControl._printSlipTextStyle.Left);
                            //    __saveAmount += __discountAmount;
                            //     */
                            //}
                            this._printSlipText(__g, __width - 15, __width - 10, 0, __y, __amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                            //if (this._showTaxDetail)
                            //{
                            //    this._printSlipText(__g, __width, __width, 0, __y, __extraWord, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            //}
                            __y += __lineHeight;

                        }

                        #endregion

                        #region ส่วนท้ายบิล

                        decimal __discountFooter = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_discount].ToString());
                        decimal __serviceChargeAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_service_charge].ToString());
                        float __leftColumn = 0.5f;
                        // ท้ายบิล
                        __totalAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_amount].ToString()) + __discountFooter + __totalAdvanceMoney;
                        __y += this._printSlipLine(__g, __width, __y);
                        string __footer1 = _getResource("Item", languageSelectIndex) + " : " + __itemQtyCount.ToString();
                        this._printSlipText(__g, __width, __width, 0, __y, __footer1, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);

                        // ภาษีมูลค่าเพิ่ม
                        decimal __beforeVatAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_before_vat].ToString());
                        decimal __exceptVatAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_except_vat].ToString());
                        decimal __vatAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_vat_value].ToString());
                        decimal __vatRate = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._vat_rate].ToString());


                        // tomyumgoong ยอดอาหาร เครื่องดิ่ม
                        /*if (MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro)
                        {
                            float __lineHeight = 0;
                            if (__serviceChargeAmount > 0)
                            {
                                string __serviceChargeText = __trans.Rows[0][_g.d.ic_trans._service_charge_word].ToString();
                                __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("Service Charge", languageSelectIndex) + " " + ((__serviceChargeText.IndexOf("%") != -1) ? __serviceChargeText : ""), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                this._printSlipText(__g, __width, __width, 0, __y, __serviceChargeAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                __y += __lineHeight;
                            }

                            __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("อาหาร", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            this._printSlipText(__g, __width, __width, 0, __y, __sumFood.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += __lineHeight;

                            __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("เครื่องดื่ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            this._printSlipText(__g, __width, __width, 0, __y, __sumDrink.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += __lineHeight;

                        }*/

                        // เงินมัดจำ
                        /*if (__advanceMoneyDetail != null)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, "เงินมัดจำ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            for (int __row = 0; __row < __advanceMoneyDetail.Rows.Count; __row++)
                            {

                                string __detail = string.Format("{0}:{1}", __advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._trans_number].ToString(), MyLib._myGlobal._convertDateFromQuery(__advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._doc_date_ref].ToString()).ToString("dd-MM-yyyy", new CultureInfo("th-TH")));
                                decimal __advanceAmount = MyLib._myGlobal._decimalPhase(__advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._amount].ToString());

                                this._printSlipText(__g, __width, __width, 0, __y, __detail, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __advanceAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                        }*/

                        // ส่วนลดท้ายบิล
                        /*
                        if (__discountFooter != 0)
                        {
                            string __discountWord2 = _getResource("ส่วนลดพิเศษ", languageSelectIndex);
                            string __discountWord = __trans.Rows[0][_g.d.ic_trans._discount_word].ToString().Trim();
                            if (__discountWord.Length > 0)
                            {
                                __discountWord2 = __discountWord2 + " : " + __discountWord;
                            }
                            this._printSlipText(__g, __width, __width, 0, __y, __discountWord2, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __discountFooter.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __saveAmount += __discountFooter;
                            // คงเหลือ
                            __totalAmount -= __discountFooter;
                        }*/

                        //decimal __diffAmount = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._total_income_amount].ToString());
                        // ปัดเศษ
                        /*if (__diff_amount != 0)
                        {
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("ส่วนลดจากการปัดเศษ", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __diff_amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __saveAmount += (__diff_amount);
                            __totalAmount += (__diff_amount * -1);

                        }

                        if (__discountFooter != 0 || __diff_amount != 0)
                        {
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("คงเหลือยอดชำระ", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);

                        }*/


                        // toe เพิ่ม option แสดงรายละเอียดภาษี
                        /*
                        if (this._showTaxDetail)
                        {

                            __y += this._printSlipLine(__g, __width, __y);
                            // สินค้ายกเว้นภาษี
                            if (__exceptVatAmount != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("มูลค่าสินค้ายกเว้นภาษีมูลค่าเพิ่ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __exceptVatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                            //
                            if (__beforeVatAmount != 0 || __vatAmount != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("มูลค่าสินค้ามีภาษีมูลค่าเพิ่ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __beforeVatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                //
                                string __vatRateStr = (__vatRate == Math.Round(__vatRate, 0)) ? __vatRate.ToString(this._formatNumber2) : __vatRate.ToString(this._formatNumber1);
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ภาษีมูลค่าเพิ่ม", languageSelectIndex) + " : " + __vatRateStr + "%", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __vatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                        }
                        */
                        /* if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                         {
                             this._printSlipText(__g, __width, __width, 0, __y, _getResource("รวมเงิน", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                             __y += this._printSlipText(__g, __width, __width, 0, __y, __totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                             SMLReport._formReport._moneyToText __moneyToText = new SMLReport._formReport._moneyToText();
                             __y += this._printSlipText(__g, __width, __width, 0, __y, __moneyToText._toText(__totalAmount), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                             __y += this._printSlipLine(__g, __width, __y);
                         }*/
                        /*if (mode == _printSlipMode.ใบกำกับภาษีอย่างย่อ)
                        {
                            // ประหยัด
                            if (__saveAmount != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("คุณประหยัดครั้งนี้", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __saveAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                            __y += this._printSlipLine(__g, __width, __y);
                            // ยอดชำระ
                            //__payCash = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._pay_cash_amount].ToString());
                            if (__payCash != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระด้วยเงินสด", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __payCash.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                            if (__creditCardDetail != null)
                            {
                                for (int __row = 0; __row < __creditCardDetail.Rows.Count; __row++)
                                {
                                    decimal __creditCardTotalAmount = MyLib._myGlobal._decimalPhase(__creditCardDetail.Rows[__row][_g.d.cb_trans_detail._sum_amount].ToString());
                                    decimal __creditCardChargeAmount = MyLib._myGlobal._decimalPhase(__creditCardDetail.Rows[__row][_g.d.cb_trans_detail._charge].ToString());
                                    if (__creditCardTotalAmount != 0)
                                    {
                                        string __creditCardType = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._credit_card_type].ToString();
                                        string __creditCardNumber = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._trans_number].ToString();
                                        for (int __loop = 0; __loop < __creditCardNumber.Length - 4; __loop++)
                                        {
                                            __creditCardNumber = __creditCardNumber.Remove(__loop, 1);
                                            __creditCardNumber = __creditCardNumber.Insert(__loop, "*");
                                        }
                                        //
                                        this._printSlipText(__g, __width, __width, 0, __y, __creditCardType + " " + __creditCardNumber, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                        __y += this._printSlipText(__g, __width, __width, 0, __y, __creditCardTotalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                        //
                                        if (__creditCardChargeAmount != 0)
                                        {
                                            __y += this._printSlipText(__g, __width, __width, 10, __y, _getResource("Charge", languageSelectIndex) + " : " + __creditCardChargeAmount.ToString(this._formatNumber1) + " บาท", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Italic), SMLPOSControl._printSlipTextStyle.Left, false);
                                        }
                                        //
                                        string __creditCardApproved = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._no_approved].ToString();
                                        __y += this._printSlipText(__g, __width, __width, 10, __y, _getResource("Approval", languageSelectIndex) + " : " + __creditCardApproved, new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Italic), SMLPOSControl._printSlipTextStyle.Left, false);
                                    }
                                }
                            }

                            // ชำระด้วยคูปอง
                            //__payCoupon = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._coupon_amount].ToString());
                            if (__payCoupon != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระด้วยคูปอง", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __payCoupon.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                            // ชำระด้วยแต้ม
                            //__payPoint = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._point_amount].ToString());
                            if (__payPoint != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระด้วยแต้ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __payPoint.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                            // เงินทอน
                            //__moneyChange = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._money_change].ToString());
                            if (__moneyChange != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("เงินทอน", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __moneyChange.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                            //
                            __y += this._printSlipLine(__g, __width, __y);

                        }*/

                        /*
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างย่อ)
                        {
                            string __docNoAndTime = _getResource("เลขที่", languageSelectIndex) + ":" + __docNo + " " + _getResource("วันที่", languageSelectIndex) + ":" + __docDate + "@" + __trans.Rows[0][_g.d.ic_trans._doc_time].ToString();
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __docNoAndTime, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);

                            if (__currentPoint > 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("แต้มครั้งนี้", languageSelectIndex) + ":", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __currentPoint.ToString(this._formatNumber2), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                                SMLProcess._posProcess __process = new SMLProcess._posProcess();
                                decimal __currentPointBalance = __process._pointBalance(__cust_code, true);

                                // แต้มสะสม
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("แต้มสะสมถึง", languageSelectIndex) + " " + __docDate, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __currentPointBalance.ToString(this._formatNumber2), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                            }
                        }*/

                        // total
                        decimal __totalPayAmount = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._total_amount_pay].ToString());
                        decimal __total_value = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_value].ToString());
                        decimal __total_amount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_amount].ToString()); // __totalAmount - (__saveAmount + __discountFooter);
                        this._printSlipText(__g, __width * __leftColumn, __width * __leftColumn, __width * __leftColumn, __y, _getResource("Total", languageSelectIndex) + " : ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                        __y += this._printSlipText(__g, __width, __width, 0, __y, __total_value.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                        this._printSlipText(__g, __width * __leftColumn, __width * __leftColumn, __width * __leftColumn, __y, _getResource("Member Discount", languageSelectIndex) + " : ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                        __y += this._printSlipText(__g, __width, __width, 0, __y, (__saveAmount + __discountFooter).ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);


                        this._printSlipText(__g, __width * __leftColumn, __width * __leftColumn, __width * __leftColumn, __y, _getResource("Ext.VAT", languageSelectIndex) + " : ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                        __y += this._printSlipText(__g, __width, __width, 0, __y, __beforeVatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                        this._printSlipText(__g, __width * __leftColumn, __width * __leftColumn, __width * __leftColumn, __y, _getResource("VAT", languageSelectIndex) + " : ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                        __y += this._printSlipText(__g, __width, __width, 0, __y, __vatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                        // coupon
                        /*DataTable __couponPay = ((DataSet)_getData[__tablePayCouponIndex]).Tables[0];
                        decimal __totalPayCoupon = 0M;
                        if (__couponPay.Rows.Count > 0)
                        {
                            for (int row = 0; row < __couponPay.Rows.Count; row++)
                            {
                                decimal __couponAmount = MyLib._myGlobal._decimalPhase(__couponPay.Rows[row][_g.d.cb_trans_detail._amount].ToString());
                                this._printSlipText(__g, __width * __leftColumn, __width * __leftColumn, __width * __leftColumn, __y, __couponPay.Rows[row][_g.d.cb_trans_detail._trans_number].ToString() + " : ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __couponAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                                __totalPayCoupon += __couponAmount;
                            }
                        }*/

                        //__payCoupon = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._coupon_amount].ToString());
                        if (__payPoint != 0)
                        {
                            this._printSlipText(__g, __width * __leftColumn, __width * __leftColumn, __width * __leftColumn, __y, _getResource("Member point used", languageSelectIndex) + " : ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __payPoint.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                        }

                        if (__payCoupon > 0M)
                        {
                            this._printSlipText(__g, __width * __leftColumn, __width * __leftColumn, __width * __leftColumn, __y, _getResource("Voucher used", languageSelectIndex) + " : ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __payCoupon.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                        }

                        this._printSlipText(__g, __width * __leftColumn, __width * __leftColumn, __width * __leftColumn, __y, _getResource("Amount", languageSelectIndex) + " : ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                        // __y += this._printSlipText(__g, __width, __width, 0, __y, (__totalPayAmount - __payCoupon - __payPoint).ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false); 
                        __y += this._printSlipText(__g, __width, __width, 0, __y, (__total_amount - (__payCoupon + __payPoint)).ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);


                        //this._printSlipText(__g, __width * __leftColumn, __width * __leftColumn, __width * __leftColumn, __y, _getResource("APP:VISA", languageSelectIndex) + " : ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                        //__y += this._printSlipText(__g, __width, __width, 0, __y, (__totalAmount - __serviceChargeAmount).ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);



                        for (int __row = 0; __row < __creditCardDetail.Rows.Count; __row++)
                        {
                            decimal __creditCardTotalAmount = MyLib._myGlobal._decimalPhase(__creditCardDetail.Rows[__row][_g.d.cb_trans_detail._sum_amount].ToString());
                            decimal __creditCardChargeAmount = MyLib._myGlobal._decimalPhase(__creditCardDetail.Rows[__row][_g.d.cb_trans_detail._charge].ToString());
                            if (__creditCardTotalAmount != 0)
                            {
                                string __creditCardType = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._credit_card_type].ToString();
                                string __creditCardNumber = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._trans_number].ToString();
                                for (int __loop = 0; __loop < __creditCardNumber.Length - 4; __loop++)
                                {
                                    __creditCardNumber = __creditCardNumber.Remove(__loop, 1);
                                    __creditCardNumber = __creditCardNumber.Insert(__loop, "X");
                                }

                                string __creditNumber = "APP:" + __creditCardType + "/" + __creditCardNumber;

                                //
                                this._printSlipText(__g, __width, __width, 0, __y, __creditNumber, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __creditCardTotalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                //
                                /*if (__creditCardChargeAmount != 0)
                                {
                                    __y += this._printSlipText(__g, __width, __width, 10, __y, _getResource("Charge", languageSelectIndex) + " : " + __creditCardChargeAmount.ToString(this._formatNumber1) + " บาท", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Italic), SMLPOSControl._printSlipTextStyle.Left, false);
                                }*/
                                //
                                //string __creditCardApproved = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._no_approved].ToString();
                                //__y += this._printSlipText(__g, __width, __width, 10, __y, _getResource("Approval", languageSelectIndex) + " : " + __creditCardApproved, new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Italic), SMLPOSControl._printSlipTextStyle.Left, false);
                            }
                        }

                        // cash
                        if (__payCash != 0)
                        {
                            this._printSlipText(__g, __width * __leftColumn, __width * __leftColumn, __width * __leftColumn, __y, _getResource("CASH", languageSelectIndex) + " : ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __payCash.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                        }

                        if (__moneyChange != 0)
                        {
                            this._printSlipText(__g, __width * __leftColumn, __width * __leftColumn, __width * __leftColumn, __y, _getResource("Change", languageSelectIndex) + " : ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __moneyChange.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                        }

                        __y += this._printSlipLine(__g, __width, __y);


                        SMLProcess._posProcess __process = new SMLProcess._posProcess();
                        decimal __currentPointBalance = __process._pointBalance(__cust_code, true);

                        //float __pointLineHeight = this._printSlipText(__g, __width, __width, 0, __y, , new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        //float __pointLineHeight = this._printSlipText(__g, __width * 0.3f, __width * 0.3f, 0, __y, _getResource("Used Point", languageSelectIndex) + " : " + __payPoint.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);

                        //this._printSlipText(__g, __width, __width, 0, __y, _getResource("Get Point", languageSelectIndex) + " : ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        //this._printSlipText(__g, __width * 0.3f, __width * 0.3f, __width * 0.3f, __y, _getResource("Get Point", languageSelectIndex) + " : " + __currentPoint.ToString(this._formatNumber2), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);

                        //this._printSlipText(__g, __width, __width, 0, __y, _getResource("Total Point", languageSelectIndex) + " : ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        //this._printSlipText(__g, __width * 0.3f, __width * 0.3f, __width * 0.6f, __y, _getResource("Total Point", languageSelectIndex) + " : " + __currentPointBalance.ToString(this._formatNumber2), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        Decimal __pointQty = (__payDetail.Rows.Count > 0) ? MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._point_qty].ToString()) : 0M;
                        string __pointText = _getResource("Used Point", languageSelectIndex) + " : " + __pointQty.ToString(this._formatNumber1) + " " + _getResource("Get Point", languageSelectIndex) + " : " + __currentPoint.ToString(this._formatNumber2) + " " + _getResource("Total Point", languageSelectIndex) + " : " + __currentPointBalance.ToString(this._formatNumber2);

                        __y += this._printSlipText(__g, __width, __width, 0, __y, __pointText, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);



                        /* earth
                        //
                        if (this._showShortDescription)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, "V=" + _getResource("สินค้ามีภาษีมูลค่าเพิ่ม", languageSelectIndex) + " " + "E=" + _getResource("สินค้ายกเว้นภาษี", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            //
                        }
                        string __saleCode = __trans.Rows[0][_g.d.ic_trans._sale_code].ToString();
                        string __cashierCode = __trans.Rows[0][_g.d.ic_trans._cashier_code].ToString();
                        if (__cashierCode.Equals(__saleCode) == false && mode == _printSlipMode.ใบกำกับภาษีอย่างย่อ)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("พนักงานขาย", languageSelectIndex) + " : " + __saleCode, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }
                        */
                        //
                        /* earth
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            __y += 15f;
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ผู้รับเงิน", languageSelectIndex) + "................................................................" + __saleCode, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);

                            // remark
                            if (__trans.Rows[0][_g.d.ic_trans._remark].ToString().Length > 0)
                            {
                                __y += 15;
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("หมายเหตุ", languageSelectIndex) + " ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __trans.Rows[0][_g.d.ic_trans._remark].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                                __y += 15;
                            }

                        }*/
                        if (this._posFooter.Trim().Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, this._posFooter, new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Center, false);
                        }

                        #endregion

                    }
                    break;
                #endregion

                #region ใบเสร็จแบบที่ 1002 copy มาจาก 3 แก้ไขให้ ลูกค้า Sea And Hill
                case 1002:
                    {

                        #region ส่วนหัว แสดงข้อมูลบริษัท

                        if (this._posHeader.Trim().Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, this._posHeader, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false, true);
                        }
                        else
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __ltdName, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __ltdAddress, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            string __telephone = "";
                            if (__ltdTel.Trim().Length > 0)
                            {
                                __telephone = _getResource("โทรศัพท์", languageSelectIndex) + ":" + __ltdTel.Trim();
                            }
                            if (__ltdFax.Trim().Length > 0)
                            {
                                __telephone = __telephone + " " + _getResource("โทรสาร", languageSelectIndex) + ":" + __ltdFax.Trim();
                            }
                            if (__telephone.Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __telephone, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            }

                            //
                            if (__ltdTax != null && __ltdTax.Trim().Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขประจำตัวผู้เสียภาษีอากร", languageSelectIndex) + " : " + __ltdTax, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            }
                        }

                        #endregion

                        #region ส่วนหัว แสดงข้อมูล เครือง POS และลูกค้า

                        // ข้อความเพิ่มเติม
                        if (header.Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource(header, languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Center, false);
                        }
                        __y += this._fontHeaderSize;

                        // ย้ายไปข้างบน
                        //if (_posBillType.Length > 0)
                        //{
                        //    headerSlip = _posBillType;
                        //}

                        __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource(headerSlip, languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Center, false);
                        __y += this._fontHeaderSize;
                        this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขเครื่อง", languageSelectIndex) + " : " + __trans.Rows[0]["pos_id_desc"].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        string __cashierName = "";
                        try
                        {
                            __cashierName = __trans.Rows[0]["cashier_name"].ToString().Split(' ')[0].ToString().Trim();
                        }
                        catch
                        {
                        }
                        //if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        //{
                        //    __cashierName = __trans.Rows[0][_g.d.ic_trans._cashier_code].ToString();
                        //}

                        __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("พนักงาน", languageSelectIndex) + " : " + __cashierName, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                        if (header.IndexOf("ยกเลิก") != -1)
                        {
                            string __cancelDocNo = __trans.Rows[0]["cancel_doc_no"].ToString();
                            string __cancelDocDate = MyLib._myGlobal._convertDateFromQuery(__trans.Rows[0]["cancel_doc_date"].ToString()).ToString("dd-MM-yyyy", new CultureInfo("th-TH"));

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขที่เอกสารยกเลิก", languageSelectIndex) + ":" + __cancelDocNo, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("วันที่", languageSelectIndex) + ":" + __cancelDocDate, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }
                        // เลขที่เอกสาร วันที่ เวลา
                        string __docDate = MyLib._myGlobal._convertDateFromQuery(__trans.Rows[0][_g.d.ic_trans._doc_date].ToString()).ToString("dd-MM-yyyy", new CultureInfo("th-TH"));
                        string __docNo = __trans.Rows[0][_g.d.ic_trans._doc_no].ToString();
                        string __docRefNo = __trans.Rows[0][_g.d.ic_trans._doc_ref].ToString();
                        __docGuid = __trans.Rows[0][_g.d.ic_trans._doc_no_guid].ToString().Trim();
                        //
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขที่", languageSelectIndex) + ":" + __docNo, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขที่อ้างอิง", languageSelectIndex) + ":" + __docRefNo, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("วันที่", languageSelectIndex) + ":" + __docDate + "@" + __trans.Rows[0][_g.d.ic_trans._doc_time].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ลูกค้า", languageSelectIndex) + " : " + "(" + __cust_code + ") " + __memberName, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขประจำตัวผู้เสียภาษี", languageSelectIndex) + " : " + __cust_taxid, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, ((__branch_type == "1") ? " [   ] " + __headquatreStr + " [ x ] " + __branchStr + " " + __branch_code : " [ x ] " + __headquatreStr + " [   ] " + __branchStr), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ที่อยู่", languageSelectIndex) + " : " + __memberAddress, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                        }
                        else
                        {
                            if (__memberCode.Trim().Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("สมาชิก", languageSelectIndex) + " : " + __memberName + " (" + __memberCode + ")", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            }

                            // พิมพ์โต๊ะ
                            if (__tableNumberStr.Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("หมายเลขโต๊ะ", languageSelectIndex) + " : " + __tableNumberStr, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            }

                            if ((MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro) && __table_trans.Rows.Count > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เวลาเข้า", languageSelectIndex) + " : " + __table_trans.Rows[0][_g.d.table_trans._open_doc_time].ToString() + " " + _getResource("เวลาออก", languageSelectIndex) + " : " + __table_trans.Rows[0][_g.d.table_trans._close_doc_time].ToString(), new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Left, false);

                            }

                        }

                        if (__customer_phone.Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __customer_phone, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }

                        __y += this._printSlipLine(__g, __width, __y);

                        #endregion

                        #region รายการสินค้า

                        int __transCount = 0;
                        decimal __itemQtyCount = 0;
                        decimal __saveAmount = 0;
                        decimal __sumFood = 0M;
                        decimal __sumDrink = 0M;

                        for (int __row = 0; __row < __transDetail.Rows.Count; __row++)
                        {
                            DataRow __data = __transDetail.Rows[__row];

                            if (__data[_g.d.ic_trans_detail._item_type].ToString().Equals("3"))
                            {
                                // สินค้าชุด ข้ามไป
                                continue;
                            }

                            decimal __amount = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._sum_amount].ToString());

                            if (MyLib._myGlobal._decimalPhase(__data[_g.d.ic_inventory_barcode._hidden_text].ToString()) == 0)
                            {
                                __transCount++;

                                decimal __price = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._price].ToString());
                                decimal __qty = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._qty].ToString());
                                decimal __priceDefault = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._price_default].ToString());
                                __itemQtyCount += __qty;
                                string __discountWord = __data[_g.d.ic_trans_detail._discount].ToString();
                                string __priceInfo = __data[_g.d.ic_trans_detail._remark].ToString();
                                decimal __discountAmount = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._discount_amount].ToString());
                                // มูลค่าสินค้า+vat
                                string __extraWord = "";
                                int __taxType = (int)MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._tax_type].ToString());
                                string __qtyStr = (__qty == Math.Round(__qty, 0)) ? __qty.ToString(this._formatNumber2) : __qty.ToString(this._formatNumber1);

                                // toe แก้ extraword case 0 = สินค้ามี Vat                         
                                switch (__taxType)
                                {
                                    case 0:
                                        __extraWord = "V";
                                        break;
                                }


                                // ชื่อสินค้า
                                StringBuilder __detail = new StringBuilder();
                                if (languageSelectIndex == 0)
                                {
                                    __detail.Append(__data[_g.d.ic_trans_detail._item_name].ToString().Trim());
                                }
                                else
                                {
                                    string __itemNameEn = __data[_g.d.ic_trans_detail._item_name_en].ToString().Trim();
                                    if (__itemNameEn.Length > 0)
                                    {
                                        __detail.Append(__itemNameEn);
                                    }
                                    else
                                    {
                                        __detail.Append(__data[_g.d.ic_trans_detail._item_name].ToString().Trim());
                                    }
                                }

                                float __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, __detail.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);

                                __y += __lineHeight;
                                if (__serialNumberTable != null && __serialNumberTable.Rows.Count > 0)
                                {
                                    // Serial Number
                                    DataRow[] __serial = __serialNumberTable.Select(_g.d.ic_trans_serial_number._doc_line_number + "=\'" + (__row).ToString() + "\'");
                                    for (int __serialLoop = 0; __serialLoop < __serial.Length; __serialLoop++)
                                    {
                                        __y += this._printSlipText(__g, __width, __width, 0, __y, "S/N:" + __serial[__serialLoop][_g.d.ic_trans_serial_number._serial_number].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                    }
                                }


                                if (__discountAmount != 0)
                                {
                                    __saveAmount += __discountAmount;
                                }

                                StringBuilder __priceQtyStr = new StringBuilder();
                                __priceQtyStr.Append(__price.ToString(this._formatNumber1) + " X " + __qtyStr + ((__discountAmount != 0) ? " ลด " + __discountAmount.ToString(this._formatNumber1) : ""));
                                //  ราคา จำนวน รวม
                                float _qtyLineHeight = this._printSlipText(__g, __width, __width, 0, __y, __priceQtyStr.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);

                                // จำนวน
                                //this._printSlipText(__g, __width - 160, __width - 150, 0, __y, __qtyStr, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                                this._printSlipText(__g, __width - 15, __width - 10, 0, __y, __amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                                if (this._showTaxDetail)
                                {
                                    this._printSlipText(__g, __width, __width, 0, __y, __extraWord, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                }

                                __y += _qtyLineHeight;
                            }

                            if (__data[_g.d.ic_inventory._drink_type].ToString().Equals("1"))
                            {
                                __sumDrink += __amount;
                            }
                            else
                            {
                                __sumFood += __amount;
                            }
                        }

                        #endregion

                        #region รายการ promotion
                        for (int __row = 0; __row < __transDetailPromotion.Rows.Count; __row++)
                        {
                            DataRow __data = __transDetailPromotion.Rows[__row];
                            decimal __amount = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail_promotion._sum_amount].ToString());

                            //__transCount++;
                            decimal __price = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail_promotion._price].ToString());
                            decimal __qty = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail_promotion._qty].ToString());

                            //__itemQtyCount += __qty;

                            StringBuilder __detail = new StringBuilder();
                            __detail.Append(__data[_g.d.ic_trans_detail_promotion._promotion_name].ToString().Trim());

                            float __lineHeight = this._printSlipText(__g, __width, __width * 0.8f, 0, __y, __detail.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                            // ราคาสามาชิก
                            //if (__memberCode.Trim().Length > 0)
                            //{
                            //    decimal __newPrice = __amount / __qty;
                            //    string __qtyStr = (__qty == Math.Round(__qty, 0)) ? __qty.ToString(this._formatNumber2) : __qty.ToString(this._formatNumber1);
                            //    string __priceStr = __newPrice.ToString(this._formatNumber1);
                            //    StringBuilder __memberPrice = new StringBuilder("ราคาสมาชิก" + " " + "@" + __priceStr);
                            //    if (__qty > 1)
                            //    {
                            //        __memberPrice.Append("x");
                            //        __memberPrice.Append(__qtyStr);
                            //    }
                            //    __y += __lineHeight;
                            //    __lineHeight = this._printSlipText(__g, __width, __width, 5, __y, __memberPrice.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            //}
                            // ส่วนลด
                            //if (__discountAmount != 0)
                            //{
                            //    //StringBuilder __discountStr = new StringBuilder("ราคาปรกติ" + " : " + __priceDefault.ToString(this._formatNumber1) + " " + "บาท");
                            //    //__y += this._printSlipText(__g, __width, __width, 5, __y, __discountStr.ToString(), new Font(this._fontDetailName, this._fontDetailSize * 0.8f), SMLPOSControl._printSlipTextStyle.Left);
                            //    __saveAmount += __discountAmount;
                            //    /*StringBuilder __discountStr = new StringBuilder();
                            //    __discountStr.Append(__priceInfo + " " + "ลด");
                            //    __discountStr.Append(" " + __discountAmount.ToString(this._formatNumber1) + " " + "บาท");
                            //    if (__priceDefault != 0)
                            //    {
                            //        __discountStr.Append(" " + "จาก" + " " + __priceDefault.ToString(this._formatNumber1) + " " + "บาท");
                            //    }
                            //    __y += this._printSlipText(__g, __width, __width, 5, __y, __discountStr.ToString(), new Font(this._fontDetailName, this._fontDetailSize * 0.8f), SMLPOSControl._printSlipTextStyle.Left);
                            //    __saveAmount += __discountAmount;
                            //     */
                            //}
                            this._printSlipText(__g, __width - 15, __width - 10, 0, __y, __amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                            //if (this._showTaxDetail)
                            //{
                            //    this._printSlipText(__g, __width, __width, 0, __y, __extraWord, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            //}
                            __y += __lineHeight;

                        }

                        #endregion

                        #region ส่วนท้ายบิล

                        decimal __discountFooter = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_discount].ToString());
                        decimal __serviceChargeAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_service_charge].ToString());

                        decimal __total_value = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_value].ToString());
                        // ท้ายบิล
                        __totalAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_amount].ToString()) + __discountFooter + __totalAdvanceMoney;
                        __y += this._printSlipLine(__g, __width, __y);
                        string __footer1 = __transCount.ToString() + " " + _getResource("รายการ", languageSelectIndex) + " " + __itemQtyCount.ToString(this._formatNumber1) + " " + _getResource("ชิ้น", languageSelectIndex);
                        this._printSlipText(__g, __width, __width, 0, __y, __footer1, new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                        __y += this._printSlipText(__g, __width, __width, 0, __y, __total_value.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);

                        // tomyumgoong ยอดอาหาร เครื่องดิ่ม
                        if (MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro)
                        {
                            float __lineHeight = 0;

                            if (__serviceChargeAmount > 0)
                            {
                                string __serviceChargeText = __trans.Rows[0][_g.d.ic_trans._service_charge_word].ToString();
                                __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("Service Charge", languageSelectIndex) + " " + ((__serviceChargeText.IndexOf("%") != -1) ? __serviceChargeText : ""), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                this._printSlipText(__g, __width, __width, 0, __y, __serviceChargeAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                __y += __lineHeight;
                            }

                            __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("อาหาร", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            this._printSlipText(__g, __width, __width, 0, __y, __sumFood.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += __lineHeight;

                            __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("เครื่องดื่ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            this._printSlipText(__g, __width, __width, 0, __y, __sumDrink.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += __lineHeight;

                            __y += this._printSlipLine(__g, __width, __y);
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("รวมทั้งสิ้น", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += this._printSlipLine(__g, __width, __y);

                        }

                        // เงินมัดจำ
                        if (__totalAdvanceMoney > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, "เงินมัดจำ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            for (int __row = 0; __row < __advanceMoneyDetail.Rows.Count; __row++)
                            {

                                string __detail = string.Format("{0}:{1}", __advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._trans_number].ToString(), MyLib._myGlobal._convertDateFromQuery(__advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._doc_date_ref].ToString()).ToString("dd-MM-yyyy", new CultureInfo("th-TH")));
                                decimal __advanceAmount = MyLib._myGlobal._decimalPhase(__advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._amount].ToString());

                                this._printSlipText(__g, __width, __width, 0, __y, __detail, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __advanceAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                        }

                        // ส่วนลดท้ายบิล
                        if (__discountFooter != 0)
                        {
                            string __discountWord2 = _getResource("ส่วนลดพิเศษ", languageSelectIndex);
                            string __discountWord = __trans.Rows[0][_g.d.ic_trans._discount_word].ToString().Trim();
                            if (__discountWord.Length > 0)
                            {
                                __discountWord2 = __discountWord2 + " : " + __discountWord;
                            }
                            this._printSlipText(__g, __width, __width, 0, __y, __discountWord2, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __discountFooter.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __saveAmount += __discountFooter;
                            // คงเหลือ
                            __totalAmount -= __discountFooter;
                        }

                        //decimal __diffAmount = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._total_income_amount].ToString());
                        // ปัดเศษ
                        if (__diff_amount != 0)
                        {
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("ส่วนลดจากการปัดเศษ", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __diff_amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __saveAmount += (__diff_amount);
                            __totalAmount += (__diff_amount * -1);

                        }

                        if (__discountFooter != 0 || __diff_amount != 0)
                        {
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("คงเหลือยอดชำระ", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, (__total_value - __discountFooter).ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);

                        }

                        // ภาษีมูลค่าเพิ่ม
                        decimal __beforeVatAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_before_vat].ToString());
                        decimal __exceptVatAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_except_vat].ToString());
                        decimal __vatAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_vat_value].ToString());
                        decimal __vatRate = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._vat_rate].ToString());

                        // toe เพิ่ม option แสดงรายละเอียดภาษี
                        if (this._showTaxDetail)
                        {

                            __y += this._printSlipLine(__g, __width, __y);
                            // สินค้ายกเว้นภาษี
                            if (__exceptVatAmount != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("มูลค่าสินค้ายกเว้นภาษีมูลค่าเพิ่ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __exceptVatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                            //
                            if (__beforeVatAmount != 0 || __vatAmount != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("มูลค่าสินค้ามีภาษีมูลค่าเพิ่ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __beforeVatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                //
                                string __vatRateStr = (__vatRate == Math.Round(__vatRate, 0)) ? __vatRate.ToString(this._formatNumber2) : __vatRate.ToString(this._formatNumber1);
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ภาษีมูลค่าเพิ่ม", languageSelectIndex) + " : " + __vatRateStr + "%", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __vatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                        }
                        __y += this._printSlipLine(__g, __width, __y);
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("รวมเงิน", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                            SMLReport._formReport._moneyToText __moneyToText = new SMLReport._formReport._moneyToText();
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __moneyToText._toText(__totalAmount), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipLine(__g, __width, __y);
                        }
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างย่อ)
                        {
                            // ประหยัด
                            if (__saveAmount != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("คุณประหยัดครั้งนี้", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __saveAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                            __y += this._printSlipLine(__g, __width, __y);
                            // ยอดชำระ
                            //__payCash = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._pay_cash_amount].ToString());
                            if (__payCash != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระด้วยเงินสด", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __payCash.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                            if (__creditCardDetail != null)
                            {
                                for (int __row = 0; __row < __creditCardDetail.Rows.Count; __row++)
                                {
                                    decimal __creditCardTotalAmount = MyLib._myGlobal._decimalPhase(__creditCardDetail.Rows[__row][_g.d.cb_trans_detail._sum_amount].ToString());
                                    decimal __creditCardChargeAmount = MyLib._myGlobal._decimalPhase(__creditCardDetail.Rows[__row][_g.d.cb_trans_detail._charge].ToString());
                                    if (__creditCardTotalAmount != 0)
                                    {
                                        string __creditCardType = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._credit_card_type].ToString();
                                        string __creditCardNumber = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._trans_number].ToString();
                                        for (int __loop = 0; __loop < __creditCardNumber.Length - 4; __loop++)
                                        {
                                            __creditCardNumber = __creditCardNumber.Remove(__loop, 1);
                                            __creditCardNumber = __creditCardNumber.Insert(__loop, "*");
                                        }
                                        //
                                        this._printSlipText(__g, __width, __width, 0, __y, __creditCardType + " " + __creditCardNumber, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                        __y += this._printSlipText(__g, __width, __width, 0, __y, __creditCardTotalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                        //
                                        if (__creditCardChargeAmount != 0)
                                        {
                                            __y += this._printSlipText(__g, __width, __width, 10, __y, _getResource("Charge", languageSelectIndex) + " : " + __creditCardChargeAmount.ToString(this._formatNumber1) + " บาท", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Italic), SMLPOSControl._printSlipTextStyle.Left, false);
                                        }
                                        //
                                        string __creditCardApproved = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._no_approved].ToString();
                                        __y += this._printSlipText(__g, __width, __width, 10, __y, _getResource("Approval", languageSelectIndex) + " : " + __creditCardApproved, new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Italic), SMLPOSControl._printSlipTextStyle.Left, false);
                                    }
                                }
                            }

                            // ชำระด้วยคูปอง
                            //__payCoupon = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._coupon_amount].ToString());
                            if (__payCoupon != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระด้วยคูปอง", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __payCoupon.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                            // ชำระด้วยแต้ม
                            //__payPoint = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._point_amount].ToString());
                            if (__payPoint != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระด้วยแต้ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __payPoint.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                            // เงินทอน
                            //__moneyChange = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._money_change].ToString());
                            if (__moneyChange != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("เงินทอน", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __moneyChange.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                            //
                            __y += this._printSlipLine(__g, __width, __y);

                            // order detail
                            if ((MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro) && this._show_order_detail && (this._show_order_detail_copy_Only == false || (this._show_order_detail_copy_Only == true && header == "- สำเนา -")))
                            {
                                // order detail
                                for (int __orderRow = 0; __orderRow < __tableOrderDetail.Rows.Count; __orderRow++)
                                {
                                    __y += this._printSlipText(__g, __width, __width, 0, __y, "ใบสั่ง : " + __tableOrderDetail.Rows[__orderRow][_g.d.table_order_doc._doc_no].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                }

                                // order cancel
                                for (int __cancelRow = 0; __cancelRow < __tableOrderCancel.Rows.Count; __cancelRow++)
                                {
                                    decimal __cancelAmount = MyLib._myGlobal._decimalPhase(__tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._sum_amount].ToString());

                                    __y += this._printSlipText(__g, __width, __width, 0, __y, (__tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._cancel_flag].ToString().Equals("1") ? "ย้ายออก " + __tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._table_number_2].ToString() + " : " : "ยกเลิก : ") + __tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._item_name].ToString() + " " + __cancelAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                }
                                __y += this._printSlipLine(__g, __width, __y);

                            }
                        }
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างย่อ)
                        {
                            string __docNoAndTime = _getResource("เลขที่", languageSelectIndex) + ":" + __docNo;
                            string __docTime = _getResource("วันที่", languageSelectIndex) + ":" + __docDate + "@" + __trans.Rows[0][_g.d.ic_trans._doc_time].ToString();

                            __y += this._printSlipText(__g, __width, __width, 0, __y, __docNoAndTime, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __docTime, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);

                            if (__currentPoint > 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("แต้มครั้งนี้", languageSelectIndex) + ":", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __currentPoint.ToString(this._formatNumber2), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                                SMLProcess._posProcess __process = new SMLProcess._posProcess();
                                decimal __currentPointBalance = __process._pointBalance(__cust_code, true);

                                // แต้มสะสม
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("แต้มสะสมถึง", languageSelectIndex) + " " + __docDate, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __currentPointBalance.ToString(this._formatNumber2), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                            }

                        }

                        //
                        if (this._showShortDescription)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, "V=" + _getResource("สินค้ามีภาษีมูลค่าเพิ่ม", languageSelectIndex) + " " + "E=" + _getResource("สินค้ายกเว้นภาษี", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            //
                        }
                        string __saleCode = __trans.Rows[0][_g.d.ic_trans._sale_code].ToString();
                        string __cashierCode = __trans.Rows[0][_g.d.ic_trans._cashier_code].ToString();
                        if (__cashierCode.Equals(__saleCode) == false && mode == _printSlipMode.ใบกำกับภาษีอย่างย่อ)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("พนักงานขาย", languageSelectIndex) + " : " + __saleCode, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }
                        //
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            __y += 15f;
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ผู้รับเงิน", languageSelectIndex) + "................................................................" + __saleCode, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);

                            // remark
                            if (__trans.Rows[0][_g.d.ic_trans._remark].ToString().Length > 0)
                            {
                                __y += 15;
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("หมายเหตุ", languageSelectIndex) + " ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __trans.Rows[0][_g.d.ic_trans._remark].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                                __y += 15;
                            }

                        }
                        if (this._posFooter.Trim().Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, this._posFooter, new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }

                        #endregion

                    }
                    break;
                #endregion

                #region 1003 copy ใบเสร็จแบบที่ 4 บรรทัดแรก รายการ บรรทัดที่สอง ราคา x จำนวน หน่วย รวม
                case 1003:
                    {

                        #region ส่วนหัว แสดงข้อมูลบริษัท

                        if (this._posHeader.Trim().Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, this._posHeader, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false, true);
                        }
                        else
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __ltdName, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __ltdAddress, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            string __telephone = "";
                            if (__ltdTel.Trim().Length > 0)
                            {
                                __telephone = _getResource("โทรศัพท์", languageSelectIndex) + ":" + __ltdTel.Trim();
                            }
                            if (__ltdFax.Trim().Length > 0)
                            {
                                __telephone = __telephone + " " + _getResource("โทรสาร", languageSelectIndex) + ":" + __ltdFax.Trim();
                            }
                            if (__telephone.Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __telephone, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            }

                            //
                            if (__ltdTax != null && __ltdTax.Trim().Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขประจำตัวผู้เสียภาษีอากร", languageSelectIndex) + " : " + __ltdTax, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                            }
                        }

                        #endregion

                        #region ส่วนหัว แสดงข้อมูล เครือง POS และลูกค้า

                        // ข้อความเพิ่มเติม
                        if (header.Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource(header, languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Center, false);
                        }
                        __y += this._fontHeaderSize;

                        // ย้ายไปข้างบน
                        //if (_posBillType.Length > 0)
                        //{
                        //    headerSlip = _posBillType;
                        //}

                        __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource(headerSlip, languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Center, false);
                        __y += this._fontHeaderSize;
                        this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขเครื่อง", languageSelectIndex) + " : " + __trans.Rows[0]["pos_id_desc"].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        string __cashierName = "";
                        try
                        {
                            __cashierName = __trans.Rows[0]["cashier_name"].ToString().Split(' ')[0].ToString().Trim();
                        }
                        catch
                        {
                        }
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            __cashierName = __trans.Rows[0][_g.d.ic_trans._cashier_code].ToString();
                        }

                        __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("พนักงาน", languageSelectIndex) + " : " + __cashierName, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                        if (header.IndexOf("ยกเลิก") != -1)
                        {
                            string __cancelDocNo = __trans.Rows[0]["cancel_doc_no"].ToString();
                            string __cancelDocDate = MyLib._myGlobal._convertDateFromQuery(__trans.Rows[0]["cancel_doc_date"].ToString()).ToString("dd-MM-yyyy", new CultureInfo("th-TH"));

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขที่เอกสารยกเลิก", languageSelectIndex) + ":" + __cancelDocNo, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("วันที่", languageSelectIndex) + ":" + __cancelDocDate, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }

                        // เลขที่เอกสาร วันที่ เวลา
                        string __docDate = MyLib._myGlobal._convertDateFromQuery(__trans.Rows[0][_g.d.ic_trans._doc_date].ToString()).ToString("dd-MM-yyyy", new CultureInfo("th-TH"));
                        string __docNo = __trans.Rows[0][_g.d.ic_trans._doc_no].ToString();
                        string __docRefNo = __trans.Rows[0][_g.d.ic_trans._doc_ref].ToString();
                        __docGuid = __trans.Rows[0][_g.d.ic_trans._doc_no_guid].ToString().Trim();
                        //
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขที่", languageSelectIndex) + ":" + __docNo, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขที่อ้างอิง", languageSelectIndex) + ":" + __docRefNo, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("วันที่", languageSelectIndex) + ":" + __docDate, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ลูกค้า", languageSelectIndex) + " : " + __memberName, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เลขประจำตัวผู้เสียภาษี", languageSelectIndex) + " : " + __cust_taxid, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, ((__branch_type == "1") ? " [   ] " + __headquatreStr + " [ x ] " + __branchStr + " " + __branch_code : " [ x ] " + __headquatreStr + " [   ] " + __branchStr), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);

                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ที่อยู่", languageSelectIndex) + " : " + __memberAddress, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                        }
                        else
                        {
                            if (__memberCode.Trim().Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("สมาชิก", languageSelectIndex) + " : " + __memberName + " (" + __memberCode + ")", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            }

                            // พิมพ์โต๊ะ
                            if (__tableNumberStr.Length > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("หมายเลขโต๊ะ", languageSelectIndex) + " : " + __tableNumberStr, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            }

                            if ((MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro) && __table_trans.Rows.Count > 0)
                            {
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("เวลาเข้า", languageSelectIndex) + " : " + __table_trans.Rows[0][_g.d.table_trans._open_doc_time].ToString() + " " + _getResource("เวลาออก", languageSelectIndex) + " : " + __table_trans.Rows[0][_g.d.table_trans._close_doc_time].ToString(), new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Left, false);

                            }

                        }

                        if (__customer_phone.Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __customer_phone, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }

                        __y += this._printSlipLine(__g, __width, __y);

                        #endregion

                        #region รายการสินค้า

                        int __transCount = 0;
                        decimal __itemQtyCount = 0;
                        decimal __saveAmount = 0;
                        decimal __sumFood = 0M;
                        decimal __sumDrink = 0M;

                        for (int __row = 0; __row < __transDetail.Rows.Count; __row++)
                        {
                            DataRow __data = __transDetail.Rows[__row];
                            if (__data[_g.d.ic_trans_detail._item_type].ToString().Equals("3"))
                            {
                                // สินค้าชุด ข้ามไป
                                continue;
                            }

                            decimal __amount = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._sum_amount].ToString());

                            if (MyLib._myGlobal._decimalPhase(__data[_g.d.ic_inventory_barcode._hidden_text].ToString()) == 0)
                            {
                                __transCount++;

                                decimal __price = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._price].ToString());
                                decimal __qty = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._qty].ToString());
                                decimal __priceDefault = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._price_default].ToString());
                                __itemQtyCount += __qty;
                                string __discountWord = __data[_g.d.ic_trans_detail._discount].ToString();
                                string __priceInfo = __data[_g.d.ic_trans_detail._remark].ToString();
                                decimal __discountAmount = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._discount_amount].ToString());
                                // มูลค่าสินค้า+vat
                                string __extraWord = "";
                                int __taxType = (int)MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail._tax_type].ToString());
                                string __qtyStr = (__qty == Math.Round(__qty, 0)) ? __qty.ToString(this._formatNumber2) : __qty.ToString(this._formatNumber1);
                                string _unit_name = __data[_g.d.ic_trans_detail._unit_name].ToString();

                                if (languageSelectIndex > 0)
                                {
                                    string __unit_name_en = __data[_g.d.ic_trans_detail._unit_name_en].ToString();

                                    if (__unit_name_en.Length > 0)
                                    {
                                        _unit_name = __unit_name_en;
                                    }
                                }


                                // toe แก้ extraword case 0 = สินค้ามี Vat                         
                                switch (__taxType)
                                {
                                    case 0:
                                        __extraWord = "V";
                                        break;
                                }


                                // ชื่อสินค้า
                                StringBuilder __detail = new StringBuilder();
                                if (languageSelectIndex == 0)
                                {
                                    __detail.Append(__data[_g.d.ic_trans_detail._item_name].ToString().Trim());
                                }
                                else
                                {
                                    string __itemNameEn = __data[_g.d.ic_trans_detail._item_name_en].ToString().Trim();
                                    if (__itemNameEn.Length > 0)
                                    {
                                        __detail.Append(__itemNameEn);
                                    }
                                    else
                                    {
                                        __detail.Append(__data[_g.d.ic_trans_detail._item_name].ToString().Trim());
                                    }
                                }


                                float __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, __detail.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);

                                __y += __lineHeight;
                                if (__serialNumberTable != null && __serialNumberTable.Rows.Count > 0)
                                {
                                    // Serial Number
                                    DataRow[] __serial = __serialNumberTable.Select(_g.d.ic_trans_serial_number._doc_line_number + "=\'" + (__row).ToString() + "\'");
                                    for (int __serialLoop = 0; __serialLoop < __serial.Length; __serialLoop++)
                                    {
                                        __y += this._printSlipText(__g, __width, __width, 0, __y, "S/N:" + __serial[__serialLoop][_g.d.ic_trans_serial_number._serial_number].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                    }
                                }


                                if (__discountAmount != 0)
                                {
                                    __saveAmount += __discountAmount;
                                }

                                StringBuilder __priceQtyStr = new StringBuilder();
                                __priceQtyStr.Append(__price.ToString(this._formatNumber1) + " X " + __qtyStr + " " + _unit_name + ((__discountAmount != 0) ? " " + _getResource("ลด", languageSelectIndex) + " " + __discountAmount.ToString(this._formatNumber1) : ""));
                                //  ราคา จำนวน รวม
                                float _qtyLineHeight = this._printSlipText(__g, __width, __width, 0, __y, __priceQtyStr.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);

                                // จำนวน
                                //this._printSlipText(__g, __width - 160, __width - 150, 0, __y, __qtyStr, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                                this._printSlipText(__g, __width - 15, __width - 10, 0, __y, __amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                                if (this._showTaxDetail && _g.g._companyProfile._vat_rate > 0)
                                {
                                    this._printSlipText(__g, __width, __width, 0, __y, __extraWord, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                }

                                __y += _qtyLineHeight;
                            }

                            if (__data[_g.d.ic_inventory._drink_type].ToString().Equals("1"))
                            {
                                __sumDrink += __amount;
                            }
                            else
                            {
                                __sumFood += __amount;
                            }
                        }

                        #endregion

                        #region รายการ promotion
                        for (int __row = 0; __row < __transDetailPromotion.Rows.Count; __row++)
                        {
                            DataRow __data = __transDetailPromotion.Rows[__row];
                            decimal __amount = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail_promotion._sum_amount].ToString());

                            //__transCount++;
                            decimal __price = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail_promotion._price].ToString());
                            decimal __qty = MyLib._myGlobal._decimalPhase(__data[_g.d.ic_trans_detail_promotion._qty].ToString());

                            //__itemQtyCount += __qty;

                            StringBuilder __detail = new StringBuilder();
                            __detail.Append(__data[_g.d.ic_trans_detail_promotion._promotion_name].ToString().Trim());

                            float __lineHeight = this._printSlipText(__g, __width, __width * 0.8f, 0, __y, __detail.ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                            this._printSlipText(__g, __width - 15, __width - 10, 0, __y, __amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                            __y += __lineHeight;

                        }

                        #endregion

                        #region ส่วนท้ายบิล

                        decimal __discountFooter = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_discount].ToString());
                        decimal __serviceChargeAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_service_charge].ToString());

                        // ท้ายบิล
                        __totalAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_amount].ToString()) + __discountFooter + __totalAdvanceMoney;
                        __y += this._printSlipLine(__g, __width, __y);
                        string __footer1 = __transCount.ToString() + " " + _getResource("รายการ", languageSelectIndex) + " " + __itemQtyCount.ToString("#,###.##") + " " + _getResource("ชิ้น", languageSelectIndex);
                        this._printSlipText(__g, __width, __width, 0, __y, __footer1, new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                        __y += this._printSlipText(__g, __width, __width, 0, __y, (__totalAmount - __serviceChargeAmount).ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);

                        // tomyumgoong ยอดอาหาร เครื่องดิ่ม
                        if (MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro)
                        {
                            float __lineHeight = 0;

                            if (__serviceChargeAmount > 0)
                            {
                                string __serviceChargeText = __trans.Rows[0][_g.d.ic_trans._service_charge_word].ToString();
                                __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("Service Charge", languageSelectIndex) + " " + ((__serviceChargeText.IndexOf("%") != -1) ? __serviceChargeText : ""), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                this._printSlipText(__g, __width, __width, 0, __y, __serviceChargeAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                __y += __lineHeight;
                            }

                            __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("อาหาร", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            this._printSlipText(__g, __width, __width, 0, __y, __sumFood.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += __lineHeight;

                            __lineHeight = this._printSlipText(__g, __width, __width, 0, __y, _getResource("เครื่องดื่ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            this._printSlipText(__g, __width, __width, 0, __y, __sumDrink.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += __lineHeight;

                            __y += this._printSlipLine(__g, __width, __y);
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("รวมทั้งสิ้น", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                            __y += this._printSlipLine(__g, __width, __y);


                        }

                        // เงินมัดจำ
                        if (__totalAdvanceMoney > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, "เงินมัดจำ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            for (int __row = 0; __row < __advanceMoneyDetail.Rows.Count; __row++)
                            {

                                string __detail = string.Format("{0}:{1}", __advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._trans_number].ToString(), MyLib._myGlobal._convertDateFromQuery(__advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._doc_date_ref].ToString()).ToString("dd-MM-yyyy", new CultureInfo("th-TH")));
                                decimal __advanceAmount = MyLib._myGlobal._decimalPhase(__advanceMoneyDetail.Rows[__row][_g.d.cb_trans_detail._amount].ToString());

                                this._printSlipText(__g, __width, __width, 0, __y, __detail, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __advanceAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                        }

                        // ส่วนลดท้ายบิล
                        if (__discountFooter != 0)
                        {
                            string __discountWord2 = _getResource("ส่วนลดพิเศษ", languageSelectIndex);
                            string __discountWord = __trans.Rows[0][_g.d.ic_trans._discount_word].ToString().Trim();
                            if (__discountWord.Length > 0)
                            {
                                __discountWord2 = __discountWord2 + " : " + __discountWord;
                            }
                            this._printSlipText(__g, __width, __width, 0, __y, __discountWord2, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __discountFooter.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __saveAmount += __discountFooter;
                            // คงเหลือ
                            __totalAmount -= __discountFooter;
                        }

                        //decimal __diffAmount = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._total_income_amount].ToString());
                        // ปัดเศษ
                        if (__diff_amount != 0)
                        {
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("ส่วนลดจากการปัดเศษ", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __diff_amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            __saveAmount += (__diff_amount);
                            __totalAmount += (__diff_amount * -1);
                        }

                        if (__discountFooter != 0 || __diff_amount != 0)
                        {
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("คงเหลือยอดชำระ", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                        }

                        // ภาษีมูลค่าเพิ่ม
                        decimal __beforeVatAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_before_vat].ToString());
                        decimal __exceptVatAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_except_vat].ToString());
                        decimal __vatAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._total_vat_value].ToString());
                        decimal __vatRate = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.ic_trans._vat_rate].ToString());

                        // toe เพิ่ม option แสดงรายละเอียดภาษี
                        if (this._showTaxDetail && _g.g._companyProfile._vat_rate > 0)
                        {

                            __y += this._printSlipLine(__g, __width, __y);
                            // สินค้ายกเว้นภาษี
                            if (__exceptVatAmount != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("มูลค่าสินค้ายกเว้นภาษีมูลค่าเพิ่ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __exceptVatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                            //
                            if (__beforeVatAmount != 0 || __vatAmount != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("มูลค่าสินค้ามีภาษีมูลค่าเพิ่ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __beforeVatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                //
                                string __vatRateStr = (__vatRate == Math.Round(__vatRate, 0)) ? __vatRate.ToString(this._formatNumber2) : __vatRate.ToString(this._formatNumber1);
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ภาษีมูลค่าเพิ่ม", languageSelectIndex) + " : " + __vatRateStr + "%", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __vatAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                        }
                        __y += this._printSlipLine(__g, __width, __y);
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            this._printSlipText(__g, __width, __width, 0, __y, _getResource("รวมเงิน", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                            SMLReport._formReport._moneyToText __moneyToText = new SMLReport._formReport._moneyToText();
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __moneyToText._toText(__totalAmount), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipLine(__g, __width, __y);
                        }
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างย่อ)
                        {
                            // ประหยัด
                            if (__saveAmount != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("คุณประหยัดครั้งนี้", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __saveAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                            __y += this._printSlipLine(__g, __width, __y);
                            // ยอดชำระ
                            //__payCash = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._pay_cash_amount].ToString());
                            if (__payCash != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระด้วยเงินสด", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __payCash.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                            if (__creditCardDetail != null)
                            {
                                for (int __row = 0; __row < __creditCardDetail.Rows.Count; __row++)
                                {
                                    decimal __creditCardTotalAmount = MyLib._myGlobal._decimalPhase(__creditCardDetail.Rows[__row][_g.d.cb_trans_detail._sum_amount].ToString());
                                    decimal __creditCardChargeAmount = MyLib._myGlobal._decimalPhase(__creditCardDetail.Rows[__row][_g.d.cb_trans_detail._charge].ToString());
                                    if (__creditCardTotalAmount != 0)
                                    {
                                        string __creditCardType = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._credit_card_type].ToString();
                                        string __creditCardNumber = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._trans_number].ToString();
                                        for (int __loop = 0; __loop < __creditCardNumber.Length - 4; __loop++)
                                        {
                                            __creditCardNumber = __creditCardNumber.Remove(__loop, 1);
                                            __creditCardNumber = __creditCardNumber.Insert(__loop, "*");
                                        }
                                        //
                                        this._printSlipText(__g, __width, __width, 0, __y, __creditCardType + " " + __creditCardNumber, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                        __y += this._printSlipText(__g, __width, __width, 0, __y, __creditCardTotalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                                        //
                                        if (__creditCardChargeAmount != 0)
                                        {
                                            __y += this._printSlipText(__g, __width, __width, 10, __y, _getResource("Charge", languageSelectIndex) + " : " + __creditCardChargeAmount.ToString(this._formatNumber1) + " บาท", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Italic), SMLPOSControl._printSlipTextStyle.Left, false);
                                        }
                                        //
                                        string __creditCardApproved = __creditCardDetail.Rows[__row][_g.d.cb_trans_detail._no_approved].ToString();
                                        __y += this._printSlipText(__g, __width, __width, 10, __y, _getResource("Approval", languageSelectIndex) + " : " + __creditCardApproved, new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Italic), SMLPOSControl._printSlipTextStyle.Left, false);
                                    }
                                }
                            }

                            // ชำระด้วยคูปอง
                            //__payCoupon = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._coupon_amount].ToString());
                            if (__payCoupon != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระด้วยคูปอง", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __payCoupon.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                            // ชำระด้วยแต้ม
                            //__payPoint = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._point_amount].ToString());
                            if (__payPoint != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("ชำระด้วยแต้ม", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __payPoint.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }

                            // เงินทอน
                            //__moneyChange = MyLib._myGlobal._decimalPhase(__payDetail.Rows[0][_g.d.cb_trans._money_change].ToString());
                            if (__moneyChange != 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("เงินทอน", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __moneyChange.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                            }
                            //
                            __y += this._printSlipLine(__g, __width, __y);

                            // order detail
                            if ((MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro) && this._show_order_detail && (this._show_order_detail_copy_Only == false || (this._show_order_detail_copy_Only == true && header == "- สำเนา -")))
                            {
                                // order detail
                                for (int __orderRow = 0; __orderRow < __tableOrderDetail.Rows.Count; __orderRow++)
                                {
                                    __y += this._printSlipText(__g, __width, __width, 0, __y, "ใบสั่ง : " + __tableOrderDetail.Rows[__orderRow][_g.d.table_order_doc._doc_no].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                }

                                // order cancel
                                for (int __cancelRow = 0; __cancelRow < __tableOrderCancel.Rows.Count; __cancelRow++)
                                {
                                    decimal __cancelAmount = MyLib._myGlobal._decimalPhase(__tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._sum_amount].ToString());

                                    __y += this._printSlipText(__g, __width, __width, 0, __y, (__tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._cancel_flag].ToString().Equals("1") ? "ย้ายออก " + __tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._table_number_2].ToString() + " : " : "ยกเลิก : ") + __tableOrderCancel.Rows[__cancelRow][_g.d.table_order_cancel._item_name].ToString() + " " + __cancelAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                }
                                __y += this._printSlipLine(__g, __width, __y);

                            }
                        }
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างย่อ)
                        {
                            string __docNoAndTime = _getResource("เลขที่", languageSelectIndex) + ":" + __docNo;
                            string __docTime = _getResource("วันที่", languageSelectIndex) + ":" + __docDate;

                            __y += this._printSlipText(__g, __width, __width, 0, __y, __docNoAndTime, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            __y += this._printSlipText(__g, __width, __width, 0, __y, __docTime, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);

                            if (__currentPoint > 0)
                            {
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("แต้มครั้งนี้", languageSelectIndex) + ":", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __currentPoint.ToString(this._formatNumber2), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                                SMLProcess._posProcess __process = new SMLProcess._posProcess();
                                decimal __currentPointBalance = __process._pointBalance(__cust_code, true);

                                // แต้มสะสม
                                this._printSlipText(__g, __width, __width, 0, __y, _getResource("แต้มสะสมถึง", languageSelectIndex) + " " + __docDate, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __currentPointBalance.ToString(this._formatNumber2), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                            }
                        }

                        //
                        if (this._showShortDescription && _g.g._companyProfile._vat_rate > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, "V=" + _getResource("สินค้ามีภาษีมูลค่าเพิ่ม", languageSelectIndex) + " " + "E=" + _getResource("สินค้ายกเว้นภาษี", languageSelectIndex), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                            //
                        }
                        string __saleCode = __trans.Rows[0][_g.d.ic_trans._sale_code].ToString();
                        string __cashierCode = __trans.Rows[0][_g.d.ic_trans._cashier_code].ToString();
                        if (__cashierCode.Equals(__saleCode) == false && mode == _printSlipMode.ใบกำกับภาษีอย่างย่อ)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("พนักงานขาย", languageSelectIndex) + " : " + __saleCode, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }
                        //
                        if (mode == _printSlipMode.ใบกำกับภาษีอย่างเต็ม)
                        {
                            __y += 15f;
                            __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("ผู้รับเงิน", languageSelectIndex) + "................................................................" + __saleCode, new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);

                            // remark
                            if (__trans.Rows[0][_g.d.ic_trans._remark].ToString().Length > 0)
                            {
                                __y += 15;
                                __y += this._printSlipText(__g, __width, __width, 0, __y, _getResource("หมายเหตุ", languageSelectIndex) + " ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                                __y += this._printSlipText(__g, __width, __width, 0, __y, __trans.Rows[0][_g.d.ic_trans._remark].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                                __y += 15;
                            }

                        }
                        if (this._posFooter.Trim().Length > 0)
                        {
                            __y += this._printSlipText(__g, __width, __width, 0, __y, this._posFooter, new Font(this._fontFooterName, this._fontFooterSize), SMLPOSControl._printSlipTextStyle.Left, false);
                        }

                        #endregion

                    }
                    break;
                    #endregion

            }

            if (mode == _printSlipMode.ใบกำกับภาษีอย่างย่อ && this._posConfig._printerType.Equals("1"))
            {
                // BarCode
                if (__docGuid.Length > 0)
                {
                    Console.WriteLine("Barcode : " + __docGuid);
                    __y += 10;
                    try
                    {
                        //Image __barcodeImage = _getBarcodeImage(__docGuid, new Size(240, 40), SMLReport._design._textAlign.Center, SMLReport._design._barcodeType.BarCode_EAN13, true, SMLReport._design._barcodeLabelPosition.BottomCenter, new Font(this._fontDetailName, 10), RotateFlipType.RotateNoneFlipNone, Color.Black, Color.White);
                        //Image __barcodeImage = _getBarcodeImage("5583794331000", new Size(240, 40), SMLReport._design._textAlign.Center, SMLReport._design._barcodeType.BarCode_EAN13, true, SMLReport._design._barcodeLabelPosition.BottomCenter, new Font(this._fontDetailName, 10), RotateFlipType.RotateNoneFlipNone, Color.Black, Color.White);                       
                        BarcoderLib.BarcodeEAN13 __ean13 = new BarcoderLib.BarcodeEAN13();
                        Image __barcodeImage = __ean13.Encode(__docGuid, 300, 30);
                        __g.DrawImage(__barcodeImage, 0, __y);
                        //PrintBarcode(__g, "5583794331000", "5583794331000", 240, 40);
                        __y += __barcodeImage.Height + 50;
                        __barcodeImage.Dispose();
                    }
                    catch
                    {
                    }
                }
            }

            if (this._posConfig._printer_manual_feed == true || manualfeed)
            {
                if (this._posConfig._print_method == 0)
                {
                    this._printSlipText(__g, __width, __width, 0, __y, ".\n.\n.\n.\n.", new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Left, true);
                }
                __y += 150;
            }

            return __y;
        }

        #endregion

        #region พิมพ์บิลเป็นช่วง

        /// <summary>พิมพ์บิลเป็นช่วง</summary>
        void _printPeriod__perionBillPrint(string fromdoc, string todoc)
        {
            // toe bug หายแล้ว
            _printSlipPeroid(_printSlipMode.ใบกำกับภาษีอย่างย่อ, fromdoc, todoc, "", "", false);
            MessageBox.Show("Success");
        }

        /// <summary>
        /// พิมพ์บิลเป็นช่วง
        /// </summary>
        /// <param name="mode"></param>
        /// <param name="docNo"></param>
        /// <param name="header"></param>
        /// <param name="headerSlip"></param>
        /// <param name="displayChange"></param>
        void _printSlipPeroid(_printSlipMode mode, string fromDocNo, string toDocNo, string header, string headerSlip, Boolean displayChange)
        {
            try
            {
                MyLib._myFrameWork __myFrameWork = new _myFrameWork();

                DataSet __result = __myFrameWork._queryShort("select *,(select " + _g.d.erp_user._name_1 + " from " + _g.d.erp_user._table + " where " + _g.d.erp_user._table + "." + _g.d.erp_user._code + "=" + _g.d.ic_trans._cashier_code + ") as cashier_name,(select " + _g.d.ar_customer._name_1 + " from " + _g.d.ar_customer._table + " where " + _g.d.ar_customer._table + "." + _g.d.ar_customer._code + "=" + _g.d.ic_trans._table + "." + _g.d.ic_trans._cust_code + ") as " + _g.d.ic_trans._cust_name + ",(select " + _g.d.ar_customer._address + " from " + _g.d.ar_customer._table + " where " + _g.d.ar_customer._table + "." + _g.d.ar_customer._code + "=" + _g.d.ic_trans._table + "." + _g.d.ic_trans._cust_code + ") as cust_address,(select " + _g.d.POS_ID._POS_ID + " from " + _g.d.POS_ID._table + " where " + _g.d.POS_ID._table + "." + _g.d.POS_ID._MACHINECODE + "=" + _g.d.ic_trans._table + "." + _g.d.ic_trans._pos_id + ") as pos_id_desc" + " from " + _g.d.ic_trans._table + " where " + MyLib._myGlobal._addUpper(_g.d.ic_trans._doc_no) + " between \'" + fromDocNo.ToUpper().ToString() + "\' and \'" + toDocNo.ToUpper().ToString() + "\'  order by " + _g.d.ic_trans._doc_no);

                switch (this._posConfig._print_method)
                {
                    case 0:
                        // Driver Printer
                        {
                            try
                            {
                                int __startRow = 0;
                                PrintDocument __pd = new PrintDocument();
                                __pd.PrinterSettings.PrinterName = this._posConfig._pos_printer_name;
                                __pd.BeginPrint += (s2, e2) =>
                                {
                                    __startRow = 0;
                                };
                                __pd.PrintPage += (s1, e1) =>
                                {
                                    e1.Graphics.CompositingQuality = System.Drawing.Drawing2D.CompositingQuality.HighQuality;
                                    e1.Graphics.InterpolationMode = System.Drawing.Drawing2D.InterpolationMode.HighQualityBicubic;
                                    e1.Graphics.SmoothingMode = System.Drawing.Drawing2D.SmoothingMode.HighQuality;
                                    e1.Graphics.PixelOffsetMode = System.Drawing.Drawing2D.PixelOffsetMode.HighQuality;
                                    e1.Graphics.PageUnit = GraphicsUnit.Pixel;

                                    float _height = 0f;
                                    //for (int __row = 0; __row < __result.Tables[0].Rows.Count; __row++)
                                    //{
                                    MyLib._printRaw __pd2 = new _printRaw((float)this._posConfig._pos_slip_width, 9600f);
                                    string _docNo = __result.Tables[0].Rows[__startRow][_g.d.ic_trans._doc_no].ToString();
                                    ArrayList _getDocData = _filterDocNo(_docNo);

                                    // header
                                    string _headerBill = "สำเนา";

                                    if (MyLib._myGlobal._decimalPhase(__result.Tables[0].Rows[__startRow][_g.d.ic_trans._last_status].ToString()) == 1)
                                    {
                                        _headerBill = "บิลยกเลิก";
                                    }
                                    // header slip
                                    //__pd2._height = this._printSlipDraw(__pd2._g, _getData, mode, header, headerSlip);

                                    // eJournal ข้ามไปก่อน พิมพ์เป็นช่วง สำหรับ e-jornal
                                    //this._save_eJournal(docNo, __pd2._bitmap, (int)__pd2._width, (int)__pd2._height);

                                    _height = this._printSlipDraw(__pd2._g, _getDocData, mode, _headerBill, "ใบกำกับภาษีอย่างย่อ", 0, _height, true);

                                    e1.Graphics.DrawImageUnscaled(__pd2._bitmap, 0, 0, (int)__pd2._width, (int)__pd2._height);

                                    if (++__startRow < __result.Tables[0].Rows.Count)
                                    {
                                        e1.HasMorePages = true;
                                    }
                                    __pd2._dispose();
                                    //}

                                };
                                __pd.Print();
                            }
                            catch (Exception __ex)
                            {
                                MessageBox.Show(__ex.Message);
                            }
                        }
                        break;
                    case 1:
                        // Raw Print
                        {
                            try
                            {
                                for (int __row = 0; __row < __result.Tables[0].Rows.Count; __row++)
                                {

                                    MyLib._printRaw __pd = new _printRaw((float)this._posConfig._pos_slip_width, 9600f);
                                    //__pd._height = this._printSlipDraw(__pd._g, _getData, mode, header, headerSlip);
                                    float _height = 0f;
                                    string _docNo = __result.Tables[0].Rows[__row][_g.d.ic_trans._doc_no].ToString();
                                    ArrayList _getDocData = _filterDocNo(_docNo);

                                    // header
                                    string _headerBill = "สำเนา";

                                    if (MyLib._myGlobal._decimalPhase(__result.Tables[0].Rows[__row][_g.d.ic_trans._last_status].ToString()) == 1)
                                    {
                                        _headerBill = "บิลยกเลิก";
                                    }
                                    // header slip

                                    __pd._height = this._printSlipDraw(__pd._g, _getDocData, mode, _headerBill, "ใบกำกับภาษีอย่างย่อ", 0, _height);
                                    if (__row != __result.Tables[0].Rows.Count - 1)
                                    {
                                        __pd._height += 150;
                                    }
                                    // eJournal
                                    //this._save_eJournal(docNo, __pd._bitmap, (int)__pd._width, (int)__pd._height);
                                    //

                                    __pd._print(this._posConfig._pos_printer_name);
                                    if (__row == __result.Tables[0].Rows.Count - 1)
                                    {
                                        __pd._print(this._posConfig._pos_printer_name, new byte[] { 29, 86, 66, 10 });
                                    }
                                    //Thread.Sleep(5000);
                                    __pd._dispose();
                                }
                            }
                            catch (Exception __ex)
                            {
                                MessageBox.Show(__ex.Message);
                            }
                        }
                        break;
                    case 2:
                        // Tcp/IP
                        {
                            try
                            {
                                for (int __row = 0; __row < __result.Tables[0].Rows.Count; __row++)
                                {
                                    IPEndPoint __ip = new IPEndPoint(IPAddress.Parse(this._posConfig._printerPort), 9100);
                                    Socket __socket = new Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);
                                    __socket.Connect(__ip);
                                    __socket.Send(new byte[] { 27, 64 }); // Initialize printer
                                    MyLib._printRaw __pd = new _printRaw((float)this._posConfig._pos_slip_width, 9600f);

                                    //__pd._height = this._printSlipDraw(__pd._g, _getData, mode, header, headerSlip);
                                    float _height = 0f;
                                    string _docNo = __result.Tables[0].Rows[__row][_g.d.ic_trans._doc_no].ToString();
                                    ArrayList _getDocData = _filterDocNo(_docNo);

                                    // header
                                    string _headerBill = "สำเนา";

                                    if (MyLib._myGlobal._decimalPhase(__result.Tables[0].Rows[__row][_g.d.ic_trans._last_status].ToString()) == 1)
                                    {
                                        _headerBill = "บิลยกเลิก";
                                    }
                                    // header slip

                                    __pd._height = this._printSlipDraw(__pd._g, _getDocData, mode, _headerBill, "ใบกำกับภาษีอย่างย่อ", 0, _height);
                                    if (__row != __result.Tables[0].Rows.Count - 1)
                                    {
                                        __pd._height += 150;
                                    }
                                    // eJournal
                                    //this._save_eJournal(docNo, __pd._bitmap, (int)__pd._width, (int)__pd._height);
                                    //
                                    __socket.Send(__pd._getDataBytes());

                                    if (__row == __result.Tables[0].Rows.Count - 1)
                                    {
                                        __socket.Send(new byte[] { 10 });
                                        __socket.Send(new byte[] { 29, 86, 66, 10 }); // Cut
                                    }
                                    __socket.Shutdown(SocketShutdown.Both);
                                    __socket.Close();
                                    __pd._dispose();
                                    //Thread.Sleep(5000);
                                }
                            }
                            catch (Exception __ex)
                            {
                                MessageBox.Show(__ex.Message);
                            }
                        }
                        break;
                }

            }
            catch (Exception __ex)
            {
                MessageBox.Show(__ex.Message.ToString());
            }
        }

        #endregion

        #region พิมพ์ใบส่งเงิน

        void _printSaveSendMoney(string docNo)
        {
            try
            {
                // toe ดึงรายละเอียดการส่งเงิน จาก _g.d.POSCashierSettle
                MyLib._myFrameWork __myFrameWork = new _myFrameWork();

                string __fieldList = MyLib._myGlobal._fieldAndComma(_g.d.POSCashierSettle._MACHINECODE,
                    _g.d.POSCashierSettle._DocNo,
                    _g.d.POSCashierSettle._DocDate,
                    _g.d.POSCashierSettle._doc_time,
                    _g.d.POSCashierSettle._CashierCode,
                    _g.d.POSCashierSettle._CashAmount,
                    _g.d.POSCashierSettle._CreditCardAmount,
                    _g.d.POSCashierSettle._CoupongAmount,
                    _g.d.POSCashierSettle._sum_amount,
                    _g.d.POSCashierSettle._total_in,
                    _g.d.POSCashierSettle._total_out,
                    _g.d.POSCashierSettle._total_amount,
                    _g.d.POSCashierSettle._total_cancel,
                    _g.d.POSCashierSettle._total_cash,
                    _g.d.POSCashierSettle._total_credit_card,
                    _g.d.POSCashierSettle._total_coupon,
                    _g.d.POSCashierSettle._total_point,
                    _g.d.POSCashierSettle._total_diff,
                    _g.d.POSCashierSettle._total_balance,
                    _g.d.POSCashierSettle._total_sum,
                    _g.d.POSCashierSettle._remark,
                    _g.d.POSCashierSettle._trans_type,
                    _g.d.POSCashierSettle._begin_date,
                    _g.d.POSCashierSettle._begin_time,
                    _g.d.POSCashierSettle._begin_user_code,
                    _g.d.POSCashierSettle._total_out_credit,
                    _g.d.POSCashierSettle._total_out_coupon,
                    _g.d.POSCashierSettle._total_advance,
                    _g.d.POSCashierSettle._total_after_advance,
                    _g.d.POSCashierSettle._deposit_cash_amount,
                    _g.d.POSCashierSettle._deposit_credit_amount,
                    _g.d.POSCashierSettle._deposit_return_cash_amount,
                    _g.d.POSCashierSettle._sale_credit_amount,
                    _g.d.POSCashierSettle._order_amount,
                    _g.d.POSCashierSettle._total_credit_charge
                    );

                // ยิง query shot ไปเช็คก่อน
                DateTime __beginDate = DateTime.Now;
                string __beginTime = "00:00";
                DateTime __docDate = DateTime.Now;
                string __docTime = "";
                string __sql = "select " + _g.d.POSCashierSettle._begin_date + "," + _g.d.POSCashierSettle._begin_time + "," + _g.d.POSCashierSettle._DocDate + "," + _g.d.POSCashierSettle._doc_time + " from " + _g.d.POSCashierSettle._table + " where " + _g.d.POSCashierSettle._DocNo + " = \'" + docNo + "\' AND " + _g.d.POSCashierSettle._trans_type + "=2 and " + _g.d.POSCashierSettle._begin_date + " is not null";
                DataTable __dt = __myFrameWork._query(MyLib._myGlobal._databaseName, __sql).Tables[0];
                if (__dt.Rows.Count > 0)
                {
                    __docDate = MyLib._myGlobal._convertDateFromQuery(__dt.Rows[0][_g.d.POSCashierSettle._DocDate].ToString());
                    __docTime = __dt.Rows[0][_g.d.POSCashierSettle._doc_time].ToString();
                    __beginDate = MyLib._myGlobal._convertDateFromQuery(__dt.Rows[0][_g.d.POSCashierSettle._begin_date].ToString());
                    __beginTime = __dt.Rows[0][_g.d.POSCashierSettle._begin_time].ToString();
                }

                string __dateCompareTrans = "to_timestamp(date(" + _g.d.ic_trans._doc_date + ")||\' \'||" + _g.d.ic_trans._doc_time + ",'YYYY/MM/DD HH24:MI')::timestamp";
                string __dateTime = __beginDate.ToString("yyyy-MM-dd", new CultureInfo("en-US")) + " " + __beginTime + ":00";

                StringBuilder __queryList = new StringBuilder();
                __queryList.Append(MyLib._myGlobal._xmlHeader + "<node>");

                // รายละเอียดการนำส่ง
                __queryList.Append(MyLib._myUtil._convertTextToXmlForQuery("select " + __fieldList + " from " + _g.d.POSCashierSettle._table + " where " + _g.d.POSCashierSettle._DocNo + " = \'" + docNo + "\' AND " + _g.d.POSCashierSettle._trans_type + "=2"));

                // บิลขายเริ่มต้น และสินสุด ,บิลยกเลิก เริ่มต้น สิ้นสุด
                string __queryTrans = "select " +
                    " coalesce((select count(" + _g.d.ic_trans._doc_no + ")  from " + _g.d.ic_trans._table + " where " + _g.d.ic_trans._trans_flag + "=44 and " + _g.d.ic_trans._is_pos + "=1 and " + _g.d.ic_trans._pos_id + "=\'" + this._posConfig._posid + "\' and " + __dateCompareTrans + ">=\'" + __dateTime + "\' and ( " + _g.d.ic_trans._doc_ref + " is null or " + _g.d.ic_trans._doc_ref + " = \'\' ) ), 0) as _invoice_count," +
                    " coalesce((select count(" + _g.d.ic_trans._doc_no + ")  from " + _g.d.ic_trans._table + " where " + _g.d.ic_trans._trans_flag + "=44 and " + _g.d.ic_trans._inquiry_type + "=1 and " + _g.d.ic_trans._is_pos + "=1 and " + _g.d.ic_trans._pos_id + "=\'" + this._posConfig._posid + "\' and " + __dateCompareTrans + ">=\'" + __dateTime + "\' and ( " + _g.d.ic_trans._doc_ref + " is null or " + _g.d.ic_trans._doc_ref + " = \'\' ) ), 0) as _invoice_cash_count," +
                    " coalesce((select count(" + _g.d.ic_trans._doc_no + ")  from " + _g.d.ic_trans._table + " where " + _g.d.ic_trans._trans_flag + "=44 and " + _g.d.ic_trans._inquiry_type + "=0 and " + _g.d.ic_trans._is_pos + "=1 and " + _g.d.ic_trans._pos_id + "=\'" + this._posConfig._posid + "\' and " + __dateCompareTrans + ">=\'" + __dateTime + "\' and ( " + _g.d.ic_trans._doc_ref + " is null or " + _g.d.ic_trans._doc_ref + " = \'\' ) ), 0) as _invoice_credit_count," +
                    " coalesce((select sum(" + _g.d.ic_trans._total_discount + ")  from " + _g.d.ic_trans._table + " where " + _g.d.ic_trans._trans_flag + "=44 and " + _g.d.ic_trans._is_pos + "=1 and " + _g.d.ic_trans._pos_id + "=\'" + this._posConfig._posid + "\' and " + __dateCompareTrans + ">=\'" + __dateTime + "\' and ( " + _g.d.ic_trans._doc_ref + " is null or " + _g.d.ic_trans._doc_ref + " = \'\') ), 0) as _total_discount," +
                    " coalesce((select " + _g.d.ic_trans._doc_no + " from " + _g.d.ic_trans._table + " where " + _g.d.ic_trans._trans_flag + "=44 and " + _g.d.ic_trans._is_pos + "=1 and " + _g.d.ic_trans._pos_id + "=\'" + this._posConfig._posid + "\' and " + __dateCompareTrans + ">=\'" + __dateTime + "\' and ( " + _g.d.ic_trans._doc_ref + " is null or " + _g.d.ic_trans._doc_ref + " = \'\')  order by " + _g.d.ic_trans._doc_no + " limit 1), '') as _begin_invoice," +
                    " coalesce((select " + _g.d.ic_trans._doc_no + " from " + _g.d.ic_trans._table + " where " + _g.d.ic_trans._trans_flag + "=44 and " + _g.d.ic_trans._is_pos + "=1 and " + _g.d.ic_trans._pos_id + "=\'" + this._posConfig._posid + "\' and " + __dateCompareTrans + ">=\'" + __dateTime + "\' and ( " + _g.d.ic_trans._doc_ref + " is null or " + _g.d.ic_trans._doc_ref + " = \'\')  order by " + _g.d.ic_trans._doc_no + " desc limit 1), '') as _end_invoice," +
                    " coalesce((select " + _g.d.ic_trans._doc_no + " from " + _g.d.ic_trans._table + " where " + _g.d.ic_trans._trans_flag + "=45 and " + _g.d.ic_trans._is_pos + "=1 and " + _g.d.ic_trans._pos_id + "=\'" + this._posConfig._posid + "\' and " + __dateCompareTrans + ">=\'" + __dateTime + "\' order by " + _g.d.ic_trans._doc_no + " limit 1), '') as _begin_cn," +
                    " coalesce((select " + _g.d.ic_trans._doc_no + " from " + _g.d.ic_trans._table + " where " + _g.d.ic_trans._trans_flag + "=45 and " + _g.d.ic_trans._is_pos + "=1 and " + _g.d.ic_trans._pos_id + "=\'" + this._posConfig._posid + "\' and " + __dateCompareTrans + ">=\'" + __dateTime + "\' order by " + _g.d.ic_trans._doc_no + " desc limit 1), '') as _end_cn";

                __queryList.Append(MyLib._myUtil._convertTextToXmlForQuery(__queryTrans));


                // cancel invoice
                __queryList.Append(MyLib._myUtil._convertTextToXmlForQuery("select * from " + _g.d.pos_settle_bill_cancel._table + " where " + _g.d.pos_settle_bill_cancel._doc_no + "=\'" + docNo + "\'"));

                // discount invoice
                __queryList.Append(MyLib._myUtil._convertTextToXmlForQuery("select * from " + _g.d.pos_settle_bill_discount._table + " where " + _g.d.pos_settle_bill_discount._doc_no + "=\'" + docNo + "\'"));

                // get sale summary item
                if (this._print_sale_daily_item)
                {
                    // data begin
                    string __startDateCompare = "to_timestamp(date(\'" + __beginDate.ToString("yyyy-MM-dd", new CultureInfo("en-US")) + "\')||\' \'||\'" + __beginTime + "\','YYYY/MM/DD HH24:MI')::timestamp";
                    string __endDateCompare = "to_timestamp(date(\'" + __docDate.ToString("yyyy-MM-dd", new CultureInfo("en-US")) + "\')||\' \'||\'" + __docTime + "\','YYYY/MM/DD HH24:MI')::timestamp";

                    string __queryItemSummary = "select " + _g.d.ic_trans_detail._item_code +
                        "," + _g.d.ic_trans_detail._item_name +
                        ", sum(" + _g.d.ic_trans_detail._qty + ") as " + _g.d.ic_trans_detail._qty +
                        ", sum(" + _g.d.ic_trans_detail._sum_amount + ") as " + _g.d.ic_trans_detail._sum_amount +
                        " from " + _g.d.ic_trans_detail._table +
                        " where " + _g.d.ic_trans_detail._is_pos + " = 1 and " +
                        _g.d.ic_trans_detail._last_status + " = 0 and " +
                       __dateCompareTrans + " between " + __startDateCompare + " and " + __endDateCompare +
                        " and (select " + _g.d.ic_trans._table + "." + _g.d.ic_trans._pos_id + " from " + _g.d.ic_trans._table + " where " + _g.d.ic_trans._table + "." + _g.d.ic_trans._doc_no + " = " + _g.d.ic_trans_detail._table + "." + _g.d.ic_trans_detail._doc_no + ") = \'" + this._posConfig._posid + "\' " +
                        " and ( (select " + _g.d.ic_trans._table + "." + _g.d.ic_trans._doc_ref + " from " + _g.d.ic_trans._table + " where " + _g.d.ic_trans._table + "." + _g.d.ic_trans._doc_no + " = " + _g.d.ic_trans_detail._table + "." + _g.d.ic_trans_detail._doc_no + " and " + _g.d.ic_trans._is_pos + "=1 and " + _g.d.ic_trans._trans_flag + "=" + _g.g._transFlagGlobal._transFlag(_g.g._transControlTypeEnum.ขาย_ขายสินค้าและบริการ) + ") is null or  (select " + _g.d.ic_trans._table + "." + _g.d.ic_trans._doc_ref + " from " + _g.d.ic_trans._table + " where " + _g.d.ic_trans._table + "." + _g.d.ic_trans._doc_no + " = " + _g.d.ic_trans_detail._table + "." + _g.d.ic_trans_detail._doc_no + " and " + _g.d.ic_trans._is_pos + "=1 and " + _g.d.ic_trans._trans_flag + "=" + _g.g._transFlagGlobal._transFlag(_g.g._transControlTypeEnum.ขาย_ขายสินค้าและบริการ) + ") = \'\' ) " +
                        " group by " + _g.d.ic_trans_detail._item_code + ", " + _g.d.ic_trans_detail._item_name +
                        " order by " + _g.d.ic_trans_detail._item_code;
                    __queryList.Append(MyLib._myUtil._convertTextToXmlForQuery(__queryItemSummary));

                    string __queyrTotalItem = "select sum(" + _g.d.ic_trans_detail._qty + ") as " + _g.d.ic_trans_detail._qty +
                        ", sum(" + _g.d.ic_trans_detail._sum_amount + ") as " + _g.d.ic_trans_detail._sum_amount +
                        " from " + _g.d.ic_trans_detail._table + " where " + _g.d.ic_trans_detail._is_pos + " = 1 and " + _g.d.ic_trans_detail._last_status + " = 0 and " +
                        __dateCompareTrans + " between " + __startDateCompare + " and " + __endDateCompare +

                        " and (select " + _g.d.ic_trans._table + "." + _g.d.ic_trans._pos_id + " from " + _g.d.ic_trans._table + " where " + _g.d.ic_trans._table + "." + _g.d.ic_trans._doc_no + " = " + _g.d.ic_trans_detail._table + "." + _g.d.ic_trans_detail._doc_no + ") = \'" + this._posConfig._posid + "\' and ((select " + _g.d.ic_trans._table + "." + _g.d.ic_trans._doc_ref + " from " + _g.d.ic_trans._table + " where " + _g.d.ic_trans._table + "." + _g.d.ic_trans._doc_no + " = " + _g.d.ic_trans_detail._table + "." + _g.d.ic_trans_detail._doc_no + " and " + _g.d.ic_trans._is_pos + "=1 and " + _g.d.ic_trans._trans_flag + "=" + _g.g._transFlagGlobal._transFlag(_g.g._transControlTypeEnum.ขาย_ขายสินค้าและบริการ) + ") is null or (select " + _g.d.ic_trans._table + "." + _g.d.ic_trans._doc_ref + " from " + _g.d.ic_trans._table + " where " + _g.d.ic_trans._table + "." + _g.d.ic_trans._doc_no + " = " + _g.d.ic_trans_detail._table + "." + _g.d.ic_trans_detail._doc_no + "  and " + _g.d.ic_trans._is_pos + "=1 and " + _g.d.ic_trans._trans_flag + "=" + _g.g._transFlagGlobal._transFlag(_g.g._transControlTypeEnum.ขาย_ขายสินค้าและบริการ) + ") = \'\' ) ";
                    __queryList.Append(MyLib._myUtil._convertTextToXmlForQuery(__queyrTotalItem));

                }

                __queryList.Append("</node>");
                string __tmpQuery = __queryList.ToString();
                ArrayList _getData = __myFrameWork._queryListGetData(MyLib._myGlobal._databaseName, __queryList.ToString());

                // print it  
                try
                {
                    switch (this._posConfig._print_method)
                    {
                        case 0:
                            // Driver Printer
                            {
                                try
                                {
                                    PrintDocument __pd = new PrintDocument();
                                    __pd.PrinterSettings.PrinterName = this._posConfig._pos_printer_name;
                                    __pd.PrintController = new StandardPrintController();
                                    __pd.PrintPage += (s1, e1) =>
                                    {
                                        // แบบเดิม
                                        this._drawSaveSendMoneySlip(_getData, e1.Graphics, docNo, __dateTime);
                                    };
                                    __pd.Print();

                                    // e-journal
                                    if (this._pos_eJournal == 1)
                                    {
                                        MyLib._printRaw __pd2 = new _printRaw((float)this._posConfig._pos_slip_width);
                                        __pd2._height = this._drawSaveSendMoneySlip(_getData, __pd2._g, docNo, __dateTime);
                                        //if (this._posConfig._printer_manual_feed == true)
                                        //{
                                        //    __pd2._height += 150;
                                        //}
                                        this._save_eJournal(docNo, __pd2._bitmap, (int)__pd2._width, (int)__pd2._height);
                                        __pd2._dispose();
                                    }

                                }
                                catch (Exception __ex)
                                {
                                    MessageBox.Show(__ex.Message);
                                }
                            }
                            break;
                        case 1:
                            // Raw Print
                            {
                                try
                                {
                                    MyLib._printRaw __pd = new _printRaw((float)this._posConfig._pos_slip_width);
                                    __pd._height = this._drawSaveSendMoneySlip(_getData, __pd._g, docNo, __dateTime);

                                    // eJournal
                                    this._save_eJournal(docNo, __pd._bitmap, (int)__pd._width, (int)__pd._height);

                                    __pd._print(this._posConfig._pos_printer_name);
                                    __pd._print(this._posConfig._pos_printer_name, new byte[] { 29, 86, 66, 10 });
                                    __pd._dispose();
                                }
                                catch (Exception __ex)
                                {
                                    MessageBox.Show(__ex.Message);
                                }
                            }
                            break;
                        case 2:
                            // Tcp/IP
                            {
                                try
                                {
                                    IPEndPoint __ip = new IPEndPoint(IPAddress.Parse(this._posConfig._printerPort), 9100);
                                    Socket __socket = new Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);
                                    __socket.Connect(__ip);
                                    __socket.Send(new byte[] { 27, 64 }); // Initialize printer
                                    MyLib._printRaw __pd = new _printRaw((float)this._posConfig._pos_slip_width);
                                    __pd._height = this._drawSaveSendMoneySlip(_getData, __pd._g, docNo, __dateTime);

                                    //eJournal
                                    this._save_eJournal(docNo, __pd._bitmap, (int)__pd._width, (int)__pd._height);

                                    __socket.Send(__pd._getDataBytes());
                                    __socket.Send(new byte[] { 10 });
                                    __socket.Send(new byte[] { 29, 86, 66, 10 }); // Cut
                                    __socket.Shutdown(SocketShutdown.Both);
                                    __socket.Close();
                                    __pd._dispose();
                                }
                                catch (Exception __ex)
                                {
                                    MessageBox.Show(__ex.Message);
                                }
                            }
                            break;
                    }
                }
                catch (Exception __ex)
                {
                    MessageBox.Show(__ex.Message.ToString());
                }

            }
            catch (Exception __ex)
            {
                MessageBox.Show(__ex.Message.ToString());
            }
        }

        float _drawSaveSendMoneySlip(ArrayList _getData, Graphics __g, String docNo, String __dateTime)
        {
            float __y = 0f;

            DataTable __trans = ((DataSet)_getData[0]).Tables[0];
            DataTable __invoice = ((DataSet)_getData[1]).Tables[0];
            DataTable __cancelDataTable = ((DataSet)_getData[2]).Tables[0];
            DataTable __discountDataTable = ((DataSet)_getData[3]).Tables[0];

            DataTable __saleDetail = null;
            DataTable __saleSum = null;

            if (this._print_sale_daily_item)
            {
                __saleDetail = ((DataSet)_getData[4]).Tables[0];
                __saleSum = ((DataSet)_getData[5]).Tables[0];
            }


            //e1.PageSettings.PaperSize = new PaperSize("Customer", 375, 10000);
            //__pd.PrinterSettings.DefaultPageSettings.PaperSize.Height = 1000;
            //
            //Font __font1 = new Font(this._fontHeaderName, 10);

            __g.CompositingQuality = System.Drawing.Drawing2D.CompositingQuality.HighQuality;
            __g.InterpolationMode = System.Drawing.Drawing2D.InterpolationMode.HighQualityBicubic;
            __g.SmoothingMode = System.Drawing.Drawing2D.SmoothingMode.HighQuality;
            __g.PixelOffsetMode = System.Drawing.Drawing2D.PixelOffsetMode.HighQuality;
            __g.PageUnit = GraphicsUnit.Pixel;
            float __width = __g.VisibleClipBounds.Width - 10;// (float)__pd.PrinterSettings.DefaultPageSettings.PaperSize.Width;

            decimal __totalAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.POSCashierSettle._total_amount].ToString()); // ยอดขาย รวม
            decimal __totalCalcel = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.POSCashierSettle._total_cancel].ToString()); // ยอดยกเลิก
            decimal __totalCreditCard = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.POSCashierSettle._total_credit_card].ToString()); // ยอดขาย บัตรเครดิต
            decimal __totalCoupon = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.POSCashierSettle._total_coupon].ToString()); // ยอดขาย คูปอง
            decimal __totalPoint = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.POSCashierSettle._total_point].ToString());
            decimal __diff_amount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.POSCashierSettle._total_diff].ToString());

            decimal __totalIn = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.POSCashierSettle._total_in].ToString()); // ยอดเงินทอนเอาเข้า
            decimal __totalOut = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.POSCashierSettle._CashAmount].ToString()); // ยอดเงินสดออก
            decimal __totalCardOut = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.POSCashierSettle._CreditCardAmount].ToString()); // ยอดเงินสดออก
            decimal __totalCouponOut = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.POSCashierSettle._CoupongAmount].ToString()); // ยอดคูปองออก

            decimal __advanceAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.POSCashierSettle._total_advance].ToString()); // ยอดเงินมัดจำ
            decimal __totalAfterAdvanceAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.POSCashierSettle._total_after_advance].ToString()); // ยอดขายหักเงินมัดจำ

            decimal __totalDiscount = MyLib._myGlobal._decimalPhase(__invoice.Rows[0]["_total_discount"].ToString()); // ส่วนลด

            decimal __saleCreditAmount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.POSCashierSettle._sale_credit_amount].ToString()); // ยอดขายเงินเชื่อ
            decimal __credit_charge_amount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.POSCashierSettle._total_credit_charge].ToString()); // ยอด charge บัตรเครดิต

            decimal __total_order_amount = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.POSCashierSettle._order_amount].ToString()); // ยอดขายเงินเชื่อ

            __totalAmount += __totalDiscount;

            // มัดจำ
            //__totalAmount += __advanceAmount;

            decimal __totalAfterDiscount = __totalAmount - __totalDiscount;
            decimal __totalBalance = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.POSCashierSettle._total_balance].ToString()); // ยอดขายสุทธิ (หัก ยกเลิกไปแล้ว)

            // มัดจำ

            decimal __totalCash = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.POSCashierSettle._total_cash].ToString()); // ยอดเงินสด ในลิ้นชัก ( หักยอดส่งเงิน รอบก่อนหน้าไปแล้ว ) แต่ยังไม่ได้หัก รอบปัจจุบัน

            decimal __totalCashOutSummary = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.POSCashierSettle._total_out].ToString()); // รายการส่งเงิน เงินสด รอบที่ผ่านมาแล้ว
            decimal __totalCreditOutSummary = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.POSCashierSettle._total_out_credit].ToString()); // รายการส่งเงิน บัตรเครดิต รอบที่ผ่านมาแล้ว
            decimal __totalCouponOutSummary = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.POSCashierSettle._total_out_coupon].ToString()); // รายการส่งเงิน คูปอง รอบที่ผ่านมาแล้ว

            // สรุปการรับเงิน เงินสด 
            decimal __cashSummary = (__totalBalance + (-1 * __diff_amount)) - ((__totalCreditCard - __credit_charge_amount) + __totalCoupon + __totalCreditOutSummary + __totalCouponOutSummary + __totalPoint + __advanceAmount + __saleCreditAmount); //(__totalBalance - __totalCashOut);
            decimal __couponSummary = __totalCoupon + __totalCouponOutSummary; //(__totalCoupon - __totalCouponOut);
            decimal __creditSummary = __totalCreditCard + __totalCreditOutSummary; // (__totalCreditCard - __totalCreditOut);

            decimal __totalInCome = (__totalBalance + (-1 * __diff_amount)) - (__advanceAmount + __saleCreditAmount); //__cashSummary + __totalCreditCard + __totalCoupon; // สรุปยอดเงินในลิ้นชัก รับจากการขาย (เงินสด)
            decimal __totalSum = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.POSCashierSettle._total_sum].ToString()); // รวมมูลค่าที่ต้องนำส่ง

            // ยอดคงเหลือในลิ้นชัก (เงินทอน + ยอดขายเงินสด) - ส่งออกรอบที่แล้ว
            decimal __totalInCashDrawer = (__totalIn + __cashSummary) - __totalCashOutSummary;  // (__totalIn + __cashSummary) - __totalOut;
            decimal __sumSendMoney = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.POSCashierSettle._sum_amount].ToString());


            int __invoiceCount = (int)MyLib._myGlobal._decimalPhase(__invoice.Rows[0]["_invoice_count"].ToString());
            float __averateInvoice = (float)__totalAmount / __invoiceCount;
            float __lineHeightTmp = 0f;

            string __ltdName = "";
            string __ltdAddress = "";
            string __ltdTel = "";
            string __ltdFax = "";
            string __ltdTax = "";

            if (MyLib._myGlobal._ltdName != null && MyLib._myGlobal._ltdAddress != null)
            {
                __ltdName = MyLib._myGlobal._ltdName;
                __ltdAddress = MyLib._myGlobal._ltdAddress;
                __ltdTel = MyLib._myGlobal._ltdTel;
                __ltdFax = MyLib._myGlobal._ltdFax;
                __ltdTax = MyLib._myGlobal._ltdTax;
            }
            else
            {
                __ltdName = "Company Name";
                __ltdAddress = "Company Address";
            }

            #region Logo

            Boolean __haveLogo = false;

            string __logoFileName = @"c:\smlsoft\logopos.jpg";
            if (File.Exists(__logoFileName))
            {
                __haveLogo = true;
            }

            if (__haveLogo)
            {
                Image __logo = Image.FromFile(__logoFileName);
                float __persent = __width / __logo.Width;
                __g.DrawImage(__logo, 0, (int)__y, __logo.Width * __persent, __logo.Height * __persent);
                __y += (__logo.Height * __persent) + 10;
            }

            #endregion

            #region ส่วนหัว แสดงข้อมูลบริษัท

            if (this._posHeader.Trim().Length > 0)
            {
                __y += this._printSlipText(__g, __width, __width, 0, __y, this._posHeader, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false, true);
            }
            else
            {
                __y += this._printSlipText(__g, __width, __width, 0, __y, __ltdName, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                __y += this._printSlipText(__g, __width, __width, 0, __y, MyLib._myGlobal._ltdAddress, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                string __telephone = "";
                if (__ltdTel.Trim().Length > 0)
                {
                    __telephone = "โทรศัพท์" + ":" + __ltdTel.Trim();
                }
                if (__ltdFax.Trim().Length > 0)
                {
                    __telephone = __telephone + " " + "โทรสาร" + ":" + __ltdFax.Trim();
                }
                if (__telephone.Length > 0)
                {
                    __y += this._printSlipText(__g, __width, __width, 0, __y, __telephone, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                }
                //

                if (__ltdTax != null && __ltdTax.Trim().Length > 0)
                {
                    __y += this._printSlipText(__g, __width, __width, 0, __y, "เลขประจำตัวผู้เสียภาษีอากร" + " : " + __ltdTax, new Font(this._fontHeaderName, this._fontHeaderSize), SMLPOSControl._printSlipTextStyle.Center, false);
                }
            }

            #endregion

            __y += 100;

            __lineHeightTmp = this._printSlipText(__g, __width, __width, 130, __y, "รหัสเครื่อง " + __trans.Rows[0][_g.d.POSCashierSettle._CashierCode].ToString() + " " + __trans.Rows[0][_g.d.POSCashierSettle._MACHINECODE].ToString(), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Center, false);
            __y += __lineHeightTmp;

            __y += this._printSlipText(__g, __width, __width, 130, __y, "เลขที่เอกสาร " + docNo, new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Center, false);
            __y += this._printSlipText(__g, __width, __width, 130, __y, "วันที่ " + __dateTime, new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Center, false);
            __y += this._printSlipText(__g, __width, __width, 130, __y, "แคชเชียร์ " + _saleCode + " " + _saleName, new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Center, false);

            __y += this._printSlipText(__g, __width, __width, 0, __y, "SIGN-IN " + __trans.Rows[0][_g.d.POSCashierSettle._begin_time].ToString(), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            __y += this._printSlipText(__g, __width, __width, 0, __y, "SIGN-OUT " + __trans.Rows[0][_g.d.POSCashierSettle._doc_time].ToString(), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);

            __y += this._printSlipLine(__g, __width, __y);

            // ยอดขาย
            __y += this._printSlipText(__g, __width, __width, 50, __y, "สรุปยอดขาย :", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);

            __lineHeightTmp = this._printSlipText(__g, __width, __width, 0, __y, "ยอดขาย", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, __totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __lineHeightTmp;

            __lineHeightTmp = this._printSlipText(__g, __width, __width, 0, __y, "ส่วนลด", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, __totalDiscount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __lineHeightTmp;

            __lineHeightTmp = this._printSlipText(__g, __width, __width, 0, __y, "ยอดขายหักส่วนลด", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, __totalAfterDiscount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __lineHeightTmp;

            __lineHeightTmp = this._printSlipText(__g, __width, __width, 0, __y, "หักรับคืน", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, __totalCalcel.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __lineHeightTmp;

            __lineHeightTmp = this._printSlipText(__g, __width, __width, 0, __y, "ยอดขายสุทธิ", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, __totalBalance.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __lineHeightTmp;

            if (__diff_amount != 0)
            {
                __lineHeightTmp = this._printSlipText(__g, __width, __width, 0, __y, "ผลต่างปัดเศษ", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                this._printSlipText(__g, __width, __width, 0, __y, __diff_amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                __y += __lineHeightTmp;
            }

            if (__advanceAmount > 0)
            {
                __lineHeightTmp = this._printSlipText(__g, __width, __width, 0, __y, "หักเงินมัดจำ", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                this._printSlipText(__g, __width, __width, 0, __y, __advanceAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                __y += __lineHeightTmp;

                __lineHeightTmp = this._printSlipText(__g, __width, __width, 0, __y, "ยอดขายหักเงินมัดจำ", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                this._printSlipText(__g, __width, __width, 0, __y, __totalAfterAdvanceAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                __y += __lineHeightTmp;
            }
            //this._printSlipText(__g, __width, __width, 0, __y, "ชาร์จท้ายบิล", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Center, false);
            //__y += this._printSlipText(__g, __width, __width, 0, __y, __totalAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);

            __y += this._printSlipText(__g, __width, __width, 0, __y, "----------------------", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);

            __lineHeightTmp = this._printSlipText(__g, __width, __width, 0, __y, "ยอดขายสุทธิรวม", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            //this._printSlipText(__g, __width, __width, 0, __y, __totalBalance.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            this._printSlipText(__g, __width, __width, 0, __y, __totalAfterAdvanceAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __lineHeightTmp;

            __y += this._printSlipText(__g, __width, __width, 0, __y, "----------------------", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);

            __lineHeightTmp = this._printSlipText(__g, __width, __width, 0, __y, "ยอดขายเงินสด", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, __cashSummary.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __lineHeightTmp;

            __lineHeightTmp = this._printSlipText(__g, __width, __width, 0, __y, "ยอดขายเงินเชื่อ", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, __saleCreditAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __lineHeightTmp;

            __y += this._printSlipText(__g, __width, __width, 0, __y, "----------------------", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);


            // รับเงิน
            __y += this._printSlipText(__g, __width, __width, 50, __y, "สรุปการรับเงินจากการขาย :", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);

            __lineHeightTmp = this._printSlipText(__g, __width, __width, 0, __y, "เงินสด", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, __cashSummary.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __lineHeightTmp;

            __lineHeightTmp = this._printSlipText(__g, __width, __width, 0, __y, "เครดิตการ์ด", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, __creditSummary.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __lineHeightTmp;

            __lineHeightTmp = this._printSlipText(__g, __width, __width, 0, __y, "คูปอง", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, __couponSummary.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __lineHeightTmp;

            if (__totalPoint > 0)
            {
                __lineHeightTmp = this._printSlipText(__g, __width, __width, 0, __y, "แต้ม", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                this._printSlipText(__g, __width, __width, 0, __y, __totalPoint.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                __y += __lineHeightTmp;

            }

            __y += this._printSlipText(__g, __width, __width, 0, __y, "----------------------", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);

            __lineHeightTmp = this._printSlipText(__g, __width, __width, 0, __y, "รวมรับเงินทั้งสิ้น", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, __totalInCome.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __lineHeightTmp;

            __y += this._printSlipText(__g, __width, __width, 0, __y, "----------------------", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);

            // order  amount
            if (MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro)
            {
                if (__total_order_amount > 0)
                {
                    __lineHeightTmp = this._printSlipText(__g, __width, __width, 0, __y, "ยอดค้างเช็คบิล", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                    this._printSlipText(__g, __width, __width, 0, __y, __total_order_amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                    __y += __lineHeightTmp;
                    __y += this._printSlipText(__g, __width, __width, 0, __y, "----------------------", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);

                }
            }

            if (_g.g._companyProfile._print_pos_settle_bill_detail == true)
            {
                #region Cancel Bill List
                if (__cancelDataTable.Rows.Count > 0)
                {
                    decimal __totalCancelBill = 0M;
                    __y += this._printSlipText(__g, __width, __width, 50, __y, "บิลยกเลิก :", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);

                    for (int __row = 0; __row < __cancelDataTable.Rows.Count; __row++)
                    {
                        string __cancelDocNo = __cancelDataTable.Rows[__row][_g.d.pos_settle_bill_cancel._ref_doc_no].ToString();
                        string __cancelDocRef = __cancelDataTable.Rows[__row][_g.d.pos_settle_bill_cancel._invoice_doc_no].ToString();
                        decimal __cancelAmount = MyLib._myGlobal._decimalPhase(__cancelDataTable.Rows[__row][_g.d.pos_settle_bill_cancel._ref_amount].ToString());

                        __lineHeightTmp = this._printSlipText(__g, __width, __width, 0, __y, __cancelDocNo, new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                        this._printSlipText(__g, __width, __width, 0, __y, __cancelAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                        __y += __lineHeightTmp;
                        __totalCancelBill += __cancelAmount;

                    }
                    __y += this._printSlipText(__g, __width, __width, 0, __y, "----------------------", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);

                    __lineHeightTmp = this._printSlipText(__g, __width, __width, 0, __y, "รวมยกเลิก", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                    this._printSlipText(__g, __width, __width, 0, __y, __totalCancelBill.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                    __y += __lineHeightTmp;

                    __y += this._printSlipText(__g, __width, __width, 0, __y, "----------------------", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);

                }
                #endregion

                #region Discount
                if (__discountDataTable.Rows.Count > 0)
                {
                    decimal __totalDiscountBill = 0M;
                    __y += this._printSlipText(__g, __width, __width, 50, __y, "บิลลดราคา :", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);

                    for (int __row = 0; __row < __discountDataTable.Rows.Count; __row++)
                    {
                        string __discountDocNo = __discountDataTable.Rows[__row][_g.d.pos_settle_bill_discount._ref_doc_no].ToString();
                        decimal __discountAmount = MyLib._myGlobal._decimalPhase(__discountDataTable.Rows[__row][_g.d.pos_settle_bill_discount._discount_amount].ToString()) + MyLib._myGlobal._decimalPhase(__discountDataTable.Rows[__row][_g.d.pos_settle_bill_discount._discount_item].ToString());

                        __lineHeightTmp = this._printSlipText(__g, __width, __width, 0, __y, __discountDocNo, new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                        this._printSlipText(__g, __width, __width, 0, __y, __discountAmount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                        __y += __lineHeightTmp;
                        __totalDiscountBill += __discountAmount;

                    }
                    __y += this._printSlipText(__g, __width, __width, 0, __y, "----------------------", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);

                    __lineHeightTmp = this._printSlipText(__g, __width, __width, 0, __y, "รวมลด", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                    this._printSlipText(__g, __width, __width, 0, __y, __totalDiscountBill.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                    __y += __lineHeightTmp;

                    __y += this._printSlipText(__g, __width, __width, 0, __y, "----------------------", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);

                }
                #endregion
            }

            // ยอดเงิน
            __y += this._printSlipText(__g, __width, __width, 50, __y, "สรุปยอดเงินสดในลิ้นชัก :", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);

            __lineHeightTmp = this._printSlipText(__g, __width, __width, 0, __y, "เงินทอน", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, __totalIn.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __lineHeightTmp;

            //__cashSummary += (-1 * __diff_amount); // เอาผลต่างมารวมด้วย

            __lineHeightTmp = this._printSlipText(__g, __width, __width, 0, __y, "รับจากการขาย", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, __cashSummary.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __lineHeightTmp;

            __lineHeightTmp = this._printSlipText(__g, __width, __width, 0, __y, "นำเงินสดออก", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, __totalCashOutSummary.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __lineHeightTmp;

            __y += this._printSlipText(__g, __width, __width, 0, __y, "----------------------", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);

            __lineHeightTmp = this._printSlipText(__g, __width, __width, 0, __y, "เงินคงเหลือในลิ้นชัก", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, __totalInCashDrawer.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __lineHeightTmp;

            __y += this._printSlipText(__g, __width, __width, 0, __y, "----------------------", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);

            // สรุปยอดส่งเงิน
            __y += this._printSlipText(__g, __width, __width, 50, __y, "สรุปยอดส่งเงิน :", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);

            __lineHeightTmp = this._printSlipText(__g, __width, __width, 0, __y, "เงินสด", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, __totalOut.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __lineHeightTmp;

            __lineHeightTmp = this._printSlipText(__g, __width, __width, 0, __y, "เครดิตการ์ด", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, __totalCardOut.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __lineHeightTmp;

            __lineHeightTmp = this._printSlipText(__g, __width, __width, 0, __y, "คูปอง", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, __totalCouponOut.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __lineHeightTmp;

            __y += this._printSlipText(__g, __width, __width, 0, __y, "----------------------", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);

            __lineHeightTmp = this._printSlipText(__g, __width, __width, 0, __y, "รวมมูลค่านำส่ง", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, __sumSendMoney.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __lineHeightTmp;

            __y += this._printSlipText(__g, __width, __width, 0, __y, "----------------------", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);

            if (this._pos_send_deposit_money == true)
            {
                __y += this._printSlipText(__g, __width, __width, 50, __y, "สรุปยอดส่งเงินมัดจำ :", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);

                decimal __deposit_cash_money = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.POSCashierSettle._deposit_cash_amount].ToString());
                decimal __deposit_card_money = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.POSCashierSettle._deposit_credit_amount].ToString());

                __lineHeightTmp = this._printSlipText(__g, __width, __width, 0, __y, "ยอดเงินสดเงินมัดจำ", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                this._printSlipText(__g, __width, __width, 0, __y, __deposit_cash_money.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                __y += __lineHeightTmp;

                __lineHeightTmp = this._printSlipText(__g, __width, __width, 0, __y, "ยอดบัตรเครดิตเงินมัดจำ", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                this._printSlipText(__g, __width, __width, 0, __y, __deposit_card_money.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                __y += __lineHeightTmp;

                __y += this._printSlipText(__g, __width, __width, 0, __y, "----------------------", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);

                __lineHeightTmp = this._printSlipText(__g, __width, __width, 0, __y, "รวมยอดนำส่งเงินมัดจำ", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                this._printSlipText(__g, __width, __width, 0, __y, (__deposit_cash_money + __deposit_card_money).ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                __y += __lineHeightTmp;

                __y += this._printSlipText(__g, __width, __width, 0, __y, "----------------------", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);

                decimal __deposit_return_cash_money = MyLib._myGlobal._decimalPhase(__trans.Rows[0][_g.d.POSCashierSettle._deposit_return_cash_amount].ToString());

                __lineHeightTmp = this._printSlipText(__g, __width, __width, 0, __y, "ยอดคืนเงินมัดจำ", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                this._printSlipText(__g, __width, __width, 0, __y, __deposit_return_cash_money.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                __y += __lineHeightTmp;

                __y += this._printSlipText(__g, __width, __width, 0, __y, "----------------------", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);

            }


            // สรุปยอดเงินคงเหลือในลิ้นชัก

            decimal __nextCash = __totalInCashDrawer - __totalOut;
            decimal __nextCoupon = __totalCoupon - __totalCouponOut;
            decimal __nextCreditCard = __totalCreditCard - __totalCardOut;

            __y += this._printSlipText(__g, __width, __width, 50, __y, "สรุปยอดเงินคงเหลือในลิ้นชัก :", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            __lineHeightTmp = this._printSlipText(__g, __width, __width, 0, __y, "เงินสด", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, __nextCash.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __lineHeightTmp;

            __lineHeightTmp = this._printSlipText(__g, __width, __width, 0, __y, "เครดิตการ์ด", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, __nextCreditCard.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __lineHeightTmp;

            __lineHeightTmp = this._printSlipText(__g, __width, __width, 0, __y, "คูปอง", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, __nextCoupon.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __lineHeightTmp;

            __y += this._printSlipText(__g, __width, __width, 0, __y, "----------------------", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);

            // บิลขาย
            __y += this._printSlipText(__g, __width, __width, 50, __y, "เลขที่ใบเสร็จ :", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);

            __lineHeightTmp = __lineHeightTmp = this._printSlipText(__g, __width, __width, 0, __y, "เลขที่ใบเสร็จเริ่มต้น", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, __invoice.Rows[0]["_begin_invoice"].ToString(), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __lineHeightTmp;

            __lineHeightTmp = this._printSlipText(__g, __width, __width, 0, __y, "เลขที่ใบเสร็จสุดท้าย", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, __invoice.Rows[0]["_end_invoice"].ToString(), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __lineHeightTmp;

            __lineHeightTmp = this._printSlipText(__g, __width, __width, 0, __y, "จำนวนบิลขายทั้งหมด", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, __invoiceCount.ToString(), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __lineHeightTmp;

            // _invoice_cash_count 
            int __invoiceCashCount = (int)MyLib._myGlobal._decimalPhase(__invoice.Rows[0]["_invoice_cash_count"].ToString());
            __lineHeightTmp = this._printSlipText(__g, __width, __width, 0, __y, "จำนวนบิลขายสด", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, __invoiceCashCount.ToString(), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __lineHeightTmp;

            // _invoice_credit_count
            int __invoiceCreditCount = (int)MyLib._myGlobal._decimalPhase(__invoice.Rows[0]["_invoice_credit_count"].ToString());
            __lineHeightTmp = this._printSlipText(__g, __width, __width, 0, __y, "จำนวนบิลขายเชื่อ", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, __invoiceCreditCount.ToString(), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __lineHeightTmp;

            __lineHeightTmp = this._printSlipText(__g, __width, __width, 0, __y, "เฉลี่ยขายต่อบิล", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
            this._printSlipText(__g, __width, __width, 0, __y, __averateInvoice.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
            __y += __lineHeightTmp;

            __y += this._printSlipText(__g, __width, __width, 0, __y, "----------------------", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);

            // เอกสารยกเลิก
            if (!__invoice.Rows[0]["_begin_cn"].ToString().Equals(""))
            {
                __lineHeightTmp = this._printSlipText(__g, __width, __width, 0, __y, "เลขที่ใบรับคืนเริ่มต้น", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                this._printSlipText(__g, __width, __width, 0, __y, __invoice.Rows[0]["_begin_cn"].ToString(), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                __y += __lineHeightTmp;

                __lineHeightTmp = this._printSlipText(__g, __width, __width, 0, __y, "เลขที่ใบรับคืนสุดท้าย", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                this._printSlipText(__g, __width, __width, 0, __y, __invoice.Rows[0]["_end_cn"].ToString(), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                __y += __lineHeightTmp;

                __y += this._printSlipText(__g, __width, __width, 0, __y, "----------------------", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);

            }

            if (this._print_sale_daily_item)
            {
                // ยอดเงิน
                __y += this._printSlipText(__g, __width, __width, 50, __y, "สรุปรายกายขายสินค้า :", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);

                // รายละเอียดสินค้า
                for (int __row = 0; __row < __saleDetail.Rows.Count; __row++)
                {
                    //__content.Append(_getTextLine(__dt1.Rows[__row][_g.d.ic_trans_detail._item_code].ToString(), MyLib._myGlobal._decimalPhase(__dt1.Rows[__row][_g.d.ic_trans_detail._qty].ToString()), "left"));
                    //__content.Append(_getTextLine(__dt1.Rows[__row][_g.d.ic_trans_detail._item_name].ToString(), MyLib._myGlobal._decimalPhase(__dt1.Rows[__row][_g.d.ic_trans_detail._sum_amount].ToString())));

                    //  รหัสสินค้า 60% จำนวน 40%
                    __lineHeightTmp = this._printSlipText(__g, __width, __width * 0.6f, 0, __y, __saleDetail.Rows[__row][_g.d.ic_trans_detail._item_code].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                    this._printSlipText(__g, __width * 0.8f, __width * 0.8f, 0, __y, MyLib._myGlobal._decimalPhase(__saleDetail.Rows[__row][_g.d.ic_trans_detail._qty].ToString()).ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                    __y += __lineHeightTmp;

                    // ชื่อ 80% ราคา 20%
                    __lineHeightTmp = this._printSlipText(__g, __width, __width * 0.8f, 0, __y, __saleDetail.Rows[__row][_g.d.ic_trans_detail._item_name].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                    this._printSlipText(__g, __width, __width, 0, __y, MyLib._myGlobal._decimalPhase(__saleDetail.Rows[__row][_g.d.ic_trans_detail._sum_amount].ToString()).ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);

                    __y += __lineHeightTmp;
                }

                __y += 20;
                __y += this._printSlipText(__g, __width, __width, 0, __y, "----------------------", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                // รวม
                //__content.Append(_getTextLine("รวม", MyLib._myGlobal._decimalPhase(__dt2.Rows[0][_g.d.ic_trans_detail._qty].ToString()), "left")); // รวมจำนวน
                //__content.Append(_getTextLine("", MyLib._myGlobal._decimalPhase(__dt2.Rows[0][_g.d.ic_trans_detail._sum_amount].ToString()))); // รวมราคา
                __lineHeightTmp = this._printSlipText(__g, __width, __width * 0.6f, 0, __y, "รวม", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, true);
                this._printSlipText(__g, __width * 0.8f, __width * 0.8f, 0, __y, MyLib._myGlobal._decimalPhase(__saleSum.Rows[0][_g.d.ic_trans_detail._qty].ToString()).ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, false);
                __y += __lineHeightTmp;

                //this._printSlipText(__g, __width - 15, __width - 10, 0, __y, __amount.ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Right, false);
                __y += this._printSlipText(__g, __width, __width, 0, __y, MyLib._myGlobal._decimalPhase(__saleSum.Rows[0][_g.d.ic_trans_detail._sum_amount].ToString()).ToString(this._formatNumber1), new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Right, true);
                __y += this._printSlipText(__g, __width, __width, 0, __y, "----------------------", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);

            }


            // remark
            if (__trans.Rows[0][_g.d.POSCashierSettle._remark].ToString().Length > 0)
            {
                __y += 15;
                __y += this._printSlipText(__g, __width, __width, 0, __y, "หมายเหตุ ", new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, false);
                __y += this._printSlipText(__g, __width, __width, 0, __y, __trans.Rows[0][_g.d.POSCashierSettle._remark].ToString(), new Font(this._fontDetailName, this._fontDetailSize), SMLPOSControl._printSlipTextStyle.Left, true);
                __y += 15;
            }

            if (this._no_remark_sendmoney == false)
            {
                __y += this._printSlipLine(__g, __width, __y);
                __y += 150;
                __y += this._printSlipText(__g, __width, __width, 10, __y, "แคชเชียร์ :", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                __y += 150;
                __y += this._printSlipLine(__g, __width, __y);
                __y += 150;
                __y += this._printSlipText(__g, __width, __width, 10, __y, "ผู้ตรวจ :", new Font(this._fontDetailName, this._fontDetailSize, FontStyle.Bold), SMLPOSControl._printSlipTextStyle.Left, false);
                __y += 150;
                __y += this._printSlipLine(__g, __width, __y);

            }

            return __y;
        }

        #endregion

        #region พิมพ์ฉลากยา

        void _printDrugLabel()
        {
            _printDrugLabel(true);
        }

        void _printDrugLabel(Boolean _isPreview)
        {
            if (_isPreview == false && this._labelPrinterName.Length == 0)
            {
                MessageBox.Show("กรุณากำหนดเครื่องพิมพ์ฉลากยา", "Warning", MessageBoxButtons.OK, MessageBoxIcon.Error);
                return;
            }
            if (_labelConfig != null)
            {
                // print Label
                PrintDocument __labelPrint = new PrintDocument();
                __labelPrint.PrintPage += new PrintPageEventHandler(__labelPrint_PrintPage);
                __labelPrint.BeginPrint += (s1, e1) =>
                {
                    _printLabelIndex = 0;

                    // 
                    PrintDocument __printPage = (PrintDocument)s1;
                    __printPage.DefaultPageSettings.PrinterSettings.PrinterName = this._labelPrinterName;
                    __printPage.DefaultPageSettings.PaperSize = new PaperSize("Customer", (int)_labelConfig._labelWidth, (int)_labelConfig._lableHeight);
                    __printPage.DefaultPageSettings.Margins = new Margins(0, 0, 0, 0);

                    // printer name

                };

                if (_isPreview)
                {
                    // ถ้ามี configLabel สั่งพิมพ์ได้ 
                    PrintPreviewDialog __dialog = new PrintPreviewDialog();
                    __dialog.Document = __labelPrint;
                    __dialog.ShowDialog(MyLib._myGlobal._mainForm);
                }
                else
                {
                    __labelPrint.Print();
                }
            }
            else
            {
                // print dialog
            }

        }

        private _labelPrintClass _getLabelPrint()
        {
            string __labelPrintFileName = string.Format(MyLib._myGlobal._smlConfigFile + "_labelPrint-{0}-{1}-{2}.xml", MyLib._myGlobal._encapeStringForFilePath(MyLib._myGlobal._getFirstWebServiceServer), MyLib._myGlobal._providerCode, MyLib._myGlobal._databaseName);

            _labelPrintClass __labelPrint = null;

            // load จากเครื่อง ดูก่อน 
            try
            {
                TextReader readFile = new StreamReader(__labelPrintFileName);
                XmlSerializer __xsLoad = new XmlSerializer(typeof(_labelPrintClass));
                __labelPrint = (_labelPrintClass)__xsLoad.Deserialize(readFile);
                readFile.Close();

            }
            catch
            {

            }

            if (__labelPrint != null)
            {
                return __labelPrint;
            }

            __labelPrint = new _labelPrintClass();

            // logo
            __labelPrint._drawObject.Add(new _labelPrintObject() { _objectType = _labelObjectType.Image, _xPos = 10, _yPos = 10, _text = @"c:\smlsoft\logopos.jpg", _objectWidth = 100, _objectHeight = 20 });

            // พิพม์บริษัท
            __labelPrint._drawObject.Add(new _labelPrintObject() { _objectType = _labelObjectType.Text, _xPos = 10, _yPos = 30, _text = "&ltdName&", _fontSet = _labelFontSet.Header });
            __labelPrint._drawObject.Add(new _labelPrintObject() { _objectType = _labelObjectType.Text, _xPos = 10, _yPos = 50, _text = "&ltdAddress&", _fontSet = _labelFontSet.Header });

            ////สมาชิก
            __labelPrint._drawObject.Add(new _labelPrintObject() { _objectType = _labelObjectType.Text, _xPos = 10, _yPos = 90, _text = "&custCode& &custName&" });

            // สินค้า
            __labelPrint._drawObject.Add(new _labelPrintObject() { _objectType = _labelObjectType.Text, _xPos = 10, _yPos = 110, _text = "&itemName&", });
            __labelPrint._drawObject.Add(new _labelPrintObject() { _objectType = _labelObjectType.Text, _xPos = 10, _yPos = 150, _text = "&m_dozen&", });
            __labelPrint._drawObject.Add(new _labelPrintObject() { _objectType = _labelObjectType.Text, _xPos = 10, _yPos = 170, _text = "&m_times&", });
            __labelPrint._drawObject.Add(new _labelPrintObject() { _objectType = _labelObjectType.Text, _xPos = 10, _yPos = 190, _text = "&m_frequency&", });
            __labelPrint._drawObject.Add(new _labelPrintObject() { _objectType = _labelObjectType.Text, _xPos = 10, _yPos = 210, _text = "&m_warning&", });
            __labelPrint._drawObject.Add(new _labelPrintObject() { _objectType = _labelObjectType.Text, _xPos = 10, _yPos = 230, _text = "&m_remark&", });

            // วันที่จ่ายยา
            __labelPrint._drawObject.Add(new _labelPrintObject() { _objectType = _labelObjectType.Text, _xPos = 300, _yPos = 30, _text = "&datetime&", _format = "d MMMM yyyy" });

            // ผู้สั่งจ่าย
            __labelPrint._drawObject.Add(new _labelPrintObject() { _objectType = _labelObjectType.Text, _xPos = 300, _yPos = 50, _text = "&saleName&", });

            // barcode
            __labelPrint._drawObject.Add(new _labelPrintObject() { _objectType = _labelObjectType.Barcode, _xPos = 300, _yPos = 70, _text = "&qty&*&barcode&", _objectWidth = 180, _objectHeight = 50 });

            // write to local drive foredit
            XmlSerializer __colXs = new XmlSerializer(typeof(_labelPrintClass));
            TextWriter __memoryStream = new StreamWriter(__labelPrintFileName, false, Encoding.UTF8);
            __colXs.Serialize(__memoryStream, __labelPrint);
            __memoryStream.Close();

            return __labelPrint;
        }

        int _printLabelIndex = 0;
        void __labelPrint_PrintPage(object sender, PrintPageEventArgs e)
        {

            // check default labelconfig 
            _labelPrintClass __labelPrint = _getLabelPrint();

            string __ltdName = "";
            string __ltdAddress = "";

            if (MyLib._myGlobal._ltdName != null)
            {
                __ltdName = MyLib._myGlobal._ltdName;
                __ltdAddress = MyLib._myGlobal._ltdAddress;
            }
            else
            {
                __ltdName = "Company Name";
                __ltdAddress = "Company Address";
            }
            // gen print
            try
            {
                _posClientItemClass __item = _itemList[_printLabelIndex];

                foreach (_labelPrintObject __obj in __labelPrint._drawObject)
                {
                    if (__obj._objectType == _labelObjectType.Barcode)
                    {
                        if (this._useBarcodeFont)
                        {
                            // พิมพ์ barcode โดยใช้ font จาก printer 
                            string __fontName = (__obj._fontName.Trim().Length > 0) ? __obj._fontName : this._labelBarCodeFontName;
                            float __fontSize = (__obj._fontSize > 0) ? __obj._fontSize : this._labelBarCodeFotnSize;

                            Font __objFont = new Font(__fontName, __fontSize);
                            string __strValue = __obj._text.Replace("&qty&", __item._qty.ToString()).Replace("&barcode&", __item._barCode);
                            float __labelWidth = (__obj._objectWidth == -1) ? _labelConfig._labelWidth : __obj._objectWidth;
                            if (__strValue.Trim().Length > 0)
                            {
                                // draw it
                                this._printSlipText(e.Graphics, _labelConfig._labelWidth, __labelWidth, __obj._xPos, __obj._yPos, __strValue, __objFont, __obj._textAlign, __obj._wrapText);
                            }
                        }
                        else
                        {
                            string __strValue = __obj._text.Replace("&qty&", __item._qty.ToString()).Replace("&barcode&", __item._barCode);
                            SMLBarcodeManage._createCode39 __code39 = new SMLBarcodeManage._createCode39();
                            e.Graphics.DrawImage(__code39._createBarCode(__strValue), __obj._xPos, __obj._yPos, __obj._objectWidth, __obj._objectHeight);
                        }
                    }
                    else if (__obj._objectType == _labelObjectType.Text)
                    {
                        string __fontName = (__obj._fontSet == _labelFontSet.Header) ? ((__obj._fontName.Trim().Length > 0) ? __obj._fontName : this._labelHeaderFontName) : ((__obj._fontName.Trim().Length > 0) ? __obj._fontName : this._labelDetailFontName);
                        float __fontSize = (__obj._fontSet == _labelFontSet.Header) ? ((__obj._fontSize > 0) ? __obj._fontSize : this._labelHeaderFotnSize) : ((__obj._fontSize > 0) ? __obj._fontSize : this._labelDetailFotnSize);

                        string __strValue = __obj._text.Replace("&ltdName&", __ltdName).Replace("&ltdAddress&", MyLib._myGlobal._ltdAddress).Replace("&custCode&", this._custCode).Replace("&custName&", this._custName).Replace("&itemName&", __item._itemName).Replace("&m_dozen&", __item._m_dozen).Replace("&m_times&", __item._m_times).Replace("&m_frequency&", __item._m_frequency).Replace("&m_warning&", __item._m_warning).Replace("&m_remark&", __item._m_remark).Replace("&datetime&", ((__obj._format.Equals("")) ? DateTime.Now.ToString() : DateTime.Now.ToString(__obj._format))).Replace("&saleName&", this._saleName).Replace("&qty&", ((__obj._format.Equals("")) ? __item._qty.ToString() : __item._qty.ToString(__obj._format))).Replace("&barcode&", __item._barCode);

                        Font __objFont = new Font(__fontName, __fontSize);

                        float __labelWidth = (__obj._objectWidth == -1) ? _labelConfig._labelWidth : __obj._objectWidth;
                        //float __labelHeight = (__obj._objectHeight == -1) ? _labelConfig._lableHeight : __obj._objectHeight;
                        if (__strValue.Trim().Length > 0)
                        {
                            // draw it
                            this._printSlipText(e.Graphics, _labelConfig._labelWidth, __labelWidth, __obj._xPos, __obj._yPos, __strValue, __objFont, __obj._textAlign, __obj._wrapText);
                        }
                    }
                    else if (__obj._objectType == _labelObjectType.Image)
                    {
                        // check exists image ถ้าไม่มี ไม่ต้องพิมพ์
                        Boolean __haveLogo = false;
                        if (File.Exists(__obj._text))
                        {
                            __haveLogo = true;
                            Image __logo = Image.FromFile(__obj._text);
                            e.Graphics.DrawImage(__logo, __obj._xPos, __obj._yPos, __obj._objectWidth, __obj._objectHeight);

                        }

                    }

                }
            }
            catch (Exception ex)
            {
                string __exstr = ex.ToString();
            }

            _printLabelIndex++;
            if (_printLabelIndex < _itemList.Count)
            {
                e.HasMorePages = true;
            }
            else
            {
                e.HasMorePages = false;
            }
        }

        #endregion

        #endregion

        #region POS Utility

        #region USBCR

        //declare usbcr.dll thingies here
        [DllImport("usbcr.dll", EntryPoint = "OpenUSB")]
        private static extern int OpenUSB();

        [DllImport("usbcr.dll", EntryPoint = "CloseUSB")]
        private static extern int CloseUSB();

        [DllImport("usbcr.dll", EntryPoint = "DrawerOpen")]
        private static extern int DrawerOpen(int n);

        [DllImport("usbcr.dll", EntryPoint = "DrawerState")]
        private static extern int DrawerState(int n);

        // old version
        [DllImport("usbcr.dll", EntryPoint = "OpenUSBcr")]
        private static extern int OpenUSBcr();

        [DllImport("usbcr.dll", EntryPoint = "CloseUSBcr")]
        private static extern int CloseUSBcr();

        #endregion

        #region FRIUSB

        [DllImport("FIRIDLLU.dll", EntryPoint = "InitFRIUSBLibrary")]
        private static extern void InitFRIUSBLibrary();

        [DllImport("FIRIDLLU.dll", EntryPoint = "CloseFRIUSBLibrary")]
        private static extern void CloseFRIUSBLibrary();

        [DllImport("FIRIDLLU.dll", EntryPoint = "GetDeviceNumber")]
        private static extern int GetDeviceNumber();

        [DllImport("FIRIDLLU.dll", EntryPoint = "OpenFRIDoor")]
        private static extern int OpenFRIDoor();

        [DllImport("FIRIDLLU.dll", EntryPoint = "GetFRIDoorStatus")]
        private static extern int GetFRIDoorStatus();

        #endregion


        void _openCashDrawer()
        {
            try
            {
                if (this._posConfig._useCashDrawer.Equals("1"))
                {
                    if (this._posConfig._cashDrawerPort != null && this._posConfig._cashDrawerPort.Length > 0)
                    {
                        if (this._posConfig._cashDrawerPort.ToLower().Equals("usbcr"))
                        {
                            try
                            {
                                int __draw_id = int.Parse(this._posConfig._drawerCodes.Trim());
                                if (OpenUSB() == 0)
                                {
                                    DrawerOpen(__draw_id);
                                    CloseUSB();
                                }

                            }
                            catch
                            {
                                try
                                {
                                    int __draw_id = int.Parse(this._posConfig._drawerCodes.Trim());
                                    if (OpenUSBcr() == 0)
                                    {
                                        DrawerOpen(__draw_id);
                                        CloseUSBcr();
                                    }

                                }
                                catch
                                {
                                }

                            }
                        }
                        else if (this._posConfig._cashDrawerPort.ToLower().Equals("friusb"))
                        {
                            try
                            {
                                InitFRIUSBLibrary();
                                int __openStaus = OpenFRIDoor();
                                CloseFRIUSBLibrary();
                            }
                            catch
                            {
                            }
                        }
                        else
                        {

                            try
                            {
                                SerialPort __sp = new SerialPort(this._posConfig._cashDrawerPort, 9600, Parity.None, 8, StopBits.One);
                                __sp.Open();

                                byte[] __send = { 7 };

                                if (this._posConfig._drawerCodes.Equals("\\07"))
                                {
                                    __sp.Write("\07");
                                }
                                else
                                {
                                    __sp.Write(__send, 0, 1);
                                }
                                __sp.Close();
                            }
                            catch
                            {
                            }
                        }
                    }
                    else
                    {
                        // ไม่ใส่ port ถือว่าให้ส่งไปหา printer

                        byte[] __kickDrawerCommand = null;
                        if (this._posConfig._drawerCodes.Trim().Length > 0)
                        {
                            string[] __command = this._posConfig._drawerCodes.Trim().Replace(" ", "").Split(',');
                            __kickDrawerCommand = new byte[__command.Length];
                            for (int __loop = 0; __loop < __command.Length; __loop++)
                            {
                                __kickDrawerCommand[__loop] = (byte)MyLib._myGlobal._decimalPhase(__command[__loop]);
                            }
                        }
                        try
                        {
                            switch (this._posConfig._print_method)
                            {
                                case 0: // Raw Printer
                                    {
                                        MyLib._printRaw __pd = new _printRaw(-1);
                                        if (__kickDrawerCommand == null)
                                        {
                                            __pd._print(this._posConfig._pos_printer_name, new byte[] { 27, 112, 0 }); // kick
                                            __pd._print(this._posConfig._pos_printer_name, new byte[] { 27, 112, 1 }); // kick
                                        }
                                        else
                                        {
                                            __pd._print(this._posConfig._pos_printer_name, __kickDrawerCommand);
                                        }
                                    }
                                    break;
                                case 1: // Raw Printer
                                    {
                                        MyLib._printRaw __pd = new _printRaw(-1);
                                        if (__kickDrawerCommand == null)
                                        {
                                            __pd._print(this._posConfig._pos_printer_name, new byte[] { 27, 112, 0 }); // kick
                                            __pd._print(this._posConfig._pos_printer_name, new byte[] { 27, 112, 1 }); // kick
                                        }
                                        else
                                        {
                                            __pd._print(this._posConfig._pos_printer_name, __kickDrawerCommand);
                                        }
                                    }
                                    break;
                                case 2: // TCP/IP
                                    {
                                        IPEndPoint __ip = new IPEndPoint(IPAddress.Parse(this._posConfig._printerPort), 9100);
                                        Socket __socket = new Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);
                                        __socket.Connect(__ip);
                                        if (__kickDrawerCommand == null)
                                        {
                                            __socket.Send(new byte[] { 27, 112, 0 }); // Kick
                                            __socket.Send(new byte[] { 27, 112, 1 }); // Kick
                                        }
                                        else
                                        {
                                            __socket.Send(__kickDrawerCommand);
                                        }
                                        __socket.Shutdown(SocketShutdown.Both);
                                        __socket.Close();
                                    }
                                    break;
                            }
                        }
                        catch
                        {
                        }
                    }
                }
            }
            catch
            {
            }
        }

        void _save_eJournal(string docNo, Bitmap source, int width, int height)
        {
            if (this._pos_eJournal == 1)
            {
                try
                {
                    Bitmap __newBitmap = new Bitmap(width, height);
                    Graphics _newGraphic = Graphics.FromImage(__newBitmap);
                    _newGraphic.DrawImage(source, 0, 0, source.Width, source.Height);
                    string __folder = @"c:\smlsoft\ejournal";
                    //เอาเข้า database 
                    try
                    {
                        System.IO.Directory.CreateDirectory(@"c:\smlsoft");
                        System.IO.Directory.CreateDirectory(__folder);
                    }
                    catch
                    {
                    }
                    // ไม่มีการทับ
                    string __fileName = __folder + "\\" + docNo + ".jpg";
                    int __running = 1;
                    while (File.Exists(__fileName))
                    {
                        __fileName = __folder + "\\" + docNo + "-" + __running.ToString() + ".jpg";
                        __running++;
                    }
                    __newBitmap.Save(__fileName, System.Drawing.Imaging.ImageFormat.Jpeg);
                }
                catch
                {
                }
            }
        }

        void _playSound(string fileName)
        {
            if (this._autoInsertItem == false)
            {
                if (File.Exists(fileName))
                {
                    SoundPlayer __sound = new SoundPlayer(fileName);
                    __sound.Play();
                }
            }
        }

        public void _writeDisplay(string Line1, string Line2, string align1, string align2)
        {
            _writeDisplay(Line1, Line2, align1, align2, this._posConfig._customer_display_linecount);
        }

        SerialPort _customerDisplayPort;
        public void _writeDisplay(string Line1, string Line2, string align1, string align2, int lineLenght)
        {
            if (this._posConfig._use_customer_display == true)
            {
                try
                {
                    if (_customerDisplayPort == null)
                    {
                        _customerDisplayPort = new SerialPort(this._posConfig._customer_display_port, int.Parse(this._posConfig._customer_display_baudrate), this._posConfig._customer_display_parity, int.Parse(this._posConfig._customer_display_databits), this._posConfig._customer_display_stopbits);
                        _customerDisplayPort.Open();
                    }

                    if (_customerDisplayPort != null && _customerDisplayPort.IsOpen == false)
                    {
                        _customerDisplayPort.Open();
                    }

                    _customerDisplayPort.Write(new byte[] { 12 }, 0, 1);

                    if (Line1.Length > 0)
                    {
                        if (align1 == "c")
                        {
                            int __startIndex = ((lineLenght - Line1.Length) / 2);
                            for (int __i = 0; __i < __startIndex; __i++)
                                _customerDisplayPort.Write(new byte[] { 9 }, 0, 1);
                            //__port.Write(new byte[] { 9 }, 0, 1);
                        }
                        else if (align1 == "r")
                        {
                            int __startIndex = ((lineLenght - Line1.Length));
                            for (int __i = 0; __i < __startIndex; __i++)
                                _customerDisplayPort.Write(new byte[] { 9 }, 0, 1);
                            //__port.Write(new byte[] { 9 }, 0, 1);
                        }
                        _customerDisplayPort.Write(Line1);
                    }

                    if (Line2.Length > 0)
                    {
                        // backto home
                        _customerDisplayPort.Write(new byte[] { 11 }, 0, 1);
                        // move down
                        _customerDisplayPort.Write(new byte[] { 10 }, 0, 1);
                        // back to left
                        _customerDisplayPort.Write(new byte[] { 13 }, 0, 1);

                        if (align2 == "c")
                        {
                            int __startIndex = ((lineLenght - Line2.Length) / 2);
                            for (int __i = 0; __i < __startIndex; __i++)
                                _customerDisplayPort.Write(new byte[] { 9 }, 0, 1);

                        }
                        else if (align2 == "r")
                        {
                            int __startIndex = ((lineLenght - Line2.Length));
                            for (int __i = 0; __i < __startIndex; __i++)
                                _customerDisplayPort.Write(new byte[] { 9 }, 0, 1);
                        }
                        _customerDisplayPort.Write(Line2);
                    }

                    //_customerDisplayPort.Close();
                }
                catch (Exception ex)
                {
                    //MessageBox.Show(ex.ToString());
                    MyLib._myGlobal._writeEventLog(ex.Message.ToString(), "SML Write Customer Display");
                }
            }
        }

        #endregion

        #region Print Tools Function

        float _printSlipLine(Graphics g, float paperWidth, float y)
        {
            if ((this._isScreenCloseTable == true && this._orderDeviceConfig._is_dot_printer == false) || (this._posConfig._printerType != null && this._posConfig._printerType.Equals("1")))
            {
                g.DrawLine(new Pen(Brushes.Black), 0, y + 2, paperWidth, y + 2);
            }
            return 4;
        }

        float _printSlipLine(Graphics g, float paperWidth, float y, float penWidth)
        {
            if ((this._isScreenCloseTable == true && this._orderDeviceConfig._is_dot_printer == false) || (this._posConfig._printerType != null && this._posConfig._printerType.Equals("1")))
            {
                g.DrawLine(new Pen(Brushes.Black, penWidth), 0, y + 2, paperWidth, y + 2);
            }
            return 4;
        }

        float _printSlipText(Graphics g, float paperWidth, float textWidth, float x, float y, string text, Font textFont, SMLPOSControl._printSlipTextStyle style, Boolean warpString)
        {
            return _printSlipText(g, paperWidth, textWidth, x, y, text, textFont, style, warpString, false);
        }

        float _printSlipText(Graphics g, float paperWidth, float textWidth, float x, float y, string text, Font textFont, SMLPOSControl._printSlipTextStyle style, Boolean warpString, Boolean trimMode)
        {
            return _printSlipText(g, paperWidth, textWidth, x, y, text, textFont, style, warpString, trimMode, -1);
        }

        float _printSlipText(Graphics g, float paperWidth, float textWidth, float x, float y, string text, Font textFont, SMLPOSControl._printSlipTextStyle style, Boolean warpString, Boolean trimMode, int maxLine)
        {
            float __x = x;
            float __sumHeight = 0;
            string[] __text = text.Trim().Split('\n');
            for (int __loop = 0; __loop < __text.Length; __loop++)
            {
                ArrayList __getText = new ArrayList();
                if (warpString)
                {
                    __getText = MyLib._myUtil._cutString(g, __text[__loop], textFont, textWidth);
                }
                else
                {
                    __getText.Add(__text[__loop]);
                }

                int __maxLine = (__getText.Count > maxLine && maxLine != -1) ? maxLine : __getText.Count;

                for (int __loop2 = 0; __loop2 < __maxLine; __loop2++)
                {
                    string __textLine = (trimMode == true) ? __getText[__loop2].ToString().Trim() : __getText[__loop2].ToString();

                    SizeF __size = g.MeasureString(__textLine, textFont);
                    switch (style)
                    {
                        case SMLPOSControl._printSlipTextStyle.Center:
                            __x = (paperWidth - __size.Width) / 2;
                            break;
                        case SMLPOSControl._printSlipTextStyle.Right:
                            __x = paperWidth - __size.Width;
                            break;
                    }
                    g.DrawString(__textLine, textFont, Brushes.Black, __x, y + __sumHeight);
                    __sumHeight += (__size.Height * 0.9f);
                }
            }
            return __sumHeight;
        }

        public Image _getBarcodeImage(string __CodeStr, Size __size, SMLReport._design._textAlign __barcodeAlign, SMLReport._design._barcodeType __type, bool __showlabel, SMLReport._design._barcodeLabelPosition __labelPosition, Font __myFont, RotateFlipType __flipType, Color __foreColoe, Color __backColor)
        {
            Image __barcodeImage = new Bitmap(__size.Width, __size.Height);

            // alignment
            BarcodeLib.AlignmentPositions __alignMent = BarcodeLib.AlignmentPositions.CENTER;
            if (__barcodeAlign == SMLReport._design._textAlign.Left)
                __alignMent = BarcodeLib.AlignmentPositions.LEFT;
            if (__barcodeAlign == SMLReport._design._textAlign.Right)
                __alignMent = BarcodeLib.AlignmentPositions.RIGHT;

            // types
            BarcodeLib.TYPE __barcodeType = BarcodeLib.TYPE.UNSPECIFIED;
            switch (__type)
            {
                case SMLReport._design._barcodeType.BarCode_UPCA:
                    __barcodeType = BarcodeLib.TYPE.UPCA;
                    break;
                case SMLReport._design._barcodeType.BarCode_EAN13:
                    __barcodeType = BarcodeLib.TYPE.EAN13;
                    break;
                case SMLReport._design._barcodeType.BarCode_EAN8:
                    __barcodeType = BarcodeLib.TYPE.EAN8;
                    break;
                case SMLReport._design._barcodeType.BarCode_2Of5:
                    __barcodeType = BarcodeLib.TYPE.Standard2of5;
                    break;
                case SMLReport._design._barcodeType.BarCode_Code39:
                    __barcodeType = BarcodeLib.TYPE.CODE39;
                    break;
                case SMLReport._design._barcodeType.BarCode_Code128:
                    __barcodeType = BarcodeLib.TYPE.CODE128;
                    break;
            }

            BarcodeLib.Barcode __barcode = new BarcodeLib.Barcode();
            __barcode.IncludeLabel = __showlabel;
            __barcode.LabelFont = __myFont;
            __barcode.Alignment = __alignMent;
            __barcode.RotateFlipType = __flipType;

            // label alignment and position
            switch (__labelPosition)
            {
                case SMLReport._design._barcodeLabelPosition.BottomLeft: __barcode.LabelPosition = BarcodeLib.LabelPositions.BOTTOMLEFT; break;
                case SMLReport._design._barcodeLabelPosition.BottomRight: __barcode.LabelPosition = BarcodeLib.LabelPositions.BOTTOMRIGHT; break;
                case SMLReport._design._barcodeLabelPosition.TopCenter: __barcode.LabelPosition = BarcodeLib.LabelPositions.TOPCENTER; break;
                case SMLReport._design._barcodeLabelPosition.TopLeft: __barcode.LabelPosition = BarcodeLib.LabelPositions.TOPLEFT; break;
                case SMLReport._design._barcodeLabelPosition.TopRight: __barcode.LabelPosition = BarcodeLib.LabelPositions.TOPRIGHT; break;
                default: __barcode.LabelPosition = BarcodeLib.LabelPositions.BOTTOMCENTER; break;
            }
            // switch

            try
            {
                __barcodeImage = __barcode.Encode(__barcodeType, __CodeStr, __foreColoe, __backColor, __size.Width, __size.Height);
            }
            catch
            {
            }
            return __barcodeImage;
        }

        #endregion

        #region POS Init Data

        private string _newKey()
        {
            StringBuilder builder = new StringBuilder();

            Random __ran = new Random();
            for (int i = 0; i < 12; i++)
            {
                int __number = __ran.Next(9) + 1;
                builder.Append(__number);
            }

            return builder.ToString();
        }

        void _loadMaster()
        {
            try
            {
                MyLib._myFrameWork __myFrameWork = new _myFrameWork();
                string __headerByPosID = "";
                // if demo config 
                //if (this._posConfig._posid.Equals("DEMOCONFIG"))
                // if demo config // เช็ค demo และ ไม่มี config
                if (MyLib._myGlobal._isDemo == true && System.IO.File.Exists(_configFileName) == false)
                {
                    this._posConfig._posid = "DEMO";
                    this._posDocFormat = "@-YYMM####";
                    this._posFillmoneyDocFormat = "@-ADYYMM####";
                    this._posSaveSendMoneyDocFormat = "@-TRYYMM####";
                    this._posFullDocFormat = "@-INVYYMM####";
                    this._posCancelDocFormat = "@-CNYYMM####";
                    this._posWareHouse = "01";
                    this._posLocation = "01";
                    this._posConfigNumber = 1;
                    this._posConfigPriceNumber = 1;
                    this._posConfigPriceNumber = 1;
                    this._posConfigSlipNumber = 0;

                }
                else
                {
                    if (this._posConfig._posid == null)
                    {
                        MessageBox.Show(MyLib._myGlobal._resource("ไม่พบรหัสเครื่อง POS"), MyLib._myGlobal._resource("warnning"), MessageBoxButtons.OK, MessageBoxIcon.Error);
                    }
                    else
                    {
                        // get pos_client config
                        DataTable __loadPostID = __myFrameWork._queryShort("select * from " + _g.d.POS_ID._table + " where " + MyLib._myGlobal._addUpper(_g.d.POS_ID._MACHINECODE) + "=\'" + this._posConfig._posid.ToUpper() + "\'").Tables[0];
                        if (__loadPostID.Rows.Count > 0)
                        {
                            this._posDocFormat = __loadPostID.Rows[0][_g.d.POS_ID._doc_format].ToString();
                            this._posFillmoneyDocFormat = __loadPostID.Rows[0][_g.d.POS_ID._doc_format_fillmoney].ToString();
                            this._posSaveSendMoneyDocFormat = __loadPostID.Rows[0][_g.d.POS_ID._doc_format_cashierSettle].ToString();
                            this._posFullDocFormat = __loadPostID.Rows[0][_g.d.POS_ID._doc_format_vat_full].ToString();
                            this._posCancelDocFormat = __loadPostID.Rows[0][_g.d.POS_ID._doc_format_cancel].ToString();
                            this._posWareHouse = __loadPostID.Rows[0][_g.d.POS_ID._pos_ic_wht].ToString();
                            this._posLocation = __loadPostID.Rows[0][_g.d.POS_ID._pos_ic_shelf].ToString();
                            this._posConfigNumber = (int)MyLib._myGlobal._decimalPhase(__loadPostID.Rows[0][_g.d.POS_ID._pos_config_number].ToString());
                            this._pos_eJournal = (int)MyLib._myGlobal._decimalPhase(__loadPostID.Rows[0][_g.d.POS_ID._pos_save_e_journal].ToString());
                            this._posConfigPriceNumber = (int)MyLib._myGlobal._decimalPhase(__loadPostID.Rows[0][_g.d.POS_ID._price_number].ToString());
                            this._posConfigSlipNumber = (int)MyLib._myGlobal._decimalPhase(__loadPostID.Rows[0][_g.d.POS_ID._slip_number].ToString());

                            this._posRunningDocFormat = __loadPostID.Rows[0][_g.d.POS_ID._doc_running_inv].ToString();
                            this._posRunningFillmoneyDocFormat = __loadPostID.Rows[0][_g.d.POS_ID._doc_running_fillmoney].ToString();
                            this._posRunningCancelDocFormat = __loadPostID.Rows[0][_g.d.POS_ID._doc_running_cancel].ToString();
                            this._posRunningFullDocFormat = __loadPostID.Rows[0][_g.d.POS_ID._doc_running_vat_full].ToString();
                            this._posRunningSaveSendMoneyDocFormat = __loadPostID.Rows[0][_g.d.POS_ID._doc_running_cashierSettle].ToString();
                            this._use_credit_sale = (__loadPostID.Rows[0][_g.d.POS_ID._use_credit_sale].ToString().Equals("1")) ? true : false;

                            this._show_order_detail = (__loadPostID.Rows[0][_g.d.POS_ID._show_order_detail].ToString().Equals("1")) ? true : false;
                            this._show_order_detail_copy_Only = (__loadPostID.Rows[0][_g.d.POS_ID._show_in_copy].ToString().Equals("1")) ? true : false;
                            this._no_remark_sendmoney = (__loadPostID.Rows[0][_g.d.POS_ID._no_remark_sendmoney].ToString().Equals("1")) ? true : false;

                            this._creditDocFormat = __loadPostID.Rows[0][_g.d.POS_ID._doc_format_credit].ToString();
                            this._creditRunningFormat = __loadPostID.Rows[0][_g.d.POS_ID._doc_running_credit].ToString();
                            this._doc_format_code_credit = __loadPostID.Rows[0][_g.d.POS_ID._doc_format_code_credit].ToString();

                            this._department_code = __loadPostID.Rows[0][_g.d.POS_ID._department_code].ToString();

                            try
                            {
                                this._pos_doc_format_code = __loadPostID.Rows[0][_g.d.POS_ID._doc_format_code].ToString();
                                this._doc_format_code_calcel = __loadPostID.Rows[0][_g.d.POS_ID._doc_format_code_doc_cancel].ToString();
                            }
                            catch
                            {
                            }

                            if (this._posConfigPriceNumber == 0)
                            {
                                this._posConfigPriceNumber = 1;
                            }

                            if (MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro)
                            {
                                this._closeTableSlipNumber = (int)MyLib._myGlobal._decimalPhase(__loadPostID.Rows[0][_g.d.POS_ID._close_form_number].ToString());
                            }

                            __headerByPosID = __loadPostID.Rows[0][_g.d.POS_ID._pos_header].ToString();
                            this._pos_type_invoice = (int)MyLib._myGlobal._decimalPhase(__loadPostID.Rows[0][_g.d.POS_ID._pos_type_invoice].ToString());
                        }
                        else
                        {
                            this._posConfigNumber = 0;
                            this._posConfigPriceNumber = 1;
                        }
                    }
                }

                this._loadPOSGlobalConfig();
                this._loadPromotion();

                if (__headerByPosID.Length > 0)
                {
                    this._posHeader = __headerByPosID;
                }

            }
            catch (Exception __ex)
            {
                MessageBox.Show(__ex.Message.ToString());
            }
        }

        private void _loadPOSGlobalConfig()
        {
            MyLib._myFrameWork __myFrameWork = new _myFrameWork();

            // get pos global config 
            StringBuilder __queryList = new StringBuilder();
            __queryList.Append(MyLib._myGlobal._xmlHeader + "<node>");
            string __query = "select * from " + _g.d.POSConfig._table;
            if (this._posConfigNumber != 0)
            {
                __query = __query + " where " + _g.d.POSConfig._pos_config_number + "=" + this._posConfigNumber.ToString();
            }
            __queryList.Append(MyLib._myUtil._convertTextToXmlForQuery(__query));
            __queryList.Append("</node>");
            ArrayList _getData = __myFrameWork._queryListGetData(MyLib._myGlobal._databaseName, __queryList.ToString());
            DataTable __posConfig = ((DataSet)_getData[0]).Tables[0];
            if (__posConfig.Rows.Count > 0)
            {
                this._posDefaultCust = __posConfig.Rows[0][_g.d.POSConfig._cust_code_default].ToString();
                this._posHeader = __posConfig.Rows[0][_g.d.POSConfig._pos_header].ToString();
                this._posFooter = __posConfig.Rows[0][_g.d.POSConfig._pos_footer].ToString();
                this._posChangeDiscount = (__posConfig.Rows[0][_g.d.POSConfig._pos_change_discount_config].ToString().Equals("1")) ? true : false;
                this._posChangePrice = (__posConfig.Rows[0][_g.d.POSConfig._pos_change_price_config].ToString().Equals("1")) ? true : false;
                this._posCancelBill = (__posConfig.Rows[0][_g.d.POSConfig._pos_cancel_bill].ToString().Equals("1")) ? true : false;
                this._posCancelBillOtherDate = (__posConfig.Rows[0][_g.d.POSConfig._pos_cancel_bill_other_date].ToString().Equals("1")) ? false : true;
                this._posBillType = __posConfig.Rows[0][_g.d.POSConfig._pos_bill_type].ToString();
                this._creditSaleBillType = __posConfig.Rows[0][_g.d.POSConfig._pos_bill_credit_type].ToString();

                this._showShortDescription = (__posConfig.Rows[0][_g.d.POSConfig._show_short_description].ToString().Equals("1")) ? false : true;
                this._showTaxDetail = (__posConfig.Rows[0][_g.d.POSConfig._show_tax_detail].ToString().Equals("1")) ? false : true;
                this._warning_peroid_open = (__posConfig.Rows[0][_g.d.POSConfig._warning_not_open_period].ToString().Equals("1")) ? true : false;
                this._close_discount_bill = (__posConfig.Rows[0][_g.d.POSConfig._pos_close_discount_bill].ToString().Equals("1")) ? true : false;
                this._balance_control = (__posConfig.Rows[0][_g.d.POSConfig._balance_control].ToString().Equals("1")) ? true : false;
                this._show_barcode_picture = (__posConfig.Rows[0][_g.d.POSConfig._barcode_picture].ToString().Equals("1")) ? true : false;
                this._print_item_set_detail = (__posConfig.Rows[0][_g.d.POSConfig._print_item_set_detail].ToString().Equals("1")) ? true : false;
                this._cashdrawer_open_password = (__posConfig.Rows[0][_g.d.POSConfig._pos_cashdrawer_open_password].ToString().Equals("1")) ? true : false;
                this._pos_show_total_balance = (__posConfig.Rows[0][_g.d.POSConfig._pos_show_total_balance].ToString().Equals("1")) ? true : false;
                this._warning_select_cust = (__posConfig.Rows[0][_g.d.POSConfig._warning_select_cust].ToString().Equals("1")) ? true : false;
                this._check_delete_item = (__posConfig.Rows[0][_g.d.POSConfig._check_remove_item].ToString().Equals("1")) ? true : false;

                this._maxPosMoney = MyLib._myGlobal._decimalPhase(__posConfig.Rows[0][_g.d.POSConfig._MaxPosMoney].ToString());

                // การปัดเศษ
                this._posConfig._round_type = (int)MyLib._myGlobal._decimalPhase(__posConfig.Rows[0][_g.d.POSConfig._RoundChangeDecimal].ToString());
                this._posConfig._round_table = __posConfig.Rows[0][_g.d.POSConfig._FormatRound].ToString();
                this._print_multilanguage_slip = (__posConfig.Rows[0][_g.d.POSConfig._pos_multilanguage_slip].ToString().Equals("1")) ? true : false;
                this._pos__disabled_check_send_money = (__posConfig.Rows[0][_g.d.POSConfig._pos_check_send_money].ToString().Equals("1")) ? true : false;
                this._pos_send_deposit_money = (__posConfig.Rows[0][_g.d.POSConfig._pos_send_deposit_money].ToString().Equals("1")) ? true : false;
                this._disable_cancel_order_outshift = (__posConfig.Rows[0][_g.d.POSConfig._disable_cancel_order_outshift].ToString().Equals("1")) ? true : false;

                this._posConfig._weight_scale_prefix = __posConfig.Rows[0][_g.d.POSConfig._weight_scale_prefix].ToString();
                this._posConfig._weight_prefix_start = (int)MyLib._myGlobal._decimalPhase(__posConfig.Rows[0][_g.d.POSConfig._weight_prefix_start].ToString());
                this._posConfig._weight_prefix_stop = (int)MyLib._myGlobal._decimalPhase(__posConfig.Rows[0][_g.d.POSConfig._weight_prefix_stop].ToString());
                this._posConfig._weight_ic_code_start = (int)MyLib._myGlobal._decimalPhase(__posConfig.Rows[0][_g.d.POSConfig._weight_ic_code_start].ToString());
                this._posConfig._weight_ic_code_stop = (int)MyLib._myGlobal._decimalPhase(__posConfig.Rows[0][_g.d.POSConfig._weight_ic_code_stop].ToString());
                this._posConfig._weight_price_start = (int)MyLib._myGlobal._decimalPhase(__posConfig.Rows[0][_g.d.POSConfig._weight_price_start].ToString());
                this._posConfig._weight_price_stop = (int)MyLib._myGlobal._decimalPhase(__posConfig.Rows[0][_g.d.POSConfig._weight_price_stop].ToString());
                this._use_item_set = (__posConfig.Rows[0][_g.d.POSConfig._use_item_set].ToString().Equals("1")) ? true : false;
                this._check_cash_drawer = (__posConfig.Rows[0][_g.d.POSConfig._check_status_drawer].ToString().Equals("1")) ? true : false;

                this._posConfig._pos_vat_type = (int)MyLib._myGlobal._decimalPhase(__posConfig.Rows[0][_g.d.POSConfig._vat_type].ToString());
                this._posConfig._service_charge_rate = MyLib._myGlobal._decimalPhase(__posConfig.Rows[0][_g.d.POSConfig._service_charge_rate].ToString());

                this._check_member_expire = (__posConfig.Rows[0][_g.d.POSConfig._check_member_expire].ToString().Equals("1")) ? true : false;
                this._point_member_only = (__posConfig.Rows[0][_g.d.POSConfig._point_member_only].ToString().Equals("1")) ? true : false;

                this._lock_edit_order = (__posConfig.Rows[0][_g.d.POSConfig._lock_edit_order].ToString().Equals("1")) ? true : false;

                this._checkFloatMoney = (__posConfig.Rows[0][_g.d.POSConfig._check_float_money].ToString().Equals("1")) ? true : false;

                this._print_sale_daily_item = (__posConfig.Rows[0][_g.d.POSConfig._print_sale_daily_item].ToString().Equals("1")) ? true : false;

                this._show_item_location_only = (__posConfig.Rows[0][_g.d.POSConfig._show_item_location_on_only].ToString().Equals("1")) ? true : false;

                this._change_currency_code = __posConfig.Rows[0][_g.d.POSConfig._change_money_currency].ToString();
                if (this._change_currency_code.Length > 0)
                {
                    DataTable __getExchangeRate = __myFrameWork._queryShort("select " + _g.d.erp_currency._exchange_rate_present + " from " + _g.d.erp_currency._table + " where " + _g.d.erp_currency._code + "=\'" + this._change_currency_code.ToUpper() + "\'").Tables[0];
                    decimal __exchangeRate = __getExchangeRate.Rows.Count > 0 ? MyLib._myGlobal._decimalPhase(__getExchangeRate.Rows[0][_g.d.erp_currency._exchange_rate_present].ToString()) : 0M;

                    if (__exchangeRate == 0)
                    {
                        this._exchangeRate = 1;
                    }
                    else
                    {
                        this._exchangeRate = __exchangeRate;
                    }
                }

                if (this._posConfig._round_table.Length > 0)
                {
                    _processRoundTable(this._posConfig._round_table);
                }
            }
        }

        private void _loadPromotion()
        {
            try
            {
                MyLib._myFrameWork __myFrameWork = new _myFrameWork();
                StringBuilder __queryPromotion = new StringBuilder();
                __queryPromotion.Append(MyLib._myGlobal._xmlHeader + "<node>");
                // ย้ายไป filter ใน process ให้รองรับการทำงานตลอด 24 ชม
                /*string __dateFilter = " and " +
                    " ( " +
                    " ( " + _g.d.ic_promotion_formula._from_date + " is null and " + _g.d.ic_promotion_formula._to_date + " is null) " +
                    " or ( " + _g.d.ic_promotion_formula._from_date + " is not null and " + _g.d.ic_promotion_formula._to_date + " is null and " + _g.d.ic_promotion_formula._from_date + " < current_date ) " +
                    " or ( " + _g.d.ic_promotion_formula._from_date + " is not null and " + _g.d.ic_promotion_formula._to_date + " is not null and current_date between " + _g.d.ic_promotion_formula._from_date + " and " + _g.d.ic_promotion_formula._to_date + " ) " +
                    " ) ";*/

                string __wherePromotion = " where " + _g.d.ic_promotion_formula._status + "=1 and (( coalesce(" + _g.d.ic_promotion_formula._lock_promotion + ", 0)=0) or (coalesce(" + _g.d.ic_promotion_formula._lock_promotion + ", 0)=1 and " + _g.d.ic_promotion_formula._lock_code_list + " like \'%" + this._posConfig._posid + "%')) order by " + _g.d.ic_promotion_formula._order_number;
                __queryPromotion.Append(MyLib._myUtil._convertTextToXmlForQuery("select * from " + _g.d.ic_promotion_formula._table + __wherePromotion));
                __queryPromotion.Append(MyLib._myUtil._convertTextToXmlForQuery("select * from " + _g.d.ic_promotion_formula_condition._table + " where " + _g.d.ic_promotion_formula_condition._condition_from + "<>\'\' and " + _g.d.ic_promotion_formula_condition._table + "." + _g.d.ic_promotion_formula_condition._code + " in (select " + _g.d.ic_promotion_formula._table + "." + _g.d.ic_promotion_formula._code + " from " + _g.d.ic_promotion_formula._table + __wherePromotion + ") order by " + _g.d.ic_promotion_formula_condition._code + "," + _g.d.ic_promotion_formula_condition._line_number));
                __queryPromotion.Append(MyLib._myUtil._convertTextToXmlForQuery("select * from " + _g.d.ic_promotion_formula_price_discount._table + " order by " + _g.d.ic_promotion_formula_price_discount._code + "," + _g.d.ic_promotion_formula_price_discount._line_number));
                __queryPromotion.Append(MyLib._myUtil._convertTextToXmlForQuery("select * from " + _g.d.ic_promotion_formula_action._table + " where " + _g.d.ic_promotion_formula_action._action_command + "<>'' order by " + _g.d.ic_promotion_formula_action._code + "," + _g.d.ic_promotion_formula_action._qty_from));
                __queryPromotion.Append(MyLib._myUtil._convertTextToXmlForQuery("select * from " + _g.d.ic_promotion_formula_group_qty._table + " where " + _g.d.ic_promotion_formula_group_qty._group_number + ">0 order by " + _g.d.ic_promotion_formula_group_qty._group_number));
                __queryPromotion.Append("</node>");
                ArrayList __getDataPromorion = __myFrameWork._queryListGetData(MyLib._myGlobal._databaseName, __queryPromotion.ToString());
                this._promotionFormula = ((DataSet)__getDataPromorion[0]).Tables[0];
                this._promotionFormulaCondition = ((DataSet)__getDataPromorion[1]).Tables[0];
                this._promotionFormulaPriceAndDiscount = ((DataSet)__getDataPromorion[2]).Tables[0];
                this._promotionFormulaAction = ((DataSet)__getDataPromorion[3]).Tables[0];
                this._promotionFormulaGroup = ((DataSet)__getDataPromorion[4]).Tables[0];
            }
            catch (Exception __ex)
            {
                MessageBox.Show(__ex.Message);
            }
        }

        //List<SMLPOSControl._roundTable> _rountTable = new List<SMLPOSControl._roundTable>();
        void _processRoundTable(string rountText)
        {
            try
            {
                string[] __roundSplit = rountText.Split(',');

                foreach (string __round in __roundSplit)
                {
                    //Regex __tableRoundRegex = new Regex(@"^(0\.+[0-9]{1,2})+\-+(0\.+[0-9]{1,2})\=+([0-1]+\.+[0-9]{1,2})");
                    Regex __tableRoundRegex = new Regex(@"^(0\.+[0-9]{1,2})+\-+(0\.+[0-9]{1,2})\=+([0-1]+(.*))");
                    if (__tableRoundRegex.IsMatch(__round))
                    {
                        MatchCollection __matcgh = __tableRoundRegex.Matches(__round);
                        decimal __fromValue = MyLib._myGlobal._decimalPhase(__matcgh[0].Groups[1].Value.ToString());
                        decimal __toValue = MyLib._myGlobal._decimalPhase(__matcgh[0].Groups[2].Value.ToString());
                        decimal __roundValue = MyLib._myGlobal._decimalPhase(__matcgh[0].Groups[3].Value.ToString());

                        this._posConfig._round_table_list.Add(new SMLPOSControl._roundTable() { _fromValue = __fromValue, _toValue = __toValue, _roundValue = __roundValue });
                    }
                }
            }
            catch
            {
            }

        }

        public void _reset()
        {
            // new concept for use counselling screen
            // เอา _newData มารวมกับ _newPharmacistData
            this._newData();

            //if (this._isPharmacist == false)
            //{
            //    // ล้างข้อมูลทั้งหมด
            //    this._newData();
            //}
            //else
            //{
            //    _newPharmacistData();
            //}


        }

        void _newData()
        {
            this._table = null;
            this._tableNameSelect = "";
            this._tableNumberSelect = "";
            this._isProcessPromotion = true;
            this._isTableCheckOut = false;
            this._isStaff = false;
            this._memberCode = "";
            this._custCode = this._posDefaultCust;
            this._custName = "";
            this._saleCode = this._posLoginCode;
            this._saleName = "";
            this._itemProcess = new List<_posClientItemClass>();
            this._itemList = new List<_posClientItemClass>();
            this._orderList = new List<string>();
            // @=POSID
            string __newDoc = "";

            if (this._isPharmacist == false)
            {
                try
                {
                    __newDoc = _g.g._getAutoRun(_g.g._autoRunType.ข้อมูลรายวัน, this._posConfig._posid, DateTime.Now.ToString(this._dateFormat, MyLib._myGlobal._cultureInfo()), this._posDocFormat, _g.g._transControlTypeEnum.ขาย_ขายสินค้าและบริการ, _g.g._transControlTypeEnum.ว่าง, "", this._posRunningDocFormat);
                }
                catch
                {
                }
            }

            _sendMessage("clear:HTML,m_yourhealthy", "", "");
            _sendMessage("update:button,cust_detail", "", "");
            _sendMessage("clear:image,item_image", "", "");

            try
            {
                _sendMessage("update:button,pos_info", this._posConfig._posid + "/" + this._posLoginCode, "");
                _sendMessage("update:label,pos_id", this._posConfig._posid, "");
            }
            catch
            {
            }

            _sendMessage("update:label,table_label", "", "");

            _sendMessage("update:button,doc_no", __newDoc, "");
            _sendMessage("update:label,doc_no", __newDoc, "");
            _sendMessage("update:label,ltdname", MyLib._myGlobal._ltdName, "");
            _sendMessage("update:label,branch_code", MyLib._myGlobal._branch_code, "");
            _sendMessage("update:label,branch_name", _g.g._companyProfile._branch_name, "");
            _sendMessage("update:button,sale_info", "", "");
            _sendMessage("update:label,sale_name", "", "");
            _sendMessage("update:label,login_name", "", "");
            _sendMessage("update:label,cust_name", "", "");
            _sendMessage("update:label,cust_address", "", "");

            _sendMessage("update:label,last_buy", "", "");
            _sendMessage("update:label,price_info", "", "");
            _sendMessage("update:label,total_amount", "", "");

            _sendMessage("update:label,point_info", "", "");
            _sendMessage("update:label,status", "", "");
            _sendMessage("update:label,exvat_amount", "", "");

            _sendMessage("update:label,vat_amount", "", "");
            _sendMessage("update:label,except_vat_amount", "", "");
            _sendMessage("clear:item_grid,sale", "", "");
            _sendMessage("show_total:item_grid,sale", "", "");

            _sendMessage("update:label,m_dozen", "", "");
            _sendMessage("update:label,m_times", "", "");
            _sendMessage("update:label,m_frequency", "", "");
            _sendMessage("update:label,m_remark", "", "");

            _sendMessage("update:label,food_amount", "", "");
            _sendMessage("update:label,drink_amount", "", "");

            _sendMessage("update:label,food_discount", "", "");
            _sendMessage("update:label,service_charge", "", "");


            this._findCust(this._posDefaultCust);
            this._findSale(this._posLoginCode);
            this._findUserLogin(this._posLoginCode);
            this._totalAmount = 0M;
            this._totalAmountVat = 0M;
            this._totalAmountExceptVat = 0M;
            this._lastBarcode = "";
            this._lastItemCode = "";
            this._lastBuy = "";
            this._pointSum = 0M;
            this._pointBalance = 0M;
            this._totalExtraDiscountAmount = 0M;
            this._discountWord = "";
            this._discountAmount = 0M;
            this._foodDiscountWord = "";
            this._foodDiscountAmount = 0M;
            this._serviceChargeWord = "";
            this._serviceChargeAmount = 0M;
            this._sms_phoenumber = "";

            this._isBirthDayMember = false;
            this._isBirthMonthMember = false;

            this._vatExcludeAmount = 0M;


            SetForegroundWindow(MyLib._myGlobal._mainForm.Handle.ToInt32());
            // Load Config สะสมแต้ม และ Promotion
            this._pointDivAmount = 0M;
            MyLib._myFrameWork __myFrameWork = new _myFrameWork();
            StringBuilder __myquery = new StringBuilder();
            __myquery.Append(MyLib._myGlobal._xmlHeader + "<node>");
            string __dateQuery = MyLib._myGlobal._convertDateToQuery(DateTime.Now);
            __myquery.Append(MyLib._myUtil._convertTextToXmlForQuery("select " + _g.d.pos_point_period._amount + " from " + _g.d.pos_point_period._table + " where \'" + __dateQuery + "\' between " + _g.d.pos_point_period._from_date + " and " + _g.d.pos_point_period._to_date));

            // x แต้มตามเดือนเกิด วันเกิด
            __myquery.Append(MyLib._myUtil._convertTextToXmlForQuery("select * from " + _g.d.pos_point_condition._table));

            string __day_field = _g.d.pos_point_special_day._day_1;
            switch (DateTime.Now.DayOfWeek)
            {
                case DayOfWeek.Monday: __day_field = _g.d.pos_point_special_day._day_1; break;
                case DayOfWeek.Tuesday: __day_field = _g.d.pos_point_special_day._day_2; break;
                case DayOfWeek.Wednesday: __day_field = _g.d.pos_point_special_day._day_3; break;
                case DayOfWeek.Thursday: __day_field = _g.d.pos_point_special_day._day_4; break;
                case DayOfWeek.Friday: __day_field = _g.d.pos_point_special_day._day_5; break;
                case DayOfWeek.Saturday: __day_field = _g.d.pos_point_special_day._day_6; break;
                case DayOfWeek.Sunday: __day_field = _g.d.pos_point_special_day._day_7; break;
            }

            // x แต้มตามช่วงวันที่

            __myquery.Append(MyLib._myUtil._convertTextToXmlForQuery("select " + _g.d.pos_point_special_day._multiply_point + " from " + _g.d.pos_point_special_day._table + " where ( \'" + __dateQuery + "\' between " + _g.d.pos_point_special_day._from_date + " and " + _g.d.pos_point_special_day._to_date + " ) and ( " + _g.d.pos_point_special_day._day_0 + "=1 or " + __day_field + "=1 )  order by " + _g.d.pos_point_special_day._order_condition + " desc "));
            __myquery.Append("</node>");
            ArrayList __data = __myFrameWork._queryListGetData(MyLib._myGlobal._databaseName, __myquery.ToString());
            if (__data.Count > 0)
            {
                DataTable __pointTable = ((DataSet)__data[0]).Tables[0];
                if (__pointTable.Rows.Count > 0)
                {
                    this._pointDivAmount = MyLib._myGlobal._decimalPhase(__pointTable.Rows[0][_g.d.pos_point_period._amount].ToString());
                }

                DataTable __pointConditionTable = ((DataSet)__data[1]).Tables[0];
                if (__pointConditionTable.Rows.Count > 0)
                {
                    this._usePointBirthDay = __pointConditionTable.Rows[0][_g.d.pos_point_condition._birth_day_use].ToString().Equals("1") ? true : false;
                    this._pointMultiplyBirthDay = (_usePointBirthDay == true) ? MyLib._myGlobal._decimalPhase(__pointConditionTable.Rows[0][_g.d.pos_point_condition._birth_day].ToString()) : 0M;

                    this._usePointMonthBirth = __pointConditionTable.Rows[0][_g.d.pos_point_condition._birth_month_use].ToString().Equals("1") ? true : false;
                    this._pointMultiplyMonthBirth = (_usePointMonthBirth == true) ? MyLib._myGlobal._decimalPhase(__pointConditionTable.Rows[0][_g.d.pos_point_condition._birth_month].ToString()) : 0M;
                }

                DataTable __pointSpecialTable = ((DataSet)__data[2]).Tables[0];
                if (__pointSpecialTable.Rows.Count > 0)
                {
                    this._pointSpecialDayMultiply = MyLib._myGlobal._decimalPhase(__pointSpecialTable.Rows[0][_g.d.pos_point_special_day._multiply_point].ToString());
                }

            }
            this._loadPromotion();
            this._checkMoneyLimit();

            this._writeDisplay("WELCOME", "", "c", "", this._posConfig._customer_display_linecount);
            if (this._posConfig._android_customer_display)
            {
                _androidCustomerScreen._setConfig(this._posConfig);
                _androidCustomerScreen._singleCommand(_g.g._androidDisplayEnum.Clear, "");
                StringBuilder __str = new StringBuilder(MyLib._myGlobal._xmlHeader);
                __str.Append("<node>");
                __str.Append(_androidCustomerScreen._add(_g.g._androidDisplayEnum.ItemName, "ยินดีต้อนรับ"));
                __str.Append("</node>");
                _androidCustomerScreen._send(__str.ToString());
            }
        }

        void _newPharmacistData()
        {
            this._isStaff = false;
            this._memberCode = "";
            this._custCode = this._posDefaultCust;
            this._custName = "";
            this._saleCode = this._posLoginCode;
            this._saleName = "";
            this._itemProcess = new List<_posClientItemClass>();
            this._itemList = new List<_posClientItemClass>();

            _sendMessage("clear:HTML,m_yourhealthy", "", "");
            _sendMessage("update:button,cust_detail", "", "");
            _sendMessage("update:button,sale_info", "", "");
            _sendMessage("update:label,sale_name", "", "");
            _sendMessage("update:label,login_name", "", "");
            _sendMessage("update:label,cust_name", "", "");

            _sendMessage("update:label,last_buy", "", "");
            _sendMessage("update:label,price_info", "", "");
            _sendMessage("update:label,total_amount", "", "");
            _sendMessage("update:label,point_info", "", "");
            _sendMessage("update:label,status", "", "");
            _sendMessage("update:label,vat_amount", "", "");
            _sendMessage("update:label,except_vat_amount", "", "");
            _sendMessage("clear:item_grid,sale", "", "");
            _sendMessage("show_total:item_grid,sale", "", "");

            _sendMessage("update:label,m_dozen", "", "");
            _sendMessage("update:label,m_times", "", "");
            _sendMessage("update:label,m_frequency", "", "");
            _sendMessage("update:label,m_remark", "", "");


            this._totalAmount = 0M;
            this._totalAmountVat = 0M;
            this._totalAmountExceptVat = 0M;
            this._lastBarcode = "";
            this._lastItemCode = "";
            this._lastBuy = "";
            this._pointSum = 0M;
            this._pointBalance = 0M;
            this._totalExtraDiscountAmount = 0M;
            this._sms_phoenumber = "";

            //this._findCust(this._posDefaultCust);
            this._findSale(this._posLoginCode);

            SetForegroundWindow(MyLib._myGlobal._mainForm.Handle.ToInt32());

        }

        void _buildMedical()
        {
            _sendMessage("clear:HTML,m_yourhealthy", "", "");
            _sendMessage("update:label,m_dozen", "", "");
            _sendMessage("update:label,m_times", "", "");
            _sendMessage("update:label,m_frequency", "", "");
            _sendMessage("update:label,m_remark", "", "");
            _sendMessage("update:label,status", "", "");

            _newPharmacistData();
        }

        /// <summary>Load XML Config POS Screen กรณี demo และไม่มีการเขียน config ใหม่ไม่ต้องโหลด</summary>
        private void _loadXMLScreenConfig()
        {
            //string __configFileName = _savePosScreenConfigFileName + MyLib._myGlobal._databaseName + ".xml";
            //string __path = Path.GetTempPath() + "\\" + __configFileName.ToLower();

            //string __localpath = string.Format(@"c:\smlsoft\{3}-{0}-{1}-{2}.xml", MyLib._myGlobal._webServiceServer.Replace(".", "_").Replace(":", "__"), MyLib._myGlobal._providerCode, MyLib._myGlobal._databaseName, _savePosScreenConfigFileName);

            // if demo and not have config
            if (MyLib._myGlobal._isDemo && System.IO.File.Exists(_configFileName) == false)
            {
                // ทำ config demo เลยไม่ต้องอ่านไฟล์
                this._posConfig = new SMLPOSControl._posScreenConfig();

                Screen __primary = Screen.PrimaryScreen;
                string _screenDeviceName = Regex.Split(__primary.DeviceName, "\0")[0].ToString();

                // add pos screen
                SMLPOSControl._screenConfig __device = new SMLPOSControl._screenConfig() { _moniter = "0", _deviceName = MyLib._myUtil._convertTextToXml(_screenDeviceName) };
                __device._isMasterScreen = true;
                if (MyLib._myGlobal._OEMVersion.Equals("ais"))
                {
                    __device._screen_code = "MPAYPOS";
                }
                else if (MyLib._myGlobal._programName.Equals("SML POS DEMO Lao"))
                {
                    __device._screen_code = "LOAPOSSCREEN";
                }
                else if (MyLib._myGlobal._programName.Equals("Account POS Singha"))
                {
                    __device._screen_code = "SINGHASCREEN";
                }
                else
                    __device._screen_code = "POSSTDSCR1";
                this._posConfig._screenConfig.Add(__device);

                // other config 
                this._posConfig._pos_slip_header_fontname = "Tahoma";
                this._posConfig._pos_slip_header_fontsize = 9;
                this._posConfig._pos_slip_detail_fontname = "Tahoma";
                this._posConfig._pos_slip_detail_fontsize = 9;
                this._posConfig._pos_slip_footer_fontname = "Tahoma";
                this._posConfig._pos_slip_footer_fontsize = 9;
                this._posConfig._pos_slip_width = 579;

                this._posConfig._invoiceSlip = "0";
                this._posConfig._printerType = "0";
                this._posConfig._useCashDrawer = "0";

                // sound
                this._posConfig._use_sound_scan_barcode = 1;
                this._posConfig._sound_on_scan_barcode = @"C:\smlsoft\beep-24.wav";
                this._posConfig._use_sound_on_already_barcode = 1;
                this._posConfig._sound_on_already_barcode = @"C:\smlsoft\beep-30.wav";
                this._posConfig._use_sound_on_not_found_barcode = 1;
                this._posConfig._sound_on_not_found_barcode = @"C:\smlsoft\beep-29.wav";
                this._posConfig._use_sound_amount = 1;

            }
            else
            {

                try
                {
                    TextReader readFile = new StreamReader(_configFileName);
                    XmlSerializer __xsLoad = new XmlSerializer(typeof(SMLPOSControl._posScreenConfig));
                    this._posConfig = (SMLPOSControl._posScreenConfig)__xsLoad.Deserialize(readFile);
                    readFile.Close();
                }
                catch
                {
                    try
                    {
                        TextReader readFile = new StreamReader(_configOldPath);
                        XmlSerializer __xsLoad = new XmlSerializer(typeof(SMLPOSControl._posScreenConfig));
                        this._posConfig = (SMLPOSControl._posScreenConfig)__xsLoad.Deserialize(readFile);
                        readFile.Close();
                    }
                    catch (Exception ex)
                    {
                    }
                }
            }
        }

        #endregion

        #region สร้างและวาดจอขาย

        /// <summary>หา Config Screen จาก DeviceName</summary>
        /// <param name="__deviceName">DeviceName</param>
        /// <returns>_screenConfig</returns>
        private SMLPOSControl._screenConfig _getConfigPOSScreen(string __deviceName)
        {
            if (this._posConfig != null)
            {
                foreach (SMLPOSControl._screenConfig __config in this._posConfig._screenConfig)
                {
                    if (__config._deviceName.Equals(__deviceName))
                    {
                        return __config;
                    }
                }
            }

            return null;
        }

        /// <summary>Bulid จอขาย</summary>
        public void _build()
        {
            _loadXMLDesign();
            _setXMLDesign();

            if (this._isPharmacist)
            {
                _buildMedical();
            }

            MyLib._myFrameWork __myFrameWork = new _myFrameWork();
            {
                StringBuilder __myQuery = new StringBuilder();
                __myQuery.Append(MyLib._myGlobal._xmlHeader + "<node>");
                __myQuery.Append(MyLib._myUtil._convertTextToXmlForQuery("update ic_trans_detail set doc_date_calc=doc_date where doc_date_calc is null"));
                __myQuery.Append(MyLib._myUtil._convertTextToXmlForQuery("update ic_trans_detail set doc_time_calc=doc_time where doc_time_calc is null"));
                __myQuery.Append("</node>");
                __myFrameWork._queryList(MyLib._myGlobal._databaseName, __myQuery.ToString());
            }
        }

        /// <summary>Set Screen form and build form</summary>
        public void _loadScreen()
        {
            if (MyLib._myGlobal._isDemo && System.IO.File.Exists(_configFileName) == false && MyLib._myGlobal._OEMVersion.Equals("ais") == false)
            {
                this._build();
            }
            else
            {
                this._posScreen = Screen.AllScreens;

                foreach (Screen __screen in this._posScreen)
                {
                    string __deviceName = Regex.Split(__screen.DeviceName, "\0")[0].ToString();
                    if (__screen.Primary == false)
                    {
                        SMLPOSControl._screenConfig __config = _getConfigPOSScreen(__deviceName);
                        if (__config != null && !__config._screen_code.Equals("None"))
                        {
                            // create posclientForm;
                            _posExtendForm __extendForm = new _posExtendForm(this._posLoginCode, this._posLoginPassword, __config._screen_code);
                            __extendForm.StartPosition = FormStartPosition.Manual;
                            __extendForm.WindowState = FormWindowState.Maximized;
                            __extendForm.FormBorderStyle = FormBorderStyle.None;

                            __extendForm.Location = __screen.Bounds.Location;
                            __extendForm.Show(this);
                            // config Screen Name;

                            _extendFormList.Add(__extendForm);
                        }
                    }
                    else
                    {
                        if (__screen.Primary == true)
                        {
                            SMLPOSControl._screenConfig __config = _getConfigPOSScreen(__deviceName);
                            if (__config != null)
                            {
                                this._posScreenCode = __config._screen_code;
                                this._build();
                            }
                        }
                    }
                }

                // load pay form
                if (this._posConfig != null && this._posConfig._payform != null && !this._posConfig._payform.Equals("") && !this._posConfig._payform.Equals("None"))
                {
                    this._posPayForm = new _posExtendForm(this._posLoginCode, this._posLoginPassword, this._posConfig._payform);
                }

            }

            _sendMessage("focus:textbox:input", "", "");
        }

        public void _initScreen()
        {
            // call สินค้าจาก web service แล้ว จับยัดลง  item panel

        }

        /// <summary>Load XML Design จาก WebService</summary>
        protected virtual void _loadXMLDesign()
        {
            // toe pos demo screen และไม่เขียน config
            if (MyLib._myGlobal._isDemo && System.IO.File.Exists(_configFileName) == false)
            {
                if (MyLib._myGlobal._programName.Equals("SML POS DEMO EN") == true)
                {
                    string _posQuery = string.Format("select " + _g.d.sml_posdesign._screen_data + " from " + _g.d.sml_posdesign._table + " where UPPER(" + _g.d.sml_posdesign._screen_code + ") = '{0}'", "POS1".ToUpper());
                    MyLib._myFrameWork __fw = new MyLib._myFrameWork();
                    byte[] __getByte = __fw._queryByte(MyLib._myGlobal._databaseName, _posQuery);

                    try
                    {
                        MemoryStream __ms = new MemoryStream(MyLib._compress._decompressBytes((byte[])__getByte));
                        XmlSerializer __xs = new XmlSerializer(typeof(SMLPOSControl._designer._posDesignXML));

                        _designXML = (SMLPOSControl._designer._posDesignXML)__xs.Deserialize(__ms);

                        // set screen pos from xml
                        //_setPosDesignXML(__xml);

                        __ms.Close();

                    }
                    catch (Exception ex)
                    {
                    }
                }
                else if (MyLib._myGlobal._programName.Equals("Account POS Singha"))
                {
                    string _posQuery = string.Format("select " + _g.d.sml_posdesign._screen_data + " from " + _g.d.sml_posdesign._table + " where UPPER(" + _g.d.sml_posdesign._screen_code + ") = '{0}'", "SINGHASCREEN".ToUpper());
                    MyLib._myFrameWork __fw = new MyLib._myFrameWork();
                    byte[] __getByte = __fw._queryByte(MyLib._myGlobal._databaseName, _posQuery);

                    try
                    {
                        MemoryStream __ms = new MemoryStream(MyLib._compress._decompressBytes((byte[])__getByte));
                        XmlSerializer __xs = new XmlSerializer(typeof(SMLPOSControl._designer._posDesignXML));

                        _designXML = (SMLPOSControl._designer._posDesignXML)__xs.Deserialize(__ms);

                        // set screen pos from xml
                        //_setPosDesignXML(__xml);

                        __ms.Close();

                    }
                    catch (Exception ex)
                    {
                    }

                }
                else if (MyLib._myGlobal._programName.Equals("SML POS DEMO Lao"))
                {
                    string _posQuery = string.Format("select " + _g.d.sml_posdesign._screen_data + " from " + _g.d.sml_posdesign._table + " where UPPER(" + _g.d.sml_posdesign._screen_code + ") = '{0}'", "LOAPOSSCREEN".ToUpper());
                    MyLib._myFrameWork __fw = new MyLib._myFrameWork();
                    byte[] __getByte = __fw._queryByte(MyLib._myGlobal._databaseName, _posQuery);

                    try
                    {
                        MemoryStream __ms = new MemoryStream(MyLib._compress._decompressBytes((byte[])__getByte));
                        XmlSerializer __xs = new XmlSerializer(typeof(SMLPOSControl._designer._posDesignXML));

                        _designXML = (SMLPOSControl._designer._posDesignXML)__xs.Deserialize(__ms);

                        // set screen pos from xml
                        //_setPosDesignXML(__xml);

                        __ms.Close();

                    }
                    catch (Exception ex)
                    {
                    }
                }
                else
                {
                    if (MyLib._myGlobal._OEMVersion == "ais")
                    {
                        string __mpayScreenCode = (MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro) ? "MPAYPOS" : "POSMPAY";
                        string _posQuery = string.Format("select " + _g.d.sml_posdesign._screen_data + " from " + _g.d.sml_posdesign._table + " where UPPER(" + _g.d.sml_posdesign._screen_code + ") = '{0}'", __mpayScreenCode.ToUpper());
                        MyLib._myFrameWork __fw = new MyLib._myFrameWork();
                        byte[] __getByte = __fw._queryByte(MyLib._myGlobal._databaseName, _posQuery);

                        try
                        {
                            MemoryStream __ms = new MemoryStream(MyLib._compress._decompressBytes((byte[])__getByte));
                            XmlSerializer __xs = new XmlSerializer(typeof(SMLPOSControl._designer._posDesignXML));

                            _designXML = (SMLPOSControl._designer._posDesignXML)__xs.Deserialize(__ms);

                            // set screen pos from xml
                            //_setPosDesignXML(__xml);

                            __ms.Close();

                        }
                        catch (Exception ex)
                        {
                        }

                    }
                    else
                    {
                        // load จอจาก embled resource
                        // get ขนาด จอ หาจอที่พอดี แล้ว จาก resource แล้ว show เลย
                        StreamReader __source = MyLib._getStream._getDataStream(MyLib._myGlobal._posDesignXmlFileName);
                        string __getXml = __source.ReadToEnd();
                        __source.Close();


                        XmlDocument _xmlDocs = new XmlDocument();
                        _xmlDocs.LoadXml(__getXml);
                        XmlNodeList __xmlList = _xmlDocs.SelectNodes("/node/posscreen");

                        // เลือก ขนาดจอให้เลย
                        Screen __current = Screen.PrimaryScreen;

                        string __reportContent = (MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro) ? __xmlList[3]["content"].InnerText : __xmlList[0]["content"].InnerText;

                        if (__current.Bounds.Width > 1024 && __current.Bounds.Height >= 768 && MyLib._myGlobal._isVersionEnum != _myGlobal._versionType.SMLTomYumGoong && MyLib._myGlobal._isVersionEnum != _myGlobal._versionType.SMLTomYumGoongPro)
                        {
                            __reportContent = __xmlList[1]["content"].InnerText;
                        }
                        else if (__current.Bounds.Width > 1024 && __current.Bounds.Height >= 768 && (MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro))
                        {
                            __reportContent = __xmlList[4]["content"].InnerText;
                        }

                        byte[] __reportByte = Convert.FromBase64String(__reportContent);
                        string __reportStr = MyLib._compress._deCompressString(__reportByte);

                        _designXML = (SMLPOSControl._designer._posDesignXML)MyLib._myGlobal._objectFromXml(__reportStr, typeof(SMLPOSControl._designer._posDesignXML));
                    }
                }
            }
            else
            {
                string _posQuery = string.Format("select " + _g.d.sml_posdesign._screen_data + " from " + _g.d.sml_posdesign._table + " where UPPER(" + _g.d.sml_posdesign._screen_code + ") = '{0}'", this._posScreenCode.ToUpper());
                MyLib._myFrameWork __fw = new MyLib._myFrameWork();
                byte[] __getByte = __fw._queryByte(MyLib._myGlobal._databaseName, _posQuery);

                try
                {
                    MemoryStream __ms = new MemoryStream(MyLib._compress._decompressBytes((byte[])__getByte));
                    XmlSerializer __xs = new XmlSerializer(typeof(SMLPOSControl._designer._posDesignXML));

                    _designXML = (SMLPOSControl._designer._posDesignXML)__xs.Deserialize(__ms);

                    // set screen pos from xml
                    //_setPosDesignXML(__xml);

                    __ms.Close();

                }
                catch (Exception ex)
                {
                }
            }
        }

        /// <summary>SET จอขาย จาก XML Design</summary>
        protected virtual void _setXMLDesign()
        {
            if (_designXML != null)
            {
                for (int __iDock = 0; __iDock < _designXML._form.Count; __iDock++)
                {
                    // create form
                    SMLPOSControl._designer._posFormXML __xmlForm = (SMLPOSControl._designer._posFormXML)_designXML._form[__iDock];

                    Form __form = _setXMLForm(__xmlForm);

                    if (__form != null)
                    {
                        // add form to dock
                        DockableFormInfo _info1 = _container.Add(__form, zAllowedDock.All, Guid.NewGuid());

                        if (__xmlForm._dock != DockStyle.None)
                            _container.DockForm(_info1, __xmlForm._dock, __xmlForm._dockMode);
                    }
                } // for form
            }
            else
            {
                MessageBox.Show("POS Design Object Not Set !!!", "Warning", MessageBoxButtons.OK, MessageBoxIcon.Error);
            }

        }

        /// <summary>SET DOCK FORM</summary>
        public Form _setXMLForm(SMLPOSControl._designer._posFormXML __xmlForm)
        {
            try
            {
                control._posForm __form = new control._posForm();
                __form.SuspendLayout();
                __form.Text = __xmlForm._text;
                __form.Width = __xmlForm._width;
                __form.Height = __xmlForm._height;
                //__form.AutoScaleDimensions = new System.Drawing.SizeF(6F, 13F);
                __form.AutoScaleMode = System.Windows.Forms.AutoScaleMode.None;

                __form.BackColor = MyLib._myGlobal._convertStringToColor(__xmlForm._backColor);
                if (__xmlForm._backImage != null)
                    __form.BackgroundImage = MyLib._myGlobal._base64ToImage(__xmlForm._backImage);
                __form.BackgroundImageLayout = __xmlForm._backImageLayout;


                for (int __i = 0; __i < __xmlForm._drawObject.Count; __i++)
                {
                    Control __obj = _getPOSObject((SMLPOSControl._designer._posDrawObjectXML)__xmlForm._drawObject[__i]);
                    if (__obj != null)
                    {
                        __obj.Parent = __form;
                        __form.Controls.Add(__obj);
                    }
                }

                __form.ResumeLayout(false);
                //__form.Invalidate();
                __form._processParentControl();
                return __form;
            }
            catch (Exception ex)
            {
            }
            return null;
        }

        /// <summary>Get POS Control จาก XML</summary>
        public Control _getPOSObject(SMLPOSControl._designer._posDrawObjectXML __objectXML)
        {
            if (__objectXML._controlType == SMLPOSControl._posControls.Label)
            {
                #region Get Label

                control._posLabelShadow __label = new control._posLabelShadow();
                __label.Location = new Point(__objectXML.X, __objectXML.Y);
                __label.Size = new Size(__objectXML.Width, __objectXML.Height);
                __label.BackColor = MyLib._myGlobal._convertStringToColor(__objectXML.BackgroundColor);
                __label.Text = __objectXML.Text;
                __label.Font = new Font(__objectXML.FontName, __objectXML.FontSize, __objectXML.FontStyle, GraphicsUnit.Point, 222);
                __label.ForeColor = MyLib._myGlobal._convertStringToColor(__objectXML.Color);
                //__label.ShadowColor = MyLib._myGlobal._convertStringToColor(__objectXML._color1);
                __label.StartColor = MyLib._myGlobal._convertStringToColor(__objectXML.BackgroundColor);
                __label.EndColor = MyLib._myGlobal._convertStringToColor(__objectXML.BackgroundColor);
                __label._id = (__objectXML._id == null) ? "" : __objectXML._id;
                __label.TextAlign = __objectXML.ContentAlign;
                __label.DrawShadow = __objectXML._drawShadow;
                __label.Tag = __objectXML._tag;
                if (__label._id.ToString().Equals("datetime"))
                {
                    __dateTimeLabel.Add(__label);
                }

                return __label;

                #endregion
            }
            else if (__objectXML._controlType == SMLPOSControl._posControls.Panel)
            {
                #region Get Panel
                control._posPanel __panel = new control._posPanel();
                __panel.Size = new Size(__objectXML.Width, __objectXML.Height);
                __panel.Location = new Point(__objectXML.X, __objectXML.Y);
                __panel._GradientStartColor = MyLib._myGlobal._convertStringToColor(__objectXML._color1);
                __panel._GradientEndColor = MyLib._myGlobal._convertStringToColor(__objectXML._color2);
                __panel._lineColor = MyLib._myGlobal._convertStringToColor(__objectXML.LineColor);
                __panel._GradientAngle = (int)__objectXML.Angle;
                __panel._roundedRadius = new Padding(__objectXML.RoundedRectangleRadius.All);
                __panel._id = (__objectXML._id == null) ? "" : __objectXML._id;
                return __panel;
                #endregion
            }
            else if (__objectXML._controlType == SMLPOSControl._posControls.Button)
            {
                #region Get Button
                control._posButton __button = new control._posButton();
                __button.Location = new Point(__objectXML.X, __objectXML.Y);
                __button.Size = new Size(__objectXML.Width, __objectXML.Height);
                __button.Font = new Font(__objectXML.FontName, __objectXML.FontSize, __objectXML.FontStyle, GraphicsUnit.Point, 222);
                __button.ButtonText = __objectXML.Text;
                __button.ForeColor = MyLib._myGlobal._convertStringToColor(__objectXML.Color);
                __button.ButtonColor = MyLib._myGlobal._convertStringToColor(__objectXML.BackgroundColor);
                __button.HighlightColor = MyLib._myGlobal._convertStringToColor(__objectXML._color1);
                __button.BaseColor = MyLib._myGlobal._convertStringToColor(__objectXML._color2);
                __button.GlowColor = MyLib._myGlobal._convertStringToColor(__objectXML._color3);

                if (__objectXML.Image != null)
                    __button.Image = MyLib._myGlobal._base64ToImage(__objectXML.Image);
                if (__objectXML._backImage != null)
                    __button.BackImage = MyLib._myGlobal._base64ToImage(__objectXML._backImage);
                __button.ImageSize = __objectXML._imageSize;
                __button.ImageAlign = __objectXML._imageIconAlignment;

                __button.CornerRadius = __objectXML.RoundedRectangleRadius.All;
                __button.TextAlign = __objectXML.ContentAlign;
                __button.Tag = __objectXML._tag;
                __button.Click += new EventHandler(__button_Click);
                __button._id = (__objectXML._id == null) ? "" : __objectXML._id;
                __button.Invalidate();

                return __button;
                #endregion
            }
            else if (__objectXML._controlType == SMLPOSControl._posControls.ItemsTable)
            {
                #region Get Item Table

                control._posGrid __grid = new control._posGrid();
                __grid._isEdit = false;
                __grid._fixFont = (_isScreenCloseTable && _orderDeviceConfig._summary_detail_font_name.Length > 0) ? new Font(_orderDeviceConfig._summary_detail_font_name, _orderDeviceConfig._summary_detail_font_size, __objectXML.FontStyle, GraphicsUnit.Point, 222) : new Font(__objectXML.FontName, __objectXML.FontSize, __objectXML.FontStyle, GraphicsUnit.Point, 222);
                __grid.Size = new Size(__objectXML.Width, __objectXML.Height);
                __grid.Location = new Point(__objectXML.X, __objectXML.Y);
                __grid._id = (__objectXML._id == null) ? "" : __objectXML._id;
                if (__objectXML._buttonHeight != 0)
                {
                    __grid._cellHeight = __objectXML._buttonHeight;
                }

                //add column
                for (int __i = 0; __i < __objectXML._posTableColumn.Count; __i++)
                {
                    SMLPOSControl._designer._posItemsTableColumnXML __col = (SMLPOSControl._designer._posItemsTableColumnXML)__objectXML._posTableColumn[__i];
                    __grid._addColumn(__col._tag, ((__col._columnType == SMLPOSControl._designer._object._tableColumnType.Number) ? 3 : 1), 255, (int)__col.ColumnsWidth, false, false, false, false, __col.FieldFormat, "", "", __col.HeaderText);

                }

                // addcolumnpricetype
                __grid._addColumn(_price_type_column, 2, 0, 0, false, true);
                return __grid;
                #endregion
            }
            else if (__objectXML._controlType == SMLPOSControl._posControls.ItemButtonPanel)
            {
                #region Get Item Button Panel

                // draw flow layout panel
                FlowLayoutPanel __panel = new FlowLayoutPanel();
                __panel.Size = new Size(__objectXML.Width, __objectXML.Height);
                __panel.Location = new Point(__objectXML.X, __objectXML.Y);
                __panel.BackColor = MyLib._myGlobal._convertStringToColor(__objectXML.BackgroundColor);
                __panel.Padding = __objectXML.Padding;

                __panel.Name = (__objectXML._id == null) ? "" : __objectXML._id;

                // draw button in panel
                // คำณวนว่าใส่ปุ่มได้ กี่ row กี่ column
                int __innerWidth = __objectXML.Width - (__objectXML.Padding.Left + __objectXML.Padding.Right); // / 
                int __innerHeight = __objectXML.Height - (__objectXML.Padding.Top + __objectXML.Padding.Bottom);

                int __buttonCol = __innerWidth / (__objectXML._buttonWidth + __objectXML._buttonMargin.Left + __objectXML._buttonMargin.Right);
                int __buttonRow = __innerHeight / (__objectXML._buttonHeight + __objectXML._buttonMargin.Top + __objectXML._buttonMargin.Bottom);

                for (int __col = 0; __col < __buttonCol; __col++)
                {
                    for (int __row = 0; __row < __buttonRow; __row++)
                    {
                        // add button
                        control._posButton __button = new control._posButton();
                        //__button.Location = new Point(__objectXML.X, __objectXML.Y);
                        __button.Size = new Size(__objectXML._buttonWidth, __objectXML._buttonHeight);
                        try
                        {
                            __button.Font = new Font(__objectXML.FontName, __objectXML.FontSize, __objectXML.FontStyle, GraphicsUnit.Point, 222);
                        }
                        catch
                        {
                        }

                        __button.ButtonText = "Product";

                        __button.ForeColor = MyLib._myGlobal._convertStringToColor(__objectXML.Color);
                        //__button.ButtonColor = MyLib._myGlobal._convertStringToColor(__objectXML.BackgroundColor);
                        __button.HighlightColor = MyLib._myGlobal._convertStringToColor(__objectXML._color1);
                        __button.BaseColor = MyLib._myGlobal._convertStringToColor(__objectXML._color2);
                        __button.GlowColor = MyLib._myGlobal._convertStringToColor(__objectXML._color3);
                        __button.CornerRadius = __objectXML.RoundedRectangleRadius.All;
                        __button.ButtonColor = MyLib._myGlobal._convertStringToColor(__objectXML._color4);
                        __button.TextAlign = __objectXML.ContentAlign;
                        __button.Tag = "SelectdItems=ProductCode";
                        __button.Click += new EventHandler(__button_Click);
                        __button.Invalidate();
                        __panel.Controls.Add(__button);

                    }
                }

                return __panel;

                #endregion
            }
            else if (__objectXML._controlType == SMLPOSControl._posControls.Image)
            {
                #region Get Image

                control._posPictureBox __image = new control._posPictureBox();
                __image.Location = new Point(__objectXML.X, __objectXML.Y);
                __image.Size = new Size(__objectXML.Width, __objectXML.Height);

                //__image.BorderStyle = System.Windows.Forms.BorderStyle.
                __image.BackColor = MyLib._myGlobal._convertStringToColor(__objectXML.BackgroundColor);
                __image.SizeMode = __objectXML.PictureBoxSizeMode;

                if (__objectXML.Image != null)
                {
                    __image.Image = MyLib._myGlobal._base64ToImage(__objectXML.Image);
                }

                __image._id = (__objectXML._id == null) ? "" : __objectXML._id;
                return __image;

                #endregion
            }
            else if (__objectXML._controlType == SMLPOSControl._posControls.HTML)
            {
                #region Get Html Browser

                control._posHTML __browser = new control._posHTML();
                __browser.ScriptErrorsSuppressed = true;
                __browser.Location = new Point(__objectXML.X, __objectXML.Y);
                __browser.Size = new Size(__objectXML.Width, __objectXML.Height);
                __browser.Navigate(__objectXML.Text.Equals("") ? "about:blank" : __objectXML.Text);
                //__browser.Name = __objectXML._id;
                __browser.ScrollBarsEnabled = __objectXML._scrollBarEnable;
                __browser._id = (__objectXML._id == null) ? "" : __objectXML._id;
                __browser._htmlSchema = __objectXML.Value;

                return __browser;

                #endregion

            }
            else if (__objectXML._controlType == SMLPOSControl._posControls.TextBox)
            {
                #region Get TextBox

                control._posTextbox __textBox = new control._posTextbox();

                __textBox.Location = new Point(__objectXML.X, __objectXML.Y);
                __textBox.Size = new Size(__objectXML.Width, __objectXML.Height);
                __textBox._id = (__objectXML._id == null) ? "" : __objectXML._id;
                __textBox._setAlignment = __objectXML.ContentAlign;
                try
                {
                    if (__objectXML.Color == null)
                        __textBox.ForeColor = Color.Black;
                    else
                        __textBox.ForeColor = MyLib._myGlobal._convertStringToColor(__objectXML.Color);
                }
                catch
                {
                }

                try
                {
                    __textBox.BackColor = MyLib._myGlobal._convertStringToColor(__objectXML.BackgroundColor);
                }
                catch
                {
                }
                try
                {
                    __textBox.Font = new Font(__objectXML.FontName, __objectXML.FontSize, __objectXML.FontStyle, GraphicsUnit.Point, 222);
                }
                catch
                {
                }
                __textBox.Tag = __objectXML._tag;

                // event keypress
                __textBox.KeyDown += (s1, e1) =>
                {
                    if (e1.KeyData == Keys.Enter)
                    {
                        e1.SuppressKeyPress = true;
                    }
                };
                __textBox.KeyUp += new KeyEventHandler(__textBox_KeyUp);
                return __textBox;

                #endregion
            }
            else if (__objectXML._controlType == SMLPOSControl._posControls.SearchLevel)
            {
                SMLInventoryControl._itemSearchLevelControl __searchControl = new SMLInventoryControl._itemSearchLevelControl(false);
                __searchControl.Location = new Point(__objectXML.X, __objectXML.Y);
                __searchControl.Size = new Size(__objectXML.Width, __objectXML.Height);
                __searchControl._productBasket = false;
                __searchControl.toolStrip1.Visible = false;
                __searchControl._qtyAddButton.Visible = false;
                __searchControl._qtyReduceButton.Visible = false;
                __searchControl._qtyTextBox.Visible = false;
                __searchControl._deleteLastItemButton.Visible = false;
                __searchControl._renewItemButton.Visible = false;
                __searchControl._menuItemClick += (menuSender, menuEvent) =>
                {
                    SMLInventoryControl._itemSearchLevelMenuControl __obj = (SMLInventoryControl._itemSearchLevelMenuControl)menuSender;
                    this._command("append:textbox:input=" + __obj._barcode + "@end:textbox:input", "");
                    //if (__obj._price != -1)
                    //{
                    //    this._command("&command&,*1*" + __obj._price + "@end:textbox:input", serialNumber);
                    //}

                };
                return __searchControl;

            }

            return null;
        }


        #endregion

        #region POS ชำระเงิน

        bool _checkPeroidAgain = true;
        bool _checkFloatAgain = true;


        void _payDialog()
        {
            if (_checkPeroidAgain == true)
            {
                MyLib._myFrameWork __myFrameWork = new MyLib._myFrameWork();
                DataTable __dt = __myFrameWork._queryShort("select * from " + _g.d.pos_period._table + " where " + _g.d.pos_period._machine_code + "=\'" + this._posConfig._posid + "\'  order by " + _g.d.pos_period._period_status + "," + _g.d.pos_period._begin_date + " desc," + _g.d.pos_period._begin_time + " desc").Tables[0];
                if (__dt.Rows.Count > 0)
                {
                    DateTime __openDate = MyLib._myGlobal._convertDateFromQuery(__dt.Rows[0][_g.d.pos_period._begin_date].ToString());
                    string __openTime = __dt.Rows[0][_g.d.pos_period._begin_time].ToString();
                    string __periodGuid = __dt.Rows[0][_g.d.pos_period._period_guid].ToString();
                    string[] __splitTime = __openTime.Split(':');


                    if (this._warning_peroid_open)
                    {
                        if (__dt.Rows.Count > 0)
                        {
                            int __status = (int)MyLib._myGlobal._decimalPhase(__dt.Rows[0][_g.d.pos_period._period_status].ToString());
                            if (__status == 0)
                            {
                                __openPeroidDate = new DateTime(__openDate.Year, __openDate.Month, __openDate.Day, MyLib._myGlobal._intPhase(__splitTime[0]), MyLib._myGlobal._intPhase(__splitTime[1]), 0);
                                _checkPeroidAgain = false;
                                this._periodGuid = __periodGuid;
                            }
                            else
                            {
                                MessageBox.Show("ยังไม่ได้ทำการเปิดกะ กรุณาเปิดกะ ก่อนทำรายการ", "warning", MessageBoxButtons.OK, MessageBoxIcon.Error);
                                return;
                            }
                        }
                        else
                        {
                            MessageBox.Show("ยังไม่ได้ทำการเปิดกะ กรุณาเปิดกะ ก่อนทำรายการ", "warning", MessageBoxButtons.OK, MessageBoxIcon.Error);
                            return;
                        }

                    }
                    else
                    {
                        // ต่อไปไม่เช็คอีก
                        _checkPeroidAgain = false;

                        // this._periodGuid = __periodGuid;
                    }
                }
                else
                {
                    if (this._warning_peroid_open)
                    {
                        MessageBox.Show("ยังไม่ได้ทำการเปิดกะ กรุณาเปิดกะ ก่อนทำรายการ", "warning", MessageBoxButtons.OK, MessageBoxIcon.Error);
                        return;
                    }
                    else
                    {
                        _checkPeroidAgain = false;
                    }
                }

            }

            if (_checkCashDrawerStatusOpen() == true)
            {
                return;
            }

            if (_checkFloatAgain == true)
            {
                if (this._checkFloatMoney == true)
                {
                    MyLib._myFrameWork __myFrameWork = new MyLib._myFrameWork();

                    // check period
                    string __docDateTimeWhere = "";

                    __docDateTimeWhere = " and " + _g.d.POSCashierSettle._DocDate + " >= \'" + DateTime.Now.ToString(_dateFormat, new CultureInfo("en-US")) + "\' ";

                    // มีการเปิดกะ ใช้เวลาเปิดกะ เป็นหลัก
                    if (this._periodGuid.Length > 0)
                    {
                        __docDateTimeWhere = " and " + _g.d.POSCashierSettle._DocDate + " >= \'" + __openPeroidDate.ToString(_dateFormat, new CultureInfo("en-US")) + "\' and " + _g.d.POSCashierSettle._doc_time + " >= \'" + __openPeroidDate.ToString("HH:mm") + "\' ";
                    }

                    DataTable __dt = __myFrameWork._queryShort("select " + _g.d.POSCashierSettle._CashAmount + " from " + _g.d.POSCashierSettle._table + " where " + _g.d.POSCashierSettle._MACHINECODE + "=\'" + this._posConfig._posid + "\' " + __docDateTimeWhere).Tables[0];
                    if (__dt.Rows.Count > 0)
                    {
                        _checkFloatAgain = false;
                    }
                    else
                    {
                        MessageBox.Show("ยังไม่ได้รับเงินทอน กรุณารับเงินทอน ก่อนทำรายการ", "warning", MessageBoxButtons.OK, MessageBoxIcon.Error);
                        return;
                    }
                }
                else
                {
                    _checkFloatAgain = false;
                }
            }


            _sendMessage("clear:textbox,input", null, "");
            if (this._totalAmount > 0)
            {
                string __docNo = _g.g._getAutoRun(_g.g._autoRunType.ข้อมูลรายวัน, this._posConfig._posid, DateTime.Now.ToString(this._dateFormat, new CultureInfo("th-TH")), this._posDocFormat, _g.g._transControlTypeEnum.ขาย_ขายสินค้าและบริการ, _g.g._transControlTypeEnum.ว่าง, "", this._posRunningDocFormat);

                if (__docNo.Length > 0)
                {
                    this._writeDisplay("Total : ", this._totalAmount.ToString(this._formatNumber1), "", "r");
                    if (this._posConfig._android_customer_display)
                    {
                        _androidCustomerScreen._setConfig(this._posConfig);
                        _androidCustomerScreen._singleCommand(_g.g._androidDisplayEnum.Clear, "");
                        StringBuilder __str = new StringBuilder(MyLib._myGlobal._xmlHeader);
                        __str.Append("<node>");
                        __str.Append(_androidCustomerScreen._add(_g.g._androidDisplayEnum.AmountWord, "รวมทั้งสิ้น"));
                        __str.Append(_androidCustomerScreen._add(_g.g._androidDisplayEnum.Amount, this._totalAmount.ToString(this._formatNumber1)));
                        __str.Append("</node>");
                        _androidCustomerScreen._send(__str.ToString());
                    }

                    //bool _isDefaultCust = (this._custCode.Length > 0 && this._custCode.Equals(this._posDefaultCust) == false) ? false : true;
                    bool __useChangeOtherCurrency = false;
                    decimal __exChangeRate = 1;
                    if (this._change_currency_code.Length > 0 && this._exchangeRate != 1)
                    {
                        __useChangeOtherCurrency = true;
                        __exChangeRate = this._exchangeRate;
                    }

                    _posPayForm __pay = new _posPayForm(this._posConfig, this._custCode, this._totalExtraDiscountAmount, (this._totalAmount + this._discountAmount) - (this._vatExcludeAmount), this._totalAmountVat, this._totalAmountExceptVat, this._pointBalance, this._close_discount_bill, this._foodDiscountAmount, this._discountWord, this._serviceChargeAmount, this._serviceChargeWord, this._use_credit_sale, __useChangeOtherCurrency, __exChangeRate);



                    if (this._custCode.Length > 0 && this._custCode.Equals(this._posDefaultCust) == false)
                    {
                        __pay._custCodeTextbox.Text = this._custCode;
                        __pay._custNameTextbox.Text = this._custName;
                    }
                    //__pay._use_credit_sale = this._use_credit_sale;
                    __pay._telephoneNumberTextbox.Text = this._sms_phoenumber;
                    __pay._checkDefaultCust += new SMLPosClient._posPayForm._checkDefaultCustEvent(__pay__checkDefaultCust);
                    __pay._saveData += new SMLPosClient._posPayForm._saveDataEvent(__pay__saveData);
                    __pay.ShowDialog(MyLib._myGlobal._mainForm);
                }
                else
                {
                    MessageBox.Show(MyLib._myGlobal._resource("ไม่พบเลขที่เอกสาร"), MyLib._myGlobal._resource("เตือน"), MessageBoxButtons.OK, MessageBoxIcon.Error);
                }
            }
            else
            {
                MessageBox.Show(MyLib._myGlobal._resource("ยังไม่มียอดเงิน"), MyLib._myGlobal._resource("เตือน"), MessageBoxButtons.OK, MessageBoxIcon.Error);
            }
        }

        bool __pay__checkDefaultCust(string custCode)
        {
            if (custCode.Length > 0 && custCode.Equals(this._posDefaultCust) == false)
            {
                return false;
            }
            return true;
        }

        void __pay__saveData(_posPayForm sender)
        {
            //MyLib._myGlobal._writeLogFile(@"C:\smlsoft\poslog.txt", DateTime.Now.ToString() + " : Start Save Process After Delegate Event\n", true);
            if (this._itemProcess.Count == 0)
            {
                MessageBox.Show(MyLib._myGlobal._resource("ไม่พบรายการสินค้า"), MyLib._myGlobal._resource("เตือน"), MessageBoxButtons.OK, MessageBoxIcon.Error);
                return;
            }

            try
            {
                sender.Close();
                _posPayForm __sender = (_posPayForm)sender;
                ArrayList __itemListForProcess = new ArrayList();
                MyLib._myFrameWork __myFrameWork = new _myFrameWork();
                string __docNo = _g.g._getAutoRun(_g.g._autoRunType.ข้อมูลรายวัน, this._posConfig._posid, DateTime.Now.ToString(this._dateFormat, MyLib._myGlobal._cultureInfo()), ((__sender._inquery_type == 0 && this._creditDocFormat.Length > 0) ? this._creditDocFormat : this._posDocFormat), _g.g._transControlTypeEnum.ขาย_ขายสินค้าและบริการ, _g.g._transControlTypeEnum.ว่าง, "", ((__sender._inquery_type == 0 && this._creditDocFormat.Length > 0) ? this._creditRunningFormat : this._posRunningDocFormat));
                _sendMessage("update:button,doc_no", __docNo, "");
                string __docGuid = "";

                // ตรวจ guid ว่าซ้ำหรือเปล่า
                //MyLib._myGlobal._writeLogFile(@"C:\smlsoft\poslog.txt", DateTime.Now.ToString() + " : Before Check Doc GUID", false);

                if (this._posConfig._pos_no_print_barcode_slip == false)
                {
                    while (true)
                    {
                        __docGuid = MyLib._myUtil._genBarCodeEan13(this._newKey());
                        DataTable __getGuid = __myFrameWork._queryShort("select " + _g.d.ic_trans._doc_no_guid + " from " + _g.d.ic_trans._table + " where " + _g.d.ic_trans._doc_no_guid + "=\'" + __docGuid + "\'").Tables[0];
                        if (__getGuid.Rows.Count == 0)
                        {
                            break;
                        }
                    }
                }

                //MyLib._myGlobal._writeLogFile(@"C:\smlsoft\poslog.txt", DateTime.Now.ToString() + " : After Check Doc GUID", false);
                string __docDate = DateTime.Now.ToString(_dateFormat, new CultureInfo("en-US"));
                string __docTime = DateTime.Now.ToString("HH:mm");
                if (__openPeroidDate > DateTime.Now)
                {
                    __docDate = DateTime.Now.ToString(_dateFormat, new CultureInfo("en-US"));
                    __docTime = __openPeroidDate.ToString("HH:mm");
                }

                // หัวเอกสาร
                // 
                Boolean __haveSerialNumber = false;
                decimal __discountTotalAmount = __sender._discountTotalAmount;
                decimal __totalVatAmount = __sender._vatAmount;
                decimal __totalBeforeVat = __sender._totalBeforeVat;
                decimal __totalAfterVat = __sender._totalBeforeVat + __totalVatAmount;
                decimal __totalAmount = (__sender._totalAmount + __sender._serviceChargeAmount + ((this._posConfig._pos_vat_type == 1) ? __sender._vatAmount : 0)) - (__discountTotalAmount + __sender._totalAdvanceAmount);

                string __remark = __sender._remarkTextbox.Text;
                string __telephone_number = __sender._telephoneNumberTextbox.Text;

                if (_g.g._companyProfile._calc_point_from_pay == true)
                {
                    if (this._point_member_only == false || (this._point_member_only == true && this._memberCode.Trim().Length > 0))
                    {
                        decimal __totalAmountPoint = __totalAmount - (__sender._couponAmount + __sender._pointAmount + __sender._totalAdvanceAmount + __sender._totalDepositAmount); // ยอดเงินสด

                        this._pointSum = (this._pointDivAmount == 0M) ? 0M : Math.Floor(__totalAmountPoint / this._pointDivAmount);

                        // toe x แต้ม
                        if (this._pointSpecialDayMultiply > 0)
                        {
                            this._pointSum *= this._pointSpecialDayMultiply;
                        }

                        if (this._usePointMonthBirth && this._isBirthMonthMember && this._pointMultiplyMonthBirth > 0)
                        {
                            this._pointSum *= this._pointMultiplyMonthBirth;
                        }

                        if (this._usePointBirthDay && this._isBirthDayMember && this._pointMultiplyBirthDay > 0)
                        {
                            this._pointSum *= this._pointMultiplyBirthDay;
                        }

                    }
                }

                decimal __pointMember = (this._memberCode.Trim().Length > 0 && (this._memberCode.Equals(this._posDefaultCust) == false)) ? this._pointSum : 0;
                decimal __pointTelephone = (__telephone_number.Length > 0) ? this._pointSum : 0;

                StringBuilder __myQuery = new StringBuilder();
                __myQuery.Append(MyLib._myGlobal._xmlHeader + "<node>");
                // หัวเอกสาร
                string __field = MyLib._myGlobal._fieldAndComma(
                    _g.d.ic_trans._doc_date,
                    _g.d.ic_trans._doc_time,
                    _g.d.ic_trans._doc_no,
                    _g.d.ic_trans._tax_doc_date,
                    _g.d.ic_trans._tax_doc_no,
                    _g.d.ic_trans._vat_rate,
                    _g.d.ic_trans._sale_code,
                    _g.d.ic_trans._cashier_code,
                    _g.d.ic_trans._cust_code,
                    _g.d.ic_trans._trans_flag,
                    _g.d.ic_trans._trans_type,
                    _g.d.ic_trans._inquiry_type,
                    _g.d.ic_trans._vat_type,
                    _g.d.ic_trans._last_status,
                    _g.d.ic_trans._discount_word,
                    _g.d.ic_trans._total_discount,
                    _g.d.ic_trans._total_before_vat,
                    _g.d.ic_trans._total_vat_value,
                    _g.d.ic_trans._total_after_vat,
                    _g.d.ic_trans._total_except_vat,
                    _g.d.ic_trans._total_amount,
                    _g.d.ic_trans._total_value,
                    _g.d.ic_trans._pos_id,
                    _g.d.ic_trans._is_pos,
                    _g.d.ic_trans._pos_bill_type,
                    _g.d.ic_trans._pos_bill_change,
                    _g.d.ic_trans._member_code,
                    _g.d.ic_trans._doc_no_guid,
                    _g.d.ic_trans._sum_point,
                    _g.d.ic_trans._doc_format_code,
                    _g.d.ic_trans._service_charge_word,
                    _g.d.ic_trans._total_service_charge,
                    _g.d.ic_trans._advance_amount,
                    _g.d.ic_trans._branch_code,
                    _g.d.ic_trans._sale_shift_id,
                    _g.d.ic_trans._remark,
                    _g.d.ic_trans._table_number,
                    _g.d.ic_trans._period_guid,
                    _g.d.ic_trans._point_telephone,
                    _g.d.ic_trans._sum_point_2,
                    _g.d.ic_trans._department_code,
                    _g.d.ic_trans._create_datetime);
                string __value = MyLib._myGlobal._fieldAndComma(
                    "\'" + __docDate + "\'",
                    "\'" + __docTime + "\'",
                    "\'" + __docNo + "\'",
                    "\'" + __docDate + "\'",
                    "\'" + __docNo + "\'",
                    _g.g._companyProfile._vat_rate.ToString(),
                    "\'" + this._saleCode + "\'",
                    "\'" + this._posLoginCode + "\'",
                    "\'" + __sender._custCode + "\'",
                    _g.g._transFlagGlobal._transFlag(_g.g._transControlTypeEnum.ขาย_ขายสินค้าและบริการ).ToString(),
                    "2",
                    ((__sender._inquery_type == 0) ? "0" : "1"),
                    ((this._posConfig._pos_vat_type == 1) ? "0" : "1"),
                    "0",
                    "\'" + __sender._textBoxDiscount.Text + "\'",
                    __discountTotalAmount.ToString(),
                    __totalBeforeVat.ToString(),
                    __totalVatAmount.ToString(),
                    __totalAfterVat.ToString(),
                    this._totalAmountExceptVat.ToString(),
                    __totalAmount.ToString(),
                    __sender._totalValue.ToString(),
                    "\'" + this._posConfig._posid + "\'",
                    "1",
                    "0",
                    "0",
                    "\'" + this._memberCode + "\'",
                    "\'" + __docGuid + "\'",
                    __pointMember.ToString(),
                    "\'" + ((__sender._inquery_type == 0 && this._doc_format_code_credit.Length > 0) ? this._doc_format_code_credit : this._pos_doc_format_code) + "\'",
                    "\'" + __sender._serviceChargeWord + "\'",
                    __sender._serviceChargeAmount.ToString(),
                    __sender._totalAdvanceAmount.ToString(),
                    "\'" + MyLib._myGlobal._branchCode + "\'",
                    "\'" + _g.g._companyProfile._sale_shift_id + "\'",
                    "\'" + MyLib._myGlobal._convertStrToQuery(__remark) + "\'",
                    "\'" + this._tableNumberSelect + "\'",
                    "\'" + this._periodGuid + "\'",
                    "\'" + __telephone_number + "\'",
                    __pointTelephone.ToString(),
                    "\'" + this._department_code + "\'",
                    "now()");
             
                __myQuery.Append(MyLib._myUtil._convertTextToXmlForQuery("insert into " + _g.d.ic_trans._table + " (" + __field + ") values (" + __value + ")"));

                // รายละเอียดสินค้า
                //MyLib._myGlobal._writeLogFile(@"C:\smlsoft\poslog.txt", DateTime.Now.ToString() + " : Before Pack Item Trans Detail", false);

                // step
                // หายอดรวมสินค้า มี vat
                // หายอดรวมสินค้า ไมีมี vat
                // หักส่วนลด ท้ายบิล ยอดไม่มี vat ก่อน
                // ถ้า ส่วนลดคงเหลืออีก หักส่วนลดยอด มี vat
                // เอายอดรวม ของสินค้ามี vat ไปหา vat ใน

                decimal __sum_qty = 0M;

                for (int __row = 0; __row < this._itemProcess.Count; __row++)
                {

                    if (this._itemProcess[__row]._isPromotionProduct == true)
                    {
                        // insert to ic_trans_detail_promotion
                        string __detailPromotionField = MyLib._myGlobal._fieldAndComma(_g.d.ic_trans_detail_promotion._doc_no, _g.d.ic_trans_detail_promotion._doc_date, _g.d.ic_trans_detail_promotion._trans_flag, _g.d.ic_trans_detail_promotion._promotion_code, _g.d.ic_trans_detail_promotion._promotion_name, _g.d.ic_trans_detail_promotion._qty, _g.d.ic_trans_detail_promotion._price, _g.d.ic_trans_detail_promotion._sum_amount, _g.d.ic_trans_detail_promotion._line_number);
                        string __detailPromotionValue = MyLib._myGlobal._fieldAndComma("\'" + __docNo + "\'", "\'" + __docDate + "\'", _g.g._transFlagGlobal._transFlag(_g.g._transControlTypeEnum.ขาย_ขายสินค้าและบริการ).ToString(), "\'" + this._itemProcess[__row]._promotionCode + "\'", "\'" + this._itemProcess[__row]._itemName.Replace("\'", "\'\'") + "\'", this._itemProcess[__row]._qty.ToString(), this._itemProcess[__row]._price.ToString(), this._itemProcess[__row]._amount.ToString(), __row.ToString());
                        __myQuery.Append(MyLib._myUtil._convertTextToXmlForQuery("insert into " + _g.d.ic_trans_detail_promotion._table + " (" + __detailPromotionField + ") values (" + __detailPromotionValue + ")"));
                    }
                    else
                    {
                        string __detailField = MyLib._myGlobal._fieldAndComma(_g.d.ic_trans_detail._doc_date, _g.d.ic_trans_detail._doc_time, _g.d.ic_trans_detail._doc_date_calc, _g.d.ic_trans_detail._doc_time_calc, _g.d.ic_trans_detail._doc_no, _g.d.ic_trans_detail._cust_code, _g.d.ic_trans_detail._trans_flag, _g.d.ic_trans_detail._trans_type, _g.d.ic_trans_detail._calc_flag, _g.d.ic_trans_detail._barcode, _g.d.ic_trans_detail._item_code, _g.d.ic_trans_detail._item_name, _g.d.ic_trans_detail._unit_code, _g.d.ic_trans_detail._qty, _g.d.ic_trans_detail._price, _g.d.ic_trans_detail._discount, _g.d.ic_trans_detail._discount_amount, _g.d.ic_trans_detail._sum_amount, _g.d.ic_trans_detail._last_status, _g.d.ic_trans_detail._status, _g.d.ic_trans_detail._line_number, _g.d.ic_trans_detail._vat_type, _g.d.ic_trans_detail._tax_type, _g.d.ic_trans_detail._wh_code, _g.d.ic_trans_detail._shelf_code, _g.d.ic_trans_detail._item_type, _g.d.ic_trans_detail._stand_value, _g.d.ic_trans_detail._divide_value, _g.d.ic_trans_detail._discount_number, _g.d.ic_trans_detail._price_changed, _g.d.ic_trans_detail._discount_changed, _g.d.ic_trans_detail._remark, _g.d.ic_trans_detail._price_default, _g.d.ic_trans_detail._is_pos, _g.d.ic_trans_detail._sum_amount_exclude_vat, _g.d.ic_trans_detail._total_vat_value, _g.d.ic_trans_detail._is_serial_number, _g.d.ic_trans_detail._inquiry_type, _g.d.ic_trans_detail._sale_code, _g.d.ic_trans_detail._price_type, _g.d.ic_trans_detail._branch_code, _g.d.ic_trans_detail._sale_shift_id, _g.d.ic_trans_detail._price_base);
                        string __detailValue = MyLib._myGlobal._fieldAndComma("\'" + __docDate + "\'", "\'" + __docTime + "\'", "\'" + __docDate + "\'", "\'" + __docTime + "\'", "\'" + __docNo + "\'", "\'" + __sender._custCode + "\'", _g.g._transFlagGlobal._transFlag(_g.g._transControlTypeEnum.ขาย_ขายสินค้าและบริการ).ToString(), "2", "-1", "\'" + this._itemProcess[__row]._barCode + "\'", "\'" + this._itemProcess[__row]._itemCode + "\'", "\'" + this._itemProcess[__row]._itemName.Replace("\'", "\'\'") + "\'", "\'" + this._itemProcess[__row]._unitCode + "\'", this._itemProcess[__row]._qty.ToString(), this._itemProcess[__row]._price.ToString(), "\'" + this._itemProcess[__row]._discountWord + "\'", this._itemProcess[__row]._discount.ToString(), this._itemProcess[__row]._amount.ToString(), "0", "0", __row.ToString(), "1", this._itemProcess[__row]._taxType.ToString(), "\'" + this._posWareHouse + "\'", "\'" + this._posLocation + "\'", this._itemProcess[__row]._itemType.ToString(), this._itemProcess[__row]._standValue.ToString(), this._itemProcess[__row]._divideValue.ToString(), this._itemProcess[__row]._discountNumber.ToString(), this._itemProcess[__row]._isChangePrice.ToString(), this._itemProcess[__row]._isChangeDiscount.ToString(), "\'" + this._itemProcess[__row]._priceInfo.ToString() + "\'", this._itemProcess[__row]._priceDefault.ToString(), "1", this._itemProcess[__row]._sumAmountExcludeVat.ToString(), this._itemProcess[__row]._totalVatValue.ToString(), (this._itemProcess[__row]._serialNumber.Length > 0) ? "1" : "0", (__sender._inquery_type == 0) ? "0" : "1", "'" + this._saleCode + "'", this._itemProcess[__row]._price_type.ToString(), "\'" + MyLib._myGlobal._branchCode + "\'", "\'" + _g.g._companyProfile._sale_shift_id + "\'", this._itemProcess[__row]._price_base.ToString());

                        string __itemSetField = MyLib._myGlobal._fieldAndComma(_g.d.ic_trans_detail._ref_guid, _g.d.ic_trans_detail._set_ref_line, _g.d.ic_trans_detail._item_code_main, _g.d.ic_trans_detail._set_ref_qty, _g.d.ic_trans_detail._set_ref_price, _g.d.ic_trans_detail._price_set_ratio, _g.d.ic_trans_detail._ref_row);
                        string __itemSetValue = MyLib._myGlobal._fieldAndComma("\'" + this._itemProcess[__row]._ref_guid + "\'", "\'" + this._itemProcess[__row]._set_ref_line + "\'", "\'" + this._itemProcess[__row]._item_code_main + "\'", this._itemProcess[__row]._set_ref_qty.ToString(), this._itemProcess[__row]._set_ref_price.ToString(), this._itemProcess[__row]._price_set_ratio.ToString(), this._itemProcess[__row]._ref_row.ToString());

                        __sum_qty += this._itemProcess[__row]._qty;

                        __myQuery.Append(MyLib._myUtil._convertTextToXmlForQuery("insert into " + _g.d.ic_trans_detail._table + " (" + __detailField + "," + __itemSetField + ") values (" + __detailValue + "," + __itemSetValue + ")"));
                        if (this._itemProcess[__row]._serialNumber.Length > 0)
                        {
                            // Serial Number
                            string __fieldSerialNumber = MyLib._myGlobal._fieldAndComma(
                                _g.d.ic_trans_serial_number._doc_no,
                                _g.d.ic_trans_serial_number._doc_date,
                                _g.d.ic_trans_serial_number._doc_time,
                                _g.d.ic_trans_serial_number._line_number,
                                _g.d.ic_trans_serial_number._doc_line_number,
                                _g.d.ic_trans_serial_number._trans_flag,
                                _g.d.ic_trans_serial_number._ic_code,
                                _g.d.ic_trans_serial_number._unit_code,
                                _g.d.ic_trans_serial_number._wh_code,
                                _g.d.ic_trans_serial_number._shelf_code,
                                _g.d.ic_trans_serial_number._wh_code_2,
                                _g.d.ic_trans_serial_number._shelf_code_2,
                                _g.d.ic_trans_serial_number._calc_flag,
                                _g.d.ic_trans_serial_number._description,
                                _g.d.ic_trans_serial_number._serial_number,
                                _g.d.ic_trans_serial_number._price,
                                _g.d.ic_trans_serial_number._last_status,
                                _g.d.ic_trans_serial_number._inquiry_type);

                            StringBuilder __valueSerialNumber = new StringBuilder();
                            __valueSerialNumber.Append("\'" + __docNo + "\',");
                            __valueSerialNumber.Append("\'" + __docDate + "\',");
                            __valueSerialNumber.Append("\'" + __docTime + "\',");
                            __valueSerialNumber.Append("0,");
                            __valueSerialNumber.Append((__row).ToString() + ",");
                            __valueSerialNumber.Append(_g.g._transFlagGlobal._transFlag(_g.g._transControlTypeEnum.ขาย_ขายสินค้าและบริการ).ToString() + ",");
                            __valueSerialNumber.Append("\'" + this._itemProcess[__row]._itemCode + "\',");
                            __valueSerialNumber.Append("\'" + this._itemProcess[__row]._unitCode + "\',");
                            __valueSerialNumber.Append("\'" + this._posWareHouse + "\',");
                            __valueSerialNumber.Append("\'" + this._posLocation + "\',");
                            __valueSerialNumber.Append("\'" + this._posWareHouse + "\',");
                            __valueSerialNumber.Append("\'" + this._posLocation + "\',");
                            __valueSerialNumber.Append("-1,");
                            __valueSerialNumber.Append("\'\',");
                            __valueSerialNumber.Append("\'" + this._itemProcess[__row]._serialNumber + "\',");
                            __valueSerialNumber.Append(this._itemProcess[__row]._totalVatValue.ToString() + ",");
                            __valueSerialNumber.Append("0,");
                            __valueSerialNumber.Append((__sender._inquery_type == 0) ? "0" : "1");
                            __myQuery.Append(MyLib._myUtil._convertTextToXmlForQuery("insert into " + _g.d.ic_trans_serial_number._table + " (" + __fieldSerialNumber + ") values (" + __valueSerialNumber.ToString() + ")"));
                            __haveSerialNumber = true;
                        }
                        __itemListForProcess.Add(this._itemProcess[__row]._itemCode);
                    }
                }

                //MyLib._myGlobal._writeLogFile(@"C:\smlsoft\poslog.txt", DateTime.Now.ToString() + " : After Pack Item Trans Detail", false);
                StringBuilder __couponNumberList = new StringBuilder();
                if (__sender._inquery_type.Equals(0) == false)
                {
                    // การจ่าย
                    string __fieldList = _g.d.cb_trans_detail._doc_no + "," + _g.d.cb_trans_detail._doc_date + "," + _g.d.cb_trans_detail._doc_time + "," + _g.d.cb_trans_detail._trans_type + "," + _g.d.cb_trans_detail._trans_flag + "," + _g.d.cb_trans_detail._sale_shift_id;
                    string __dataList = "\'" + __docNo + "\',\'" + __docDate + "\',\'" + __docTime + "\'," + "2" + "," + _g.g._transFlagGlobal._transFlag(_g.g._transControlTypeEnum.ขาย_ขายสินค้าและบริการ).ToString() + ",\'" + _g.g._companyProfile._sale_shift_id + "\'";

                    // บัตรเครดิต
                    __sender._payCreditCardGrid._updateRowIsChangeAll(true);
                    __myQuery.Append(__sender._payCreditCardGrid._createQueryForInsert(_g.d.cb_trans_detail._table, __fieldList + "," + _g.d.cb_trans_detail._doc_type + "," + _g.d.cb_trans_detail._trans_number_type + "," + _g.d.cb_trans_detail._ap_ar_type + "," + _g.d.cb_trans_detail._ap_ar_code + ",", __dataList + "," + "3" + "," + "1" + "," + "1" + ",\'" + __sender._custCode + "\',", false, true));

                    //MyLib._myGlobal._writeLogFile(@"C:\smlsoft\poslog.txt", DateTime.Now.ToString() + " : After Pack Credit Pay", false);

                    // คูปอง
                    __sender._payCouponGrid._updateRowIsChangeAll(true);
                    for (int __loop = 0; __loop < __sender._payCouponGrid._rowData.Count; __loop++)
                    {
                        string __number = __sender._payCouponGrid._cellGet(__loop, _g.d.cb_trans_detail._trans_number).ToString().Trim();
                        if (__number.Length > 0)
                        {
                            if (__couponNumberList.Length > 0)
                            {
                                __couponNumberList.Append(",");
                            }
                            __couponNumberList.Append(__number);
                        }
                    }
                    __myQuery.Append(__sender._payCouponGrid._createQueryForInsert(_g.d.cb_trans_detail._table, __fieldList + "," + _g.d.cb_trans_detail._doc_type + "," + _g.d.cb_trans_detail._trans_number_type + "," + _g.d.cb_trans_detail._ap_ar_type + "," + _g.d.cb_trans_detail._ap_ar_code + "," + _g.d.cb_trans_detail._last_status + ",", __dataList + "," + "9" + "," + "1" + "," + "1" + ",\'" + __sender._custCode + "\'," + "0" + ","));


                    // สกุลเงินอื่นๆ

                    __sender._payOtherCurrencyGrid._updateRowIsChangeAll(true);
                    __myQuery.Append(__sender._payOtherCurrencyGrid._createQueryForInsert(_g.d.cb_trans_detail._table, __fieldList + "," + _g.d.cb_trans_detail._doc_type + "," + _g.d.cb_trans_detail._trans_number_type + "," + _g.d.cb_trans_detail._ap_ar_type + "," + _g.d.cb_trans_detail._ap_ar_code + ",", __dataList + "," + "19" + "," + "1" + "," + "1" + ",\'" + __sender._custCode + "\',"));


                    //MyLib._myGlobal._writeLogFile(@"C:\smlsoft\poslog.txt", DateTime.Now.ToString() + " : After Pack Coupon Pay", false);

                    // รวม
                    decimal __diffAmount = __sender._diffAmount * -1; // ยอดปัดเศษ 
                    decimal __creditCardAmount = __sender._creditCardAmount;
                    decimal __couponAmount = __sender._couponAmount;
                    decimal __pointQty = __sender._pointQty; // รับชำระเป็นแต้ม
                    decimal __pointAmount = __sender._pointAmount; // รับชำระเป็นแต้ม
                    decimal __finalBalanceAmount = __sender._finalBalance - (__creditCardAmount + __couponAmount + __pointAmount + __sender._totalAdvanceAmount + __sender._totalDepositAmount); // ยอดเงินสด

                    if (__sender._payOtherCurrencyAmount > 0)
                    {
                        __finalBalanceAmount -= __sender._payOtherCurrencyAmount;
                    }

                    decimal __totalNetAmount = __sender._totalAmount; // ยอดขายรวมจ่ายทั้งสิ้น
                    decimal __totalAmountPay = __finalBalanceAmount + __creditCardAmount + __couponAmount + __pointAmount + __sender._creditCardChargeAmount; // ยอดรวมจ่ายทั้งสิ้น
                    string __fieldPay = MyLib._myGlobal._fieldAndComma(_g.d.cb_trans._sale_shift_id, _g.d.cb_trans._doc_no, _g.d.cb_trans._doc_date, _g.d.cb_trans._doc_time, _g.d.cb_trans._ap_ar_code, _g.d.cb_trans._pay_type, _g.d.cb_trans._trans_type, _g.d.cb_trans._trans_flag,
                        _g.d.cb_trans._cash_amount, _g.d.cb_trans._card_amount, _g.d.cb_trans._coupon_amount, _g.d.cb_trans._total_income_amount, _g.d.cb_trans._pay_cash_amount, _g.d.cb_trans._money_change,
                        _g.d.cb_trans._total_amount,
                        _g.d.cb_trans._total_amount_pay,
                        _g.d.cb_trans._total_net_amount,
                        _g.d.cb_trans._point_qty,
                        _g.d.cb_trans._point_amount,
                        _g.d.cb_trans._petty_cash_amount,
                        _g.d.cb_trans._chq_amount,
                        _g.d.cb_trans._tranfer_amount,
                        _g.d.cb_trans._total_tax_at_pay,
                        _g.d.cb_trans._deposit_amount,
                        _g.d.cb_trans._total_credit_charge,
                        _g.d.cb_trans._total_other_currency);
                    string __dataPay = MyLib._myGlobal._fieldAndComma("\'" + _g.g._companyProfile._sale_shift_id + "\'", "\'" + __docNo + "\'", "\'" + __docDate + "\'", "\'" + __docTime + "\'", "\'" + __sender._custCode + "\'", "1", "2", _g.g._transFlagGlobal._transFlag(_g.g._transControlTypeEnum.ขาย_ขายสินค้าและบริการ).ToString(),
                        __finalBalanceAmount.ToString(), (__creditCardAmount + __sender._creditCardChargeAmount).ToString(), __couponAmount.ToString(), __diffAmount.ToString(), __sender._payCash.ToString(), __sender._moneyChange.ToString(),
                        __totalAmount.ToString(),
                        __totalAmountPay.ToString(),
                        (__totalAmount + __sender._creditCardChargeAmount).ToString(),
                        __pointQty.ToString(),
                        __pointAmount.ToString(),
                        "0",
                        "0",
                        "0",
                        "0",
                        __sender._totalDepositAmount.ToString(),
                        __sender._creditCardChargeAmount.ToString(),
                        __sender._payOtherCurrencyAmount.ToString());
                    __myQuery.Append(MyLib._myUtil._convertTextToXmlForQuery("insert into " + _g.d.cb_trans._table + " (" + __fieldPay + ") values (" + __dataPay + ")"));
                    //

                    // เงินล่วงหน้า
                    __sender._payDepositGrid._updateRowIsChangeAll(true);
                    __myQuery.Append(__sender._payDepositGrid._createQueryForInsert(_g.d.cb_trans_detail._table, __fieldList + "," + _g.d.cb_trans_detail._doc_type + ",", __dataList + "," + "5,"));

                }
                //MyLib._myGlobal._writeLogFile(@"C:\smlsoft\poslog.txt", DateTime.Now.ToString() + " : Pack Query Success", false);

                if ((MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro) && this._isTableCheckOut == true)
                {
                    // กลับไป update status ของ table_trans 
                    string _updateTableTransquery = "update " + _g.d.table_trans._table + " set " + _g.d.table_trans._cashier_doc_date + " = \'" + __docDate + "\'," + _g.d.table_trans._cashier_doc_time + " = \'" + __docTime + "\'," + _g.d.table_trans._cashier_doc_no + " = \'" + __docNo + "\', " + _g.d.table_trans._cashier_sale_code + "=\'" + this._saleCode + "\' where " + _g.d.table_trans._trans_guid + " = \'" + this._table._transGuidNumber + "\' and  " + _g.d.table_trans._table_number + " = \'" + this._table._tableNumber + "\'";
                    __myQuery.Append(MyLib._myUtil._convertTextToXmlForQuery(_updateTableTransquery));

                    // กลับไป updage table_master status = 0, trand_guid = '', open_date = '', open_time = ''
                    string _updateTableMaster = "update " + _g.d.table_master._table + " set " + _g.d.table_master._status + " =  0, " + _g.d.table_master._trans_guid + " = '', " + _g.d.table_master._open_date + " = null, " + _g.d.table_master._open_time + " = '', " + _g.d.table_master._last_member_code + " = '', " + _g.d.table_master._last_service_charge + " = '', " + _g.d.table_master._last_discount + " = '' where " + _g.d.table_master._number + " = '" + this._table._tableNumber + "' and " + _g.d.table_master._trans_guid + " = '" + this._table._transGuidNumber + "' ";
                    __myQuery.Append(MyLib._myUtil._convertTextToXmlForQuery(_updateTableMaster));

                    // upddate table_order
                    string _updateTableOrder = "update " + _g.d.table_order._table + " set " + _g.d.table_order._last_status + "=3 where " + _g.d.table_order._table_number + " = '" + this._table._tableNumber + "' and " + _g.d.table_order._last_status + " <> 3";
                    __myQuery.Append(MyLib._myUtil._convertTextToXmlForQuery(_updateTableOrder));

                    // upddate table_order_doc
                    string _updateTableOrderDoc = "update " + _g.d.table_order_doc._table + " set " + _g.d.table_order_doc._last_status + "=3, " + _g.d.table_order_doc._cashier_doc_no + "='" + __docNo + "', " + _g.d.table_order_doc._cashier_doc_date + "='" + __docDate + "' where " + _g.d.table_order_doc._table_number + " = '" + this._table._tableNumber + "' and " + _g.d.table_order_doc._last_status + " <> 3";
                    __myQuery.Append(MyLib._myUtil._convertTextToXmlForQuery(_updateTableOrderDoc));
                }

                if ((MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong) && this._orderList.Count > 0)
                {
                    __myQuery.Append(MyLib._myUtil._convertTextToXmlForQuery("update " + _g.d.table_order._table + " set " + _g.d.table_order._last_status + "=3 where " + MyLib._myGlobal._addUpper(_g.d.table_order._doc_no) + " in (\'" + string.Join("\',\'", this._orderList.ToArray()) + "\')"));
                    __myQuery.Append(MyLib._myUtil._convertTextToXmlForQuery("update " + _g.d.table_order_doc._table + " set " + _g.d.table_order_doc._last_status + "=3 where " + MyLib._myGlobal._addUpper(_g.d.table_order_doc._doc_no) + " in (\'" + string.Join("\',\'", this._orderList.ToArray()) + "\')"));
                }

                // เงินมัดจำ
                __myQuery.Append(__sender._payAdvance._queryInsert(__sender._custCode, __docNo, "\'" + __docDate + "\'", __docTime));

                // ภาษีขาย
                string __vatFieldList = _g.d.gl_journal_vat_sale._book_code + "," + _g.d.gl_journal_vat_sale._vat_calc + "," + _g.d.gl_journal_vat_sale._trans_type + "," + _g.d.gl_journal_vat_sale._trans_flag + "," + _g.d.gl_journal_vat_sale._doc_date + "," + _g.d.gl_journal_vat_sale._doc_no + "," + _g.d.gl_journal_vat_sale._ar_code + ",";
                string __vatDataList = "\'\'," + _g.g._transTypeGlobal._vatSaleType(_g.g._transControlTypeEnum.ขาย_ขายสินค้าและบริการ).ToString() + ",2," + _g.g._transFlagGlobal._transFlag(_g.g._transControlTypeEnum.ขาย_ขายสินค้าและบริการ).ToString() + ",\'" + __docDate + "\',\'" + __docNo + "\',\'" + __sender._custCode + "\',";

                string __vatFieldList2 = MyLib._myGlobal._fieldAndComma(
                    _g.d.gl_journal_vat_sale._vat_date,
                    _g.d.gl_journal_vat_sale._vat_number,
                    _g.d.gl_journal_vat_sale._vat_effective_period,
                    _g.d.gl_journal_vat_sale._vat_effective_year,
                    _g.d.gl_journal_vat_sale._description,
                    _g.d.gl_journal_vat_sale._tax_group,
                    _g.d.gl_journal_vat_sale._base_caltax_amount,
                    _g.d.gl_journal_vat_sale._tax_rate,
                    _g.d.gl_journal_vat_sale._amount,
                    _g.d.gl_journal_vat_sale._except_tax_amount,
                    _g.d.gl_journal_vat_sale._is_add
                    );
                string __vatDataList2 = MyLib._myGlobal._fieldAndComma(
                    "\'" + __docDate + "\'",
                    "\'" + __docNo + "\'",
                    DateTime.Now.Month.ToString(),
                    (DateTime.Now.Year + +MyLib._myGlobal._year_add).ToString(),
                    "\'\'", // รายละเอียด
                    "\'\'", // กลุ่มภาษี
                    __totalBeforeVat.ToString(),
                    _g.g._companyProfile._vat_rate.ToString(),
                    __totalVatAmount.ToString(),
                    __sender._itemTotalExceptVatAmount.ToString(),
                    "0"
                    );

                string __vatQuery = "insert into " + _g.d.gl_journal_vat_sale._table + "(" + __vatFieldList + "" + __vatFieldList2 + ") values (" + __vatDataList + "" + __vatDataList2 + ")";
                __myQuery.Append(MyLib._myUtil._convertTextToXmlForQuery(__vatQuery));

                if (_g.g._companyProfile._print_packing_pos_order == true && this._isTableCheckOut == false)
                {
                    // save to table_order
                    MyLib.RandomStringGenerator __genNumber = new MyLib.RandomStringGenerator();

                    // หัวเอกสาร
                    __myQuery.Append(MyLib._myUtil._convertTextToXmlForQuery("insert into " + _g.d.table_order_doc._table + "(" + _g.d.table_order_doc._doc_no + ", " + _g.d.table_order_doc._doc_date + "," + _g.d.table_order_doc._doc_time + "," + _g.d.table_order_doc._sale_code + "," + _g.d.table_order_doc._table_number + "," + _g.d.table_order_doc._cust_code + "," + _g.d.table_order_doc._qty + "," + _g.d.table_order_doc._sum_amount + "," + _g.d.table_order_doc._trans_guid + "," + _g.d.table_order_doc._last_status + ") values " +
                        " (\'" + __docNo + "\', \'" + __docDate + "\',\'" + __docTime + "\',\'" + this._saleCode + "\',\'" + this._posConfig._posid + "\', \'" + __sender._custCode + "\'," + __sum_qty.ToString() + "," + __sender._totalValue.ToString() + ", '', 3)"));
                    // หางเอกสาร

                    for (int __row = 0; __row < this._itemProcess.Count; __row++)
                    {

                        if (this._itemProcess[__row]._isPromotionProduct == false)
                        {
                            string __fieldList = MyLib._myGlobal._fieldAndComma(
                                _g.d.table_order._doc_no,
                                _g.d.table_order._doc_date,
                                _g.d.table_order._doc_time,
                                _g.d.table_order._line_number,
                                _g.d.table_order._table_number,
                                _g.d.table_order._item_code,
                                _g.d.table_order._barcode,
                                _g.d.table_order._price,
                                _g.d.table_order._qty,
                                _g.d.table_order._qty_send,
                                _g.d.table_order._qty_cancel,
                                _g.d.table_order._qty_balance,
                                _g.d.table_order._unit_code,
                                _g.d.table_order._sum_amount,
                                _g.d.table_order._order_type,
                                _g.d.table_order._remark,
                                _g.d.table_order._kitchen_code,
                                _g.d.table_order._guid_line,
                                _g.d.table_order._last_status,
                                _g.d.table_order._trans_guid,
                                _g.d.table_order._as_item_name,
                                _g.d.table_order._confirm_guid
                                );

                            string __guid_line = Guid.NewGuid().ToString();
                            //bool __print_per_unit =  (int)this._itemGrid._cellGet(__row, _g.d.ic_inventory._print_order_per_unit);

                            // order_type 1=ลงโต๊ะ,2=กลับบ้าน, 3=develiry
                            string __valueList = MyLib._myGlobal._fieldAndComma(
                                "\'" + __docNo + "\'",
                                "\'" + __docDate + "\'",
                                "\'" + __docTime + "\'",
                                (__row + 1).ToString(),
                                "\'" + this._posConfig._posid + "\'",
                                "\'" + this._itemProcess[__row]._itemCode + "\'",
                                "\'" + this._itemProcess[__row]._itemCode + "\'", // barcode
                                this._itemProcess[__row]._price.ToString(),
                                this._itemProcess[__row]._qty.ToString(),
                                "0",
                                "0",
                                this._itemProcess[__row]._qty.ToString(),
                                "\'" + this._itemProcess[__row]._unitCode + "\'",
                                this._itemProcess[__row]._amount.ToString(),
                                //"0", toe mark qty_send ซ้ำ
                                "1", // order_type
                                "\'" + "" + "\'", // remark
                                "\'" + this._itemProcess[__row]._kitchen_code + "\'",
                                "\'" + __guid_line + "\'",
                                "3", // คิดเงินแล้ว
                                "\'" + this._trans_guid + "\'",
                                "\'" + "" + "\'", //  this._itemGrid._cellGet(__row, _g.d.table_order._as_item_name).ToString()
                                "\'" + this._itemProcess[__row]._confirm_guid + "\'"
                                );
                            __myQuery.Append(MyLib._myUtil._convertTextToXmlForQuery("insert into " + _g.d.table_order._table + " (" + __fieldList + ") values(" + __valueList + ")"));

                            // gen checker 
                            if (_g.g._companyProfile._use_order_checker == true && this._itemProcess[__row]._barcode_checker_print == true)
                            {
                                int __qty = (int)this._itemProcess[__row]._qty;
                                string __fieldMaster = MyLib._myGlobal._fieldAndComma(
                                    _g.d.order_checker._doc_date,
                                    _g.d.order_checker._doc_no,
                                    _g.d.order_checker._guid_line
                                    );

                                string __valueMaster = MyLib._myGlobal._fieldAndComma(
                                    "\'" + __docDate + "\'",
                                    "\'" + __docNo + "\'",
                                    "\'" + __guid_line + "\'"
                                    );

                                if (this._itemProcess[__row]._print_per_unit == true)
                                {
                                    // พิมพ์ใบ order แบบแยก
                                    for (int __i = 0; __i < __qty; __i++)
                                    {
                                        string __confirm_guid = MyLib._myUtil._genBarCodeEan13(__genNumber.NextString(12, false, false, true, false, false)); // Guid.NewGuid().ToString();
                                        __myQuery.Append(MyLib._myUtil._convertTextToXmlForQuery("insert into " + _g.d.order_checker._table + " (" + __fieldMaster + "," + _g.d.order_checker._guid_confirm + "," + _g.d.order_checker._order_qty + ") values (" + __valueMaster + ",\'" + __confirm_guid + "\', \'1\')"));
                                    }
                                }
                                else
                                {
                                    string __confirm_guid = MyLib._myUtil._genBarCodeEan13(__genNumber.NextString(12, false, false, true, false, false)); // Guid.NewGuid().ToString();
                                    __myQuery.Append(MyLib._myUtil._convertTextToXmlForQuery("insert into " + _g.d.order_checker._table + " (" + __fieldMaster + "," + _g.d.order_checker._guid_confirm + "," + _g.d.order_checker._order_qty + ") values (" + __valueMaster + ",\'" + __confirm_guid + "\', \'" + __qty + "\')"));
                                }
                            }
                        }
                        __myQuery.Append(MyLib._myUtil._convertTextToXmlForQuery("insert into " + _g.d.table_order_log._table + " (" + _g.d.table_order_log._date_time + "," + _g.d.table_order_log._command1 + "," + _g.d.table_order_log._message + "," + _g.d.table_order_log._sale_code + ") values (now(),\'Order\',\'Table Number : " + this._posConfig._posid + ", trans_guid : " + "" + ",Doc No : " + __docNo + "\',\'" + this._saleCode + "\')"));
                    }
                }
                // ส่ง sms
                if (MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong ||
                    MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro)
                {
                    if (__telephone_number.Trim().Length == 10)
                    {
                        __myQuery.Append(MyLib._myUtil._convertTextToXmlForQuery("insert into " + _g.d.point_center_sms._table + " (" + _g.d.point_center_sms._telephone_number + ") values (\'" + __telephone_number.Trim() + "\')"));
                    }
                }
                __myQuery.Append("</node>");

                //MyLib._myGlobal._writeLogFile(@"C:\smlsoft\poslog.txt", DateTime.Now.ToString() + " : Before Query Process Success ", false);
                //string __debugQuery = __myQuery.ToString();
                string __resultStr = __myFrameWork._queryList(MyLib._myGlobal._databaseName, __myQuery.ToString());

                //MyLib._myGlobal._writeLogFile(@"C:\smlsoft\poslog.txt", DateTime.Now.ToString() + " : Query Process Success ", false);

                if (__resultStr.Length == 0)
                {
                    _sendMessage("update:label,total_amount_2", __totalAmount.ToString(this._formatNumber1), "");
                    _sendMessage("update:label,receive_cash", __sender._payCash.ToString(this._formatNumber1), "");
                    _sendMessage("update:label,change_amount", __sender._moneyChange.ToString(this._formatNumber1), "");

                    if (__sender._inquery_type.Equals(0) == false)
                    {
                        this._writeDisplay("Receive : " + __sender._payCash.ToString(this._formatNumber1), "Change  : " + __sender._moneyChange.ToString(this._formatNumber1), "", "");
                        if (this._posConfig._android_customer_display)
                        {
                            StringBuilder __str = new StringBuilder(MyLib._myGlobal._xmlHeader);
                            __str.Append("<node>");
                            __str.Append(_androidCustomerScreen._add(_g.g._androidDisplayEnum.ItemName, "รับชำระทั้งสิ้น"));
                            __str.Append(_androidCustomerScreen._add(_g.g._androidDisplayEnum.Total, __sender._payCash.ToString(this._formatNumber1)));
                            __str.Append(_androidCustomerScreen._add(_g.g._androidDisplayEnum.AmountWord, "เงินทอน"));
                            __str.Append(_androidCustomerScreen._add(_g.g._androidDisplayEnum.Amount, __sender._moneyChange.ToString(this._formatNumber1)));
                            __str.Append("</node>");
                            _androidCustomerScreen._send(__str.ToString());
                        }

                        if (this._posConfig._use_sound_amount == 1 && __sender._payCash > 0)
                        {
                            if (__sender._moneyToVoice != null)
                            {
                                __sender._moneyToVoice._stop();
                            }
                            MyLib._moneyToVoice __moneyToVoice = new MyLib._moneyToVoice();
                            StringBuilder __sound = new StringBuilder();
                            __sound.Append(",รับเงิน," + __moneyToVoice._toText(__sender._payCash));
                            if (__sender._moneyChange != 0)
                            {
                                __sound.Append(",@," + ",เงินทอน," + __moneyToVoice._toText(__sender._moneyChange));
                            }
                            __moneyToVoice._toVoice(__sound.ToString() + ",@,@,ขอบคุณ");
                        }
                        //
                    }
                    else
                    {
                        MyLib._moneyToVoice __moneyToVoice = new MyLib._moneyToVoice();
                        StringBuilder __sound = new StringBuilder();
                        __moneyToVoice._toVoice(__sound.ToString() + ",@,@,ขอบคุณ");
                    }

                    bool _isPrint = true;

                    if (this._posConfig._invoiceSlip.Equals("0"))
                    {
                        _isPrint = false;
                    }

                    if (this._posConfig._no_print_slip == true && _isPrint == true)
                    {
                        _isPrint = false;
                    }


                    // ถามก่อนพิมพ์
                    if (this._posConfig._pos_ask_before_print && _isPrint == true)
                    {
                        if (MessageBox.Show("ยืนยันการพิมพ์ใบเสร็จรับเงิน", "ยืนยันการพิมพ์", MessageBoxButtons.YesNo, MessageBoxIcon.Question) == DialogResult.Yes)
                        {
                            _isPrint = true;
                        }
                        else
                        {
                            _isPrint = false;
                        }
                    }

                    if (_isPrint)
                    {
                        int _languageSelect = 0;
                        if (_print_multilanguage_slip == true)
                        {
                            _languageSelect = _selectLanguage();
                        }

                        if (this._posConfig._invoiceSlip.Equals("1"))
                        {
                            string __headerText = "ใบกำกับภาษีอย่างย่อ";

                            if (__sender._inquery_type == 0)
                            {
                                __headerText = "ใบส่งสินค้า/ใบกำกับภาษี";
                            }

                            if (_g.g._companyProfile._vat_rate == 0)
                            {
                                __headerText = "";
                            }

                            //MyLib._myGlobal._writeLogFile(@"C:\smlsoft\poslog.txt", DateTime.Now.ToString() + " : Start Draw Slip" , false);

                            this._printSlip(_printSlipMode.ใบกำกับภาษีอย่างย่อ, __docNo, "", "", __headerText, true, true, _languageSelect);

                            if (this._posConfig._pos_slip_copy_print)
                            {
                                for (int __i = 0; __i < this._posConfig._pos_slip_copy_printNumber; __i++)
                                {
                                    this._printSlip(_printSlipMode.ใบกำกับภาษีอย่างย่อ, __docNo, "", "- สำเนา -", __headerText, true, false, _languageSelect);
                                }
                            }

                        }
                        else if (this._posConfig._invoiceSlip.Equals("2"))
                        {
                            this._openCashDrawer();

                            // พิมพ์จาก form design
                            int __transFlag = 44;
                            SMLReport._formReport._formPrint __form = new SMLReport._formReport._formPrint(this._posConfig._slip_form);
                            __form.PrinterName = this._posConfig._pos_printer_name;

                            __form.PreviewPrintDialog = false;

                            __form._conditon.Add(new SMLReport._formReport._formPrint._conditionClass("doc_no", __docNo));
                            __form._conditon.Add(new SMLReport._formReport._formPrint._conditionClass("trans_flag", __transFlag.ToString()));
                            __form._query();

                            __form.Dispose();

                            // พิมพ์โดยดึงจากแบบฟอร์มมาพิมพ์
                        }
                        //
                    }
                    else
                    {
                        this._openCashDrawer();
                    }

                    this._finishForm = new _posFinishForm(this._posConfig);

                    if (__sender._useChangeOtherCurrency)
                    {
                        this._finishForm.Height = 537;
                    }
                    decimal __finalPayAmount = __sender._finalBalance - (__sender._couponAmount + __sender._pointAmount + __sender._totalAdvanceAmount + __sender._totalDepositAmount); // ยอดเงินสด
                    decimal __payAmount = __sender._payCash + __sender._creditCardAmount;

                    //this._finishForm._textBoxTotalAmount.Text = __totalAmount.ToString(this._formatNumber1);
                    this._finishForm._textBoxTotalAmount.Text = (__sender._useChangeOtherCurrency) ? "" : __finalPayAmount.ToString(this._formatNumber1);

                    // toe กรณีขายเชื่อแสดงเป็นค่าว่าง
                    if (__sender._inquery_type.Equals(0) == false)
                    {
                        //this._finishForm._textBoxPay.Text = __sender._sumPayMoney.ToString(this._formatNumber1);
                        //this._finishForm._textBoxChange.Text = __sender._moneyChange.ToString(this._formatNumber1);
                        this._finishForm._textBoxPay.Text = __payAmount.ToString(this._formatNumber1);
                        this._finishForm._textBoxChange.Text = (__sender._useChangeOtherCurrency) ? "" : __sender._moneyChange.ToString(this._formatNumber1);
                        this._finishForm._textboxChangeOtherCurrency.Text = __sender._changeMoneyOtherCurrency.ToString(this._formatNumber1);
                    }
                    else
                    {
                        this._finishForm._textBoxPay.Text = "-";
                        this._finishForm._textBoxChange.Text = "-";
                    }

                    this._finishForm.ShowDialog(this);

                    //MyLib._myGlobal._writeLogFile(@"C:\smlsoft\poslog.txt", DateTime.Now.ToString() + " : After Show Finish Form", false);

                    // check ก่อน
                    if (__couponNumberList.Length > 0)
                    {
                        SMLProcess._posProcess __processPos = new SMLProcess._posProcess();
                        __processPos._numberList = __couponNumberList.ToString();
                        Thread __posThread = new Thread(__processPos._processCoupon);
                        __posThread.Start();
                    }

                    // check ก่อน

                    if (__sender._totalDepositAmount > 0)
                    {
                        _processDepositMoney __processDeposit = new _processDepositMoney();
                        Thread __processDepositThread = new Thread(new ThreadStart(__processDeposit._run));
                        __processDepositThread.Start();
                    }

                    // Process
                    _processStockThread __process = new _processStockThread();
                    __process._itemList = _g.g._getItemRepack(__itemListForProcess);
                    Thread __thread = new Thread(new ThreadStart(__process._run));
                    __thread.Start();

                    // process serial number
                    if (__haveSerialNumber)
                    {
                        //SMLProcess._docFlowThread __flow = new SMLProcess._docFlowThread(_g.g._transControlTypeEnum.ขาย_ขายสินค้าและบริการ, "", "");
                        //__myQuery.Append(__flow._serialNumberQueryList());

                        _processSerialNumberThread __serialProcess = new _processSerialNumberThread();
                        Thread __processSerialThread = new Thread(new ThreadStart(__serialProcess._run));
                        __processSerialThread.Start();
                    }

                    // กรณีใช้ระบบพิมพ์ใบสั่งจัด และไม่ได้มาจากหน้าจอคิดเงินร้านอาหาร
                    if (_g.g._companyProfile._print_packing_pos_order == true && this._isTableCheckOut == false)
                    {
                        // send order to kitchen print
                        SMLPOSControl._kitchenPrintClass __printOrder = new SMLPOSControl._kitchenPrintClass();
                        __printOrder._printOrder(__docNo, __docDate, __docTime, "ใบสั่งจัดรายการ", 0);
                    }

                    // toe แทรก process ประมวลผลบัตรเครดิต
                    if (sender._payCreditCardGrid._rowData.Count > 0)
                    {
                        SMLERPGlobal._smlFrameWork __processCredit = new SMLERPGlobal._smlFrameWork();
                        Thread __threadProcessCredit = new Thread(new ThreadStart(__processCredit._processChqCreditCardCurrentDatabase));
                        __threadProcessCredit.Start();
                        // __processCredit._processChqCreditCard(MyLib._myGlobal._databaseName);

                    }

                    if ((MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro) && _g.g._companyProfile._auto_open_table == true)
                    {
                        // เปิดโต๊ะอัติโนมัติ
                        __myQuery = new StringBuilder();
                        IFormatProvider __cultureEng = new CultureInfo("en-US");
                        string __date = DateTime.Now.ToString("yyyy-MM-dd", __cultureEng);
                        string __time = DateTime.Now.ToString("HH:mm", __cultureEng);
                        __myQuery.Append(MyLib._myGlobal._xmlHeader + "<node>");
                        string __transGuid = Guid.NewGuid().ToString();

                        __myQuery.Append(MyLib._myUtil._convertTextToXmlForQuery("update " + _g.d.table_master._table + " set " + _g.d.table_master._status + "=1," + _g.d.table_master._trans_guid + "=\'" + __transGuid + "\'," + _g.d.table_master._open_date + "=\'" + __date + "\'," + _g.d.table_master._open_time + "=\'" + __time + "\' where " + MyLib._myGlobal._addUpper(_g.d.table_master._number) + " = \'" + this._tableNumberSelect.ToUpper() + "\'"));
                        __myQuery.Append(MyLib._myUtil._convertTextToXmlForQuery("insert into " + _g.d.table_trans._table + " (" + _g.d.table_trans._trans_guid + "," + _g.d.table_trans._table_number + "," + _g.d.table_trans._open_doc_date + "," + _g.d.table_trans._open_doc_time + "," + _g.d.table_trans._open_sale_code + "," + _g.d.table_trans._customer_count + ") values (\'" + __transGuid + "\',\'" + this._tableNumberSelect.ToUpper() + "\',\'" + __date + "\',\'" + __time + "\',\'" + this._saleCode + "\',\'" + "0" + "\')"));

                        // log
                        __myQuery.Append(MyLib._myUtil._convertTextToXmlForQuery("insert into " + _g.d.table_order_log._table + " (" + _g.d.table_order_log._date_time + "," + _g.d.table_order_log._command1 + "," + _g.d.table_order_log._message + "," + _g.d.table_order_log._sale_code + ") values (now(),\'open\',\'Table Number : " + this._tableNumberSelect + ", trans_guid : " + __transGuid + "\', \'" + this._saleCode + "\')"));

                        __myQuery.Append("</node>");

                        string __result = __myFrameWork._queryList(MyLib._myGlobal._databaseName, __myQuery.ToString());
                    }

                    /*SMLERPGlobal._smlFrameWork __smlFrameWork = new SMLERPGlobal._smlFrameWork();
                    string __itemListStr = __smlFrameWork._getItemRepack(__itemListForProcess);
                    __resultStr = __smlFrameWork._process_stock_balance(MyLib._myGlobal._databaseName, __itemListStr, _g.g._transFlagGlobal._transFlag(_g.g._transControlTypeEnum.ขาย_ขายสินค้าและบริการ).ToString());*/
                    //

                    //MyLib._myGlobal._writeLogFile(@"C:\smlsoft\poslog.txt", DateTime.Now.ToString() + " : Start Process Stock", false);

                    // process coupon thread

                    this._newData();

                    //MyLib._myGlobal._writeLogFile(@"C:\smlsoft\poslog.txt", DateTime.Now.ToString() + " : Call New Data Success", false);

                }
                else
                {
                    MessageBox.Show(__resultStr);
                }
            }
            catch (Exception __ex)
            {
                MessageBox.Show(__ex.Message.ToString());
            }
        }

        #endregion

        #region ค้นหาและตรวจสอบ

        /// <summary>
        /// ค้นหาลูกค้า
        /// </summary>
        /// <param name="custCode"></param>
        /// <returns></returns>
        Boolean _findCust(string custCode)
        {
            MyLib._myFrameWork __myFrameWork = new _myFrameWork();
            string __query = "select " + _g.d.ar_dealer._ar_code + "," + _g.d.ar_dealer._is_staff +
                "," + "(select " + _g.d.ar_customer._name_1 + " from " + _g.d.ar_customer._table + " where " + _g.d.ar_customer._table + "." + _g.d.ar_customer._code + "=" + _g.d.ar_dealer._table + "." + _g.d.ar_dealer._ar_code + ") as " + _g.d.ar_dealer._ar_name +
                "," + "(select " + _g.d.ar_customer._point_balance + " from " + _g.d.ar_customer._table + " where " + _g.d.ar_customer._table + "." + _g.d.ar_customer._code + "=" + _g.d.ar_dealer._table + "." + _g.d.ar_dealer._ar_code + ") as " + _g.d.ar_customer._point_balance +
                "," + "(select " + _g.d.ar_customer._address + " from " + _g.d.ar_customer._table + " where " + _g.d.ar_customer._table + "." + _g.d.ar_customer._code + "=" + _g.d.ar_dealer._table + "." + _g.d.ar_dealer._ar_code + ") as " + _g.d.ar_dealer._address +
                "," + "(select " + _g.d.ar_customer._sms_phonenumber + " from " + _g.d.ar_customer._table + " where " + _g.d.ar_customer._table + "." + _g.d.ar_customer._code + "=" + _g.d.ar_dealer._table + "." + _g.d.ar_dealer._ar_code + ") as " + _g.d.ar_customer._sms_phonenumber +
                "," + "(select " + _g.d.ar_customer._birth_day + " from " + _g.d.ar_customer._table + " where " + _g.d.ar_customer._table + "." + _g.d.ar_customer._code + "=" + _g.d.ar_dealer._table + "." + _g.d.ar_dealer._ar_code + ") as " + _g.d.ar_customer._birth_day +
                "," + _g.d.ar_dealer._regist_date + "," + _g.d.ar_dealer._expire_date +
                " from " + _g.d.ar_dealer._table + " where " + MyLib._myGlobal._addUpper(_g.d.ar_dealer._code) + "=\'" + custCode.ToUpper() + "\'";
            DataSet __ds = __myFrameWork._queryShort(__query);
            if (__ds.Tables.Count > 0)
            {
                DataTable __getData = __ds.Tables[0];
                if (__getData.Rows.Count > 0)
                {
                    if (this._itemList.Count == 0)
                    {
                        if (this._check_member_expire)
                        {
                            // check expire 
                            DateTime __registDate = MyLib._myGlobal._convertDateFromQuery(__getData.Rows[0][_g.d.ar_dealer._regist_date].ToString());
                            DateTime __expireDate = MyLib._myGlobal._convertDateFromQuery(__getData.Rows[0][_g.d.ar_dealer._expire_date].ToString());
                            DateTime __toDay = new DateTime(DateTime.Now.Year, DateTime.Now.Month, DateTime.Now.Day);
                            if (__toDay < __registDate || __toDay > __expireDate)
                            {
                                if (MessageBox.Show("สมาชิกหมดอายุไปแล้ว ต้องการดำเนินการต่อไปหรือไม่", "ยืนยัน", MessageBoxButtons.YesNo, MessageBoxIcon.Asterisk, MessageBoxDefaultButton.Button2) == DialogResult.Yes)
                                {
                                    return _findAr(__getData.Rows[0][_g.d.ar_dealer._ar_code].ToString());
                                }
                                else
                                {
                                    return false;
                                }
                            }
                        }
                        this._memberCode = custCode;
                        this._custCode = __getData.Rows[0][_g.d.ar_dealer._ar_code].ToString();
                        this._custName = __getData.Rows[0][_g.d.ar_dealer._ar_name].ToString();
                        string __custAddress = __getData.Rows[0][_g.d.ar_dealer._address].ToString();



                        _sendMessage("update:button,cust_detail", this._custName + " (" + this._custCode + ")", "");
                        _sendMessage("update:label,cust_name", this._custName, "");
                        _sendMessage("update:label,cust_address", __custAddress, "");
                        this._isStaff = (MyLib._myGlobal._decimalPhase(__getData.Rows[0][_g.d.ar_dealer._is_staff].ToString()) == 1) ? true : false;

                        if (_isPharmacist || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLPOSMED)
                        {
                            // แสดงข้อมูลสุขภาพ
                            _sendMessage("updateHealthy:HTML,m_yourhealthy", string.Format("{0},{1}", this._custCode, this._memberCode), "");
                        }

                        // tomyumgoong กลับไป update ข้อมูล โต๊ะ เป็นการคิดเงินโต๊ะ
                        if ((this._table != null || this._isScreenCloseTable) && (MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro) && this._autoInsertItem == false)
                        {
                            if (this._memberCode.Trim().Length > 0 && (this._memberCode.Equals(this._posDefaultCust) == false))
                            {
                                MyLib._myFrameWork __myFramework = new _myFrameWork();
                                string __queryUdateTableTrans2 = "update " + _g.d.table_trans._table + " set " + _g.d.table_trans._cust_code + " =\'" + this._memberCode + "\' where " + _g.d.table_trans._trans_guid + "=\'" + this._trans_guid + "\' and " + _g.d.table_trans._table_number + "=\'" + this._tableNumberSelect + "\'";

                                __myFramework._queryInsertOrUpdate(MyLib._myGlobal._databaseName, __queryUdateTableTrans2);
                            }
                        }

                        // แต้ม
                        this._pointSum = 0M;
                        this._pointBalance = 0M;
                        if (this._memberCode.Trim().Length > 0 && (this._memberCode.Equals(this._posDefaultCust) == false))
                        {
                            if (_g.g._companyProfile._activeSync == true && _g.g._companyProfile._use_point_center == true)
                            {
                                this._pointBalance = MyLib._myGlobal._decimalPhase(__getData.Rows[0][_g.d.ar_customer._point_balance].ToString());
                            }
                            else
                            {
                                SMLProcess._posProcess __process = new SMLProcess._posProcess();
                                this._pointBalance = __process._pointBalance(this._custCode);
                            }
                        }
                        this._sms_phoenumber = __getData.Rows[0][_g.d.ar_customer._sms_phonenumber].ToString();
                        _sendMessage("update:label,point_info", String.Format("{0} : {1} - {2} : {3}", MyLib._myGlobal._resource("แต้มยกมา"), this._pointBalance.ToString(this._formatNumber1), MyLib._myGlobal._resource("แต้มใหม่"), this._pointSum.ToString(this._formatNumber1)), "");
                        //
                        _androidCustomerScreen._setConfig(this._posConfig);
                        StringBuilder __str = new StringBuilder(MyLib._myGlobal._xmlHeader);
                        __str.Append("<node>");
                        __str.Append(_androidCustomerScreen._add(_g.g._androidDisplayEnum.ItemName, "ชื่อ : " + this._custName));
                        if (this._pointBalance != 0)
                        {
                            __str.Append(_androidCustomerScreen._add(_g.g._androidDisplayEnum.AmountWord, "แต้มยกมา"));
                            __str.Append(_androidCustomerScreen._add(_g.g._androidDisplayEnum.Amount, this._pointBalance.ToString(this._formatNumber1)));
                        }
                        __str.Append("</node>");
                        _androidCustomerScreen._send(__str.ToString());

                        // birth day & month
                        DateTime __birthDay = MyLib._myGlobal._convertDateFromQuery(__getData.Rows[0][_g.d.ar_customer._birth_day].ToString());

                        if (__birthDay.Month == DateTime.Now.Month)
                        {
                            this._isBirthMonthMember = true;
                            if (__birthDay.Day == DateTime.Now.Day && __birthDay.Month == DateTime.Now.Month)
                            {
                                this._isBirthDayMember = true;
                            }
                        }

                        return true;
                    }
                    else
                    {
                        MessageBox.Show("มีการขายไปแล้ว ไม่สามารถเลือกสมาชิกได้");
                        return true;
                    }
                }
            }
            return false;
        }

        Boolean _findUserLogin(string __userCode)
        {
            MyLib._myFrameWork __myFrameWork = new _myFrameWork();
            string __query = "select " + _g.d.erp_user._name_1 + " from " + _g.d.erp_user._table + " where " + MyLib._myGlobal._addUpper(_g.d.erp_user._code) + "=\'" + __userCode.ToUpper() + "\'";
            DataSet __ds = __myFrameWork._queryShort(__query);
            if (__ds.Tables.Count > 0)
            {
                DataTable __getData = __ds.Tables[0];
                if (__getData.Rows.Count > 0)
                {
                    this._posLoginName = __getData.Rows[0][_g.d.erp_user._name_1].ToString();
                    _sendMessage("update:label,login_name", this._posLoginName, "");
                    return true;
                }
            }
            return false;
        }

        Boolean _findSale(string saleCode)
        {
            MyLib._myFrameWork __myFrameWork = new _myFrameWork();
            string __query = "select " + _g.d.erp_user._name_1 + " from " + _g.d.erp_user._table + " where " + MyLib._myGlobal._addUpper(_g.d.erp_user._code) + "=\'" + saleCode.ToUpper() + "\'";
            DataSet __ds = __myFrameWork._queryShort(__query);
            if (__ds.Tables.Count > 0)
            {
                DataTable __getData = __ds.Tables[0];
                if (__getData.Rows.Count > 0)
                {
                    this._saleCode = saleCode;
                    this._saleName = __getData.Rows[0][_g.d.erp_user._name_1].ToString();
                    _sendMessage("update:button,sale_info", this._saleName + " (" + this._saleCode + ")", "");
                    _sendMessage("update:label,sale_name", this._saleName, "");
                    return true;
                }
            }
            return false;
        }

        Boolean _findAr(string arCode)
        {
            MyLib._myFrameWork __myFrameWork = new _myFrameWork();
            string __query = "select " + _g.d.ar_customer._code + "," + _g.d.ar_customer._name_1 + "," + _g.d.ar_customer._point_balance + "," + _g.d.ar_customer._sms_phonenumber + "," + _g.d.ar_customer._birth_day + " from " + _g.d.ar_customer._table + " where " + MyLib._myGlobal._addUpper(_g.d.ar_customer._code) + "=\'" + arCode.ToUpper() + "\'";
            DataSet __ds = __myFrameWork._queryShort(__query);
            if (__ds.Tables.Count > 0)
            {
                DataTable __getData = __ds.Tables[0];
                if (__getData.Rows.Count > 0)
                {
                    if (this._itemList.Count == 0)
                    {
                        this._memberCode = "";
                        this._custCode = __getData.Rows[0][_g.d.ar_customer._code].ToString();
                        this._custName = __getData.Rows[0][_g.d.ar_customer._name_1].ToString();
                        this._sms_phoenumber = __getData.Rows[0][_g.d.ar_customer._sms_phonenumber].ToString();
                        _sendMessage("update:button,cust_detail", this._custName + " (" + this._custCode + ")", "");
                        _sendMessage("update:label,cust_name", this._custName, "");
                        //
                        _androidCustomerScreen._setConfig(this._posConfig);
                        StringBuilder __str = new StringBuilder(MyLib._myGlobal._xmlHeader);
                        __str.Append("<node>");
                        __str.Append(_androidCustomerScreen._add(_g.g._androidDisplayEnum.ItemName, "ชื่อ : " + this._custName));
                        if (this._pointBalance != 0)
                        {
                            __str.Append(_androidCustomerScreen._add(_g.g._androidDisplayEnum.AmountWord, "แต้มยกมา"));
                            __str.Append(_androidCustomerScreen._add(_g.g._androidDisplayEnum.Amount, this._pointBalance.ToString(this._formatNumber1)));
                        }
                        __str.Append("</node>");
                        _androidCustomerScreen._send(__str.ToString());

                        DateTime __birthDay = MyLib._myGlobal._convertDateFromQuery(__getData.Rows[0][_g.d.ar_customer._birth_day].ToString());

                        // birth day & month
                        if (__birthDay.Month == DateTime.Now.Month)
                        {
                            this._isBirthMonthMember = true;
                            if (__birthDay.Day == DateTime.Now.Day && __birthDay.Month == DateTime.Now.Month)
                            {
                                this._isBirthDayMember = true;
                            }
                        }

                        return true;
                    }
                    else
                    {
                        MessageBox.Show("มีการขายไปแล้ว ไม่สามารถเลือกสมาชิกได้");
                        return true;
                    }

                }
            }

            return false;
        }

        private bool _allowShowTotalBalance(bool showUserInputDialog)
        {
            bool __result = false;
            // เช็คจากสิทธิ์ ของผู้ใช้งานก่อน 
            MyLib._myFrameWork __myFrameWork = new MyLib._myFrameWork();
            DataTable __queryResult = __myFrameWork._queryShort("select * from " + _g.d.erp_user._table + " where " + MyLib._myGlobal._addUpper(_g.d.erp_user._code) + "=\'" + this._posLoginCode + "\' and " + _g.d.erp_user._password + "=\'" + this._posLoginPassword + "\'").Tables[0];
            if (__queryResult.Rows.Count > 0)
            {
                __result = __queryResult.Rows[0][_g.d.erp_user._show_total_balance].ToString().Equals("1") ? true : false;
            }

            if (__result == false)
            {
                if (showUserInputDialog == true)
                {
                    // ถ้าไม่ได้ ให้ ป้อน user และ password
                    _posConfimUserForm __confirmUser = new _posConfimUserForm();
                    if (__confirmUser.ShowDialog(MyLib._myGlobal._mainForm) == DialogResult.OK)
                    {
                        if (MyLib._myGlobal._isDemo == true)
                            return true;

                        string __userCode = __confirmUser._userCodeTextBox.Text.ToUpper();
                        string __userPassword = __confirmUser._passwordTextBox.Text;
                        DataTable __dt = __myFrameWork._queryShort("select " + _g.d.erp_user._cancel_pos_bill_level + "," + _g.d.erp_user._show_total_balance + " from " + _g.d.erp_user._table + " where " + MyLib._myGlobal._addUpper(_g.d.erp_user._code) + "=\'" + __userCode + "\' and " + _g.d.erp_user._password + "=\'" + __userPassword + "\'").Tables[0];
                        if (__dt.Rows.Count > 0)
                        {
                            string __strAllow = __dt.Rows[0][_g.d.erp_user._cancel_pos_bill_level].ToString();
                            __result = __dt.Rows[0][_g.d.erp_user._show_total_balance].ToString().Equals("1") ? true : false;
                            if (__result == false)
                            {
                                MessageBox.Show("ไม่สามารถแสดงยอดขาย");
                            }


                        }
                        else
                        {
                            MessageBox.Show("ไม่พบ username และ password ดังกล่าว");
                        }
                    }
                }
            }

            return __result;
        }

        private bool _allowCancelBill()
        {
            bool _result = false;
            MyLib._myFrameWork __myFrameWork = new MyLib._myFrameWork();
            DateTime __openShiftDate = DateTime.Now;
            string __openShiftTime = "";

            if (this._disable_cancel_order_outshift)
            {
                // check กะ             
                string __query = "select * from " + _g.d.pos_period._table + " where " + _g.d.pos_period._machine_code + "=\'" + this._posConfig._posid + "\' and " + _g.d.pos_period._period_status + " = 0 order by " + _g.d.pos_period._period_status + "," + _g.d.pos_period._begin_date + " desc," + _g.d.pos_period._begin_time + " desc";

                DataTable __dt = __myFrameWork._queryShort(__query.ToString()).Tables[0];

                //DataTable __dt = __myFrameWork._queryShort().Tables[0];
                if (__dt.Rows.Count > 0)
                {
                    __openShiftDate = MyLib._myGlobal._convertDateFromQuery(__dt.Rows[0][_g.d.pos_period._begin_date].ToString());
                    __openShiftTime = __dt.Rows[0][_g.d.pos_period._begin_time].ToString();
                }
                else
                {
                    MessageBox.Show("ไม่พบข้อมูลการเปิดกะ");
                    return false;
                }

            }

            if (this._posCancelBill == true)
                return true;

            // เช็คจากสิทธิ์ ของผู้ใช้งานก่อน 
            DataTable __result = __myFrameWork._queryShort("select * from " + _g.d.erp_user._table + " where " + MyLib._myGlobal._addUpper(_g.d.erp_user._code) + "=\'" + this._posLoginCode + "\' and " + _g.d.erp_user._password + "=\'" + this._posLoginPassword + "\'").Tables[0];
            if (__result.Rows.Count > 0)
            {
                _result = __result.Rows[0][_g.d.erp_user._cancel_pos_bill_level].ToString().Equals("1") ? true : false;
            }

            if (_result == false)
            {
                // ถ้าไม่ได้ ให้ ป้อน user และ password
                _posConfimUserForm __confirmUser = new _posConfimUserForm();
                if (__confirmUser.ShowDialog(MyLib._myGlobal._mainForm) == DialogResult.OK)
                {
                    string __userCode = __confirmUser._userCodeTextBox.Text.ToUpper();
                    string __userPassword = __confirmUser._passwordTextBox.Text;
                    DataTable __dt = __myFrameWork._queryShort("select " + _g.d.erp_user._cancel_pos_bill_level + "," + _g.d.erp_user._cancel_pos_bill_level + " from " + _g.d.erp_user._table + " where " + MyLib._myGlobal._addUpper(_g.d.erp_user._code) + "=\'" + __userCode + "\' and " + _g.d.erp_user._password + "=\'" + __userPassword + "\'").Tables[0];
                    if (__dt.Rows.Count > 0)
                    {
                        string __strAllow = __dt.Rows[0][_g.d.erp_user._cancel_pos_bill_level].ToString();
                        _result = __dt.Rows[0][_g.d.erp_user._cancel_pos_bill_level].ToString().Equals("1") ? true : false;

                        if (_result == false)
                        {
                            MessageBox.Show("ไม่สามารถยกเลิกใบเสร็จได้");
                        }

                    }
                    else
                    {
                        MessageBox.Show("ไม่พบ username และ password ดังกล่าว");
                    }
                }
            }

            // clear textbox
            _sendMessage("clear:textbox,input", null, "");

            return _result;
        }

        private bool _allowChangePrice()
        {
            bool _result = false;
            // เช็คจากสิทธิ์ ของผู้ใช้งานก่อน 
            MyLib._myFrameWork __myFrameWork = new MyLib._myFrameWork();
            DataTable __result = __myFrameWork._queryShort("select " + _g.d.erp_user._price_level_1 + " from " + _g.d.erp_user._table + " where " + MyLib._myGlobal._addUpper(_g.d.erp_user._code) + "=\'" + this._posLoginCode + "\' and " + _g.d.erp_user._password + "=\'" + this._posLoginPassword + "\'").Tables[0];
            if (__result.Rows.Count > 0)
            {
                _result = __result.Rows[0][_g.d.erp_user._price_level_1].ToString().Equals("1") ? true : false;
            }

            if (_result == false)
            {
                // ถ้าไม่ได้ ให้ ป้อน user และ password
                _posConfimUserForm __confirmUser = new _posConfimUserForm();
                if (__confirmUser.ShowDialog(MyLib._myGlobal._mainForm) == DialogResult.OK)
                {
                    string __userCode = __confirmUser._userCodeTextBox.Text.ToUpper();
                    string __userPassword = __confirmUser._passwordTextBox.Text;
                    DataTable __dt = __myFrameWork._queryShort("select " + _g.d.erp_user._price_level_1 + " from " + _g.d.erp_user._table + " where " + MyLib._myGlobal._addUpper(_g.d.erp_user._code) + "=\'" + __userCode + "\' and " + _g.d.erp_user._password + "=\'" + __userPassword + "\'").Tables[0];
                    if (__dt.Rows.Count > 0)
                    {
                        string __strAllow = __dt.Rows[0][_g.d.erp_user._price_level_1].ToString();
                        _result = __dt.Rows[0][_g.d.erp_user._price_level_1].ToString().Equals("1") ? true : false;

                        if (_result == false)
                        {
                            MessageBox.Show("ไม่สามารถแก้ไขราคาสินค้าได้");
                        }

                    }
                    else
                    {
                        MessageBox.Show("ไม่พบ username และ password ดังกล่าว");
                    }
                }
            }

            // clear textbox
            _sendMessage("clear:textbox,input", null, "");

            return _result;
        }

        private bool _allowChangeDiscount()
        {
            bool _result = false;
            // เช็คจากสิทธิ์ ของผู้ใช้งานก่อน 
            MyLib._myFrameWork __myFrameWork = new MyLib._myFrameWork();
            DataTable __result = __myFrameWork._queryShort("select " + _g.d.erp_user._discount_level_1 + " from " + _g.d.erp_user._table + " where " + MyLib._myGlobal._addUpper(_g.d.erp_user._code) + "=\'" + this._posLoginCode + "\' and " + _g.d.erp_user._password + "=\'" + this._posLoginPassword + "\'").Tables[0];
            if (__result.Rows.Count > 0)
            {
                _result = __result.Rows[0][_g.d.erp_user._discount_level_1].ToString().Equals("1") ? true : false;
            }

            if (_result == false)
            {
                // ถ้าไม่ได้ ให้ ป้อน user และ password
                _posConfimUserForm __confirmUser = new _posConfimUserForm();
                if (__confirmUser.ShowDialog(MyLib._myGlobal._mainForm) == DialogResult.OK)
                {
                    string __userCode = __confirmUser._userCodeTextBox.Text.ToUpper();
                    string __userPassword = __confirmUser._passwordTextBox.Text;
                    DataTable __dt = __myFrameWork._queryShort("select " + _g.d.erp_user._price_level_1 + "," + _g.d.erp_user._discount_level_1 + " from " + _g.d.erp_user._table + " where " + MyLib._myGlobal._addUpper(_g.d.erp_user._code) + "=\'" + __userCode + "\' and " + _g.d.erp_user._password + "=\'" + __userPassword + "\'").Tables[0];
                    if (__dt.Rows.Count > 0)
                    {
                        string __strAllow = __dt.Rows[0][_g.d.erp_user._price_level_1].ToString();
                        _result = __dt.Rows[0][_g.d.erp_user._discount_level_1].ToString().Equals("1") ? true : false;

                        if (_result == false)
                        {
                            MessageBox.Show("ไม่สามารถแก้ไขส่วนลดได้");
                        }

                    }
                    else
                    {
                        MessageBox.Show("ไม่พบ username และ password ดังกล่าว");
                    }
                }
            }

            // clear textbox
            _sendMessage("clear:textbox,input", null, "");
            return _result;
        }

        void _saveCommandLog(string userCode, string command, string message, string approveCode)
        {
            string __query = "insert into " + _g.d.pos_log._table + " (" + _g.d.pos_log._datetime + "," + _g.d.pos_log._user_code + "," + _g.d.pos_log._command + "," + _g.d.pos_log._message + "," + _g.d.pos_log._approve_code + ") values(now(), '{0}', '{1}', '{2}','{3}')";
            MyLib._myFrameWork __myFramework = new _myFrameWork();
            __myFramework._query(MyLib._myGlobal._databaseName, string.Format(__query, userCode, MyLib._myGlobal._convertStrToQuery(command), MyLib._myGlobal._convertStrToQuery(message), approveCode));

        }

        private bool _checkUserRight(string fieldName, string errorMessage)
        {
            bool __result = false;
            _lastApproveCode = "";

            MyLib._myFrameWork __myFrameWork = new MyLib._myFrameWork();
            DataTable __dataResult = __myFrameWork._queryShort("select " + fieldName + " from " + _g.d.erp_user._table + " where " + MyLib._myGlobal._addUpper(_g.d.erp_user._code) + "=\'" + this._posLoginCode + "\' and " + _g.d.erp_user._password + "=\'" + this._posLoginPassword + "\'").Tables[0];
            if (__dataResult.Rows.Count > 0)
            {
                __result = __dataResult.Rows[0][fieldName].ToString().Equals("1") ? true : false;
            }

            if (__result == false)
            {
                _posConfimUserForm __confirmUser = new _posConfimUserForm();
                if (__confirmUser.ShowDialog(MyLib._myGlobal._mainForm) == DialogResult.OK)
                {
                    string __userCode = __confirmUser._userCodeTextBox.Text.ToUpper();
                    string __userPassword = __confirmUser._passwordTextBox.Text;
                    DataTable __dt = __myFrameWork._queryShort("select " + fieldName + " from " + _g.d.erp_user._table + " where " + MyLib._myGlobal._addUpper(_g.d.erp_user._code) + "=\'" + __userCode + "\' and " + _g.d.erp_user._password + "=\'" + __userPassword + "\'").Tables[0];
                    if (__dt.Rows.Count > 0)
                    {
                        //string __strAllow = __dt.Rows[0][fieldName].ToString();
                        __result = __dt.Rows[0][fieldName].ToString().Equals("1") ? true : false;

                        if (__result == false)
                        {
                            MessageBox.Show(errorMessage, "ไม่อนุญาติ", MessageBoxButtons.OK, MessageBoxIcon.Error);
                        }
                        else
                        {
                            _lastApproveCode = __userCode;
                        }

                    }
                    else
                    {
                        MessageBox.Show("ไม่พบ username และ password ดังกล่าว");
                    }
                }
            }
            return __result;
        }

        private bool _allowOpenCashDrawer()
        {
            bool __result = false;

            if (this._cashdrawer_open_password == true)
            {
                __result = _checkUserRight(_g.d.erp_user._open_cash_drawer, "ไม่อนุญาติให้เปิดลิ้นชัก");
                // เช็คจากสิทธิ์ ของผู้ใช้งานก่อน 
                // toe move to checkright
                /*
                MyLib._myFrameWork __myFrameWork = new MyLib._myFrameWork();
                DataTable __dataResult = __myFrameWork._queryShort("select * from " + _g.d.erp_user._table + " where " + MyLib._myGlobal._addUpper(_g.d.erp_user._code) + "=\'" + this._posLoginCode + "\' and " + _g.d.erp_user._password + "=\'" + this._posLoginPassword + "\'").Tables[0];
                if (__dataResult.Rows.Count > 0)
                {
                    __result = __dataResult.Rows[0][_g.d.erp_user._open_cash_drawer].ToString().Equals("1") ? true : false;
                }

                if (__result == false)
                {
                    _posConfimUserForm __confirmUser = new _posConfimUserForm();
                    if (__confirmUser.ShowDialog(MyLib._myGlobal._mainForm) == DialogResult.OK)
                    {
                        string __userCode = __confirmUser._userCodeTextBox.Text.ToUpper();
                        string __userPassword = __confirmUser._passwordTextBox.Text;
                        DataTable __dt = __myFrameWork._queryShort("select * from " + _g.d.erp_user._table + " where " + MyLib._myGlobal._addUpper(_g.d.erp_user._code) + "=\'" + __userCode + "\' and " + _g.d.erp_user._password + "=\'" + __userPassword + "\'").Tables[0];
                        if (__dt.Rows.Count > 0)
                        {
                            string __strAllow = __dt.Rows[0][_g.d.erp_user._open_cash_drawer].ToString();
                            __result = __dt.Rows[0][_g.d.erp_user._open_cash_drawer].ToString().Equals("1") ? true : false;

                            if (__result == false)
                            {
                                MessageBox.Show("ไม่อนุญาติให้เปิดลิ้นชัก", "ไม่อนุญาติ", MessageBoxButtons.OK, MessageBoxIcon.Error);
                            }

                        }
                        else
                        {
                            MessageBox.Show("ไม่พบ username และ password ดังกล่าว");
                        }
                    }
                }*/

            }
            else
            {
                __result = true;
            }

            return __result;
        }

        /// <summary>
        /// ตรวจสอบการเลือกลูกค้า option เลือกลูกค้าก่อนขาย
        /// </summary>
        /// <returns></returns>
        private Boolean _checkSelectCust()
        {
            if (this._warning_select_cust == false)
                return true;
            if (this._isScreenCloseTable == true)
                return true;

            if (this._custCode.Equals(this._posDefaultCust) == false)
            {
                return true;
            }

            return false;
        }

        private Boolean _checkSaleLowStandPrice(string barcode, decimal standPrice, decimal salePrice, decimal qty, string discountWord)
        {
            if (standPrice == 0)
                return false;

            decimal __calc = qty * salePrice;
            decimal __total_amount = MyLib._myGlobal._calcAfterDiscount(discountWord, MyLib._myGlobal._round(__calc, _g.g._companyProfile._item_price_decimal), _g.g._companyProfile._item_price_decimal);

            decimal __standPriceQty = standPrice * qty;

            if (__standPriceQty > __total_amount)
            {
                MessageBox.Show(MyLib._myGlobal._resource(barcode + ":" + "ห้ามขายต่ำกว่าราคากลาง"), MyLib._myGlobal._resource("เตือน"));
                return true;
            }
            return false;
        }

        private void _checkMoneyLimit()
        {
            if (this._maxPosMoney > 0M)
            {
                MyLib._myFrameWork __myFrameWork = new MyLib._myFrameWork();

                DateTime __beginDate = DateTime.Now;
                string __beginTime = "00:00";

                // ดึงรายละเอียด การเปิดกะ
                DataTable __dt = __myFrameWork._queryShort("select * from " + _g.d.pos_period._table + " where " + _g.d.pos_period._machine_code + "=\'" + this._posConfig._posid + "\' order by " + _g.d.pos_period._period_status + "," + _g.d.pos_period._begin_date + " desc," + _g.d.pos_period._begin_time + " desc").Tables[0];
                if (__dt.Rows.Count > 0)
                {
                    int __status = (int)MyLib._myGlobal._decimalPhase(__dt.Rows[0][_g.d.pos_period._period_status].ToString());
                    if (__status == 0)
                    {
                        __beginDate = MyLib._myGlobal._convertDateFromQuery(__dt.Rows[0][_g.d.pos_period._begin_date].ToString());
                        __beginTime = __dt.Rows[0][_g.d.pos_period._begin_time].ToString();
                    }
                }
                string __dateTime = __beginDate.ToString("yyyy-MM-dd", new CultureInfo("en-US")) + " " + __beginTime + ":00";
                string __dateCompare = "to_timestamp(date(" + _g.d.POSCashierSettle._DocDate + ")||\' \'||" + _g.d.POSCashierSettle._doc_time + ",'YYYY/MM/DD HH24:MI')::timestamp";
                StringBuilder __myquery = new StringBuilder();
                __myquery.Append(MyLib._myGlobal._xmlHeader + "<node>");
                // ยอดรับเงิน (เงินทอน) - #1
                __myquery.Append(MyLib._myUtil._convertTextToXmlForQuery("select coalesce(sum(" + _g.d.POSCashierSettle._CashAmount + "), 0) as " + _g.d.POSCashierSettle._CashAmount + " from " + _g.d.POSCashierSettle._table + " where " + _g.d.POSCashierSettle._MACHINECODE + "=\'" + this._posConfig._posid + "\' and " + __dateCompare + ">=\'" + __dateTime + "\' and " + _g.d.POSCashierSettle._trans_type + "=1"));
                // ยอดส่งเงินสด - #2
                __myquery.Append(MyLib._myUtil._convertTextToXmlForQuery("select coalesce(sum(" + _g.d.POSCashierSettle._CashAmount + "), 0) as " + _g.d.POSCashierSettle._CashAmount + " from " + _g.d.POSCashierSettle._table + " where " + _g.d.POSCashierSettle._MACHINECODE + "=\'" + this._posConfig._posid + "\' and " + __dateCompare + ">=\'" + __dateTime + "\' and " + _g.d.POSCashierSettle._trans_type + "=2"));
                // ยอดส่งบัตรเครดิต - #3
                __myquery.Append(MyLib._myUtil._convertTextToXmlForQuery("select coalesce(sum(" + _g.d.POSCashierSettle._CreditCardAmount + "), 0) as " + _g.d.POSCashierSettle._CreditCardAmount + " from " + _g.d.POSCashierSettle._table + " where " + _g.d.POSCashierSettle._MACHINECODE + "=\'" + this._posConfig._posid + "\' and " + __dateCompare + ">=\'" + __dateTime + "\' and " + _g.d.POSCashierSettle._trans_type + "=2"));
                // ยอดส่งคูปอง - #4
                __myquery.Append(MyLib._myUtil._convertTextToXmlForQuery("select coalesce(sum(" + _g.d.POSCashierSettle._CoupongAmount + "), 0) as " + _g.d.POSCashierSettle._CoupongAmount + " from " + _g.d.POSCashierSettle._table + " where " + _g.d.POSCashierSettle._MACHINECODE + "=\'" + this._posConfig._posid + "\' and " + __dateCompare + ">=\'" + __dateTime + "\' and " + _g.d.POSCashierSettle._trans_type + "=2"));
                // ยอดขาย,ยอดยกเลิก,ยอดรับเงินสด,บัตรเครดิต,ปัดเศษ - #5
                string __dateCompareTrans = "to_timestamp(date(" + _g.d.ic_trans._doc_date + ")||\' \'||" + _g.d.ic_trans._doc_time + ",'YYYY/MM/DD HH24:MI')::timestamp";
                string __fieldCancel = "cancel_amount";
                string __fieldCashAmount = "cash_amount";
                string __fieldCreditCardAmount = "credit_card_amount";
                string __fieldCouponAmount = "coupon_amount";
                string __fieldDiffAmount = "diff_amount";
                string __fieldPointAmount = "point_amount";
                // เงินมัดจำ

                string __queryTrans = "select sum(" + _g.d.ic_trans._total_amount + ") as " + _g.d.ic_trans._total_amount + ", sum(" + _g.d.ic_trans._advance_amount + ") as " + _g.d.ic_trans._advance_amount + ",sum(" + __fieldCancel + ") as " + __fieldCancel + ",sum(" + __fieldCashAmount + ") as " + __fieldCashAmount + ",sum(" + __fieldCreditCardAmount + ") as " + __fieldCreditCardAmount + ",sum(" + __fieldCouponAmount + ") as " + __fieldCouponAmount + ",sum(" + __fieldDiffAmount + ") as " + __fieldDiffAmount + ",sum(" + __fieldPointAmount + ") as " + __fieldPointAmount + " from (select " + _g.d.ic_trans._pos_id + "," + _g.d.ic_trans._total_amount + ",case when " + _g.d.ic_trans._last_status + " = 1 then 0 else " + _g.d.ic_trans._advance_amount + " end as " + _g.d.ic_trans._advance_amount + ",case when " + _g.d.ic_trans._last_status + "=1 then " + _g.d.ic_trans._total_amount + " else 0 end as " + __fieldCancel + ",case when " + _g.d.ic_trans._last_status + "=1 then 0 else (select sum(" + _g.d.cb_trans._cash_amount + ") from " + _g.d.cb_trans._table + " where " + _g.d.cb_trans._table + "." + _g.d.cb_trans._doc_no + "=" + _g.d.ic_trans._table + "." + _g.d.ic_trans._doc_no + ") end as " + __fieldCashAmount + ",case when " + _g.d.ic_trans._last_status + "=1 then 0 else (select sum(" + _g.d.cb_trans._card_amount + ") from " + _g.d.cb_trans._table + " where " + _g.d.cb_trans._table + "." + _g.d.cb_trans._doc_no + "=" + _g.d.ic_trans._table + "." + _g.d.ic_trans._doc_no + ") end as " + __fieldCreditCardAmount + ",case when " + _g.d.ic_trans._last_status + "=1 then 0 else (select sum(" + _g.d.cb_trans._coupon_amount + ") from " + _g.d.cb_trans._table + " where " + _g.d.cb_trans._table + "." + _g.d.cb_trans._doc_no + "=" + _g.d.ic_trans._table + "." + _g.d.ic_trans._doc_no + ") end as " + __fieldCouponAmount + ",case when " + _g.d.ic_trans._last_status + "=1 then 0 else (select sum(" + _g.d.cb_trans._total_income_amount + ") from " + _g.d.cb_trans._table + " where " + _g.d.cb_trans._table + "." + _g.d.cb_trans._doc_no + "=" + _g.d.ic_trans._table + "." + _g.d.ic_trans._doc_no + ") end as " + __fieldDiffAmount + ", case when " + _g.d.ic_trans._last_status + "=1 then 0 else (select sum(" + _g.d.cb_trans._point_amount + ") from " + _g.d.cb_trans._table + " where " + _g.d.cb_trans._table + "." + _g.d.cb_trans._doc_no + "=" + _g.d.ic_trans._table + "." + _g.d.ic_trans._doc_no + ") end as " + __fieldPointAmount + " from " + _g.d.ic_trans._table + " where " + _g.d.ic_trans._trans_flag + "=44 and " + _g.d.ic_trans._is_pos + "=1 and " + _g.d.ic_trans._pos_id + "=\'" + this._posConfig._posid + "\' and " + __dateCompareTrans + ">=\'" + __dateTime + "\' and ( " + _g.d.ic_trans._doc_ref + " is null or " + _g.d.ic_trans._doc_ref + " = \'\') ) as temp1";
                __myquery.Append(MyLib._myUtil._convertTextToXmlForQuery(__queryTrans));
                //
                __myquery.Append("</node>");
                string __tmpQuery = __myquery.ToString();

                ArrayList __data = __myFrameWork._queryListGetData(MyLib._myGlobal._databaseName, __myquery.ToString());
                DataTable __dt1 = ((DataSet)__data[0]).Tables[0];
                DataTable __dt2 = ((DataSet)__data[1]).Tables[0];
                DataTable __dt3 = ((DataSet)__data[2]).Tables[0];
                DataTable __dt4 = ((DataSet)__data[3]).Tables[0];
                DataTable __dt5 = ((DataSet)__data[4]).Tables[0];
                decimal __totalIn = 0M;
                decimal __totalOut = 0M;
                decimal __totalOutCredit = 0M;
                decimal __totalOutCoupon = 0M;
                decimal __totalSale = 0M;
                decimal __totalSaleCancel = 0M;
                decimal __cashAmount = 0M;
                decimal __creditCardAmount = 0M;
                decimal __couponAmount = 0M;
                decimal __diffAmount = 0M;
                decimal __pointAmount = 0M;

                decimal __advanceAmount = 0M;

                if (__dt1.Rows.Count > 0) __totalIn = MyLib._myGlobal._decimalPhase(__dt1.Rows[0][_g.d.POSCashierSettle._CashAmount].ToString());
                if (__dt2.Rows.Count > 0) __totalOut = MyLib._myGlobal._decimalPhase(__dt2.Rows[0][_g.d.POSCashierSettle._CashAmount].ToString());
                if (__dt3.Rows.Count > 0) __totalOutCredit = MyLib._myGlobal._decimalPhase(__dt3.Rows[0][_g.d.POSCashierSettle._CreditCardAmount].ToString());
                if (__dt4.Rows.Count > 0) __totalOutCoupon = MyLib._myGlobal._decimalPhase(__dt4.Rows[0][_g.d.POSCashierSettle._CoupongAmount].ToString());
                if (__dt5.Rows.Count > 0)
                {
                    __totalSale = MyLib._myGlobal._decimalPhase(__dt5.Rows[0][_g.d.ic_trans._total_amount].ToString());
                    __advanceAmount = MyLib._myGlobal._decimalPhase(__dt5.Rows[0][_g.d.ic_trans._advance_amount].ToString());
                    __totalSaleCancel = MyLib._myGlobal._decimalPhase(__dt5.Rows[0][__fieldCancel].ToString());
                    //__cashAmount = MyLib._myGlobal._decimalPhase(__dt5.Rows[0][__fieldCashAmount].ToString()) + (__totalIn - (__totalOut + __totalSaleCancel));
                    __cashAmount = MyLib._myGlobal._decimalPhase(__dt5.Rows[0][__fieldCashAmount].ToString()) + (__totalIn - __totalOut);
                    __creditCardAmount = MyLib._myGlobal._decimalPhase(__dt5.Rows[0][__fieldCreditCardAmount].ToString()) - __totalOutCredit;
                    __couponAmount = MyLib._myGlobal._decimalPhase(__dt5.Rows[0][__fieldCouponAmount].ToString()) - __totalOutCoupon;
                    __diffAmount = MyLib._myGlobal._decimalPhase(__dt5.Rows[0][__fieldDiffAmount].ToString());
                    __pointAmount = MyLib._myGlobal._decimalPhase(__dt5.Rows[0][__fieldPointAmount].ToString());
                }

                // check and warning
                if (__cashAmount > this._maxPosMoney)
                {
                    MessageBox.Show(MyLib._myGlobal._resource("จำนวนเงินในลิ้นชักเกินกว่าที่กำหนดไว้"), MyLib._myGlobal._resource("warning"), MessageBoxButtons.OK, MessageBoxIcon.Exclamation);
                }

            }
        }

        #endregion

        #region POS Control Event

        void __textBox_KeyUp(object sender, KeyEventArgs e)
        {
            switch (e.KeyData)
            {
                case Keys.F1:
                    _helpForm __help = new _helpForm();
                    __help.ShowDialog(MyLib._myGlobal._mainForm);
                    break;
                case Keys.Enter:
                    _textBoxEnterKey(sender, e);
                    break;
                case Keys.F2:
                    this._command("f2", "");
                    break;
                case Keys.F3:
                    this._command("f3", "");
                    break;
                case Keys.F4:
                    this._command("f4", "");
                    break;
                case Keys.F5:
                    this._command("f5", "");
                    break;
                case Keys.F11:
                    _textBoxEnterKey(sender, e);
                    this._payDialog();
                    int a = 0;
                    int b = a + 1;
                    break;
                case Keys.F6:
                    {
                        this._command("f6", "");
                    }
                    break;
                case Keys.F7:
                    this._command("f7", "");
                    break;
                case Keys.F8:
                    this._command("f8", "");
                    break;
                case Keys.Control | Keys.P:
                    // open picture info popup
                    _openPicturePopup();
                    break;
                case Keys.Control | Keys.S:
                    this._command("&serialsearch&", "");
                    break;
            }
            return;
        }

        /// <summary>me event หลังจาก กด enter</summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        public void _textBoxEnterKey(object sender, KeyEventArgs e)
        {
            TextBox __tb = (TextBox)sender;
            string __mesage = __tb.Tag.ToString().Replace("@value@", __tb.Text);
            //MessageBox.Show(" call event mssage " + __mesage);
            this._command(__mesage, "");
        }

        void __button_Click(object sender, EventArgs e)
        {
            control._posButton __button = (control._posButton)sender;
            // 
            // MessageBox.Show("Call Event Message " + __button.Tag);
            this._command(__button.Tag.ToString(), "");
        }

        #endregion

        #region POS Message

        public void _sendMessage(string __object, string __message, string serialNumber)
        {
            try
            {
                // split ค่า
                string[] __control = __object.Split(','); // sample add:item_grid,table1,table2

                string[] __operationSplit = __control[0].Split(':');
                string __controltype = __operationSplit[1];
                string __operation = __operationSplit[0];

                string __controlFilter = __object.Replace(__control[0].ToString() + ",", string.Empty).Replace(__control[0].ToString(), string.Empty);

                switch (__controltype)
                {
                    case "button":
                        _opreation(_posClientObjectType.Button, __operation, __controlFilter, __message, serialNumber);
                        break;
                    case "label":
                        _opreation(_posClientObjectType.Label, __operation, __controlFilter, __message, serialNumber);
                        break;
                    case "textbox":
                        _opreation(_posClientObjectType.TextBox, __operation, __controlFilter, __message, serialNumber);
                        break;
                    case "item_grid":
                        _opreation(_posClientObjectType.Grid, __operation, __controlFilter, __message, serialNumber);
                        break;
                    case "image":
                        _opreation(_posClientObjectType.Image, __operation, __controlFilter, __message, serialNumber);
                        break;
                    case "HTML":
                        _opreation(_posClientObjectType.HTML, __operation, __controlFilter, __message, serialNumber);
                        break;
                }

                // get opreation
                // ส่งไป process

                // process extend form
                foreach (_posExtendForm __extendForm in _extendFormList)
                {
                    __extendForm._sendMessage(__object, __message);
                }
            }
            catch (Exception __ex)
            {
                MessageBox.Show(__ex.Message.ToString());
            }
        }

        public string _readMessage(string __object)
        {

            // get control

            // pack message 

            return null;
        }

        #endregion

        #region POS Command Operation

        /*Boolean _promotionCheck(DataRow[] condition, int row)
        {
            if (row < condition.Length)
            {
                string __itemCode = condition[row][_g.d.ic_promotion_formula_condition._condition_from].ToString();
                if (__itemCode.Trim().Length == 0)
                {
                    return true;
                }
                decimal __qtyFrom = MyLib._myGlobal._decimalPhase(condition[row][_g.d.ic_promotion_formula_condition._condition_value_from].ToString());
                decimal __qtyTo = MyLib._myGlobal._decimalPhase(condition[row][_g.d.ic_promotion_formula_condition._condition_value_to].ToString());
                for (int __loop = 0; __loop < this._itemListTemp.Count; __loop++)
                {
                    if (__itemCode.Equals(this._itemListTemp[__loop]._itemCode) && this._itemListTemp[__loop]._qty >= __qtyFrom)
                    {
                        if (row < condition.Length - 1)
                        {
                            return this._promotionCheck(condition, row + 1);
                        }
                        else
                        {
                            return true;
                        }
                    }
                }
            }
            return false;
        }*/


        /*void _promotionProcess(string promotionCode, string promotionName, DataRow[] priceAndDiscount)
        {
            for (int __loop1 = 0; __loop1 < priceAndDiscount.Length; __loop1++)
            {
                string __itemCode = priceAndDiscount[__loop1][_g.d.ic_promotion_formula_price_discount._item_code].ToString();
                string __discountWord = priceAndDiscount[__loop1][_g.d.ic_promotion_formula_price_discount._discount].ToString();
                decimal __qtyStart = MyLib._myGlobal._decimalPhase(priceAndDiscount[__loop1][_g.d.ic_promotion_formula_price_discount._qty_start].ToString());
                decimal __price = MyLib._myGlobal._decimalPhase(priceAndDiscount[__loop1][_g.d.ic_promotion_formula_price_discount._price].ToString());
                for (int __loop2 = 0; __loop2 < this._itemListTemp.Count; __loop2++)
                {
                    if (__itemCode.Equals(this._itemListTemp[__loop2]._itemCode))
                    {
                        this._itemListTemp[__loop2]._promotion_qty_balance -= (__qtyStart == 0) ? 0 : (__qtyStart - 1);
                        if (this._itemListTemp[__loop2]._promotion_qty_balance >= 0)
                        {
                            int __addr = -1;
                            for (int __loop3 = 0; __loop3 < this._promotionResult.Count; __loop3++)
                            {
                                if (this._promotionResult[__loop3]._promotionCode.Equals(promotionCode))
                                {
                                    __addr = __loop3;
                                    break;
                                }
                            }
                            _promotionResultClass __newPromotion = null;
                            if (__addr == -1)
                            {
                                __newPromotion = new _promotionResultClass();
                                this._promotionResult.Add(__newPromotion);
                                __addr = this._promotionResult.Count - 1;
                            }
                            else
                            {
                                __newPromotion = this._promotionResult[__addr];
                            }
                            __newPromotion._count++;
                            __newPromotion._promotionCode = promotionCode;
                            __newPromotion._promotionName = promotionName;
                            __newPromotion._itemCode = __itemCode;
                            __newPromotion._price = (__price == 0) ? this._itemListTemp[__loop2]._price : __price;
                            decimal __amount = __newPromotion._price * __newPromotion._qty;
                            __newPromotion._discount += (MyLib._myGlobal._calcAfterDiscount(__discountWord, MyLib._myGlobal._round(__amount, _g.g._companyProfile._item_price_decimal), _g.g._companyProfile._item_price_decimal) * this._itemListTemp[__loop2]._promotion_qty_balance);
                            if (__price != 0)
                            {
                                __newPromotion._discount += this._itemListTemp[__loop2]._amount - __newPromotion._price;
                            }
                            this._promotionResult[__addr] = __newPromotion;
                            //this._itemListTemp[__loop2]._promotion_qty_balance --;
                        }
                    }
                }
            }
        }*/

        private void _addItemToGrid(Boolean showMessage, int row)
        {
            _sendMessage("update:label,last_buy", this._lastBuy, "");
            this._lastBuy = "";
            //
            List<_promotionResultClass> __promotionDiscountResult = new List<_promotionResultClass>();
            this._itemProcess = new List<_posClientItemClass>();
            _processItem __process = new _processItem(this._itemProcess, this._isProcessPromotion, this._itemList, this._custCode, this._memberCode, this._posDefaultCust, this._promotionFormula, this._promotionFormulaCondition, this._promotionFormulaAction, this._promotionFormulaGroup, __promotionDiscountResult, this._formatNumber1, showMessage, row, this._price_type_column, this._pointBalance, this._pointDivAmount);
            __process._sendMessage += (string __object, string __message, string serialNumber) =>
            {
                this._sendMessage(__object, __message, serialNumber);
            };

            __process._promotionErrorMessage += (string __promotionName, string __mesasge) =>
            {
                MessageBox.Show("Error Promotion : " + __promotionName + "\n" + __mesasge, "Error Promotion : " + __promotionName);
            };
            __process._posConfig = this._posConfig;
            __process._foodDiscountWord = this._foodDiscountWord;
            __process._serviceChargeWord = this._serviceChargeWord;
            __process._discountWord = this._discountWord;

            // point send 
            __process._usePointBirthDay = this._usePointBirthDay;
            __process._pointMultiplyBirthDay = this._pointMultiplyBirthDay;

            __process._usePointMonthBirth = this._usePointMonthBirth;
            __process._pointMultiplyMonthBirth = this._pointMultiplyMonthBirth;

            __process._pointSpecialDayMultiply = this._pointSpecialDayMultiply;

            __process._isBirthDayMember = this._isBirthDayMember;
            __process._isBirthMonthMember = this._isBirthMonthMember;
            __process._point_member_only = this._point_member_only;

            // สั่ง process item ทำงาน
            _sendMessage("update:item_grid,sale", __process._start(), "");
            this._discountAmount = __process._discountAmount;
            this._totalAmount = __process._totalAmount;
            this._finalBalance = __process._finalBalance;
            this._vatExcludeAmount = __process._vatExcludeAmount;
            this._diffAmount = __process._diffAmount;
            this._totalAmountVat = __process._totalAmountVat;
            this._totalAmountExceptVat = __process._totalAmountExceptVat;
            this._totalExtraDiscountAmount = __process._totalExtraDiscountAmount;
            this._totalFoodAmount = __process._totalFoodAmount;
            this._totalDrinkAmount = __process._totalDrinkAmount;
            this._pointSum = __process._pointSum;
            this._foodDiscountAmount = __process._foodDiscountAmount;
            this._serviceChargeAmount = __process._serviceChargeAmount;
            //this._foodDiscountWord = __process._foodDiscountWord;
            /*
            // คำนวณยอดรวม
            decimal __totalAmount = 0M;
            decimal __pointTotal = 0M;
            decimal __totalAmountVat = 0M;
            decimal __totalAmountExceptVat = 0M;
            decimal __totalFoodAmount = 0M;
            decimal __totalDrinkAmount = 0M;
            for (int __loop = 0; __loop < this._itemProcess.Count; __loop++)
            {
                __totalAmount += this._itemProcess[__loop]._amount;
                __pointTotal += (this._itemProcess[__loop]._havePoint) ? this._itemProcess[__loop]._amount : 0M; ;
                if (this._itemProcess[__loop]._taxType == 0)
                {
                    //__totalVat += Math.Round(this._itemProcess[__loop]._amount * (_g.g._companyProfile._vat_rate / 100.0M), _g.g._companyProfile._item_amount_decimal);
                    __totalAmountVat += this._itemProcess[__loop]._amount;
                }
                else
                {
                    __totalAmountExceptVat += this._itemProcess[__loop]._amount;
                }

                // คำณวนยอดอาหารและเครื่องดื่ม
                if (MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong)
                {
                    if (this._itemProcess[__loop]._isPromotionProduct == false)
                    {
                        if (this._itemProcess[__loop]._drink_type == 0)
                        {
                            __totalFoodAmount += this._itemProcess[__loop]._amount;
                        }
                        else
                        {
                            __totalDrinkAmount += this._itemProcess[__loop]._amount;
                        }
                    }
                }

            }
            // คำนวณหาแต้มสะสม ของบิล
            this._pointSum = 0M;
            if (this._memberCode.Equals(this._posDefaultCust) == false)
            {
                this._pointSum = (this._pointDivAmount == 0M) ? 0M : Math.Floor(__pointTotal / this._pointDivAmount);
            }

            #region หาส่วนลดอาหาร จาก F7
            // หาส่วนลด ต้มยำกุ้ง
            decimal __discountFoodAmount = 0M;
            if (this._foodDiscountWord.Length > 0 && MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong)
            {
                decimal __totalAfterDiscount = MyLib._myGlobal._calcAfterDiscount(this._foodDiscountWord, MyLib._myGlobal._round(__totalFoodAmount, _g.g._companyProfile._item_price_decimal), _g.g._companyProfile._item_price_decimal);
                // คำณวนส่วนลด
                __discountFoodAmount = __totalFoodAmount - __totalAfterDiscount;

                this._foodDiscountAmount = __discountFoodAmount;
                __totalAmount -= __discountFoodAmount;

                _sendMessage("update:label,food_discount", String.Format("{0}{1} : {2}", MyLib._myGlobal._resource("ส่วนลด "), ((this._foodDiscountWord.IndexOf("%") != -1) ? this._foodDiscountWord : ""), this._foodDiscountAmount.ToString(this._formatNumber1)), "");
            }

            #endregion

            // ลดขั้นสุดท้าย หาจาก total amount
            decimal __afterDiscount = 0M;
            decimal __discountAmount = 0M;

            if (this._discountWord.Length > 0)
            {
                __afterDiscount = MyLib._myGlobal._calcAfterDiscount(this._discountWord, MyLib._myGlobal._round(__totalAmount, _g.g._companyProfile._item_price_decimal), _g.g._companyProfile._item_price_decimal);
                __discountAmount = __totalAmount - __afterDiscount;
                __totalAmount -= __discountAmount;


            }

            // ปัดเศษ
            decimal __totalAfterDiff = _posProcess._diffProcess(__totalAmount, this._posConfig);

            decimal __finalBalance = Math.Floor(__totalAmount) + __totalAfterDiff;
            decimal __diffAmount = (__finalBalance - __totalAmount); // (this._finalBalance - this._totalAfterDiscount) * -1;

            //
            _sendMessage("update:label,vat_amount", MyLib._myGlobal._resource("สินค้ามีภาษี") + " : " + __totalAmountVat.ToString(this._formatNumber1), "");
            _sendMessage("update:label,except_vat_amount", MyLib._myGlobal._resource("สินค้ายกเว้นภาษี") + " : " + __totalAmountExceptVat.ToString(this._formatNumber1), "");
            _sendMessage("update:label,total_amount", __finalBalance.ToString(this._formatNumber1), "");
            _sendMessage("update:label,point_info", String.Format("{0} : {1} - {2} : {3}", MyLib._myGlobal._resource("แต้มยกมา"), this._pointBalance.ToString(this._formatNumber1), MyLib._myGlobal._resource("แต้มใหม่"), this._pointSum.ToString(this._formatNumber1)), "");
            _sendMessage("update:label,diff_amount", MyLib._myGlobal._resource("ยอดปัดเศษ") + " : " + __diffAmount.ToString(this._formatNumber1), "");

            // food & drink
            _sendMessage("update:label,food_amount", String.Format("{0} : {1}", MyLib._myGlobal._resource("ยอดอาหาร"), __totalFoodAmount.ToString(this._formatNumber1)), "");
            _sendMessage("update:label,drink_amount", String.Format("{0} : {1}", MyLib._myGlobal._resource("ยอดเครื่องดื่ม"), __totalDrinkAmount.ToString(this._formatNumber1)), "");

            this._discountAmount = __discountAmount;
            this._totalAmount = __totalAmount;
            this._finalBalance = __finalBalance;
            this._diffAmount = __diffAmount;
            this._totalAmountVat = __totalAmountVat;
            this._totalAmountExceptVat = __totalAmountExceptVat;
            this._totalExtraDiscountAmount = (__process._promotionDiscountAmount * -1); // +(this._discountAmout * -1);
            this._totalFoodAmount = __totalFoodAmount;
            this._totalDrinkAmount = __totalDrinkAmount;
            */
            if (row != -1)
            {
                // Focus
            }
            if (this._posConfig._android_customer_display)
            {
                if (this._itemList.Count > 0)
                {
                    int __row = (row == -1) ? this._itemList.Count - 1 : row;

                    StringBuilder __str = new StringBuilder(MyLib._myGlobal._xmlHeader);
                    __str.Append("<node>");
                    __str.Append(_androidCustomerScreen._add(_g.g._androidDisplayEnum.ItemName, this._itemList[__row]._itemName));
                    __str.Append(_androidCustomerScreen._add(_g.g._androidDisplayEnum.Unit, this._itemList[__row]._unitCode));
                    __str.Append(_androidCustomerScreen._add(_g.g._androidDisplayEnum.Qty, this._itemList[__row]._qtyLast.ToString(this._formatNumber1)));
                    __str.Append(_androidCustomerScreen._add(_g.g._androidDisplayEnum.Price, this._itemList[__row]._price.ToString(this._formatNumber1)) + " บาท");
                    decimal __total = this._itemList[__row]._qtyLast * this._itemList[__row]._price;
                    __str.Append(_androidCustomerScreen._add(_g.g._androidDisplayEnum.Total, __total.ToString(this._formatNumber1)));
                    __str.Append(_androidCustomerScreen._add(_g.g._androidDisplayEnum.AmountWord, "รวมทั้งสิ้น"));
                    __str.Append(_androidCustomerScreen._add(_g.g._androidDisplayEnum.Amount, this._totalAmount.ToString(this._formatNumber1)));
                    __str.Append("</node>");
                    _androidCustomerScreen._send(__str.ToString());
                }
            }

            // reset จอค้าง
            _sendMessage("update:label,total_amount_2", this._totalAmount.ToString(this._formatNumber1), "");
            _sendMessage("update:label,change_amount", "", "");
            _sendMessage("update:label,receive_cash", "", "");

        }

        void _getholdBill(object sender, int row)
        {
            MyLib._myGrid __source = (MyLib._myGrid)sender;
            this._reset();
            if (this._findCust(this._holdBill[row]._custCode) == false)
            {
                this._findAr(this._holdBill[row]._custCode);
            }
            this._holdBill[row]._item.ForEach((__item) =>
            {
                this._lastBarcode = __item._barCode != null ? __item._barCode : "";
                this._lastItemCode = __item._itemCode != null ? __item._itemCode : "";
                this._itemList.Add(__item);

            });
            this._holdBill.RemoveAt(row);
            this._addItemToGrid(true, -1);
        }

        List<control._posTextbox> __getTextBoxObject(control._posForm source, string __filterControl, string[] __idList)
        {
            List<control._posTextbox> __textBoxList = new List<control._posTextbox>();
            foreach (Control __control in source.Controls)
            {
                if (__control.GetType() == typeof(control._posTextbox))
                {
                    control._posTextbox __controlTextBox = (control._posTextbox)__control;
                    if (__filterControl == null || __filterControl.Equals(""))
                    {
                        __textBoxList.Add(__controlTextBox);
                    }
                    else
                    {
                        if (__idList != null)
                        {
                            foreach (string __id in __idList)
                            {
                                if (__controlTextBox._id != null && __controlTextBox._id.Equals(__id))
                                {
                                    __textBoxList.Add(__controlTextBox);
                                }
                            }
                        }
                    }
                }
            }
            return __textBoxList;
        }

        /// <summary>
        /// get control ที่ต้องการทั้งหมด ยังไม่รวม filter
        /// </summary>
        /// <param name="__parentControl"></param>
        /// <param name="__getObjectType"></param>
        /// <returns></returns>
        public Control[] _getControlByType(Type __getType, Control __panel)
        {
            List<Control> __controlList = new List<Control>();
            try
            {
                foreach (Control __obj in __panel.Controls)
                {
                    if (__obj.GetType() == typeof(control._posPanel) || __obj.GetType() == typeof(GroupBox))
                    {
                        Control[] __getInControl = _getControlByType(__getType, __obj);

                        if (__getInControl != null)
                            __controlList.AddRange(__getInControl);
                    }
                    else if (__obj.GetType() == __getType)
                    {
                        __controlList.Add(__obj);
                    }
                }

                return __controlList.ToArray();
            }
            catch
            {
            }

            return null;
        }

        public Control[] _getControl(_posClientObjectType __getType, Control __panel, string __filterControl, string[] __idList)
        {
            // get Target Type 
            Type __targetType = null;

            switch (__getType)
            {
                case _posClientObjectType.Label:
                    __targetType = typeof(control._posLabelShadow);
                    break;
                case _posClientObjectType.Button:
                    __targetType = typeof(control._posButton);
                    break;
                case _posClientObjectType.Grid:
                    __targetType = typeof(control._posGrid);
                    break;
                case _posClientObjectType.HTML:
                    __targetType = typeof(control._posHTML);
                    break;
                case _posClientObjectType.Image:
                    __targetType = typeof(control._posPictureBox);
                    break;
            }

            // filter 

            Control[] __getControlType = _getControlByType(__targetType, __panel);
            if (__getControlType != null)
            {
                switch (__getType)
                {
                    case _posClientObjectType.Label:
                        {
                            List<control._posLabelShadow> __labelFiltered = new List<control._posLabelShadow>();

                            foreach (Control __getControlObj in __getControlType)
                            {
                                control._posLabelShadow __labelControl = (control._posLabelShadow)__getControlObj;
                                if (__filterControl == null || __filterControl.Equals(""))
                                {
                                    __labelFiltered.Add(__labelControl);
                                }
                                else
                                {
                                    if (__idList != null)
                                    {
                                        foreach (string __id in __idList)
                                        {
                                            if (__labelControl._id != null && __labelControl._id.Equals(__id))
                                            {
                                                __labelFiltered.Add(__labelControl);
                                            }
                                        }
                                    }
                                }
                            }

                            return __labelFiltered.ToArray();
                        }
                    case _posClientObjectType.Button:
                        {
                            List<control._posButton> __buttonFiltered = new List<control._posButton>();

                            foreach (Control __getControlObj in __getControlType)
                            {
                                control._posButton __buttonControl = (control._posButton)__getControlObj;
                                if (__filterControl == null || __filterControl.Equals(""))
                                {
                                    __buttonFiltered.Add(__buttonControl);
                                }
                                else
                                {
                                    if (__idList != null)
                                    {
                                        foreach (string __id in __idList)
                                        {
                                            if (__buttonControl._id != null && __buttonControl._id.Equals(__id))
                                            {
                                                __buttonFiltered.Add(__buttonControl);
                                            }
                                        }
                                    }
                                }
                            }

                            return __buttonFiltered.ToArray();
                        }
                    case _posClientObjectType.Grid:
                        {
                            List<control._posGrid> __gridFiltered = new List<control._posGrid>();

                            foreach (Control __getControlObj in __getControlType)
                            {
                                control._posGrid __gridControl = (control._posGrid)__getControlObj;
                                if (__filterControl == null || __filterControl.Equals(""))
                                {
                                    __gridFiltered.Add(__gridControl);
                                }
                                else
                                {
                                    if (__idList != null)
                                    {
                                        foreach (string __id in __idList)
                                        {
                                            if (__gridControl._id != null && __gridControl._id.Equals(__id))
                                            {
                                                __gridFiltered.Add(__gridControl);
                                            }
                                        }
                                    }
                                }
                            }

                            return __gridFiltered.ToArray();
                        }
                    case _posClientObjectType.HTML:
                        {
                            List<control._posHTML> __HTMLFiltered = new List<control._posHTML>();

                            foreach (Control __getControlObj in __getControlType)
                            {
                                control._posHTML __HTMLControl = (control._posHTML)__getControlObj;
                                if (__filterControl == null || __filterControl.Equals(""))
                                {
                                    __HTMLFiltered.Add(__HTMLControl);
                                }
                                else
                                {
                                    if (__idList != null)
                                    {
                                        foreach (string __id in __idList)
                                        {
                                            if (__HTMLControl._id != null && __HTMLControl._id.Equals(__id))
                                            {
                                                __HTMLFiltered.Add(__HTMLControl);
                                            }
                                        }
                                    }
                                }
                            }

                            return __HTMLFiltered.ToArray();
                        }
                    case _posClientObjectType.Image:
                        {
                            List<control._posPictureBox> __PictureFiltered = new List<control._posPictureBox>();

                            foreach (Control __getControlObj in __getControlType)
                            {
                                control._posPictureBox __pictureControl = (control._posPictureBox)__getControlObj;
                                if (__filterControl == null || __filterControl.Equals(""))
                                {
                                    __PictureFiltered.Add(__pictureControl);
                                }
                                else
                                {
                                    if (__idList != null)
                                    {
                                        foreach (string __id in __idList)
                                        {
                                            if (__pictureControl._id != null && __pictureControl._id.Equals(__id))
                                            {
                                                __PictureFiltered.Add(__pictureControl);
                                            }
                                        }
                                    }
                                }
                            }

                            return __PictureFiltered.ToArray();
                        }
                }
            }
            return null;
        }

        /// <summary>
        /// จัดการกับ Grid ทุก ๆ opreation (add,change,remove,clear)
        /// </summary>
        /// <param name="__operation"></param>
        /// <param name="__filterControl"></param>
        /// <param name="__message"></param>
        private void _opreation(_posClientObjectType type, string __operation, string __filterControl, string __message, string serialNumber)
        {
            List<control._posGrid> __gridList = new List<control._posGrid>();
            List<control._posTextbox> __textBoxList = new List<control._posTextbox>();
            List<control._posLabelShadow> __labelList = new List<control._posLabelShadow>();
            List<control._posButton> __buttonList = new List<control._posButton>();
            List<control._posPictureBox> __pictureList = new List<control._posPictureBox>();
            List<control._posHTML> __HTMLList = new List<control._posHTML>();

            string[] __idList = null;
            if (__filterControl != null && !__filterControl.Equals(""))
                __idList = __filterControl.Split(',');

            // get control เป็น array control
            //var __grid = from info in this.Controls where ((Control)info).GetType() == typeof(MyLib._myGrid) select info; 
            for (int __form = 0; __form < _container.Count; __form++)
            {
                DockableFormInfo __dockInfo = _container.GetFormInfoAt(__form);
                //_object._form __formDock = (_object._form)__dockInfo.DockableForm;
                if (__dockInfo.DockableForm.GetType() == typeof(control._posForm))
                {

                    switch (type)
                    {
                        case _posClientObjectType.TextBox:
                            {
                                List<control._posTextbox> __controlTextbox = this.__getTextBoxObject((control._posForm)__dockInfo.DockableForm, __filterControl, __idList);
                                if (__controlTextbox.Count > 0)
                                {
                                    __textBoxList = __controlTextbox;
                                }

                                // oter form
                            }
                            break;
                    }

                    // toe ย้ายไป _getControl เอา แก้ไขปัญหา Control ใน Panel มองไม่เห็น

                    //foreach (Control __control in ((control._posForm)__dockInfo.DockableForm).Controls)
                    //{
                    switch (type)
                    {
                        case _posClientObjectType.Button:
                            {
                                /*
                                if (__control.GetType() == typeof(control._posButton))
                                {
                                    control._posButton __controlButton = (control._posButton)__control;
                                    if (__filterControl == null || __filterControl.Equals(""))
                                    {
                                        __buttonList.Add(__controlButton);
                                    }
                                    else
                                    {
                                        if (__idList != null)
                                        {
                                            foreach (string __id in __idList)
                                            {
                                                if (__controlButton._id != null && __controlButton._id.Equals(__id))
                                                {
                                                    __buttonList.Add(__controlButton);
                                                }
                                            }
                                        }
                                    }
                                }
                                 * */
                                control._posButton[] __controlButton = (control._posButton[])_getControl(_posClientObjectType.Button, (control._posForm)__dockInfo.DockableForm, __filterControl, __idList);
                                if (__controlButton != null)
                                {
                                    __buttonList.AddRange(__controlButton);
                                }

                            }
                            break;
                        case _posClientObjectType.Label:
                            {
                                /*
                                if (__control.GetType() == typeof(control._posLabelShadow))
                                {
                                    control._posLabelShadow __controlLabel = (control._posLabelShadow)__control;
                                    if (__filterControl == null || __filterControl.Equals(""))
                                    {
                                        __labelList.Add(__controlLabel);
                                    }
                                    else
                                    {
                                        if (__idList != null)
                                        {
                                            foreach (string __id in __idList)
                                            {
                                                if (__controlLabel._id != null && __controlLabel._id.Equals(__id))
                                                {
                                                    __labelList.Add(__controlLabel);
                                                }
                                            }
                                        }
                                    }
                                }
                                 * */
                                control._posLabelShadow[] __controlLabel = (control._posLabelShadow[])_getControl(_posClientObjectType.Label, (control._posForm)__dockInfo.DockableForm, __filterControl, __idList);
                                if (__controlLabel != null)
                                {
                                    __labelList.AddRange(__controlLabel);
                                }

                            }
                            break;
                        /*                        case _posClientObjectType.TextBox:
                                                    {
                                                        if (__control.GetType() == typeof(control._posTextbox))
                                                        {
                                                            control._posTextbox __controlTextBox = (control._posTextbox)__control;
                                                            if (__filterControl == null || __filterControl.Equals(""))
                                                            {
                                                                __textBoxList.Add(__controlTextBox);
                                                            }
                                                            else
                                                            {
                                                                if (__idList != null)
                                                                {
                                                                    foreach (string __id in __idList)
                                                                    {
                                                                        if (__controlTextBox._id != null && __controlTextBox._id.Equals(__id))
                                                                        {
                                                                            __textBoxList.Add(__controlTextBox);
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                    break;*/
                        case _posClientObjectType.Grid:
                            {
                                /*
                                if (__control.GetType() == typeof(control._posGrid))
                                {
                                    control._posGrid __controlGrid = (control._posGrid)__control;
                                    if (__filterControl == null || __filterControl.Equals(""))
                                    {
                                        __gridList.Add(__controlGrid);
                                    }
                                    else
                                    {
                                        if (__idList != null)
                                        {
                                            foreach (string __id in __idList)
                                            {
                                                if (__controlGrid._id != null && __controlGrid._id.Equals(__id))
                                                {
                                                    __gridList.Add(__controlGrid);
                                                }
                                            }
                                        }
                                    }
                                }
                                 * */
                                control._posGrid[] __controlGrid = (control._posGrid[])_getControl(_posClientObjectType.Grid, (control._posForm)__dockInfo.DockableForm, __filterControl, __idList);
                                if (__controlGrid != null)
                                {
                                    __gridList.AddRange(__controlGrid);
                                }

                            }
                            break;
                        case _posClientObjectType.Image:
                            {
                                /*
                                if (__control.GetType() == typeof(control._posPictureBox))
                                {
                                    control._posPictureBox __pictureBox = (control._posPictureBox)__control;
                                    if (__filterControl == null || __filterControl.Equals(""))
                                    {
                                        __pictureList.Add(__pictureBox);
                                    }
                                    else
                                    {
                                        if (__idList != null)
                                        {
                                            foreach (string __id in __idList)
                                            {
                                                if (__pictureBox._id != null && __pictureBox._id.Equals(__id))
                                                {
                                                    __pictureList.Add(__pictureBox);
                                                }
                                            }
                                        }
                                    }

                                }
                                 * */
                                control._posPictureBox[] __controlImage = (control._posPictureBox[])_getControl(_posClientObjectType.Image, (control._posForm)__dockInfo.DockableForm, __filterControl, __idList);
                                if (__controlImage != null)
                                {
                                    __pictureList.AddRange(__controlImage);
                                }

                            }
                            break;

                        case _posClientObjectType.HTML:
                            {
                                /*
                                if (__control.GetType() == typeof(control._posHTML))
                                {
                                    control._posHTML __html = (control._posHTML)__control;
                                    if (__filterControl == null || __filterControl.Equals(""))
                                    {
                                        __HTMLList.Add(__html);
                                    }
                                    else
                                    {
                                        if (__idList != null)
                                        {
                                            foreach (string __id in __idList)
                                            {
                                                if (__html._id != null && __html._id.Equals(__id))
                                                {
                                                    __HTMLList.Add(__html);
                                                }
                                            }
                                        }

                                    }
                                }
                                 * */
                                control._posHTML[] __controlHTML = (control._posHTML[])_getControl(_posClientObjectType.HTML, (control._posForm)__dockInfo.DockableForm, __filterControl, __idList);
                                if (__controlHTML != null)
                                {
                                    __HTMLList.AddRange(__controlHTML);
                                }

                            }
                            break;
                    }
                }
                //}

            }

            switch (type)
            {
                case _posClientObjectType.Button:
                    switch (__operation)
                    {
                        case "update":
                            for (int __loop = 0; __loop < __buttonList.Count; __loop++)
                            {
                                __buttonList[__loop].ButtonText = __message;
                                __buttonList[__loop].Invalidate();
                            }
                            break;
                    }
                    break;
                case _posClientObjectType.Label:
                    switch (__operation)
                    {
                        case "update":
                            for (int __loop = 0; __loop < __labelList.Count; __loop++)
                            {
                                __labelList[__loop].Text = __message;
                                __labelList[__loop].Invalidate();
                            }
                            break;
                    }
                    break;
                case _posClientObjectType.TextBox:
                    switch (__operation)
                    {
                        case "end":
                            for (int __loop = 0; __loop < __textBoxList.Count; __loop++)
                            {
                                for (int __form = 0; __form < _container.Count; __form++)
                                {
                                    DockableFormInfo __dockInfo = _container.GetFormInfoAt(__form);
                                    if (__dockInfo.DockableForm.GetType() == typeof(control._posForm))
                                    {
                                        List<control._posTextbox> __findTextBox = this.__getTextBoxObject((control._posForm)__dockInfo.DockableForm, __filterControl, __idList);
                                        for (int __textBox = 0; __textBox < __findTextBox.Count; __textBox++)
                                        {
                                            TextBox __tb = (TextBox)__findTextBox[__textBox];
                                            string __mesage = __tb.Tag.ToString().Replace("@value@", __tb.Text);
                                            //MessageBox.Show(" call event mssage " + __mesage);
                                            this._command(__mesage, serialNumber);
                                        }
                                    }
                                }
                            }
                            break;
                        case "focus":
                            for (int __loop = 0; __loop < __textBoxList.Count; __loop++)
                            {
                                __textBoxList[__loop].Focus();
                                __textBoxList[__loop].Select(__textBoxList[__loop].Text.Length, 0);
                            }
                            break;
                        case "enter":
                            for (int __loop = 0; __loop < __textBoxList.Count; __loop++)
                            {
                                __textBoxList[__loop].Text = __message;
                                __textBoxList[__loop].Invalidate();
                            }
                            break;
                        case "delete":
                            for (int __loop = 0; __loop < __textBoxList.Count; __loop++)
                            {
                                if (__textBoxList[__loop].Text.Length > 0)
                                {
                                    __textBoxList[__loop].Text = __textBoxList[__loop].Text.Remove(__textBoxList[__loop].Text.Length - 1, 1);
                                    __textBoxList[__loop].Invalidate();
                                }
                            }
                            break;
                        case "append":
                            for (int __loop = 0; __loop < __textBoxList.Count; __loop++)
                            {
                                __textBoxList[__loop].Text = __textBoxList[__loop].Text + __message;
                                __textBoxList[__loop].Invalidate();
                            }
                            break;
                        case "clear":
                            for (int __loop = 0; __loop < __textBoxList.Count; __loop++)
                            {
                                __textBoxList[__loop].Text = "";
                                __textBoxList[__loop].Invalidate();
                            }
                            break;
                    }
                    break;
                case _posClientObjectType.Grid:
                    switch (__operation)
                    {
                        case "update":
                            _updateProductToGrid(__gridList.ToArray(), __message);
                            break;
                        case "clear":
                            for (int __loop = 0; __loop < __gridList.Count; __loop++)
                            {
                                __gridList[__loop]._clear();
                            }
                            break;
                        case "show_total":
                            for (int __loop = 0; __loop < __gridList.Count; __loop++)
                            {
                                __gridList[__loop]._total_show = true;
                            }
                            break;
                    }
                    break;
                case _posClientObjectType.Image:
                    switch (__operation)
                    {
                        case "update":
                            _updateItemPicture(__pictureList.ToArray(), __message);
                            break;

                        case "clear":
                            _clearItemPicture(__pictureList.ToArray());
                            break;
                    }
                    break;
                case _posClientObjectType.HTML:
                    switch (__operation)
                    {
                        case "clear":
                            _clearHTMLHealthy(__HTMLList.ToArray());
                            break;
                        case "updateHealthy":
                            _updateHTMLHealthy(__HTMLList.ToArray(), __message);
                            break;
                    }

                    break;
            }
        }

        //private control._posPictureBox[] __pictureBoxLists = null;

        private void _clearItemPicture(control._posPictureBox[] __pictureBoxs)
        {
            foreach (control._posPictureBox __pictureBox in __pictureBoxs)
            {
                __pictureBox.Image = null;
                __pictureBox.Invalidate();
            }

            if (this._getPictureControl != null)
            {
                this._getPictureControl._clearpic();
            }
        }

        private void _openPicturePopup()
        {
            if (_getPictureControl == null)
            {
                this._getPictureControl = new SMLERPControl._getPicture();
                this._getPictureControl.toolStrip1.Enabled = false;
                this._getPictureControl._DisplayPictureAmount = 6;
                this._getPictureControl._checkClick = false;
                Form __form0 = new Form();
                __form0.BackColor = Color.LightCyan;
                __form0.Width = 500;
                __form0.Height = 400;
                __form0.Controls.Add(this._getPictureControl);
                this._getPictureControl.Dock = DockStyle.Fill;
                DockableFormInfo __form = this._container.Add(__form0, zAllowedDock.All, Guid.NewGuid());

            }

            this._getPictureControl._clearpic();
            this._getPictureControl._loadImage(this._lastItemCode);

        }

        private void _updateItemPicture(control._posPictureBox[] __pictureBoxs, string __message)
        {
            // get image 
            SMLERPControl._getImageData __getImage = new SMLERPControl._getImageData(__message);
            __getImage._onLoadImageComplete += (s1, e1) =>
            {
                if (e1 != null)
                {
                    SMLERPControl._getImageData __obj = (SMLERPControl._getImageData)s1;
                    foreach (control._posPictureBox __pictureBox in __pictureBoxs)
                    {

                        // วาดจำนวนรูปภาพ
                        Graphics __graphic = Graphics.FromImage(e1); // e1. // Image.  __pictureBox.CreateGraphics();
                        StringFormat sf = StringFormat.GenericTypographic;
                        sf.Alignment = StringAlignment.Near;
                        sf.LineAlignment = StringAlignment.Near;
                        __graphic.DrawString("1/" + __obj._imageCount, new Font(this._fontDetailName, 17, FontStyle.Regular), new SolidBrush(Color.Black), new RectangleF(10, 10, __pictureBox.Size.Width, __pictureBox.Size.Height), sf);
                        //__graphic.Dispose();

                        __pictureBox.Image = e1;
                        __pictureBox.Invalidate();
                    }

                    if (this._getPictureControl != null)
                    {
                        this._getPictureControl._clearpic();
                        this._getPictureControl._loadImage(__message);
                    }
                }
                else
                {
                    _clearItemPicture(__pictureBoxs);
                }
            };
            __getImage._onLoadImageNotFound += (s2) =>
            {
                _clearItemPicture(__pictureBoxs);
            };
            __getImage._process();

        }

        private void _clearHTMLHealthy(control._posHTML[] __htmlArrObj)
        {
            foreach (control._posHTML __html in __htmlArrObj)
            {
                string __healthyHTML = __html._htmlSchema.Replace("&measure_date&", string.Empty).Replace("&height&", string.Empty).Replace("&weight&", string.Empty).Replace("&presure&", string.Empty).Replace("&body_fat&", string.Empty).Replace("&ldl&", string.Empty).Replace("&hdl&", string.Empty).Replace("&triglyceride&", string.Empty).Replace("&cholesterol&", string.Empty).Replace("&kkos&", string.Empty).Replace("&blood_oxygen&", string.Empty).Replace("&bmi&", string.Empty).Replace("&blood_sugar&", string.Empty).Replace("&bun&", string.Empty).Replace("&creatinine&", string.Empty).Replace("&remark&", string.Empty);
                __html.DocumentText = __healthyHTML;
            }

        }

        private void _updateHTMLHealthy(control._posHTML[] __htmlArrObj, string __message)
        {
            //string __healthyHTML = _yourHealtryInfo(__message);

            string[] __messageArr = __message.Split(',');
            MyLib._myFrameWork __myFrameWork = new _myFrameWork();


            string __query = "select * from " + _g.d.m_yourhealthy._table + " where " + _g.d.m_yourhealthy._ar_code + " = \'" + __messageArr[0].ToUpper() + "\' AND " + _g.d.m_yourhealthy._member_id + " = \'" + __messageArr[1].ToUpper() + "\'";
            DataSet __ds = __myFrameWork._queryShort(__query);
            if (__ds.Tables.Count > 0)
            {
                if (__ds.Tables[0].Rows.Count > 0)
                {
                    // get healthydata and replace it
                    string __measure_date = __ds.Tables[0].Rows[0][_g.d.m_yourhealthy._measure_date].ToString();
                    string __height = __ds.Tables[0].Rows[0][_g.d.m_yourhealthy._high].ToString();
                    string __weight = __ds.Tables[0].Rows[0][_g.d.m_yourhealthy._weight].ToString();
                    string __presure = __ds.Tables[0].Rows[0][_g.d.m_yourhealthy._pressure].ToString();
                    string __body_fat = __ds.Tables[0].Rows[0][_g.d.m_yourhealthy._body_fat].ToString();
                    string __ldl = __ds.Tables[0].Rows[0][_g.d.m_yourhealthy._ldl].ToString();
                    string __hdl = __ds.Tables[0].Rows[0][_g.d.m_yourhealthy._hdl].ToString();
                    string __triglyceride = __ds.Tables[0].Rows[0][_g.d.m_yourhealthy._triglyceride].ToString();
                    string __cholesterol = __ds.Tables[0].Rows[0][_g.d.m_yourhealthy._cholesterol].ToString();
                    string __kkos = __ds.Tables[0].Rows[0][_g.d.m_yourhealthy._kkos].ToString();
                    string __blood_Oxygen = __ds.Tables[0].Rows[0][_g.d.m_yourhealthy._blood_Oxygen].ToString();
                    string __bmi = __ds.Tables[0].Rows[0][_g.d.m_yourhealthy._bmi].ToString();
                    string __blood_sugar = __ds.Tables[0].Rows[0][_g.d.m_yourhealthy._blood_sugar].ToString();
                    string __bun = __ds.Tables[0].Rows[0][_g.d.m_yourhealthy._bun].ToString();
                    string __creatinine = __ds.Tables[0].Rows[0][_g.d.m_yourhealthy._creatinine].ToString();
                    string __remark = __ds.Tables[0].Rows[0][_g.d.m_yourhealthy._remark].ToString();
                    //string __ar_name = __ds.Tables[0].Rows[0][_g.d.m_yourhealthy._ar_name].ToString();

                    foreach (control._posHTML __html in __htmlArrObj)
                    {
                        string __healthyHTML = __html._htmlSchema.Replace("&measure_date&", __measure_date).Replace("&height&", __height).Replace("&weight&", __weight).Replace("&presure&", __presure).Replace("&body_fat&", __body_fat).Replace("&ldl&", __ldl).Replace("&hdl&", __hdl).Replace("&triglyceride&", __triglyceride).Replace("&cholesterol&", __cholesterol).Replace("&kkos&", __kkos).Replace("&blood_oxygen&", __blood_Oxygen).Replace("&bmi&", __bmi).Replace("&blood_sugar&", __blood_sugar).Replace("&bun&", __bun).Replace("&creatinine&", __creatinine).Replace("&remark&", __remark);
                        __html.DocumentText = __healthyHTML;
                    }
                }
            }


        }

        private void _updateProductToGrid(MyLib._myGrid[] __grids, string __message)
        {
            XmlDocument __docs = new XmlDocument();
            __docs.LoadXml(__message);
            XmlNode __node = __docs.DocumentElement;

            // read message from xml ตีความ message
            foreach (MyLib._myGrid __grid in __grids)
            {
                __grid._clear();
                XmlNodeList __itemNodes = __node.SelectNodes("item");
                foreach (XmlNode __item in __itemNodes)
                {
                    // add row
                    int __row = __grid._addRow();
                    for (int __col = 0; __col < __grid._columnList.Count - 1; __col++)
                    {
                        MyLib._myGrid._columnType __column = (MyLib._myGrid._columnType)__grid._columnList[__col];
                        try
                        {
                            //string __result = __item[__column._originalName].InnerText;
                            object __result = null;
                            if (__column._type == 3)
                            {
                                __result = MyLib._myGlobal._decimalPhase(__item[__column._originalName].InnerText);
                            }
                            else
                            {
                                __result = __item[__column._originalName].InnerText;
                            }
                            __grid._cellUpdate(__row, __column._originalName, __result, false);
                        }
                        catch
                        {
                        }
                    }

                    __grid._cellUpdate(__row, _price_type_column, (int)MyLib._myGlobal._decimalPhase(__item[_price_type_column].InnerText), false);
                }
                __grid._selectRow = __grid._rowData.Count - 1;
                __grid.Invalidate();
                if (__grid._vScrollBar1.Visible == true)
                {
                    __grid._vScrollBar1.Maximum += 1;
                    __grid._vScrollBar1.Value = __grid._vScrollBar1.Maximum;
                    __grid.Invalidate();
                }
            }
        }

        private DataTable _copyToDataTable(DataTable tableDesc, DataTable tableSchema, DataRow[] data)
        {
            foreach (DataRow sourcerow in data)
            {
                DataRow destRow = tableDesc.NewRow();

                // วนใส่ ทีละ column
                //foreach (string colname in columns)
                //{
                //    destRow[colname] = sourcerow[colname];
                //}
                for (int __col = 0; __col < tableSchema.Columns.Count; __col++)
                {
                    string __colName = tableSchema.Columns[__col].ColumnName;
                    destRow[__colName] = sourcerow[__col];
                }

                tableDesc.Rows.Add(destRow);
            }

            return tableDesc;
        }

        private ArrayList _filterDocNo(string docNo)
        {
            ArrayList _newData = null;

            try
            {
                int __tableIndex = 0;

                MyLib._myFrameWork __myFrameWork = new _myFrameWork();
                StringBuilder __queryList = new StringBuilder();
                __queryList.Append(MyLib._myGlobal._xmlHeader + "<node>");
                __queryList.Append(MyLib._myUtil._convertTextToXmlForQuery("select *,(select " + _g.d.erp_user._name_1 + " from " + _g.d.erp_user._table + " where " + _g.d.erp_user._table + "." + _g.d.erp_user._code + "=" + _g.d.ic_trans._cashier_code + ") as cashier_name,(select " + _g.d.ar_customer._name_1 + " from " + _g.d.ar_customer._table + " where " + _g.d.ar_customer._table + "." + _g.d.ar_customer._code + "=" + _g.d.ic_trans._table + "." + _g.d.ic_trans._cust_code + ") as " + _g.d.ic_trans._cust_name + ",(select " + _g.d.ar_customer._address + " from " + _g.d.ar_customer._table + " where " + _g.d.ar_customer._table + "." + _g.d.ar_customer._code + "=" + _g.d.ic_trans._table + "." + _g.d.ic_trans._cust_code + ") as cust_address,(select " + _g.d.POS_ID._POS_ID + " from " + _g.d.POS_ID._table + " where " + _g.d.POS_ID._table + "." + _g.d.POS_ID._MACHINECODE + "=" + _g.d.ic_trans._table + "." + _g.d.ic_trans._pos_id + ") as pos_id_desc" + " from " + _g.d.ic_trans._table + " where " + _g.d.ic_trans._doc_no + "=\'" + docNo.ToString() + "\'"));
                __icTransTableIndex = __tableIndex;
                __tableIndex++;

                __queryList.Append(MyLib._myUtil._convertTextToXmlForQuery("select *, (select " + _g.d.ic_inventory_barcode._table + "." + _g.d.ic_inventory_barcode._hidden_text + " from " + _g.d.ic_inventory_barcode._table + " where " + _g.d.ic_inventory_barcode._table + "." + _g.d.ic_inventory_barcode._ic_code + " =" + _g.d.ic_trans_detail._table + "." + _g.d.ic_trans_detail._item_code + " and " + _g.d.ic_inventory_barcode._table + "." + _g.d.ic_inventory_barcode._barcode + " = " + _g.d.ic_trans_detail._table + "." + _g.d.ic_trans_detail._barcode + " and " + _g.d.ic_inventory_barcode._table + "." + _g.d.ic_inventory_barcode._unit_code + " = " + _g.d.ic_trans_detail._table + "." + _g.d.ic_trans_detail._unit_code + " limit 1) as " + _g.d.ic_inventory_barcode._hidden_text + ", (select " + _g.d.ic_unit._table + "." + _g.d.ic_unit._name_1 + " from " + _g.d.ic_unit._table + " where " + _g.d.ic_unit._table + "." + _g.d.ic_unit._code + " = " + _g.d.ic_trans_detail._table + "." + _g.d.ic_trans_detail._unit_code + " ) as " + _g.d.ic_trans_detail._unit_name + ", (select " + _g.d.ic_inventory._drink_type + " from " + _g.d.ic_inventory._table + " where " + _g.d.ic_inventory._table + "." + _g.d.ic_inventory._code + " = " + _g.d.ic_trans_detail._table + "." + _g.d.ic_trans_detail._item_code + ") as " + _g.d.ic_inventory._drink_type + ", (select ic_inventory.name_eng_1 from ic_inventory where ic_inventory.code = ic_trans_detail.item_code ) as " + _g.d.ic_trans_detail._item_name_en + ", (select ic_unit.name_2 from ic_unit where ic_unit.code = ic_trans_detail.unit_code) as " + _g.d.ic_trans_detail._unit_name_en + " from " + _g.d.ic_trans_detail._table + " where " + _g.d.ic_trans_detail._doc_no + "=\'" + docNo.ToString() + "\' order by " + _g.d.ic_trans_detail._line_number));
                __icTransDetailTableIndex = __tableIndex;
                __tableIndex++;

                __queryList.Append(MyLib._myUtil._convertTextToXmlForQuery("select * from " + _g.d.cb_trans._table + " where " + _g.d.cb_trans._doc_no + "=\'" + docNo.ToString() + "\'"));
                __cbTransTableIndex = __tableIndex;
                __tableIndex++;

                __queryList.Append(MyLib._myUtil._convertTextToXmlForQuery("select * from " + _g.d.cb_trans_detail._table + " where " + _g.d.cb_trans_detail._doc_no + "=\'" + docNo.ToString() + "\' and " + _g.d.cb_trans_detail._doc_type + "=3"));
                __creditCardTableIndex = __tableIndex;
                __tableIndex++;

                __queryList.Append(MyLib._myUtil._convertTextToXmlForQuery("select * from " + _g.d.ic_trans_detail_promotion._table + " where " + _g.d.ic_trans_detail_promotion._doc_no + "=\'" + docNo.ToString() + "\'  order by " + _g.d.ic_trans_detail_promotion._line_number));
                __icTransDetailPromotionTableIndex = __tableIndex;
                __tableIndex++;

                __queryList.Append(MyLib._myUtil._convertTextToXmlForQuery("select * from " + _g.d.cb_trans_detail._table + " where " + _g.d.cb_trans_detail._doc_no + "=\'" + docNo.ToString() + "\' and " + _g.d.cb_trans_detail._doc_type + "=6 "));
                __advanceMoneyTableIndex = __tableIndex;
                __tableIndex++;

                __queryList.Append(MyLib._myUtil._convertTextToXmlForQuery("select * from " + _g.d.ic_trans_serial_number._table + " where " + _g.d.ic_trans_serial_number._doc_no + "=\'" + docNo.ToString() + "\' "));
                __icTransSerialNumberTableIndex = __tableIndex;
                __tableIndex++;



                if (MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro)
                {
                    __queryList.Append(MyLib._myUtil._convertTextToXmlForQuery("select *, (select " + _g.d.table_master._table + "." + _g.d.table_master._name_1 + " from " + _g.d.table_master._table + " where " + _g.d.table_master._table + "." + _g.d.table_master._number + " = " + _g.d.table_trans._table + "." + _g.d.table_trans._table_number + ") as " + _g.d.table_master._name_1 + " from " + _g.d.table_trans._table + " where " + _g.d.table_trans._cashier_doc_no + "=\'" + docNo.ToString() + "\' "));
                }
                __queryList.Append("</node>");

                _newData = __myFrameWork._queryListGetData(MyLib._myGlobal._databaseName, __queryList.ToString());

            }
            catch
            {
            }

            /*

            // trans
            DataRow[] __row1 = ((DataSet)getData[0]).Tables[0].Select(_g.d.ic_trans._doc_no + " = \'" + docNo + "\'", );
            DataSet __ds1 = new DataSet();
            DataTable __dt1 = new DataTable();
            //__dt1.Rows.Add(__row1[0]);
            //__dt1.ImportRow(__row1[0]);

            __dt1 = _copyToDataTable(__dt1, ((DataSet)getData[0]).Tables[0], __row1);

            __ds1.Tables.Add(__dt1);
            _newData.Add(__ds1);

            //trans detail
            DataRow[] __row2 = ((DataSet)getData[1]).Tables[0].Select(_g.d.ic_trans_detail._doc_no + " = \'" + docNo + "\'");
            DataSet __ds2 = new DataSet();
            DataTable __dt2 = new DataTable();
            foreach (DataRow __dr in __row2)
            {
                __dt2.ImportRow(__dr);
            }

            __ds2.Tables.Add(__dt2);
            _newData.Add(__ds2);

            // cbtrans
            DataRow[] __row3 = ((DataSet)getData[2]).Tables[0].Select(_g.d.cb_trans._doc_no + " = \'" + docNo + "\'");
            DataSet __ds3 = new DataSet();
            DataTable __dt3 = new DataTable();
            foreach (DataRow __dr in __row3)
            {
                __dt3.ImportRow(__dr);
            }

            __ds3.Tables.Add(__dt3);
            _newData.Add(__ds3);

            //coupon
            DataSet __ds4 = new DataSet();
            DataTable __dt4 = new DataTable();
            if (((DataSet)getData[3]).Tables[0].Rows.Count > 0)
            {
                DataRow[] __row4 = ((DataSet)getData[3]).Tables[0].Select(_g.d.cb_trans_detail._doc_no + " = \'" + docNo + "\'");
                foreach (DataRow __dr in __row4)
                {
                    __dt4.ImportRow(__dr);
                }
            }
            __ds4.Tables.Add(__dt4);
            _newData.Add(__ds4);

            // table for tom yum goong
            if (MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong)
            {
                DataRow[] __row5 = ((DataSet)getData[4]).Tables[0].Select(_g.d.table_trans._cashier_doc_no + " = \'" + docNo + "\'");
                DataSet __ds5 = new DataSet();
                DataTable __dt5 = new DataTable();
                foreach (DataRow __dr in __row5)
                {
                    __dt5.ImportRow(__dr);
                }

                __ds5.Tables.Add(__dt5);
                _newData.Add(__ds5);

            }*/


            return _newData;
        }

        private Boolean _checkbalanceControl(int mode, DataTable dataTable, string itemCode, string barcode, decimal qty, int itemType)
        {
            Boolean __result = true;

            if (this._balance_control && itemType != 1 && itemType != 3)
            {
                __result = false;

                decimal __balanceCheck = 0M;
                Boolean __warningBalanceControl = false;
                //DataTable __balanceTable = ((DataSet)__data[3]).Tables[0];
                if (mode == 1)
                {
                    StringBuilder __myquery = new StringBuilder();
                    __myquery.Append(MyLib._myGlobal._xmlHeader + "<node>");

                    SMLProcess._icProcess __process = new SMLProcess._icProcess();

                    //" and " + _g.d.ic_trans_detail._wh_code + " = \'" + this._posWareHouse + "\' and " + _g.d.ic_trans_detail._shelf_code + "=\'" + this._posLocation + "\'"
                    __myquery.Append(MyLib._myUtil._convertTextToXmlForQuery(__process._queryItemBalance(itemCode, _g.d.ic_trans_detail._wh_code + " as " + _g.d.ic_resource._warehouse + "," + _g.d.ic_trans_detail._shelf_code + " as " + _g.d.ic_resource._location, _g.d.ic_resource._qty, _g.d.ic_trans_detail._item_code + "," + _g.d.ic_trans_detail._wh_code + "," + _g.d.ic_trans_detail._shelf_code, "")));

                    //__myquery.Append(MyLib._myUtil._convertTextToXmlForQuery("select balance_control from ic_inventory_detail where =\'" + itemCode + "\'"));

                    __myquery.Append("</node>");

                    MyLib._myFrameWork _myFrameWork = new MyLib._myFrameWork();
                    ArrayList __queryResult = _myFrameWork._queryListGetData(MyLib._myGlobal._databaseName, __myquery.ToString());
                    dataTable = ((DataSet)__queryResult[0]).Tables[0];

                }

                if (dataTable.Rows.Count > 0)
                {
                    DataRow[] __balanceRow = dataTable.Select(_g.d.ic_resource._warehouse + " = \'" + this._posWareHouse + "\' and " + _g.d.ic_resource._location + "=\'" + this._posLocation + "\'");
                    decimal __balanceQty = 0M;
                    if (__balanceRow.Length > 0)
                        __balanceQty = (decimal)MyLib._myGlobal._decimalPhase(__balanceRow[0][_g.d.ic_resource._qty].ToString());

                    // รวมจำนวน
                    for (int __row = 0; __row < this._itemList.Count; __row++)
                    {
                        if (itemCode.Equals(this._itemList[__row]._itemCode))
                        {
                            __balanceCheck += (decimal)this._itemList[__row]._qty * (this._itemList[__row]._standValue / this._itemList[__row]._divideValue);
                        }
                    }

                    __balanceCheck += qty;

                    // เช็คคงเหลือ
                    if (__balanceQty - __balanceCheck >= 0)
                    {
                        __warningBalanceControl = true;
                        __result = true;
                    }
                }


                if (__warningBalanceControl == false)
                {
                    StringBuilder __message = new StringBuilder("สินค้า" + " : " + ((barcode.Length > 0) ? barcode : itemCode) + "\n" + "คลัง" + " : " + this._posWareHouse + "\n" + "ที่เก็บ" + " : " + this._posLocation + " " + "ห้ามติดลบ");

                    MyLib._myMessageBox __messageBox = new _myMessageBox(MemoryBoxButton.CustomOK);
                    __messageBox.buttonNotoAll.Text = "แสดงยอดคงเหลือ";
                    __messageBox.buttonNotoAll.Width += 30;
                    __messageBox.buttonNotoAll.Location = new Point(__messageBox.buttonNotoAll.Location.X - 30, __messageBox.buttonNotoAll.Location.Y);
                    __messageBox.buttonNotoAll.Click += (clickviewbalanceObj, clickviewbalanceEvent) =>
                    {
                        if (this._balanceForm == null)
                        {
                            this._balanceForm = new SMLERPControl._icBalanceForm();
                        }
                        this._balanceForm._load(itemCode);
                        this._balanceForm.ShowDialog();
                    };
                    __messageBox.ShowMemoryDialog(__message.ToString(), "ห้ามขายสินค้าติดลบ");
                }
            }

            return __result;
        }

        /// <summary>
        /// ตรวจสอบสถานะลิ้นชัก สถานะปรกติ Return False
        /// </summary>
        /// <returns>Boolean True=เปิดไว้</returns>
        private bool _checkCashDrawerStatusOpen()
        {
            bool __result = false;


            //if (this._posConfig._useCashDrawer.Equals("1"))
            //{
            //    if (this._posConfig._cashDrawerPort != null && this._posConfig._cashDrawerPort.Length > 0)
            //    {
            //        if (this._posConfig._cashDrawerPort.ToLower().Equals("usbcr"))
            //        {
            //            try
            //            {
            //                int __draw_id = int.Parse(this._posConfig._drawerCodes.Trim());
            //                if (OpenUSB() == 0)
            //                {
            //                    int __portStatus = DrawerState(__draw_id);

            //                    if (__portStatus == 0)
            //                    {
            //                        __result = true;
            //                    }

            //                    CloseUSB();
            //                }

            //            }
            //            catch
            //            {
            //                try
            //                {
            //                    int __draw_id = int.Parse(this._posConfig._drawerCodes.Trim());
            //                    if (OpenUSBcr() == 0)
            //                    {
            //                        int __portStatus = DrawerState(__draw_id);
            //                        if (__portStatus == 0)
            //                        {
            //                            __result = true;
            //                        }
            //                        CloseUSBcr();
            //                    }

            //                }
            //                catch
            //                {
            //                }

            //            }
            //        }
            //        else if (this._posConfig._cashDrawerPort.ToLower().Equals("friusb"))
            //        {
            //            try
            //            {
            //                InitFRIUSBLibrary();
            //                int __status = GetFRIDoorStatus();
            //                if (__status == 0)
            //                {
            //                    __result = true;
            //                }
            //                CloseFRIUSBLibrary();
            //            }
            //            catch
            //            {
            //            }
            //        }
            //    }
            //}
            //if (__result == true)
            //{
            //    MessageBox.Show(MyLib._myGlobal._resource("กรุณาปิดลิ้นชักก่อนทำรายการ"), MyLib._myGlobal._resource("เตือน"), MessageBoxButtons.OK, MessageBoxIcon.Asterisk);
            //}

            return __result;
        }

        _selectLanguageForm _languageForm = null;
        public int _selectLanguage()
        {
            if (_languageForm == null)
            {
                _languageForm = new _selectLanguageForm();
            }

            _languageForm.ShowDialog();
            return _languageForm._languageIndex;
        }

        #endregion

        #region Command


        public void _command(string source, string serialNumber)
        {
            _command(source, serialNumber, false);
        }

        public void _command(string source, string serialNumber, bool isPriceChange)
        {
            _command(source, serialNumber, isPriceChange, "", "", 0M, 0M, 0M);

        }

        public void _command(string source, string serialNumber, bool isPriceChange, string refGuid, string icCodeMain, decimal setRefQty, decimal setRefPrice, decimal priceSetRatio)
        {
            _command(source, serialNumber, isPriceChange, refGuid, icCodeMain, setRefQty, setRefPrice, priceSetRatio, "");
        }

        void writeEventPOSLogs(string Message)
        {
            //if (!EventLog.SourceExists(MyLib._myGlobal._programName))
            //    EventLog.CreateEventSource(MyLib._myGlobal._programName, "Application");

            //EventLog.WriteEntry(MyLib._myGlobal._programName, Message, EventLogEntryType.Information, 234);

        }

        public void _command(string source, string serialNumber, bool isPriceChange, string refGuid, string icCodeMain, decimal setRefQty, decimal setRefPrice, decimal priceSetRatio, string extraItemName)
        {

            //writeEventPOSLogs("Source : " + source + " Serial : " + serialNumber);

            if (source.Length == 0)
                return;

            if (this._lock_edit_order && this._autoInsertItem == false && this._tableNameSelect != ""
                && (source != "F9" && source != "&command&,*99" && source != "&command&," && source != "&command&,*98" && source != "&command&,*93" && source != "&reset&"))
            {
                MessageBox.Show("ห้ามแก้ไขรายการอาหาร");
                return;
            }

            string[] __source = source.ToLower().Split('@');
            for (int __sourceLoop = 0; __sourceLoop < __source.Length; __sourceLoop++)
            {
                if (__source[__sourceLoop].Equals("f1"))
                {
                    _helpForm __help = new _helpForm();
                    __help.ShowDialog(MyLib._myGlobal._mainForm);
                }
                #region การค้นหา
                else if (__source[__sourceLoop].Equals("f2"))
                {
                    #region ค้นหาสินค้าตาม Barcode

                    if (this._searchIC == null)
                    {
                        this._searchIC = new MyLib._searchDataFull();

                        this._searchIC.Text = MyLib._myGlobal._resource("ค้นหาสินค้าตาม Barcode");
                        this._searchIC._dataList._loadViewFormat(_g.g._search_screen_ic_barcode, MyLib._myGlobal._userSearchScreenGroup, false);


                        this._searchIC._dataList._extraWhere = " coalesce((select " + _g.d.ic_inventory_detail._is_hold_sale + " from " + _g.d.ic_inventory_detail._table + " where " + _g.d.ic_inventory_detail._table + "." + _g.d.ic_inventory_detail._ic_code + "=" + _g.d.ic_inventory_barcode._table + "." + _g.d.ic_inventory_barcode._ic_code + "), 0)=0 ";

                        if (this._show_item_location_only)
                        {
                            this._searchIC._dataList._extraWhere += " and " + " exists(select ic_code from ic_wh_shelf where ic_wh_shelf.ic_code = ic_inventory_barcode.ic_code and ic_wh_shelf.wh_code = '" + this._posWareHouse + "' and ic_wh_shelf.shelf_code = '" + this._posLocation + "' ) ";
                        }

                        if (this._posConfig._pos_search_minibox == true)
                        {
                            this._searchIC.Size = new Size(700, 80 + (16 * this._posConfig._pos_search_result_items));
                            this._searchIC.StartPosition = FormStartPosition.CenterScreen;
                        }
                        else
                        {
                            this._searchIC.WindowState = FormWindowState.Maximized;
                        }

                        this._searchIC._dataList._gridData._mouseClick += (s1, e1) =>
                        {
                            if (e1._row != -1)
                            {
                                object __itemCode = this._searchIC._dataList._gridData._cellGet(this._searchIC._dataList._gridData._selectRow, _g.d.ic_inventory_barcode._table + "." + _g.d.ic_inventory_barcode._ic_code);
                                object __barCode = this._searchIC._dataList._gridData._cellGet(this._searchIC._dataList._gridData._selectRow, _g.d.ic_inventory_barcode._table + "." + _g.d.ic_inventory_barcode._barcode);

                                string __code = (__barCode != null) ? __barCode.ToString() : __itemCode.ToString();

                                this._searchIC.Close();
                                //this._searchItem.Dispose();
                                this._command("append:textbox:input=" + __code + "@end:textbox:input", serialNumber);
                            }
                        };

                        this._searchIC._searchEnterKeyPress += (s1, e1) =>
                        {
                            if (e1 != -1)
                            {
                                object __itemCode = this._searchIC._dataList._gridData._cellGet(this._searchIC._dataList._gridData._selectRow, _g.d.ic_inventory_barcode._table + "." + _g.d.ic_inventory_barcode._ic_code);
                                object __barCode = this._searchIC._dataList._gridData._cellGet(this._searchIC._dataList._gridData._selectRow, _g.d.ic_inventory_barcode._table + "." + _g.d.ic_inventory_barcode._barcode);

                                string __code = (__barCode != null) ? __barCode.ToString() : __itemCode.ToString();

                                this._searchIC.Close();
                                //this._searchIC.Dispose();
                                this._command("append:textbox:input=" + __code + "@end:textbox:input", serialNumber);
                            }
                        };
                    }
                    else
                    {

                    }
                    this._searchIC.ShowDialog(this);
                    #endregion
                }
                else if (__source[__sourceLoop].Equals("&serialsearch&") && MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLPOS)
                {
                    // ค้นหาจาก serial _g.g._search_screen_ic_serial
                    if (this._searchSerial == null)
                    {
                        this._searchSerial = new MyLib._searchDataFull();

                        this._searchSerial.Text = MyLib._myGlobal._resource("ค้นหา Serial สินค้า");
                        this._searchSerial._dataList._loadViewFormat(_g.g._search_screen_ic_serial, MyLib._myGlobal._userSearchScreenGroup, false);
                        if (this._posConfig._pos_search_minibox == true)
                        {
                            this._searchSerial.Size = new Size(700, 80 + (16 * this._posConfig._pos_search_result_items));
                            this._searchSerial.StartPosition = FormStartPosition.CenterScreen;
                        }
                        else
                        {
                            this._searchSerial.WindowState = FormWindowState.Maximized;
                        }
                        this._searchSerial._dataList._gridData._mouseClick += (s1, e1) =>
                        {
                            //object __itemCode = this._searchSerial._dataList._gridData._cellGet(this._searchSerial._dataList._gridData._selectRow, _g.d.ic_serial._table + "." + _g.d.ic_serial._ic_code);
                            object __serial = this._searchSerial._dataList._gridData._cellGet(this._searchSerial._dataList._gridData._selectRow, _g.d.ic_serial._table + "." + _g.d.ic_serial._serial_number);

                            //string __code = (__barCode != null) ? __barCode.ToString() : __itemCode.ToString();

                            this._searchSerial.Close();
                            this._searchSerial.Dispose();
                            this._searchSerial = null;
                            this._command("enter:textbox:input=" + __serial + "@end:textbox:input", "");
                        };
                        this._searchSerial._searchEnterKeyPress += (s1, e1) =>
                        {
                            //object __itemCode = this._searchSerial._dataList._gridData._cellGet(this._searchSerial._dataList._gridData._selectRow, _g.d.ic_inventory_barcode._table + "." + _g.d.ic_inventory_barcode._ic_code);
                            object __serial = this._searchSerial._dataList._gridData._cellGet(this._searchSerial._dataList._gridData._selectRow, _g.d.ic_serial._table + "." + _g.d.ic_serial._serial_number);

                            //string __code = (__barCode != null) ? __barCode.ToString() : __itemCode.ToString();

                            this._searchSerial.Close();
                            this._searchSerial.Dispose();
                            this._searchSerial = null;
                            this._command("enter:textbox:input=" + __serial + "@end:textbox:input", serialNumber);
                        };
                        this._searchSerial._dataList._extraWhere = _g.d.ic_serial._status + "=0 and " + _g.d.ic_serial._wh_code + "=\'" + this._posWareHouse + "\' and " + _g.d.ic_serial._shelf_code + " =\'" + this._posLocation + "\'";
                    }
                    else
                    {

                    }
                    //this._searchSerial._dataList._refreshData();
                    this._searchSerial.ShowDialog(this);

                }
                else if (__source[__sourceLoop].Equals("f3"))
                {
                    #region ค้นหาสมาชิก
                    this._searchItem = new MyLib._searchDataFull();
                    this._searchItem.Text = MyLib._myGlobal._resource("ค้นหาสมาชิก");
                    this._searchItem._dataList._loadViewFormat(_g.g._search_screen_ar_dealer, MyLib._myGlobal._userSearchScreenGroup, false);

                    /*if (this._show_item_location_only)
                    {
                        this._searchItem._dataList._extraWhere = " exists(select ic_code from ic_wh_shelf where ic_wh_shelf.ic_code = ic_inventory_barcode.ic_code and ic_wh_shelf.wh_code = '" + this._posWareHouse + "' and ic_wh_shelf.shelf_code = '" + this._posLocation + "' ) ";
                    }*/

                    this._searchItem.WindowState = FormWindowState.Maximized;
                    this._searchItem._dataList._gridData._mouseClick += (s1, e1) =>
                    {

                        if (e1._row != -1)
                        {
                            string __arCode = this._searchItem._dataList._gridData._cellGet(this._searchItem._dataList._gridData._selectRow, _g.d.ar_dealer._table + "." + _g.d.ar_dealer._code).ToString();
                            this._searchItem.Close();
                            this._searchItem.Dispose();
                            this._command("enter:textbox:input=" + __arCode + "@end:textbox:input", serialNumber);
                        }
                    };
                    this._searchItem._searchEnterKeyPress += (s1, e1) =>
                    {
                        if (e1 != -1)
                        {
                            string __arCode = this._searchItem._dataList._gridData._cellGet(this._searchItem._dataList._gridData._selectRow, _g.d.ar_dealer._table + "." + _g.d.ar_dealer._code).ToString();
                            this._searchItem.Close();
                            this._searchItem.Dispose();
                            this._command("enter:textbox:input=" + __arCode + "@end:textbox:input", serialNumber);
                        }
                    };
                    this._searchItem.ShowDialog(MyLib._myGlobal._mainForm);
                    #endregion
                }
                else if (__source[__sourceLoop].Equals("f6"))
                {
                    #region ค้นหาลูกค้า
                    this._searchItem = new MyLib._searchDataFull();
                    this._searchItem.Text = MyLib._myGlobal._resource("ค้นหาสมาชิก");
                    this._searchItem._dataList._loadViewFormat(_g.g._search_screen_ar, MyLib._myGlobal._userSearchScreenGroup, false);
                    this._searchItem.WindowState = FormWindowState.Maximized;
                    this._searchItem._dataList._gridData._mouseClick += (s1, e1) =>
                    {
                        if (e1._row != -1)
                        {
                            string __arCode = this._searchItem._dataList._gridData._cellGet(this._searchItem._dataList._gridData._selectRow, _g.d.ar_customer._table + "." + _g.d.ar_customer._code).ToString();
                            this._searchItem.Close();
                            this._searchItem.Dispose();
                            this._command("enter:textbox:input=" + __arCode + "@end:textbox:input", serialNumber);

                        }

                    };

                    this._searchItem._searchEnterKeyPress += (s1, e1) =>
                    {
                        if (e1 != -1)
                        {
                            string __arCode = this._searchItem._dataList._gridData._cellGet(this._searchItem._dataList._gridData._selectRow, _g.d.ar_customer._table + "." + _g.d.ar_customer._code).ToString();
                            this._searchItem.Close();
                            this._searchItem.Dispose();
                            this._command("enter:textbox:input=" + __arCode + "@end:textbox:input", serialNumber);
                        }

                    };

                    this._searchItem.ShowDialog(MyLib._myGlobal._mainForm);


                    #endregion
                }
                else if (__source[__sourceLoop].Equals("f4"))
                {
                    #region ค้นหาพนักงานขาย
                    this._searchItem = new MyLib._searchDataFull();
                    this._searchItem.Text = MyLib._myGlobal._resource("ค้นหาพนักงานขาย");
                    this._searchItem._dataList._loadViewFormat(_g.g._search_screen_erp_user, MyLib._myGlobal._userSearchScreenGroup, false);
                    this._searchItem.WindowState = FormWindowState.Maximized;
                    this._searchItem._dataList._gridData._mouseClick += (s1, e1) =>
                    {
                        string __SaleCode = this._searchItem._dataList._gridData._cellGet(this._searchItem._dataList._gridData._selectRow, _g.d.erp_user._table + "." + _g.d.erp_user._code).ToString();
                        this._searchItem.Close();
                        this._searchItem.Dispose();
                        this._command("enter:textbox:input=" + __SaleCode + "@end:textbox:input", serialNumber);
                    };
                    this._searchItem._searchEnterKeyPress += (s1, e1) =>
                    {
                        string __SaleCode = this._searchItem._dataList._gridData._cellGet(this._searchItem._dataList._gridData._selectRow, _g.d.erp_user._table + "." + _g.d.erp_user._code).ToString();
                        this._searchItem.Close();
                        this._searchItem.Dispose();
                        this._command("enter:textbox:input=" + __SaleCode + "@end:textbox:input", serialNumber);
                    };
                    this._searchItem.ShowDialog(MyLib._myGlobal._mainForm);

                    #endregion
                }
                else if (__source[__sourceLoop].Equals("f5"))
                {
                    #region ค้นหาสินค้าแบบ Level
                    if (this._searchLevelForm == null)
                    {
                        this._searchLevelForm = new _itemSearchLevelForm();
                        this._searchLevelForm._itemSearchLevelControl1._productBasket = this._posConfig._search_level_basket;
                        this._searchLevelForm._itemSearchLevelControl1._menuItemClick += (menuSender, menuEvent) =>
                        {
                            this._autoInsertItem = true;

                            if (this._posConfig._search_level_basket)
                            {
                                for (int __row = 0; __row < this._searchLevelForm._itemSearchLevelControl1._selectGrid._rowData.Count; __row++)
                                {
                                    string __itemCode = this._searchLevelForm._itemSearchLevelControl1._selectGrid._cellGet(__row, _g.d.ic_trans_detail._item_code).ToString();
                                    string __BarCode = this._searchLevelForm._itemSearchLevelControl1._selectGrid._cellGet(__row, _g.d.ic_trans_detail._barcode).ToString();
                                    string __unitCode = this._searchLevelForm._itemSearchLevelControl1._selectGrid._cellGet(__row, _g.d.ic_trans_detail._unit_code).ToString();
                                    decimal __price = MyLib._myGlobal._decimalPhase(this._searchLevelForm._itemSearchLevelControl1._selectGrid._cellGet(__row, _g.d.ic_trans_detail._price).ToString());
                                    decimal __qty = MyLib._myGlobal._decimalPhase(this._searchLevelForm._itemSearchLevelControl1._selectGrid._cellGet(__row, _g.d.ic_trans_detail._qty).ToString());

                                    if (!__BarCode.Equals(""))
                                    {
                                        this._command("enter:textbox:input=" + __qty + "*" + __BarCode + "@end:textbox:input", serialNumber);
                                        //if (__price != -1)
                                        //{
                                        //    this._command("&command&,*1*" + __price + "@end:textbox:input", serialNumber);
                                        //}
                                    }
                                }
                            }
                            else
                            {
                                SMLInventoryControl._itemSearchLevelMenuControl __obj = (SMLInventoryControl._itemSearchLevelMenuControl)menuSender;
                                this._command("append:textbox:input=" + __obj._barcode + "@end:textbox:input", serialNumber);
                                //if (__obj._price != -1)
                                //{
                                //    this._command("&command&,*1*" + __obj._price + "@end:textbox:input", serialNumber);
                                //}
                            }
                            this._searchLevelForm.Close();

                            this._autoInsertItem = false;
                        };
                    }
                    this._searchLevelForm.ShowDialog();
                    #endregion
                }
                #endregion
                else if (__source[__sourceLoop].Equals("f7") && (MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro))
                {
                    #region ส่วนลดอาหาร
                    Boolean __inputFoodDiscount = true;
                    string __discountFood = "";

                    if (__source.Length == 2)
                    {
                        __discountFood = __source[1];
                        __inputFoodDiscount = false;
                    }

                    if (__inputFoodDiscount)
                    {
                        _posInputNumberForm __numberForm = new _posInputNumberForm("ส่วนลดอาหาร");
                        __numberForm.Text = "ส่วนลดอาหาร";
                        __numberForm.ShowDialog();
                        //decimal __dsicountCountValue = 0M;

                        if (__numberForm.DialogResult == DialogResult.OK)
                        {
                            __discountFood = __numberForm._getNumberValue;
                            // __dsicountCountValue = MyLib._myGlobal._calcAfterDiscount(__discountFood, MyLib._myGlobal._round(this._totalAmount, _g.g._companyProfile._item_price_decimal), _g.g._companyProfile._item_price_decimal);
                            // คำณวนส่วนลด
                        }
                    }

                    if (__discountFood.Length > 0)
                    {
                        this._foodDiscountWord = __discountFood;

                        this._addItemToGrid(true, -1);

                        if (this._table != null && this._autoInsertItem == false)
                        {
                            // บันทึกส่วนลด ลงไปใน table trans ด้วย
                            MyLib._myFrameWork __myFramework = new _myFrameWork();
                            __myFramework._queryInsertOrUpdate(MyLib._myGlobal._databaseName, "update " + _g.d.table_trans._table + " set " + _g.d.table_trans._food_discount + "=\'" + this._foodDiscountWord + "\' where " + _g.d.table_trans._trans_guid + "=\'" + this._trans_guid + "\' and " + _g.d.table_trans._table_number + "=\'" + this._tableNumberSelect + "\'");
                        }
                    }

                    if (__source.Length == 2)
                    {
                        break;
                    }
                    #endregion
                }
                else if (__source[__sourceLoop].Equals("f8") && (MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro))
                {
                    #region Service Charge

                    Boolean __inputServiceCharge = true;
                    string __serviceChargeStr = "";
                    if (__source.Length == 2)
                    {
                        __inputServiceCharge = false;
                        __serviceChargeStr = __source[1];
                    }

                    if (__inputServiceCharge == true && this._posConfig._service_charge_rate != 0M)
                    {
                        __inputServiceCharge = false;
                        __serviceChargeStr = this._posConfig._service_charge_rate.ToString() + "%";
                    }

                    if (__inputServiceCharge)
                    {
                        _posInputNumberForm __numberForm = new _posInputNumberForm("Service Charge");
                        __numberForm.Text = "Service Charge";
                        __numberForm.ShowDialog();
                        //decimal __dsicountCountValue = 0M;

                        if (__numberForm.DialogResult == DialogResult.OK)
                        {
                            __serviceChargeStr = __numberForm._getNumberValue;
                            // __dsicountCountValue = MyLib._myGlobal._calcAfterDiscount(__discountFood, MyLib._myGlobal._round(this._totalAmount, _g.g._companyProfile._item_price_decimal), _g.g._companyProfile._item_price_decimal);
                            // คำณวนส่วนลด
                        }
                    }

                    // check
                    if (__serviceChargeStr.Length > 0)
                    {
                        string __checkStrNumber = __serviceChargeStr.Replace("%", string.Empty);
                        if (MyLib._myGlobal._decimalPhase(__checkStrNumber) < 0)
                        {
                            __serviceChargeStr = "";
                        }
                    }

                    if (__serviceChargeStr.Length > 0)
                    {

                        this._serviceChargeWord = __serviceChargeStr;

                        this._addItemToGrid(true, -1);

                        if (this._table != null && this._autoInsertItem == false)
                        {
                            // บันทึกส่วนลด ลงไปใน table trans ด้วย
                            MyLib._myFrameWork __myFramework = new _myFrameWork();
                            __myFramework._queryInsertOrUpdate(MyLib._myGlobal._databaseName, "update " + _g.d.table_trans._table + " set " + _g.d.table_trans._service_charge + "=\'" + this._serviceChargeWord + "\' where " + _g.d.table_trans._trans_guid + "=\'" + this._trans_guid + "\' and " + _g.d.table_trans._table_number + "=\'" + this._tableNumberSelect + "\'");
                        }
                    }

                    if (__source.Length == 2)
                    {
                        break;
                    }
                    #endregion
                }
                else if (__source[__sourceLoop].Equals("f9"))
                {
                    this._payDialog();
                }
                else if (__source[__sourceLoop].Equals("&reset&"))
                {
                    this._reset();
                }
                else
                {
                    if (__source[__sourceLoop].IndexOf("&command&") != -1)
                    {
                        string[] __split = __source[__sourceLoop].Split(',');
                        if (__split.Length > 1)
                        {

                            if (__split[1].Length > 0 && (__split[1][0] == '+' || __split[1][0] == '-') && (__split[1].IndexOf("*") == -1))
                            {

                                decimal __getValueNumberInput = MyLib._myGlobal._decimalPhase(__split[1].Remove(0, 1));

                                if (__getValueNumberInput != 0)
                                {
                                    #region กด + หรือ - จำนวนสินค้า บรรทัดสุดท้าย
                                    // กรณีกด + หรือ - จำนวนสินค้า (บรรทัดสุดท้าย)
                                    if (this._itemList.Count > 0)
                                    {
                                        decimal __qty = MyLib._myGlobal._decimalPhase(__split[1].Remove(0, 1));
                                        if (__split[1][0] == '+')
                                        {
                                            if (this._itemList[this._itemList.Count - 1]._balanceControl == false && _checkbalanceControl(1, null, this._itemList[this._itemList.Count - 1]._itemCode, this._itemList[this._itemList.Count - 1]._barCode, __qty * (this._itemList[this._itemList.Count - 1]._standValue / this._itemList[this._itemList.Count - 1]._divideValue), this._itemList[this._itemList.Count - 1]._itemType) == false)
                                            {
                                                return;
                                            }
                                            this._itemList[this._itemList.Count - 1]._qtyLast = __qty;
                                            this._itemList[this._itemList.Count - 1]._qty += __qty;
                                        }
                                        else
                                        {
                                            if (this._itemList[this._itemList.Count - 1]._qty - __qty > 0)
                                            {
                                                this._itemList[this._itemList.Count - 1]._qtyLast = __qty;
                                                this._itemList[this._itemList.Count - 1]._qty -= __qty;
                                            }
                                        }

                                        // เมื่อมีการแก้ไข จำนวน หาราคาใหม่
                                        SMLInventoryControl._findPriceClass __getPrice = new SMLInventoryControl._findPriceClass();
                                        //SMLInventoryControl._icTransItemGridControl._priceStruct __result = __getPrice._findPricePOS(this._itemList[this._itemList.Count - 1]._itemCode, this._itemList[this._itemList.Count - 1]._barCode, this._itemList[this._itemList.Count - 1]._unitCode, this._itemList[this._itemList.Count - 1]._qty, ((this._memberCode.Equals(this._posDefaultCust)) ? "" : this._custCode), ((this._memberCode.Equals(this._posDefaultCust)) ? "" : this._memberCode), this._posConfigPriceNumber, this._isStaff, this._posConfig._posid);
                                        SMLInventoryControl._icTransItemGridControl._priceStruct __result = __getPrice._findPricePOS(this._itemList[this._itemList.Count - 1]._itemCode, this._itemList[this._itemList.Count - 1]._barCode, this._itemList[this._itemList.Count - 1]._unitCode, this._itemList[this._itemList.Count - 1]._qty, this._custCode, this._memberCode, this._posConfigPriceNumber, this._isStaff, this._posConfig._posid, this._posDefaultCust);

                                        if (_g.g._companyProfile._ic_price_formula_control)
                                        {
                                            if (__result._stand_price > __result._price)
                                            {
                                                MessageBox.Show(MyLib._myGlobal._resource("ห้ามขายต่ำกว่าราคากลาง"), MyLib._myGlobal._resource("เตือน"));
                                                return;
                                            }
                                        }

                                        this._itemList[this._itemList.Count - 1]._price = __result._price;
                                        this._itemList[this._itemList.Count - 1]._price_type = __result._type;
                                        this._itemList[this._itemList.Count - 1]._discountWord = __result._discountWord;
                                        this._itemList[this._itemList.Count - 1]._discountNumber = __result._discountNumber;
                                        this._itemList[this._itemList.Count - 1]._price_stand = __result._stand_price;

                                        if (__result._price_info.Length > 0)
                                        {
                                            this._itemList[this._itemList.Count - 1]._priceInfo = __result._price_info;
                                            _sendMessage("update:label,price_info", __result._price_info, serialNumber);
                                        }


                                        this._itemList[this._itemList.Count - 1]._amount = this._itemList[this._itemList.Count - 1]._qty * this._itemList[this._itemList.Count - 1]._price;
                                        this._addItemToGrid(true, -1);
                                        _sendMessage("clear:textbox,input", null, serialNumber);
                                    }
                                }
                                #endregion
                            }
                            else
                            {
                                #region *10 ยกเลิกการคำณวนโปรโมชั่น
                                if (__split[1].ToString().Length >= 3 && __split[1].ToString().Substring(0, 3).ToString().Equals("*10"))
                                {
                                    this._isProcessPromotion = false;
                                    this._addItemToGrid(false, -1);

                                    if (this._table != null && this._autoInsertItem == false)
                                    {
                                        MyLib._myFrameWork __myFramework = new _myFrameWork();
                                        __myFramework._queryInsertOrUpdate(MyLib._myGlobal._databaseName, "update " + _g.d.table_trans._table + " set " + _g.d.table_trans._ispromotion_process + "=\'1\' where " + _g.d.table_trans._trans_guid + "=\'" + this._trans_guid + "\' and " + _g.d.table_trans._table_number + "=\'" + this._tableNumberSelect + "\'");
                                    }

                                    _sendMessage("clear:textbox,input", null, serialNumber);
                                }
                                #endregion
                                #region *11 สั่งคำณวนโปรโมชั่น
                                else if (__split[1].ToString().Length >= 3 && __split[1].ToString().Substring(0, 3).ToString().Equals("*11"))
                                {
                                    this._isProcessPromotion = true;
                                    this._addItemToGrid(false, -1);

                                    if (this._table != null && this._autoInsertItem == false)
                                    {
                                        MyLib._myFrameWork __myFramework = new _myFrameWork();
                                        __myFramework._queryInsertOrUpdate(MyLib._myGlobal._databaseName, "update " + _g.d.table_trans._table + " set " + _g.d.table_trans._ispromotion_process + "=\'0\' where " + _g.d.table_trans._trans_guid + "=\'" + this._trans_guid + "\' and " + _g.d.table_trans._table_number + "=\'" + this._tableNumberSelect + "\'");
                                    }

                                    _sendMessage("clear:textbox,input", null, serialNumber);
                                }
                                #endregion
                                #region *1* แก้ไขราคา
                                else if (__split[1].ToString().Length >= 3 && __split[1].ToString().Substring(0, 3).ToString().Equals("*1*"))
                                {
                                    // เช็ค config อนุญาติแก้ไขราคา
                                    bool __allowChangePrice = true;
                                    if (this._posChangePrice || this._autoInsertItem)
                                    {
                                        __allowChangePrice = true;
                                    }
                                    else
                                    {
                                        // เช็คสิทธิ์ user แก้ไขราคาได้หรือเปล่า
                                        __allowChangePrice = _allowChangePrice();
                                    }

                                    // แก้ไขราคา รายการล่าสุด
                                    if (__allowChangePrice)
                                    {
                                        if (this._itemList.Count > 0)
                                        {
                                            // check line edit ต้วอย่าง command *1*#2#25 ความหมาย แก้ไขราคา (*1*) บรรทัดที่ 2 (#2#) ให้เป็น 25 บาท
                                            bool __setByLine = false;
                                            string __editLineText = "";
                                            int __editLine = -1;
                                            // Get Line by Regex
                                            Regex __lineGet = new Regex(@"\#+(\d+)+\#");
                                            if (__lineGet.IsMatch(__split[1].ToString()))
                                            {
                                                __setByLine = true;
                                                __editLineText = __lineGet.Matches(__split[1].ToString())[0].Value;
                                                __editLine = (int)MyLib._myGlobal._decimalPhase(__lineGet.Matches(__split[1].ToString())[0].Value.Replace("#", string.Empty));
                                            }


                                            if (this._lastBarcode.Length == 0 && this._lastItemCode.Length == 0)
                                            {
                                                MessageBox.Show("ไม่พบรายการสินค้า");
                                            }
                                            else
                                            {
                                                // ค้นหา Barcode เดิม ก่อนแก้ไข
                                                Boolean __found = false;
                                                int __foundAddr = -1;
                                                for (int __row = this._itemList.Count - 1; __row >= 0; __row--)
                                                {
                                                    // ค้นหาจาก barcode
                                                    if ((this._lastBarcode.Equals(this._itemList[__row]._barCode) && __setByLine == false) || (__setByLine && __editLine.Equals(__row + 1)))
                                                    {
                                                        __foundAddr = __row;
                                                        __found = true;
                                                        break;
                                                    }

                                                    // ค้นหาจาก รหัสสินค้า
                                                    if (this._lastBarcode.Length == 0 && this._lastItemCode.Equals(this._itemList[__row]._itemCode) && (__setByLine == false) || (__setByLine && __editLine.Equals(__row + 1)))
                                                    {
                                                        __foundAddr = __row;
                                                        __found = true;
                                                        break;
                                                    }
                                                }
                                                //
                                                if (__found == false)
                                                {
                                                    MessageBox.Show("ไม่พบรายการสินค้า");
                                                }
                                                else
                                                {
                                                    string __newPriceStr = __split[1].ToString().Remove(0, 3).Trim();

                                                    if (__setByLine)
                                                    {
                                                        __newPriceStr = __newPriceStr.Replace(__editLineText, string.Empty);
                                                    }

                                                    decimal __newPrice = 0;
                                                    bool __checkNumber = Decimal.TryParse(__newPriceStr, out __newPrice);
                                                    bool _doChangePrice = true;
                                                    if (__newPriceStr.Length == 0 || __checkNumber == false)
                                                    {
                                                        // โต๋เพิ่มตรงนี้
                                                        _posInputNumberForm __numberForm = new _posInputNumberForm("แก้ไขราคาสินค้า");
                                                        __numberForm.ShowDialog();

                                                        if (__numberForm.DialogResult == DialogResult.OK)
                                                        {
                                                            __newPriceStr = __numberForm._getNumberValue;
                                                        }
                                                        else
                                                        {
                                                            _doChangePrice = false;
                                                        }
                                                        //__newPriceStr = "";

                                                        __checkNumber = Decimal.TryParse(__newPriceStr, out __newPrice);
                                                    }
                                                    if (_doChangePrice)
                                                    {
                                                        if (__newPriceStr.Length == 0 || __checkNumber == false)
                                                        {
                                                            MessageBox.Show("ป้อนราคาผิดพลาด");
                                                        }
                                                        else
                                                        {
                                                            // เช็คขายต่ำกว่าราคากลาง
                                                            if (_g.g._companyProfile._ic_price_formula_control)
                                                            {
                                                                //if (this._itemList[__foundAddr]._price_stand > __newPrice)
                                                                if (this._checkSaleLowStandPrice(((this._itemList[__foundAddr]._barCode != null && this._itemList[__foundAddr]._barCode.Length > 0) ? this._itemList[__foundAddr]._barCode : this._itemList[__foundAddr]._itemCode), this._itemList[__foundAddr]._price_stand, __newPrice, this._itemList[__foundAddr]._qty, this._itemList[__foundAddr]._discountWord))
                                                                {
                                                                    _sendMessage("clear:textbox,input", null, "");
                                                                    return;
                                                                }
                                                            }

                                                            this._itemList[__foundAddr]._price = __newPrice;
                                                            this._itemList[__foundAddr]._isChangePrice = 1;
                                                            _posClientItemClass __item = this._itemList[__foundAddr];
                                                            _sendMessage("update:label,status", String.Format("แก้ไขราคา" + " : {0}/{1}/{2}/@ {3} x {4} = {5}", __item._barCode, __item._itemName, __item._unitCode, __item._qty.ToString(this._formatNumber1), __item._price.ToString(this._formatNumber1), __item._amount.ToString(this._formatNumber1)), "");
                                                            //
                                                            this._addItemToGrid(false, -1);
                                                        }
                                                    }
                                                }
                                            }
                                            _sendMessage("clear:textbox,input", null, "");
                                        }
                                    }
                                }
                                #endregion
                                #region *2* แก้ไขส่วนลด
                                else if (__split[1].ToString().Length >= 3 && __split[1].ToString().Substring(0, 3).ToString().Equals("*2*"))
                                {
                                    bool __allowChangeDiscount = true;

                                    if (this._posChangeDiscount)
                                    {
                                        __allowChangeDiscount = true;
                                    }
                                    else
                                    {
                                        __allowChangeDiscount = _allowChangeDiscount();
                                    }

                                    if (__allowChangeDiscount)
                                    {

                                        // แก้ไขส่วนลด รายการล่าสุด
                                        if (this._itemList.Count > 0)
                                        {
                                            bool __setByLine = false;
                                            string __editLineText = "";
                                            int __editLine = -1;
                                            // Get Line by Regex
                                            Regex __lineGet = new Regex(@"\#+(\d+)+\#");
                                            if (__lineGet.IsMatch(__split[1].ToString()))
                                            {
                                                __setByLine = true;
                                                __editLineText = __lineGet.Matches(__split[1].ToString())[0].Value;
                                                __editLine = (int)MyLib._myGlobal._decimalPhase(__lineGet.Matches(__split[1].ToString())[0].Value.Replace("#", string.Empty));
                                            }

                                            if (this._lastBarcode.Length == 0)
                                            {
                                                MessageBox.Show("ไม่พบรายการสินค้า");
                                            }
                                            else
                                            {
                                                // ค้นหา Barcode เดิม
                                                Boolean __found = false;
                                                int __foundAddr = -1;
                                                for (int __row = this._itemList.Count - 1; __row >= 0; __row--)
                                                {
                                                    if ((this._lastBarcode.Equals(this._itemList[__row]._barCode) && __setByLine == false) || (__setByLine && __editLine.Equals(__row + 1)))
                                                    {
                                                        __foundAddr = __row;
                                                        __found = true;
                                                        break;
                                                    }
                                                }
                                                //
                                                if (__found == false)
                                                {
                                                    MessageBox.Show("ไม่พบรายการสินค้า");
                                                }
                                                else
                                                {
                                                    string __newDiscountStr = __split[1].ToString().Remove(0, 3).Trim();

                                                    if (!__editLineText.Equals(""))
                                                    {
                                                        __newDiscountStr = __newDiscountStr.Replace(__editLineText, string.Empty);
                                                    }
                                                    Boolean _dochangeDiscount = true;

                                                    // toe
                                                    if (__newDiscountStr.Equals("*"))
                                                    {
                                                        _posInputNumberForm __numberForm = new _posInputNumberForm("แก้ไขส่วนลด");
                                                        __numberForm.ShowDialog();

                                                        if (__numberForm.DialogResult == DialogResult.OK)
                                                        {
                                                            __newDiscountStr = __numberForm._getNumberValue;
                                                        }
                                                        else
                                                        {
                                                            _dochangeDiscount = false;
                                                        }

                                                    }

                                                    if (_dochangeDiscount)
                                                    {
                                                        // เช็คขายต่ำกว่าราคากลาง
                                                        if (_g.g._companyProfile._ic_price_formula_control)
                                                        {
                                                            if (this._checkSaleLowStandPrice(((this._itemList[__foundAddr]._barCode != null && this._itemList[__foundAddr]._barCode.Length > 0) ? this._itemList[__foundAddr]._barCode : this._itemList[__foundAddr]._itemCode), this._itemList[__foundAddr]._price_stand, this._itemList[__foundAddr]._price, this._itemList[__foundAddr]._qty, __newDiscountStr))
                                                            {
                                                                _sendMessage("clear:textbox,input", null, "");
                                                                return;
                                                            }
                                                        }

                                                        this._itemList[__foundAddr]._discountWord = __newDiscountStr;
                                                        this._itemList[__foundAddr]._isChangeDiscount = 1;
                                                        _posClientItemClass __item = this._itemList[__foundAddr];
                                                        if (__newDiscountStr.Length == 0)
                                                        {
                                                            _sendMessage("update:label,status", "ยกเลิกส่วนลด" + " : " + __item._barCode + "/" + __item._itemName, serialNumber);
                                                        }
                                                        else
                                                        {
                                                            _sendMessage("update:label,status", "แก้ไขส่วนลด" + " : " + __item._barCode + "/" + __item._itemName + "=" + __newDiscountStr, serialNumber);
                                                        }
                                                    }
                                                    //
                                                    this._addItemToGrid(false, -1);
                                                }
                                            }
                                            _sendMessage("clear:textbox,input", null, serialNumber);
                                        }
                                    }

                                }
                                #endregion
                                #region *3* แก้ไขรายละเอียดการจ่ายยา
                                else if (__split[1].ToString().Length >= 3 && __split[1].ToString().Substring(0, 3).ToString().Equals("*3*") && (_isPharmacist || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLPOSMED))
                                {
                                    // แก้ไขรายละเอียดการจ่ายยา

                                    // get line ถ้าไม่ได้ใส่ line มา ให้ดึงรายการสุดท้าย
                                    int __addr = (int)MyLib._myGlobal._decimalPhase(__split[1].ToString().Remove(0, 3));
                                    if (__addr == 0)
                                    {
                                        __addr = this._itemList.Count;
                                    }
                                    __addr--;
                                    if (__addr < this._itemList.Count)
                                    {
                                        // show dialog for edit
                                        _posClientItemClass __item = this._itemList[__addr];
                                        _posChangeDetailForm __changeDetailForm = new _posChangeDetailForm(__item);
                                        if (__changeDetailForm.ShowDialog(MyLib._myGlobal._mainForm) == DialogResult.OK)
                                        {
                                            string _new_dozen = __changeDetailForm._dozenTextbox.Text;
                                            string _new_frequency = __changeDetailForm._frequencyTextbox.Text;
                                            string _new_times = __changeDetailForm._timesTextbox.Text;
                                            string _new_warning = __changeDetailForm._wraningTextbox.Text;
                                            string _new_remark = __changeDetailForm._remarkTextbox.Text;

                                            this._itemList[__addr]._m_dozen = _new_dozen;
                                            this._itemList[__addr]._m_frequency = _new_frequency;
                                            this._itemList[__addr]._m_times = _new_times;
                                            this._itemList[__addr]._m_warning = _new_warning;
                                            this._itemList[__addr]._m_remark = _new_remark;

                                            _sendMessage("update:label,m_dozen", _new_dozen, serialNumber);
                                            _sendMessage("update:label,m_times", _new_frequency, serialNumber);
                                            _sendMessage("update:label,m_frequency", _new_times, serialNumber);
                                            _sendMessage("update:label,m_remark", _new_warning, serialNumber);
                                            //_sendMessage("update:label,status", _new_remark);
                                        }
                                    }

                                    _sendMessage("clear:textbox,input", null, serialNumber);

                                }
                                #endregion
                                #region *4* เปลี่ยนหน่วยนับ
                                else if (__split[1].ToString().Length >= 3 && __split[1].ToString().Substring(0, 3).ToString().Equals("*4*"))
                                {
                                    // เปลี่ยนหน่วยนับ
                                    if (this._itemList.Count > 0)
                                    {
                                        int __addr = (int)MyLib._myGlobal._decimalPhase(__split[1].ToString().Remove(0, 3));
                                        if (__addr == 0)
                                        {
                                            __addr = this._itemList.Count;
                                        }
                                        __addr--;
                                        if (__addr < this._itemList.Count)
                                        {
                                            _posClientItemClass __item = this._itemList[__addr];
                                            MyLib._myFrameWork __myFrameWork = new _myFrameWork();
                                            DataTable __check = __myFrameWork._queryShort("select " + _g.d.ic_inventory._unit_type + " from " + _g.d.ic_inventory._table + " where " + MyLib._myGlobal._addUpper(_g.d.ic_inventory._code) + "=\'" + __item._itemCode.ToUpper() + "\'").Tables[0];
                                            if (__check.Rows.Count > 0)
                                            {
                                                if ((int)MyLib._myGlobal._decimalPhase(__check.Rows[0][_g.d.ic_inventory._unit_type].ToString()) != 1)
                                                {
                                                    MessageBox.Show("สินค้าหน่วยนับเดียว");
                                                }
                                                else
                                                {
                                                    SMLERPControl._ic._icTransItemGridSelectUnitForm __selectUnit = new SMLERPControl._ic._icTransItemGridSelectUnitForm();
                                                    __selectUnit._itemCode = this._itemList[__addr]._itemCode;
                                                    __selectUnit._selectUnitCode += (mode, unitCode) =>
                                                    {
                                                        __selectUnit.Close();
                                                        if (mode == 1)
                                                        {
                                                            this._itemList[__addr]._unitCode = unitCode;

                                                            // toe หา divide value and stand value
                                                            int __standValue = MyLib._myGlobal._intPhase(__selectUnit._icmainGridUnit._cellGet(__selectUnit._icmainGridUnit.SelectRow, _g.d.ic_unit_use._stand_value).ToString());
                                                            int __divideValue = MyLib._myGlobal._intPhase(__selectUnit._icmainGridUnit._cellGet(__selectUnit._icmainGridUnit.SelectRow, _g.d.ic_unit_use._divide_value).ToString());
                                                            this._itemList[__addr]._standValue = __standValue;
                                                            this._itemList[__addr]._divideValue = __divideValue;


                                                            // หาราคาตาม barcode ก่อน
                                                            // หาราคาตามสินค้า
                                                            string __today = MyLib._myGlobal._convertDateToQuery(DateTime.Now);
                                                            SMLInventoryControl._findPriceClass __getPrice = new SMLInventoryControl._findPriceClass();
                                                            SMLInventoryControl._icTransItemGridControl._priceStruct __result = __getPrice._findPriceByItem(this._itemList[__addr]._itemCode, this._itemList[__addr]._barCode, unitCode, this._itemList[__addr]._qty, this._custCode, this._memberCode, false, "", __today, _g.g._vatTypeEnum.ภาษีรวมใน, 0, 1, 0);
                                                            decimal __price = __result._price;
                                                            int __price_type = __result._type;
                                                            if (__price == 0)
                                                            {
                                                                // เอาราคารวมในมาเพิ่ม vat
                                                                __price = MyLib._myGlobal._round(__result._price1 + (__result._price1 * (_g.g._companyProfile._vat_rate / 100M)), 2);
                                                            }
                                                            this._itemList[__addr]._price = __price;
                                                            this._itemList[__addr]._price_type = __price_type;
                                                            this._itemList[__addr]._price_stand = __result._stand_price;
                                                            this._itemList[__addr]._discountWord = __result._discountWord;
                                                            //
                                                            this._addItemToGrid(false, -1);
                                                        }
                                                    };
                                                    __selectUnit.ShowDialog(this);
                                                }
                                            }
                                        }
                                        else
                                        {
                                            _sendMessage("update:label,status", "แก้ไขหน่วยนับผิดพลาด", serialNumber);
                                        }
                                        _sendMessage("clear:textbox,input", null, serialNumber);
                                    }

                                }
                                #endregion
                                #region *5* แก้ไขชื่อสินค้า
                                else if (__split[1].ToString().Length >= 3 && __split[1].ToString().Substring(0, 3).ToString().Equals("*5*"))
                                {
                                    if (this._itemList.Count > 0)
                                    {
                                        // check line edit ต้วอย่าง command *1*#2#25 ความหมาย แก้ไขราคา (*1*) บรรทัดที่ 2 (#2#) ให้เป็น 25 บาท
                                        bool __setByLine = false;
                                        string __editLineText = "";
                                        int __editLine = -1;
                                        // Get Line by Regex
                                        Regex __lineGet = new Regex(@"\#+(\d+)+\#");
                                        if (__lineGet.IsMatch(__split[1].ToString()))
                                        {
                                            __setByLine = true;
                                            __editLineText = __lineGet.Matches(__split[1].ToString())[0].Value;
                                            __editLine = (int)MyLib._myGlobal._decimalPhase(__lineGet.Matches(__split[1].ToString())[0].Value.Replace("#", string.Empty));
                                        }

                                        if (this._lastBarcode.Length == 0 && this._lastItemCode.Length == 0)
                                        {
                                            MessageBox.Show("ไม่พบรายการสินค้า");
                                        }
                                        else
                                        {
                                            // ค้นหา Barcode เดิม ก่อนแก้ไข
                                            Boolean __found = false;
                                            int __foundAddr = -1;
                                            for (int __row = this._itemList.Count - 1; __row >= 0; __row--)
                                            {
                                                // ค้นหาจาก barcode
                                                if ((this._lastBarcode.Equals(this._itemList[__row]._barCode) && __setByLine == false) || (__setByLine && __editLine.Equals(__row + 1)))
                                                {
                                                    __foundAddr = __row;
                                                    __found = true;
                                                    break;
                                                }

                                                // ค้นหาจาก รหัสสินค้า
                                                if (this._lastBarcode.Length == 0 && this._lastItemCode.Equals(this._itemList[__row]._itemCode) && (__setByLine == false) || (__setByLine && __editLine.Equals(__row + 1)))
                                                {
                                                    __foundAddr = __row;
                                                    __found = true;
                                                    break;
                                                }
                                            }
                                            //
                                            if (__found == false)
                                            {
                                                MessageBox.Show("ไม่พบรายการสินค้า");
                                            }
                                            else
                                            {
                                                string __newItemName = __split[1].ToString().Remove(0, 3).Trim();

                                                if (__setByLine)
                                                {
                                                    __newItemName = __newItemName.Replace(__editLineText, string.Empty);
                                                }

                                                decimal __newPrice = 0;
                                                //bool __checkNumber = Decimal.TryParse(__newPriceStr, out __newPrice);
                                                //bool _doChangePrice = true;
                                                //if (__newItemName.Length == 0 )
                                                //{
                                                ////    // โต๋เพิ่มตรงนี้                                                    
                                                ////    _posInputNumberForm __numberForm = new _posInputNumberForm("แก้ไขราคาสินค้า");
                                                ////    __numberForm.ShowDialog();

                                                ////    if (__numberForm.DialogResult == DialogResult.OK)
                                                ////    {
                                                ////        __newPriceStr = __numberForm._getNumberValue;
                                                ////    }
                                                ////    else
                                                ////    {
                                                ////        _doChangePrice = false;
                                                ////    }
                                                ////    //__newPriceStr = "";

                                                ////    __checkNumber = Decimal.TryParse(__newPriceStr, out __newPrice);
                                                //}
                                                //if (_doChangePrice)
                                                //{
                                                if (__newItemName.Length == 0)
                                                {
                                                    MessageBox.Show("ป้อนชื่อสินค้าผิดพลาด");
                                                }
                                                else
                                                {
                                                    this._itemList[__foundAddr]._itemName = __newItemName;
                                                    _posClientItemClass __item = this._itemList[__foundAddr];
                                                    _sendMessage("update:label,status", String.Format("แก้ไขชื่อสินค้า" + " : {0}/{1}/{2}/@ {3} x {4} = {5}", __item._barCode, __item._itemName, __item._unitCode, __item._qty.ToString(this._formatNumber1), __item._price.ToString(this._formatNumber1), __item._amount.ToString(this._formatNumber1)), "");
                                                    //
                                                    this._addItemToGrid(false, -1);
                                                }
                                                //}
                                            }
                                        }
                                        _sendMessage("clear:textbox,input", null, "");
                                    }


                                }
                                #endregion
                                else if (__split[1].ToString().Length >= 3 && __split[1].ToString().Substring(0, 3).ToString().Equals("*tt"))
                                {

                                }
                                #region *00 เก็บเงินโต๊ะ
                                else if (__split[1].ToString().Length >= 3 && __split[1].ToString().Substring(0, 3).ToString().Equals("*00") && (MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro))
                                {

                                    Form __formTable = new Form();
                                    __formTable.StartPosition = FormStartPosition.CenterScreen;
                                    //__formTable.Size = new System.Drawing.Size(700, 600);
                                    __formTable.WindowState = FormWindowState.Maximized;
                                    __formTable.Text = "เก็บเงินโต๊ะ";

                                    SMLPOSControl._tableSearchLevelControl __tableSelect = new SMLPOSControl._tableSearchLevelControl();
                                    __tableSelect.Dock = DockStyle.Fill;
                                    __tableSelect._menuTableClick += (s1, e1) =>
                                    {
                                        SMLPOSControl._tableSearchLevelMenuControl __table = (SMLPOSControl._tableSearchLevelMenuControl)s1;
                                        switch (__table._status)
                                        {
                                            case 0:
                                                MessageBox.Show("โต๊ะนี้ยังไม่เปิด");
                                                break;
                                            case 1:
                                                MessageBox.Show("โต๊ะนี้ยังไม่มีการปิดโต๊ะ");
                                                break;
                                            case 2:
                                                {
                                                    this._newData();
                                                    // เรียก order มา
                                                    this._isTableCheckOut = true;
                                                    _getTableOrderForPay(__table);
                                                    __formTable.Close();

                                                };
                                                break;
                                        }
                                    };
                                    __formTable.Controls.Add(__tableSelect);
                                    __formTable.ShowDialog(MyLib._myGlobal._mainForm);
                                    _sendMessage("clear:textbox,input", null, serialNumber);


                                }
                                #endregion
                                #region *01 สั่ง order ด้วยรหัส
                                else if (__split[1].ToString().Length >= 3 && __split[1].ToString().Substring(0, 3).ToString().Equals("*01") && (MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro))
                                {

                                    //Form __formTable = new Form();
                                    //__formTable.StartPosition = FormStartPosition.CenterScreen;
                                    //__formTable.Size = new System.Drawing.Size(700, 600);
                                    //__formTable.Text = "เก็บเงินโต๊ะ";

                                    //SMLPOSControl._tableSearchLevelControl __tableSelect = new SMLPOSControl._tableSearchLevelControl();
                                    //__tableSelect.Dock = DockStyle.Fill;
                                    //__tableSelect._menuTableClick += (s1, e1) =>
                                    //{
                                    //    SMLPOSControl._tableSearchLevelMenuControl __table = (SMLPOSControl._tableSearchLevelMenuControl)s1;
                                    //    switch (__table._status)
                                    //    {
                                    //        case 0: MessageBox.Show("โต๊ะนี้ยังไม่เปิด");
                                    //            break;
                                    //        case 1: MessageBox.Show("โต๊ะนี้ยังไม่มีการปิดโต๊ะ");
                                    //            break;
                                    //        case 2:
                                    //            {
                                    //                // เรียก order มา
                                    //                this._isTableCheckOut = true;
                                    //                _getTableOrderForPay(__table);
                                    //                __formTable.Close();

                                    //            };
                                    //            break;
                                    //    }
                                    //};
                                    //__formTable.Controls.Add(__tableSelect);
                                    //__formTable.ShowDialog(MyLib._myGlobal._mainForm);
                                    Form __formOrder = new Form();
                                    __formOrder.StartPosition = FormStartPosition.CenterScreen;
                                    __formOrder.WindowState = FormWindowState.Maximized;
                                    __formOrder.Text = "สั่งอาหาร (ด้วยรหัส)";
                                    SMLPOSControl._food._orderControl __orderControl = new SMLPOSControl._food._orderControl(1);
                                    __orderControl._afterCloseTableForPay += (s1, e1, sale, isCloseTable) =>
                                    {
                                        // call show pay bill
                                        SMLPosClient._closeTableSummaryForm _summaryForm = new _closeTableSummaryForm(e1, sale, isCloseTable);
                                        _summaryForm.ShowDialog(__formOrder);
                                        // ถาม บัตรสมาชิก 
                                    };
                                    __orderControl.Dock = DockStyle.Fill;
                                    __formOrder.Controls.Add(__orderControl);
                                    __formOrder.ShowDialog(MyLib._myGlobal._mainForm);
                                    _sendMessage("clear:textbox,input", null, serialNumber);


                                }
                                #region *02 ปิดโต๊ะ
                                else if (__split[1].ToString().Length >= 3 && __split[1].ToString().Substring(0, 3).ToString().Equals("*02") && (MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro))
                                {
                                    // 1.กด ปิดโต๊ะ
                                    // 2.เลือก โต๊ะ
                                    // 3.สั่งเพิ่ม
                                    // 4.พิมพ์ใบปิดโต๊ะ + ปิด

                                    Form __formTable = new Form();
                                    __formTable.StartPosition = FormStartPosition.CenterScreen;
                                    __formTable.Size = new System.Drawing.Size(700, 600);
                                    __formTable.Text = "ปิดโต๊ะ";

                                    SMLPOSControl._tableSearchLevelControl __tableSelect = new SMLPOSControl._tableSearchLevelControl();
                                    __tableSelect.Dock = DockStyle.Fill;
                                    __tableSelect._menuTableClick += (s1, e1) =>
                                    {
                                        SMLPOSControl._tableSearchLevelMenuControl __table = (SMLPOSControl._tableSearchLevelMenuControl)s1;
                                        switch (__table._status)
                                        {
                                            case 0:
                                                MessageBox.Show("โต๊ะนี้ยังไม่เปิด");
                                                break;
                                            case 1:
                                                {
                                                    __formTable.Close();
                                                    SMLPOSControl._food._orderControl __orderControl = new SMLPOSControl._food._orderControl(1);
                                                    // กำหนดโต๊ะ                                                    
                                                    __orderControl._loadTable(this._saleCode, this._saleName, __table._tableNumber, __table._tableName, __table._transGuidNumber);
                                                    __orderControl._foodOrder._isForClseTable = true;

                                                    if (MessageBox.Show("ต้องการสั่งอาหารเพิ่มก่อนปิดโต๊ะหรือไม่", "ยืนยัน", MessageBoxButtons.YesNo) == DialogResult.Yes)
                                                    {

                                                        // confirm สั่งอาหารเพิ่ม
                                                        // เรียก หน้าจอสั่งอาหารด้วยรหัส มา
                                                        Form __formOrder = new Form();
                                                        __formOrder.StartPosition = FormStartPosition.CenterScreen;
                                                        __formOrder.WindowState = FormWindowState.Maximized;
                                                        __formOrder.Text = "สั่งอาหาร (ด้วยรหัส)";
                                                        __orderControl.Dock = DockStyle.Fill;

                                                        __orderControl._afterCloseTableForPay += (s2, e2, sale, isCloseTable) =>
                                                        {
                                                            // call show pay bill
                                                            SMLPosClient._closeTableSummaryForm _summaryForm = new _closeTableSummaryForm(e2, sale, isCloseTable);
                                                            _summaryForm.ShowDialog(__formOrder);

                                                            // ปิดจอ

                                                            _summaryForm.Dispose();
                                                            __formOrder.Close();
                                                            __orderControl.Dispose();
                                                        };


                                                        __formOrder.Controls.Add(__orderControl);
                                                        __formOrder.ShowDialog(MyLib._myGlobal._mainForm);
                                                    }
                                                    else
                                                    {
                                                        __orderControl._afterCloseTableForPay += (s2, e2, sale, isCloseTable) =>
                                                        {
                                                            // call show pay bill
                                                            SMLPosClient._closeTableSummaryForm _summaryForm = new _closeTableSummaryForm(e2, sale, isCloseTable);
                                                            _summaryForm.ShowDialog(MyLib._myGlobal._mainForm);
                                                            // ถาม บัตรสมาชิก 

                                                            _summaryForm.Dispose();
                                                            __orderControl.Dispose();

                                                        };
                                                        // สั่งปิดโต๊ะ
                                                        __orderControl._foodOrder._checkInputKey("995");

                                                    }

                                                    // ปิดโต๊ะ


                                                };
                                                break;
                                            case 2:
                                                MessageBox.Show("โต๊ะนี้ทำการปิดโต๊ะไปแล้ว");
                                                break;
                                        }
                                    };
                                    __formTable.Controls.Add(__tableSelect);
                                    __formTable.ShowDialog(MyLib._myGlobal._mainForm);

                                    _sendMessage("clear:textbox,input", null, serialNumber);

                                }
                                #endregion
                                #endregion
                                #region *93 พิมพ์บิลปิดโต๊ะ Tomyumgoong
                                else if (__split[1].ToString().Length >= 3 && __split[1].ToString().Substring(0, 3).ToString().Equals("*93") && (MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro))
                                {

                                    // call print pre cash
                                    this._printPreCash();
                                    _sendMessage("clear:textbox,input", null, serialNumber);

                                }
                                #endregion
                                // *55

                                #region กำหนดส่วนลดท้ายบิล คำณวนหลังจากลด pro และ อาหาร *9*10%
                                else if (__split[1].ToString().Length >= 3 && __split[1].ToString().Substring(0, 3).ToString().Equals("*9*")
                                    // && (MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro)
                                    )
                                {

                                    string __discountInsert = __split[1].ToString().Remove(0, 3).Trim();

                                    if (__discountInsert.Length == 0)
                                    {
                                        _posInputNumberForm __numberForm = new _posInputNumberForm("ส่วนลด");
                                        __numberForm.ShowDialog();

                                        if (__numberForm.DialogResult == DialogResult.OK)
                                        {
                                            __discountInsert = __numberForm._getNumberValue;
                                        }
                                    }

                                    if (__discountInsert.Length > 0)
                                    {
                                        this._discountWord = __discountInsert;
                                        _addItemToGrid(false, -1);

                                        if ((MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro))
                                        {

                                            if (this._table != null && this._autoInsertItem == false)
                                            {
                                                // บันทึกส่วนลด ลงไปใน table trans ด้วย
                                                MyLib._myFrameWork __myFramework = new _myFrameWork();
                                                __myFramework._queryInsertOrUpdate(MyLib._myGlobal._databaseName, "update " + _g.d.table_trans._table + " set " + _g.d.table_trans._total_discount + "=\'" + this._discountWord + "\' where " + _g.d.table_trans._trans_guid + "=\'" + this._trans_guid + "\' and " + _g.d.table_trans._table_number + "=\'" + this._tableNumberSelect + "\'");
                                            }
                                        }

                                    }
                                    _sendMessage("clear:textbox,input", null, serialNumber);


                                }
                                #endregion
                                else if (__split[1].ToString().Length >= 3 && __split[1].ToString().Substring(0, 3).ToString().Equals("*55"))
                                {
                                    if (this._memberCode.Trim().Length > 0 && (this._memberCode.Equals(this._posDefaultCust) == false))
                                    {
                                        string __discount = __split[1].ToString().Substring(3);
                                        // discount birthday
                                        if (_isBirthMonthMember == true)
                                        {
                                            // check 

                                            // 1. check in center
                                            // 2. check in client

                                            bool __pass = false;
                                            bool __centerPass = false;

                                            string __queryCheckBirthDate = "select distinct doc_no, doc_date from ic_trans_detail where price_type = 55 and doc_date between \'" + DateTime.Now.Year + "-01-01\' and '" + DateTime.Now.Year + "-12-31' and cust_code = \'" + this._custCode + "\' ";

                                            MyLib._myFrameWork __myFrameWork = new _myFrameWork();

                                            if (_g.g._companyProfile._activeSync)
                                            {
                                                try
                                                {
                                                    MyLib._myFrameWork __datacenterFrameWork = new MyLib._myFrameWork(_g.g._companyProfile._activeSyncServer, "SMLConfig" + _g.g._companyProfile._activeSyncProvider + ".xml", MyLib._myGlobal._databaseType.PostgreSql);
                                                    MyLib._myGlobal._databaseType __centerDatabaseType = __datacenterFrameWork._setDataBaseCode();

                                                    DataSet __checkBirthDayCenterResult = __datacenterFrameWork._query(_g.g._companyProfile._activeSyncDatabase, __queryCheckBirthDate);

                                                    if (__checkBirthDayCenterResult.Tables.Count > 0)
                                                    {
                                                        if (__checkBirthDayCenterResult.Tables[0].Rows.Count == 0)
                                                        {
                                                            __centerPass = true;
                                                        }
                                                        else
                                                        {
                                                            MessageBox.Show("มีการใช้สิทธิ์ ดังกล่าวไปแล้ว บิลเลขที่ : " + __checkBirthDayCenterResult.Tables[0].Rows[0][0].ToString() + " เมื่อวันที่ : " + __checkBirthDayCenterResult.Tables[0].Rows[0][1].ToString());
                                                        }
                                                    }
                                                    else
                                                    {
                                                        MessageBox.Show("");
                                                    }
                                                }
                                                catch
                                                {
                                                    MessageBox.Show("ผิดพลาดการเชื่อมต่อ กรุณาลองใหม่");
                                                    __pass = false;

                                                }
                                            }
                                            else
                                            {
                                                __centerPass = true;
                                            }

                                            // check client 

                                            if (__centerPass == true)
                                            {

                                                DataSet __checkBirthDayResult = __myFrameWork._query(MyLib._myGlobal._databaseName, __queryCheckBirthDate);
                                                if (__checkBirthDayResult.Tables.Count > 0)
                                                {
                                                    if (__checkBirthDayResult.Tables[0].Rows.Count == 0)
                                                    {
                                                        __pass = true;
                                                    }
                                                    else
                                                    {
                                                        MessageBox.Show("มีการใช้สิทธิ์ ดังกล่าวไปแล้ว บิลเลขที่ : " + __checkBirthDayResult.Tables[0].Rows[0][0].ToString() + " เมื่อวันที่ : " + __checkBirthDayResult.Tables[0].Rows[0][1].ToString());
                                                    }
                                                }
                                                else
                                                {
                                                    MessageBox.Show("");
                                                }
                                            }


                                            if (__pass)
                                            {


                                                // pass
                                                for (int itemrow = 0; itemrow < this._itemList.Count; itemrow++)
                                                {
                                                    this._itemList[itemrow]._price_type = 55;
                                                    this._itemList[itemrow]._discountWord = __discount;
                                                    this._itemList[itemrow]._discountNumber = 55;
                                                    this._itemList[itemrow]._priceInfo = "ส่วนลดวันเกิด " + __discount;
                                                    this._itemList[itemrow]._price = this._itemList[itemrow]._priceDefault;
                                                }

                                                this._addItemToGrid(false, -1);
                                            }
                                        }
                                        else
                                        {
                                            MessageBox.Show("ไม่อยู่ในช่วงเดือนเกิดของสมาชิก");
                                        }
                                    }
                                    else
                                    {
                                        MessageBox.Show("ไม่พบข้อมูลสมาชิก");
                                    }
                                    _sendMessage("clear:textbox,input", null, serialNumber);

                                }
                                else
                                {
                                    #region *** ลบรายการ
                                    if (__split[1].ToString().Length >= 3 && __split[1].ToString().Substring(0, 3).ToString().Equals("***"))
                                    {
                                        bool __check_pass = true;
                                        if (this._check_delete_item)
                                        {
                                            // check password
                                            __check_pass = _checkUserRight(_g.d.erp_user._delete_item_pos, "ไม่อนุญาติให้ลบรายการสินค้า");

                                        }

                                        // ลบรายการ (สามารถระบุบรรทัดได้เช่น ***5 คือ ลบบรรทัดที่ 5)
                                        if (__check_pass)
                                        {
                                            if (this._itemList.Count > 0)
                                            {
                                                int __addr = (int)MyLib._myGlobal._decimalPhase(__split[1].ToString().Remove(0, 3));
                                                if (__addr == 0)
                                                {
                                                    __addr = this._itemList.Count;
                                                }
                                                __addr--;
                                                if (__addr < this._itemList.Count)
                                                {
                                                    _posClientItemClass __item = this._itemList[__addr];
                                                    _sendMessage("update:label,status", String.Format("ลบ" + " : {0}/{1}/{2}/@ {3} x {4} = {5}", __item._barCode, __item._itemName, __item._unitCode, __item._qty.ToString(this._formatNumber1), __item._price.ToString(this._formatNumber1), __item._amount.ToString(this._formatNumber1)), serialNumber);

                                                    if (__check_pass && _check_delete_item)
                                                    {
                                                        // save pos log

                                                        string __strMessage = string.Format("{0}/{1}/{2}/{3}/{4}", __item._barCode, __item._itemName, __item._unitCode, __item._qty.ToString(this._formatNumber1), __item._price.ToString(this._formatNumber1));
                                                        _saveCommandLog(this._posLoginCode, source, __strMessage, _lastApproveCode);
                                                    }
                                                    //
                                                    this._itemList.RemoveAt(__addr);
                                                    this._addItemToGrid(false, -1);
                                                }
                                                else
                                                {
                                                    _sendMessage("update:label,status", "ลบผิดพลาด", serialNumber);
                                                }
                                            }

                                        }
                                        _sendMessage("clear:textbox,input", null, serialNumber);

                                    }
                                    #endregion
                                    #region *0*0* reprint ใบส่งเงิน
                                    else if (__split[1].ToString().Length >= 5 && __split[1].ToString().Substring(0, 5).ToString().Equals("*0*0*"))
                                    {


                                        string __doc_no = __split[1].ToString().Replace("*0*0*", string.Empty);
                                        this._printSaveSendMoney(__doc_no.ToUpper());
                                        _sendMessage("clear:textbox,input", null, serialNumber);

                                    }
                                    #endregion
                                    else
                                    {
                                        switch (__split[1].ToString())
                                        {
                                            case "*51":
                                                #region พิมพ์ใบเสร็จเป็นช่วง
                                                {
                                                    _posPrintSlipPeriod _printPeriod = new _posPrintSlipPeriod(this._posConfig, this._posLoginCode, this._posLoginPassword);
                                                    _printPeriod._perionBillPrint += new _periodBillPrint(_printPeriod__perionBillPrint);
                                                    _printPeriod.ShowDialog();
                                                }
                                                #endregion
                                                break;
                                            case "*52":
                                                #region สรุปยอดขาย
                                                {
                                                    _sendMessage("clear:textbox,input", null, serialNumber);
                                                    Form __form = new Form();
                                                    __form.StartPosition = FormStartPosition.CenterScreen;
                                                    __form.Size = new System.Drawing.Size(400, 350);
                                                    __form.Text = "สรุปยอดขาย";
                                                    _summaryDayUserControl __sum = new _summaryDayUserControl(this._posConfig._posid, this._posLoginCode, this._posLoginPassword);
                                                    __sum.Dock = DockStyle.Fill;
                                                    __form.Controls.Add(__sum);
                                                    __sum._closeButton.Click += (s1, e1) =>
                                                    {
                                                        __form.Close();
                                                    };
                                                    __sum._buttonPrintClick += (s1, e1) =>
                                                    {
                                                        _summaryDayUserControl __control = (_summaryDayUserControl)s1;
                                                        string __selectSaleDate = __control._saleDateSelected;
                                                        this._printSummarySaleDaily(__selectSaleDate);
                                                    };

                                                    __sum._buttonPreviewClick += (s1, e1) =>
                                                    {
                                                        _summaryDayUserControl __control = (_summaryDayUserControl)s1;
                                                        string __selectSaleDate = __control._saleDateSelected;
                                                        __sum._saleSummaryPreview(__selectSaleDate, this._posConfig._posid);
                                                    };

                                                    __form.ShowDialog(MyLib._myGlobal._mainForm);
                                                }
                                                #endregion
                                                break;
                                            case "*60":
                                                #region ข้อมูลสมาชิก
                                                {
                                                    _sendMessage("clear:textbox,input", null, serialNumber);
                                                    Form __form = new Form();
                                                    __form.Text = "ข้อมูลสมาชิก";

                                                    SMLERPControl._customer._ar _ar1 = new SMLERPControl._customer._ar();
                                                    _ar1._myManageData1._dataList._buttonDelete.Visible = false;
                                                    _ar1._myManageData1._dataList._closeScreen += () =>
                                                    {
                                                        __form.Close();
                                                    };
                                                    _ar1._closeButton.Click += (s1, e1) =>
                                                    {
                                                        __form.Close();
                                                    };
                                                    //SMLERPAR._ar __ar = new SMLERPAR._ar();

                                                    //SMLERPAR._ar()
                                                    _ar1.Dock = DockStyle.Fill;
                                                    __form.Controls.Add(_ar1);
                                                    __form.WindowState = FormWindowState.Maximized;
                                                    __form.ShowDialog();

                                                }
                                                #endregion
                                                break;
                                            case "*62":
                                                #region สรุปการขายสินค้า
                                                {
                                                    _sendMessage("clear:textbox,input", null, serialNumber);
                                                    Form __form = new Form();
                                                    __form.StartPosition = FormStartPosition.CenterScreen;
                                                    __form.Size = new System.Drawing.Size(400, 350);
                                                    __form.Text = "สรุปการขายสินค้า";
                                                    _summaryDayUserControl __sum = new _summaryDayUserControl(this._posConfig._posid, this._posLoginCode, this._posLoginPassword);
                                                    __sum.Dock = DockStyle.Fill;
                                                    __form.Controls.Add(__sum);
                                                    __sum._closeButton.Click += (s1, e1) =>
                                                    {
                                                        __form.Close();
                                                    };
                                                    __sum._buttonPrintClick += (s1, e1) =>
                                                    {
                                                        // พิมพ์รายงานสรุปรายละเอียดการขายสินค้า
                                                        _summaryDayUserControl __control = (_summaryDayUserControl)s1;
                                                        string __selectSaleDate = __control._saleDateSelected;
                                                        this._printSummaryItemSaleDaily(__selectSaleDate);
                                                    };

                                                    __sum._buttonPreviewClick += (s1, e1) =>
                                                    {
                                                        _summaryDayUserControl __control = (_summaryDayUserControl)s1;
                                                        string __selectSaleDate = __control._saleDateSelected;
                                                        __sum._itemSaleSummaryPreview(__selectSaleDate, this._posConfig._posid);
                                                    };

                                                    __form.ShowDialog(MyLib._myGlobal._mainForm);

                                                }
                                                #endregion
                                                break;
                                            case "*71":
                                                #region พักบิล
                                                {
                                                    _sendMessage("clear:textbox,input", null, serialNumber);
                                                    if (this._itemList.Count == 0)
                                                    {
                                                        MessageBox.Show("ไม่มีรายการขาย");
                                                    }
                                                    else
                                                    {
                                                        if (MessageBox.Show("ต้องการพักบิลและเริ่มหน้าจอขายใหม่", "Confirm", MessageBoxButtons.YesNo, MessageBoxIcon.Asterisk, MessageBoxDefaultButton.Button2) == DialogResult.Yes)
                                                        {
                                                            _holdBillClass __data = new _holdBillClass();
                                                            __data._dateTime = DateTime.Now;
                                                            __data._custCode = (this._memberCode.Length == 0) ? this._custCode : this._memberCode;
                                                            __data._custName = this._custName;
                                                            __data._item = new List<_posClientItemClass>();
                                                            __data._totalAmount = this._totalAmount;
                                                            this._itemList.ForEach((__item) =>
                                                            {
                                                                __data._item.Add(__item);
                                                            });
                                                            this._holdBill.Add(__data);
                                                            this._reset();
                                                        }
                                                    }
                                                }
                                                #endregion
                                                break;
                                            case "*72":
                                                #region เรียกบิลพัก
                                                {
                                                    _sendMessage("clear:textbox,input", null, serialNumber);
                                                    if (this._holdBill.Count == 0)
                                                    {
                                                        MessageBox.Show("ไม่มีรายการพักบิล");
                                                    }
                                                    else
                                                    {
                                                        _holdBillForm __holdBill = new _holdBillForm(this._holdBill);
                                                        __holdBill._grid._mouseClick += (object sender, GridCellEventArgs e) =>
                                                        {
                                                            // เรียกบิลพัก
                                                            this._getholdBill(sender, e._row);
                                                            __holdBill.Close();
                                                        };
                                                        __holdBill._grid._keyDown += (object sender, int row, int column, Keys keyCode) =>
                                                        {
                                                            // เรียกบิลพัก (กด Enter)
                                                            if (keyCode == Keys.Enter)
                                                            {
                                                                this._getholdBill(sender, row);
                                                                __holdBill.Close();
                                                                return true;
                                                            }
                                                            return false;
                                                        };
                                                        __holdBill.ShowDialog(MyLib._myGlobal._mainForm);
                                                    }
                                                }
                                                #endregion
                                                break;
                                            case "*73":
                                                #region ล้างบิลพัก
                                                {
                                                    _sendMessage("clear:textbox,input", null, serialNumber);
                                                    if (MessageBox.Show("ต้องการยกเลิกรายการพักบิลทั้งหมด", "Confirm", MessageBoxButtons.YesNo, MessageBoxIcon.Asterisk, MessageBoxDefaultButton.Button2) == DialogResult.Yes)
                                                    {
                                                        this._holdBill.Clear();
                                                    }
                                                }
                                                #endregion
                                                break;
                                            case "*75":
                                                #region แสดงเคลื่อนไหวสะสมแต้ม
                                                {
                                                    _sendMessage("clear:textbox,input", null, serialNumber);
                                                    _pointMovementControl __movement = new _pointMovementControl(this._custCode);
                                                    Form __form = new Form();
                                                    __form.WindowState = FormWindowState.Maximized;
                                                    __movement.Dock = DockStyle.Fill;
                                                    __form.Controls.Add(__movement);
                                                    __form.ShowDialog();
                                                }
                                                #endregion
                                                break;
                                            case "*80":
                                                #region แสดงยอดขาย
                                                {
                                                    bool _showTotal = true;

                                                    bool _checkShowTotal = this._pos_show_total_balance;

                                                    /*
                                                    if (_showTotal == false)
                                                    {
                                                        _showTotal = this._allowShowTotalBalance(true);
                                                    }
                                                    */
                                                    if (_checkShowTotal == true)
                                                    {
                                                        _showTotal = false;
                                                        _showTotal = this._allowShowTotalBalance(true);
                                                    }

                                                    if (_showTotal == true)
                                                    {
                                                        _sendMessage("clear:textbox,input", null, serialNumber);
                                                        Form __form = new Form();
                                                        __form.StartPosition = FormStartPosition.CenterScreen;
                                                        __form.Size = new System.Drawing.Size(700, 600);
                                                        __form.Text = "สรุปยอด";
                                                        _summaryUserControl __sum = new _summaryUserControl(this._posConfig, this._posFillmoneyDocFormat, this._posLoginCode, this._posLoginPassword, false, this._posRunningFillmoneyDocFormat, true, this._pos_send_deposit_money, this._periodGuid);
                                                        __sum.Dock = DockStyle.Fill;
                                                        __form.Controls.Add(__sum);
                                                        __form.ShowDialog(MyLib._myGlobal._mainForm);
                                                    }

                                                }
                                                #endregion
                                                break;
                                            case "*81":
                                                #region เปิดกะ
                                                {
                                                    _sendMessage("clear:textbox,input", null, serialNumber);
                                                    _periodOpenForm __form = new _periodOpenForm(this._posConfig._posid, this._posLoginCode, this._posLoginPassword);
                                                    __form._openSuccess += (guid, openDateTime) =>
                                                    {
                                                        this._periodGuid = guid;
                                                        this.__openPeroidDate = openDateTime;
                                                    };
                                                    __form.ShowDialog();
                                                }
                                                #endregion
                                                break;
                                            case "*82":
                                                #region เพิ่มเงินทอน
                                                _sendMessage("clear:textbox,input", null, serialNumber);
                                                _moneyReceive __moneyReceive = new _moneyReceive(this._posConfig, this._posFillmoneyDocFormat, this._posLoginCode, this._posLoginPassword, this._posRunningFillmoneyDocFormat, this.__openPeroidDate);
                                                //__moneyReceive._saveSuccess += () =>
                                                //{
                                                // toe หลักจากส่งเงิน ให้เปิดลิ้นชัก
                                                //this._openCashDrawer();

                                                //};
                                                __moneyReceive.ShowDialog();
                                                #endregion
                                                break;
                                            case "*83":
                                                #region ส่งเงิน
                                                {
                                                    _sendMessage("clear:textbox,input", null, serialNumber);

                                                    bool _showTotal = true;

                                                    bool _checkShowTotal = this._pos_show_total_balance;


                                                    if (_checkShowTotal == true)
                                                    {
                                                        _showTotal = false;
                                                        _showTotal = this._allowShowTotalBalance(false);
                                                    }

                                                    Form __form = new Form();
                                                    __form.StartPosition = FormStartPosition.CenterScreen;
                                                    __form.Size = new System.Drawing.Size(700, 600);
                                                    __form.Text = "ส่งเงิน";
                                                    _summaryUserControl __sum = new _summaryUserControl(this._posConfig, this._posSaveSendMoneyDocFormat, this._posLoginCode, this._posLoginPassword, true, this._posRunningSaveSendMoneyDocFormat, _showTotal, this._pos_send_deposit_money, this._periodGuid);
                                                    __sum.Dock = DockStyle.Fill;
                                                    __form.Controls.Add(__sum);
                                                    __sum._closeButton.Click += (s1, e1) =>
                                                    {
                                                        __form.Close();
                                                    };
                                                    __sum._saveButton.Click += (s1, e1) =>
                                                    {
                                                        if (__sum._saveData())
                                                        {
                                                            string _save_doc_no = __sum._save_doc_no;
                                                            this._printSaveSendMoney(_save_doc_no);

                                                            // toe หลักจากส่งเงิน ให้เปิดลิ้นชัก
                                                            //this._openCashDrawer();

                                                            __form.Close();
                                                        }
                                                    };
                                                    __form.ShowDialog(MyLib._myGlobal._mainForm);
                                                }
                                                #endregion
                                                break;
                                            case "*84":
                                                #region ปิดกะ
                                                {
                                                    _sendMessage("clear:textbox,input", null, serialNumber);
                                                    _periodCloseForm __form = new _periodCloseForm(this._posConfig._posid, this._posLoginCode, this._posLoginPassword, this._pos__disabled_check_send_money);
                                                    __form.ShowDialog();
                                                    if (__form._closePeroidSuccess)
                                                    {
                                                        _checkPeroidAgain = true;
                                                        _checkFloatAgain = true;
                                                        this._periodGuid = "";
                                                    }
                                                }
                                                #endregion
                                                break;
                                            case "*86":
                                                #region Preview ฉลากยา
                                                {
                                                    if (_isPharmacist || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLPOSMED)
                                                    {
                                                        this._printDrugLabel();
                                                        _sendMessage("clear:textbox,input", null, serialNumber);
                                                    }
                                                }
                                                #endregion
                                                break;
                                            case "*87":
                                                #region พิมพ์ฉลากยา
                                                {
                                                    if (_isPharmacist || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLPOSMED)
                                                    {
                                                        this._printDrugLabel(false);
                                                        _sendMessage("clear:textbox,input", null, serialNumber);
                                                    }
                                                }
                                                #endregion
                                                break;
                                            case "*88":
                                                #region แสดงบิลยกเลิก
                                                {
                                                    _sendMessage("clear:textbox,input", null, serialNumber);
                                                    Form __form = new Form();
                                                    //
                                                    DateTime __beginDate = DateTime.Now;
                                                    string __beginTime = "00:00";
                                                    MyLib._myFrameWork __myFrameWork = new _myFrameWork();
                                                    DataTable __dt = __myFrameWork._queryShort("select * from " + _g.d.pos_period._table + " where " + _g.d.pos_period._machine_code + "=\'" + this._posConfig._posid + "\' order by " + _g.d.pos_period._period_status + ", " + _g.d.pos_period._begin_date + " desc," + _g.d.pos_period._begin_time + " desc").Tables[0];
                                                    if (__dt.Rows.Count > 0)
                                                    {
                                                        int __status = (int)MyLib._myGlobal._decimalPhase(__dt.Rows[0][_g.d.pos_period._period_status].ToString());
                                                        if (__status == 0)
                                                        {
                                                            __beginDate = MyLib._myGlobal._convertDateFromQuery(__dt.Rows[0][_g.d.pos_period._begin_date].ToString());
                                                            __beginTime = __dt.Rows[0][_g.d.pos_period._begin_time].ToString();
                                                        }
                                                    }
                                                    string __dateCompareTrans = "to_timestamp(date(" + _g.d.ic_trans._doc_date + ")||\' \'||" + _g.d.ic_trans._doc_time + ",'YYYY/MM/DD HH24:MI')::timestamp";
                                                    string __dateTime = __beginDate.ToString("yyyy-MM-dd", new CultureInfo("en-US")) + " " + __beginTime + ":00";
                                                    //
                                                    __form.Text = "บิลขายยกเลิก" + " : " + this._posConfig._posid + " " + __dateTime;
                                                    SMLERPSO._soInvoiceCancel __control = new SMLERPSO._soInvoiceCancel(__form.Text, _g.d.ic_trans._is_pos + "=1 and " + _g.d.ic_trans._pos_id + "=\'" + this._posConfig._posid + "\' and " + __dateCompareTrans + ">=\'" + __dateTime + "\'", true);
                                                    __control.Dock = DockStyle.Fill;
                                                    __form.Controls.Add(__control);
                                                    __form.WindowState = FormWindowState.Maximized;
                                                    __form.ShowDialog(MyLib._myGlobal._mainForm);
                                                }
                                                #endregion
                                                break;
                                            case "*89":
                                                #region แสดงบิลขาย
                                                {
                                                    _sendMessage("clear:textbox,input", null, serialNumber);
                                                    Form __form = new Form();
                                                    //
                                                    DateTime __beginDate = DateTime.Now;
                                                    string __beginTime = "00:00";
                                                    MyLib._myFrameWork __myFrameWork = new _myFrameWork();
                                                    DataTable __dt = __myFrameWork._queryShort("select * from " + _g.d.pos_period._table + " where " + _g.d.pos_period._machine_code + "=\'" + this._posConfig._posid + "\' order by " + _g.d.pos_period._period_status + " ," + _g.d.pos_period._begin_date + " desc," + _g.d.pos_period._begin_time + " desc").Tables[0];
                                                    if (__dt.Rows.Count > 0)
                                                    {
                                                        int __status = (int)MyLib._myGlobal._decimalPhase(__dt.Rows[0][_g.d.pos_period._period_status].ToString());
                                                        if (__status == 0)
                                                        {
                                                            __beginDate = MyLib._myGlobal._convertDateFromQuery(__dt.Rows[0][_g.d.pos_period._begin_date].ToString());
                                                            __beginTime = __dt.Rows[0][_g.d.pos_period._begin_time].ToString();
                                                        }
                                                    }
                                                    string __dateCompareTrans = "to_timestamp(date(" + _g.d.ic_trans._doc_date + ")||\' \'||" + _g.d.ic_trans._doc_time + ",'YYYY/MM/DD HH24:MI')::timestamp";
                                                    string __dateTime = __beginDate.ToString("yyyy-MM-dd", new CultureInfo("en-US")) + " " + __beginTime + ":00";
                                                    //
                                                    __form.Text = "บิลขาย" + " : " + this._posConfig._posid + " " + __dateTime;
                                                    SMLERPSO._soInvoice __control = new SMLERPSO._soInvoice(__form.Text, _g.d.ic_trans._is_pos + "=1 and " + _g.d.ic_trans._pos_id + "=\'" + this._posConfig._posid + "\' and " + __dateCompareTrans + ">=\'" + __dateTime + "\' and ( " + _g.d.ic_trans._doc_ref + " is null or " + _g.d.ic_trans._doc_ref + " = \'\' ) ", true);
                                                    __control._ictrans._myManageTrans._isDelete = false;
                                                    __control._ictrans._myManageTrans._dataList._buttonDelete.Visible =
                                                        __control._ictrans._myManageTrans._dataList._buttonNew.Visible =
                                                        __control._ictrans._myManageTrans._dataList._buttonSelectAll.Visible =
                                                        __control._ictrans._myManageTrans._dataList._printRangeButton.Visible =
                                                        __control._ictrans._myManageTrans._dataList._buttonNewFromTemp.Visible = false;


                                                    __control.Dock = DockStyle.Fill;
                                                    __form.Controls.Add(__control);
                                                    __form.WindowState = FormWindowState.Maximized;
                                                    __form.ShowDialog();

                                                    // clear memory
                                                    __dt.Dispose();
                                                    __control.Dispose();
                                                    __form.Close();
                                                    __form.Dispose();



                                                }
                                                #endregion
                                                break;
                                            case "*90":
                                                #region เปิดที่เก็บเงิน
                                                _sendMessage("clear:textbox,input", null, serialNumber);

                                                if (_allowOpenCashDrawer())
                                                {
                                                    this._openCashDrawer();
                                                }
                                                #endregion
                                                break;
                                            case "*91":
                                                #region เริ่มใหม่
                                                if (MessageBox.Show("ต้องการเริ่มรายการใหม่", "Confirm", MessageBoxButtons.YesNo, MessageBoxIcon.Asterisk, MessageBoxDefaultButton.Button2) == DialogResult.Yes)
                                                {
                                                    this._reset();
                                                }
                                                _sendMessage("clear:textbox,input", null, serialNumber);
                                                #endregion
                                                break;
                                            case "*94":
                                                #region ยกเลิกใบเสร็จ
                                                {
                                                    _sendMessage("clear:textbox,input", null, serialNumber);
                                                    bool __allowCancelBill = true;

                                                    //if (this._posCancelBill)
                                                    //{
                                                    //    __allowCancelBill = true;
                                                    //}
                                                    //else
                                                    //{
                                                    __allowCancelBill = _allowCancelBill();
                                                    //}

                                                    if (__allowCancelBill)
                                                    {
                                                        _cancelBillForm __cancel = new _cancelBillForm(this._posConfig, this._posCancelDocFormat, this._posLoginCode, this._posLoginPassword, this._posCancelBillOtherDate, this._posRunningCancelDocFormat, this._disable_cancel_order_outshift, this._doc_format_code_calcel);
                                                        __cancel._cancelBillSuccess += (docNo, cancelDocNo) =>
                                                        {
                                                            int _languageSelect = 0;
                                                            if (_print_multilanguage_slip == true)
                                                            {
                                                                _languageSelect = _selectLanguage();
                                                            }

                                                            string __headerText = "ใบกำกับภาษีอย่างย่อ";

                                                            if (_g.g._companyProfile._vat_rate == 0)
                                                            {
                                                                __headerText = "";
                                                            }

                                                            this._printSlip(_printSlipMode.ใบกำกับภาษีอย่างย่อ, docNo, cancelDocNo, "ยกเลิก", __headerText, false, false, _languageSelect);
                                                        };
                                                        __cancel.ShowDialog();
                                                    }

                                                }
                                                #endregion
                                                break;
                                            case "*95":
                                                #region พิมพ์บิลปิดโต๊ะ
                                                {

                                                    if (_isScreenCloseTable && (MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro))
                                                    {

                                                        this._printPreCash();

                                                        this.Dispose();
                                                        _afterCloseForm(null);
                                                    }

                                                }
                                                #endregion
                                                break;
                                            case "*97":
                                                #region ออกใบกำกับภาษีเต็มรูปแบบ
                                                {
                                                    _sendMessage("clear:textbox,input", null, serialNumber);
                                                    _printVatFull __printVatFull = new _printVatFull(this._posConfig, this._posFullDocFormat, this._posLoginCode, this._posLoginPassword, 0, this._posRunningFullDocFormat);
                                                    __printVatFull._billSuccess += (docNo, docRefNo) =>
                                                    {
                                                        // toe check config พิมพ์แบบเต็ม
                                                        if (this._posConfig.full_invoice_print_type == 1)
                                                        {
                                                            int __transFlag = _g.g._transFlagGlobal._transFlag(_g.g._transControlTypeEnum.ขาย_ใบกำกับภาษีอย่างเต็มออกแทน); // 44;  
                                                            SMLReport._formReport._formPrint __form = new SMLReport._formReport._formPrint(this._posConfig.full_invoice_form_code);
                                                            __form.PrinterName = this._posConfig.full_invoice_printer_name;

                                                            __form.PreviewPrintDialog = false;

                                                            __form._conditon.Add(new SMLReport._formReport._formPrint._conditionClass("doc_no", docNo));
                                                            __form._conditon.Add(new SMLReport._formReport._formPrint._conditionClass("trans_flag", __transFlag.ToString()));
                                                            __form._query();
                                                            // พิมพ์โดยดึงจากแบบฟอร์มมาพิมพ์
                                                        }
                                                        else
                                                        {
                                                            int _languageSelect = 0;
                                                            if (_print_multilanguage_slip == true)
                                                            {
                                                                _languageSelect = _selectLanguage();
                                                            }


                                                            this._printSlip(_printSlipMode.ใบกำกับภาษีอย่างเต็ม, docNo, docRefNo, "", "ใบเสร็จรับเงิน/ใบกำกับภาษี", false, false, _languageSelect);
                                                            this._printSlip(_printSlipMode.ใบกำกับภาษีอย่างเต็ม, docNo, docRefNo, "สำเนา", "ใบเสร็จรับเงิน/ใบกำกับภาษี", false, false, _languageSelect);
                                                        }
                                                    };
                                                    __printVatFull.ShowDialog();
                                                }
                                                #endregion
                                                break;
                                            case "*92":
                                                #region reprint ใบกำกับภาษีเต็มรูปแบบ
                                                {
                                                    _sendMessage("clear:textbox,input", null, serialNumber);
                                                    _printVatFull __printVatFull = new _printVatFull(this._posConfig, this._posFullDocFormat, this._posLoginCode, this._posLoginPassword, 1, this._posRunningFullDocFormat);
                                                    __printVatFull._billSuccess += (docNo, docRefNo) =>
                                                    {
                                                        // toe check config พิมพ์แบบเต็ม
                                                        if (this._posConfig.full_invoice_print_type == 1)
                                                        {
                                                            int __transFlag = _g.g._transFlagGlobal._transFlag(_g.g._transControlTypeEnum.ขาย_ใบกำกับภาษีอย่างเต็มออกแทน); ;
                                                            SMLReport._formReport._formPrint __form = new SMLReport._formReport._formPrint(this._posConfig.full_invoice_form_code);
                                                            __form.PrinterName = this._posConfig.full_invoice_printer_name;

                                                            __form.PreviewPrintDialog = false;

                                                            __form._conditon.Add(new SMLReport._formReport._formPrint._conditionClass("doc_no", docNo));
                                                            __form._conditon.Add(new SMLReport._formReport._formPrint._conditionClass("trans_flag", __transFlag.ToString()));
                                                            __form._query();
                                                            // พิมพ์โดยดึงจากแบบฟอร์มมาพิมพ์
                                                        }
                                                        else
                                                        {
                                                            int _languageSelect = 0;
                                                            if (_print_multilanguage_slip == true)
                                                            {
                                                                _languageSelect = _selectLanguage();
                                                            }


                                                            this._printSlip(_printSlipMode.ใบกำกับภาษีอย่างเต็ม, docNo, docRefNo, "", "ใบเสร็จรับเงิน/ใบกำกับภาษี", false, false, _languageSelect);
                                                            this._printSlip(_printSlipMode.ใบกำกับภาษีอย่างเต็ม, docNo, docRefNo, "สำเนา", "ใบเสร็จรับเงิน/ใบกำกับภาษี", false, false, _languageSelect);
                                                        }
                                                    };
                                                    __printVatFull.ShowDialog();

                                                }
                                                #endregion
                                                break;
                                            case "*96":
                                                #region Reprint
                                                {
                                                    _sendMessage("clear:textbox,input", null, serialNumber);
                                                    _reprintBillForm __reprint = new _reprintBillForm(this._posConfig, this._posLoginCode, this._posLoginPassword);
                                                    __reprint._print += (docNo) =>
                                                    {
                                                        int _languageSelect = 0;
                                                        if (_print_multilanguage_slip == true)
                                                        {
                                                            _languageSelect = _selectLanguage();
                                                        }

                                                        if (this._posConfig._invoiceSlip.Equals("1"))
                                                        {
                                                            string __headerText = "ใบกำกับภาษีอย่างย่อ";

                                                            //if (__sender._inquery_type == 0)
                                                            //{
                                                            //    __headerText = "ใบส่งสินค้า/ใบกำกับภาษี";
                                                            //}
                                                            if (_g.g._companyProfile._vat_rate == 0)
                                                            {
                                                                __headerText = "";
                                                            }

                                                            this._printSlip(_printSlipMode.ใบกำกับภาษีอย่างย่อ, docNo, "", "", __headerText, false, false, _languageSelect);

                                                            if (this._posConfig._pos_slip_copy_print)
                                                            {
                                                                for (int __i = 0; __i < this._posConfig._pos_slip_copy_printNumber; __i++)
                                                                {
                                                                    this._printSlip(_printSlipMode.ใบกำกับภาษีอย่างย่อ, docNo, "", "- สำเนา -", __headerText, true, false, _languageSelect);
                                                                }
                                                            }
                                                        }
                                                        else if (this._posConfig._invoiceSlip.Equals("2"))
                                                        {
                                                            // พิมพ์จาก form design
                                                            int __transFlag = 44;
                                                            SMLReport._formReport._formPrint __form = new SMLReport._formReport._formPrint(this._posConfig._slip_form);
                                                            __form.PrinterName = this._posConfig._pos_printer_name;

                                                            __form.PreviewPrintDialog = false;

                                                            __form._conditon.Add(new SMLReport._formReport._formPrint._conditionClass("doc_no", docNo));
                                                            __form._conditon.Add(new SMLReport._formReport._formPrint._conditionClass("trans_flag", __transFlag.ToString()));
                                                            __form._query();
                                                            // พิมพ์โดยดึงจากแบบฟอร์มมาพิมพ์
                                                        }
                                                    };
                                                    __reprint.ShowDialog();
                                                }
                                                #endregion
                                                break;
                                            case "*98":
                                                #region ปิดหน้าจอขาย
                                                {
                                                    _sendMessage("clear:textbox,input", null, serialNumber);
                                                    if (_isScreenCloseTable || MessageBox.Show("ต้องการปิดหน้าจอ", "Confirm", MessageBoxButtons.YesNo, MessageBoxIcon.Asterisk, MessageBoxDefaultButton.Button2) == DialogResult.Yes)
                                                    {
                                                        foreach (_posExtendForm __extend in _extendFormList)
                                                        {
                                                            __extend.Dispose();
                                                        }

                                                        this.Dispose();

                                                        if (_afterCloseForm != null)
                                                        {
                                                            _afterCloseForm(null);
                                                        }
                                                    }
                                                }
                                                #endregion
                                                break;
                                            case "*99":
                                                #region คิดเงิน
                                                {
                                                    this._payDialog();
                                                    _sendMessage("clear:textbox,input", null, serialNumber);
                                                }
                                                #endregion
                                                break;
                                            default:
                                                {
                                                    #region ค้นหาสินค้าและ barcode
                                                    MyLib._myFrameWork __myFrameWork = new _myFrameWork();
                                                    string[] __splitBarCode = __split[1].ToString().ToUpper().Trim().Split('*');
                                                    decimal __qty = 1;
                                                    string __barCode = "";
                                                    if (__splitBarCode.Length == 2)
                                                    {
                                                        // มีจำนวนและรหัสสินค้า เช่น 5*554456
                                                        decimal __tmpQty = MyLib._myGlobal._decimalPhase(__splitBarCode[0].ToString());
                                                        if (__tmpQty != 0)
                                                        {
                                                            __qty = __tmpQty;
                                                        }


                                                        __barCode = __splitBarCode[1].ToString().ToUpper();
                                                    }
                                                    else
                                                    {
                                                        __barCode = __splitBarCode[0].ToString().ToUpper();
                                                    }
                                                    //
                                                    _sendMessage("clear:textbox,input", null, serialNumber);
                                                    Boolean __isProduct = false;
                                                    Boolean __isCustCode = false;
                                                    Boolean __isSaleCode = false;

                                                    #region barcode และสินค้า
                                                    StringBuilder __myquery = new StringBuilder();
                                                    string __fieldHavePoint = "have_point";

                                                    /*
                                                    if (__barCode.Length > 0 && this._check_cash_drawer == true)
                                                    {
                                                        if (_checkCashDrawerStatusOpen())
                                                        {
                                                            return;
                                                        }
                                                    }*/

                                                    // check weight scale 
                                                    if (__barCode.Length == 13 && this._posConfig._weight_scale_prefix.Length > 0)
                                                    {
                                                        // check
                                                        string __getPrefix = "";
                                                        string __getBarcode = "";
                                                        decimal __getPriceWeight = 0M;

                                                        try
                                                        {
                                                            __getPrefix = __barCode.Substring(this._posConfig._weight_prefix_start - 1, (this._posConfig._weight_prefix_stop - this._posConfig._weight_prefix_start) + 1);
                                                            __getBarcode = __barCode.Substring(this._posConfig._weight_ic_code_start - 1, (this._posConfig._weight_ic_code_stop - this._posConfig._weight_ic_code_start) + 1);
                                                            __getPriceWeight = MyLib._myGlobal._decimalPhase(__barCode.Substring(this._posConfig._weight_price_start - 1, (this._posConfig._weight_price_stop - this._posConfig._weight_price_start) + 1));
                                                        }
                                                        catch
                                                        {
                                                        }

                                                        if (__getPrefix.Equals(this._posConfig._weight_scale_prefix) == true)
                                                        {
                                                            // หา จำนวน น้ำหนัก
                                                            DataSet __weightResult = __myFrameWork._queryShort("select * from " + _g.d.ic_inventory_barcode._table + " where " + _g.d.ic_inventory_barcode._barcode + " = \'" + __getBarcode + "\'");
                                                            decimal __getPricePerUnit = 0M;

                                                            if (__weightResult.Tables.Count > 0 && __weightResult.Tables[0].Rows.Count > 0)
                                                            {
                                                                switch (this._posConfigPriceNumber)
                                                                {
                                                                    case 0:
                                                                    case 1:
                                                                        __getPricePerUnit = MyLib._myGlobal._decimalPhase(__weightResult.Tables[0].Rows[0][_g.d.ic_inventory_barcode._price].ToString());
                                                                        break;
                                                                    case 2:
                                                                        __getPricePerUnit = MyLib._myGlobal._decimalPhase(__weightResult.Tables[0].Rows[0][_g.d.ic_inventory_barcode._price].ToString());
                                                                        break;
                                                                    case 3:
                                                                        __getPricePerUnit = MyLib._myGlobal._decimalPhase(__weightResult.Tables[0].Rows[0][_g.d.ic_inventory_barcode._price].ToString());
                                                                        break;
                                                                    case 4:
                                                                        __getPricePerUnit = MyLib._myGlobal._decimalPhase(__weightResult.Tables[0].Rows[0][_g.d.ic_inventory_barcode._price].ToString());
                                                                        break;
                                                                }

                                                                decimal __getUnitWeight = (__getPriceWeight / 100) / __getPricePerUnit;

                                                                // send process
                                                                this._command("append:textbox:input=" + __getUnitWeight.ToString() + "*" + __getBarcode + "@end:textbox:input", serialNumber);
                                                                break;
                                                            }
                                                        }
                                                    }


                                                    int __queryIndex = 0;

                                                    int __inventoryTable = -1;
                                                    int __lastBuyTable = -1;
                                                    int __barcodePriceTable = -1;
                                                    int __icBalanceTable = -1;
                                                    int __drugTable = -1;
                                                    int __allergicTable = -1;

                                                    // toe check empty barcode 
                                                    if (__barCode.Length > 0)
                                                    {
                                                        __myquery.Append(MyLib._myGlobal._xmlHeader + "<node>");
                                                        // 0 = ค้นหาสินค้าและราคา 
                                                        string __query = "select " +
                                                            MyLib._myGlobal._fieldAndComma(_g.d.ic_inventory_barcode._barcode,
                                                                _g.d.ic_inventory_barcode._ic_code,
                                                                "(select " + _g.d.ic_inventory._name_1 + " from " + _g.d.ic_inventory._table + " where " +
                                                                _g.d.ic_inventory._code + "=" + _g.d.ic_inventory_barcode._ic_code +
                                                                ") as " + _g.d.ic_inventory_barcode._description,

                                                                // serial
                                                                "(select " + _g.d.ic_inventory._ic_serial_no + " from " + _g.d.ic_inventory._table + " where " +
                                                                _g.d.ic_inventory._code + "=" + _g.d.ic_inventory_barcode._ic_code +
                                                                ") as " + _g.d.ic_inventory._ic_serial_no,

                                                                "(select " + _g.d.ic_inventory_detail._have_point + " from " + _g.d.ic_inventory_detail._table + " where " +
                                                                _g.d.ic_inventory_detail._table + "." + _g.d.ic_inventory_detail._ic_code + "=" + _g.d.ic_inventory_barcode._table + "." + _g.d.ic_inventory_barcode._ic_code +
                                                                ") as " + __fieldHavePoint,

                                                                "(select " + _g.d.ic_inventory._item_type + " from " + _g.d.ic_inventory._table + " where " +
                                                                _g.d.ic_inventory._code + "=" + _g.d.ic_inventory_barcode._ic_code +
                                                                ") as item_type",

                                                                "(select " + _g.d.ic_inventory._tax_type + " from " + _g.d.ic_inventory._table + " where " +
                                                                _g.d.ic_inventory._code + "=" + _g.d.ic_inventory_barcode._ic_code +
                                                                ") as tax_type", _g.d.ic_inventory_barcode._unit_code,

                                                                "(select " + _g.d.ic_unit_use._stand_value + " from " + _g.d.ic_unit_use._table + " where " +
                                                                _g.d.ic_unit_use._table + "." + _g.d.ic_unit_use._ic_code + "=" + _g.d.ic_inventory_barcode._table + "." + _g.d.ic_inventory_barcode._ic_code + " and " +
                                                                _g.d.ic_unit_use._table + "." + _g.d.ic_unit_use._code + "=" + _g.d.ic_inventory_barcode._table + "." + _g.d.ic_inventory_barcode._unit_code +
                                                                ") as stand_value",

                                                                "(select " + _g.d.ic_unit_use._divide_value + " from " + _g.d.ic_unit_use._table + " where " +
                                                                _g.d.ic_unit_use._table + "." + _g.d.ic_unit_use._ic_code + "=" + _g.d.ic_inventory_barcode._table + "." + _g.d.ic_inventory_barcode._ic_code + " and " +
                                                                _g.d.ic_unit_use._table + "." + _g.d.ic_unit_use._code + "=" + _g.d.ic_inventory_barcode._table + "." + _g.d.ic_inventory_barcode._unit_code +
                                                                ") as divide_value",

                                                                "(select " + _g.d.ic_inventory._drink_type + " from " + _g.d.ic_inventory._table + " where " +
                                                                _g.d.ic_inventory._code + "=" + _g.d.ic_inventory_barcode._ic_code +
                                                                ") as " + _g.d.ic_inventory._drink_type,

                                                                _g.d.ic_inventory_barcode._price,
                                                                _g.d.ic_inventory_barcode._price_2,
                                                                _g.d.ic_inventory_barcode._price_3,
                                                                _g.d.ic_inventory_barcode._price_4,
                                                                // ราคากลาง
                                                                "coalesce((select " + _g.d.ic_inventory_price_formula._price_0 + " from " + _g.d.ic_inventory_price_formula._table + " where " +
                                                                _g.d.ic_inventory_price_formula._table + "." + _g.d.ic_inventory_price_formula._ic_code + "=" + _g.d.ic_inventory_barcode._table + "." + _g.d.ic_inventory_barcode._ic_code + " and " + _g.d.ic_inventory_price_formula._table + "." + _g.d.ic_inventory_price_formula._unit_code + "=" + _g.d.ic_inventory_barcode._table + "." + _g.d.ic_inventory_barcode._unit_code + " limit 1" +
                                                                "), \'\') as " + _g.d.ic_inventory_price_formula._price_0,
                                                                _g.d.ic_inventory_barcode._price_member,
                                                                _g.d.ic_inventory_barcode._price_member_2,
                                                                _g.d.ic_inventory_barcode._price_member_3,
                                                                _g.d.ic_inventory_barcode._price_member_4,

                                                                "(select " + _g.d.ic_inventory._no_discount + " from " + _g.d.ic_inventory._table + " where " +
                                                                _g.d.ic_inventory._code + "=" + _g.d.ic_inventory_barcode._ic_code +
                                                                ") as " + _g.d.ic_inventory._no_discount) +

                                                            ", " + _g.d.ic_inventory_barcode._hidden_text +

                                                            // print per unit
                                                            ((_g.g._companyProfile._print_packing_pos_order == true && this._isTableCheckOut == false) ?


                                                            ", (select " + _g.d.kitchen_master_item._kitchen_code + " from " + _g.d.kitchen_master_item._table + " where " + _g.d.kitchen_master_item._food_code + " = " + _g.d.ic_inventory_barcode._table + "." + _g.d.ic_inventory_barcode._ic_code + " " +
                                                                " and " + _g.d.kitchen_master_item._kitchen_code + " in (select " + _g.d.kitchen_master_pos_id._kitchen_code + " from " + _g.d.kitchen_master_pos_id._table + " where " + _g.d.kitchen_master_pos_id._pos_id + "=\'" + this._posConfig._posid + "\')) as " + _g.d.kitchen_master_item._kitchen_code +

                                                            ", (select " + _g.d.ic_inventory._print_order_per_unit + " from " + _g.d.ic_inventory._table + " where " +
                                                            _g.d.ic_inventory._code + "=" + _g.d.ic_inventory_barcode._ic_code +
                                                            ") as " + _g.d.ic_inventory._print_order_per_unit +

                                                            ", (select " + _g.d.ic_inventory._barcode_checker_print + " from " + _g.d.ic_inventory._table + " where " +
                                                            _g.d.ic_inventory._code + "=" + _g.d.ic_inventory_barcode._ic_code +
                                                            ") as " + _g.d.ic_inventory._barcode_checker_print

                                                            : "") +

                                                            ", (select " + _g.d.ic_inventory._remark + " from " + _g.d.ic_inventory._table + " where " +
                                                            _g.d.ic_inventory._code + "=" + _g.d.ic_inventory_barcode._ic_code +
                                                            ") as " + _g.d.ic_inventory._remark +

                                                            ", (select " + _g.d.ic_inventory._pos_no_sum + " from " + _g.d.ic_inventory._table + " where " +
                                                            _g.d.ic_inventory._code + "=" + _g.d.ic_inventory_barcode._ic_code +
                                                            ") as " + _g.d.ic_inventory._pos_no_sum +

                                                            ", (select " + _g.d.ic_inventory_detail._is_hold_sale + " from " + _g.d.ic_inventory_detail._table + " where " +
                                                            _g.d.ic_inventory_detail._table + "." + _g.d.ic_inventory_detail._ic_code + "=" + _g.d.ic_inventory_barcode._table + "." + _g.d.ic_inventory_barcode._ic_code +
                                                            ") as " + _g.d.ic_inventory_detail._is_hold_sale +

                                                            "," + _g.d.ic_inventory_barcode._no_point +

                                                            // check balance
                                                            ",(select " + _g.d.ic_inventory_detail._balance_control + " from " + _g.d.ic_inventory_detail._table + " where " +
                                                            _g.d.ic_inventory_detail._table + "." + _g.d.ic_inventory_detail._ic_code + "=" + _g.d.ic_inventory_barcode._table + "." + _g.d.ic_inventory_barcode._ic_code +
                                                            ") as " + _g.d.ic_inventory_detail._balance_control +


                                                            " from " +
                                                            _g.d.ic_inventory_barcode._table + " where " + _g.d.ic_inventory_barcode._barcode +
                                                            "=\'" + __barCode + "\'";
                                                        __myquery.Append(MyLib._myUtil._convertTextToXmlForQuery(__query));
                                                        __inventoryTable = __queryIndex;
                                                        __queryIndex++;

                                                        // 1= ค้นหาว่าเคยซื้อล่าสุดเมื่อไหร่
                                                        string __queryLastBuy = "select " + _g.d.ic_trans_detail._item_name + "," + _g.d.ic_trans_detail._doc_date + "," + _g.d.ic_trans_detail._doc_time + "," + _g.d.ic_trans_detail._discount_amount + "," + _g.d.ic_trans_detail._price + "," + _g.d.ic_trans_detail._qty + "," + _g.d.ic_trans_detail._unit_code + " from " + _g.d.ic_trans_detail._table + " where " + _g.d.ic_trans_detail._barcode + "=\'" + __barCode + "\' and " + _g.d.ic_trans_detail._cust_code + "=\'" + this._custCode + "\'" + " order by " + _g.d.ic_trans_detail._doc_date + " desc," + _g.d.ic_trans_detail._doc_time + " desc" + " limit 1";
                                                        __myquery.Append(MyLib._myUtil._convertTextToXmlForQuery(__queryLastBuy));
                                                        __lastBuyTable = __queryIndex;
                                                        __queryIndex++;

                                                        // 2= ดึงราคาตาม barcode
                                                        string __dateCompare = "\'" + DateTime.Now.ToString(_dateFormat, new CultureInfo("en-US")) + "\'";
                                                        string __queryBarcodePrice = "select " + _g.d.ic_inventory_barcode_price._discount_word + "," + _g.d.ic_inventory_barcode_price._discount_type + " from " +
                                                            _g.d.ic_inventory_barcode_price._table + " where " + _g.d.ic_inventory_barcode_price._barcode + "=\'" +
                                                            __barCode + "\' and " + __dateCompare + " between " + _g.d.ic_inventory_barcode_price._date_begin + " and " + _g.d.ic_inventory_barcode_price._date_end + " and " + _g.d.ic_inventory_barcode_price._status + "=1 and " +
                                                            __qty + " between " + _g.d.ic_inventory_barcode_price._qty_begin + "  and " + _g.d.ic_inventory_barcode_price._qty_end +
                                                            // toe ส่วนลดตามสาขา
                                                            " and ((coalesce(" + _g.d.ic_inventory_barcode_price._lock_discount + ", 0)=0) or (coalesce(" + _g.d.ic_inventory_barcode_price._lock_discount + ", 0)=1 and " + _g.d.ic_inventory_barcode_price._lock_code_list + " like '%" + this._posConfig._posid + "%' ))" +
                                                            // toe filter ตามวัน
                                                            " and ((coalesce(lock_day, '') = '') or ( lock_day like '%" + ((int)DateTime.Now.DayOfWeek).ToString() + "%')) " +
                                                            "  order by " + _g.d.ic_inventory_barcode_price._discount_type + "," + _g.d.ic_inventory_barcode_price._priority;
                                                        __myquery.Append(MyLib._myUtil._convertTextToXmlForQuery(__queryBarcodePrice));
                                                        __barcodePriceTable = __queryIndex;
                                                        __queryIndex++;

                                                        // 3= ยอดคงเหลือ ตามคลังที่เก็บ
                                                        SMLProcess._icProcess __process = new SMLProcess._icProcess();
                                                        __myquery.Append(MyLib._myUtil._convertTextToXmlForQuery(__process._queryItemBarcodeBalance(__barCode, _g.d.ic_trans_detail._wh_code + " as " + _g.d.ic_resource._warehouse + "," + _g.d.ic_trans_detail._shelf_code + " as " + _g.d.ic_resource._location, _g.d.ic_resource._qty, _g.d.ic_trans_detail._item_code + "," + _g.d.ic_trans_detail._wh_code + "," + _g.d.ic_trans_detail._shelf_code, "")));
                                                        __icBalanceTable = __queryIndex;
                                                        __queryIndex++;


                                                        if (_isPharmacist || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLPOSMED)
                                                        {
                                                            //string m_information_query = "select " + MyLib._myGlobal._fieldAndComma("(select " + _g.d.m_dozen._name_1 + " from " + _g.d.m_dozen._table + " where " + _g.d.m_dozen._icode + " = (select " + _g.d.m_information._dozen + " from " + _g.d.m_information._table + " where " + _g.d.m_information._ic_code + "=" + _g.d.ic_inventory_barcode._ic_code + ")) as " + _g.d.m_information._dozen) + " from " + _g.d.ic_inventory_barcode._table + " where " + MyLib._myGlobal._addUpper(_g.d.ic_inventory_barcode._barcode) + "=\'" + __barCode + "\'";
                                                            // 4 = รายละเอียดยา
                                                            string m_information_query = "select " + MyLib._myGlobal._fieldAndComma("(select " + _g.d.m_dozen._name_1 +
                                                                " from " + _g.d.m_dozen._table + " where " + _g.d.m_dozen._table + "." + _g.d.m_dozen._icode +
                                                                " = (select " + _g.d.m_information._dozen + " from " + _g.d.m_information._table +
                                                                " where " + _g.d.m_information._table + "." + _g.d.m_information._ic_code + "=" +
                                                                _g.d.ic_inventory_barcode._table + "." + _g.d.ic_inventory_barcode._ic_code + ")) as " +
                                                                _g.d.m_information._dozen,

                                                                "(select " + _g.d.m_times._name_1 + " from " + _g.d.m_times._table +
                                                                " where " + _g.d.m_times._table + "." + _g.d.m_times._code + " = (select " + _g.d.m_information._times +
                                                                " from " + _g.d.m_information._table + " where " + _g.d.m_information._table + "." +
                                                                _g.d.m_information._ic_code + "=" + _g.d.ic_inventory_barcode._table + "." +
                                                                _g.d.ic_inventory_barcode._ic_code + ")) as " + _g.d.m_information._times,

                                                                "(select " +
                                                                _g.d.m_frequency._name_1 + " from " + _g.d.m_frequency._table + " where " + _g.d.m_frequency._table +
                                                                "." + _g.d.m_frequency._code + " = (select " + _g.d.m_information._frequency + " from " +
                                                                _g.d.m_information._table + " where " + _g.d.m_information._table + "." + _g.d.m_information._ic_code +
                                                                "=" + _g.d.ic_inventory_barcode._table + "." + _g.d.ic_inventory_barcode._ic_code + ")) as " +
                                                                _g.d.m_information._frequency,

                                                                "(select " + _g.d.m_information._remark + " from " +
                                                                _g.d.m_information._table + " where " + _g.d.m_information._table + "." + _g.d.m_information._ic_code +
                                                                "=" + _g.d.ic_inventory_barcode._table + "." + _g.d.ic_inventory_barcode._ic_code + ") as " +
                                                                _g.d.m_information._remark) +

                                                                " from " + _g.d.ic_inventory_barcode._table + " where " +
                                                                _g.d.ic_inventory_barcode._barcode + "=\'" + __barCode + "\'";
                                                            __myquery.Append(MyLib._myUtil._convertTextToXmlForQuery(m_information_query));
                                                            __drugTable = __queryIndex;
                                                            __queryIndex++;


                                                            // 5 = ตรวจสอบการแพ้ยา
                                                            string __allergicQuery =
                                                                "select " + MyLib._myGlobal._fieldAndComma(_g.d.m_allergic._ic_group_main,
                                                                _g.d.m_allergic._symptom,
                                                                _g.d.m_allergic._remark) +
                                                                " from " + _g.d.m_allergic._table +
                                                                " where " +
                                                                _g.d.m_allergic._ar_code + " = '" + this._custCode + "' AND " +
                                                                _g.d.m_allergic._ic_group_main + "= (select " + _g.d.ic_inventory._group_main +
                                                                " from " + _g.d.ic_inventory._table + " where " + _g.d.ic_inventory._code +
                                                                " = (select " + _g.d.ic_inventory_barcode._ic_code + " from " + _g.d.ic_inventory_barcode._table +
                                                                " where " + _g.d.ic_inventory_barcode._barcode + " ='" + __barCode + "')) ";
                                                            __myquery.Append(MyLib._myUtil._convertTextToXmlForQuery(__allergicQuery));
                                                            __allergicTable = __queryIndex;
                                                            __queryIndex++;

                                                        }

                                                        __myquery.Append("</node>");
                                                        //string __debug_query = __myquery.ToString();

                                                        ArrayList __data = __myFrameWork._queryListGetData(MyLib._myGlobal._databaseName, __myquery.ToString());
                                                        if (__data.Count > 0)
                                                        {
                                                            DataTable __getData = ((DataSet)__data[__inventoryTable]).Tables[0];
                                                            if (__getData.Rows.Count == 0)
                                                            {
                                                                // check option warnning_select_cust

                                                                #region เมื่อไม่พบ barcode ไปหาสินค้าแทน
                                                                // ไม่พบสินค้า
                                                                if (__barCode.Length > 0)
                                                                {
                                                                    if (this._posConfig._use_sound_on_not_found_barcode == 1)
                                                                    {
                                                                        this._playSound(this._posConfig._sound_on_not_found_barcode);
                                                                    }
                                                                    if (MyLib._myGlobal._isVersionEnum != _myGlobal._versionType.SMLPOSLite)
                                                                    {
                                                                        #region  ไม่พบ Barcode ให้หาตาม Serial Number
                                                                        __myquery = new StringBuilder();
                                                                        __myquery.Append(MyLib._myGlobal._xmlHeader + "<node>");
                                                                        switch (__myFrameWork._databaseSelectType)
                                                                        {

                                                                            case _myGlobal._databaseType.MicrosoftSQL2000:
                                                                            case _myGlobal._databaseType.MicrosoftSQL2005:
                                                                                //  "coalesce((select " + _g.d.ic_inventory_barcode._barcode + " from " + _g.d.ic_inventory_barcode._table + " where " + _g.d.ic_inventory_barcode._table + "." + _g.d.ic_inventory_barcode._ic_code + "=" + _g.d.ic_serial._table + "." + _g.d.ic_serial._ic_code + "),\'\') as barcode")
                                                                                __myquery.Append(MyLib._myUtil._convertTextToXmlForQuery("select top 1 " + MyLib._myGlobal._fieldAndComma(_g.d.ic_serial._ic_code, _g.d.ic_serial._ic_unit, _g.d.ic_serial._status, _g.d.ic_serial._wh_code, _g.d.ic_serial._shelf_code, "coalesce((select " + _g.d.ic_inventory_barcode._barcode + " from " + _g.d.ic_inventory_barcode._table + " where " + _g.d.ic_inventory_barcode._table + "." + _g.d.ic_inventory_barcode._ic_code + "=" + _g.d.ic_serial._table + "." + _g.d.ic_serial._ic_code + " and " + _g.d.ic_inventory_barcode._table + "." + _g.d.ic_inventory_barcode._unit_code + " = " + _g.d.ic_serial._table + "." + _g.d.ic_serial._ic_unit + " ),\'\') as barcode") + " from " + _g.d.ic_serial._table + " where " + _g.d.ic_serial._serial_number + "=\'" + __barCode.Trim() + "\'"));

                                                                                break;
                                                                            default:
                                                                                //  
                                                                                __myquery.Append(MyLib._myUtil._convertTextToXmlForQuery("select " + MyLib._myGlobal._fieldAndComma(_g.d.ic_serial._ic_code, _g.d.ic_serial._ic_unit, _g.d.ic_serial._status, _g.d.ic_serial._wh_code, _g.d.ic_serial._shelf_code, "coalesce((select " + _g.d.ic_inventory_barcode._barcode + " from " + _g.d.ic_inventory_barcode._table + " where " + _g.d.ic_inventory_barcode._table + "." + _g.d.ic_inventory_barcode._ic_code + "=" + _g.d.ic_serial._table + "." + _g.d.ic_serial._ic_code + " and " + _g.d.ic_inventory_barcode._table + "." + _g.d.ic_inventory_barcode._unit_code + " = " + _g.d.ic_serial._table + "." + _g.d.ic_serial._ic_unit + " limit (1) ),\'\') as barcode") + " from " + _g.d.ic_serial._table + " where " + _g.d.ic_serial._serial_number + "=\'" + __barCode.Trim() + "\'"));

                                                                                break;
                                                                        }
                                                                        //  "coalesce((select " + _g.d.ic_inventory_barcode._barcode + " from " + _g.d.ic_inventory_barcode._table + " where " + _g.d.ic_inventory_barcode._table + "." + _g.d.ic_inventory_barcode._ic_code + "=" + _g.d.ic_serial._table + "." + _g.d.ic_serial._ic_code + "),\'\') as barcode")
                                                                        //__myquery.Append(MyLib._myUtil._convertTextToXmlForQuery("select " + MyLib._myGlobal._fieldAndComma(_g.d.ic_serial._ic_code, _g.d.ic_serial._ic_unit, _g.d.ic_serial._status) + " from " + _g.d.ic_serial._table + " where " + _g.d.ic_serial._serial_number + "=\'" + __barCode.Trim() + "\'"));
                                                                        __myquery.Append("</node>");
                                                                        ArrayList __dataSerialNumber = __myFrameWork._queryListGetData(MyLib._myGlobal._databaseName, __myquery.ToString());
                                                                        DataTable __serialNumberDataTable = ((DataSet)__dataSerialNumber[0]).Tables[0];
                                                                        if (__serialNumberDataTable.Rows.Count > 0)
                                                                        {
                                                                            if (_checkSelectCust() == false)
                                                                            {
                                                                                // warning
                                                                                MessageBox.Show(MyLib._myGlobal._resource("กรุณาเลือกลูกค้าก่อนทำการขาย"), MyLib._myGlobal._resource("เตือน"), MessageBoxButtons.OK, MessageBoxIcon.Exclamation);

                                                                                return;

                                                                            }
                                                                            else
                                                                            {
                                                                                #region ค้นหาจาก Serial
                                                                                if (__serialNumberDataTable.Rows[0][_g.d.ic_serial._status].ToString().Equals("1"))
                                                                                {
                                                                                    MessageBox.Show("หมายเลขเครื่อง" + " : " + __barCode + " " + "ขายไปแล้ว");
                                                                                    __barCode = "";
                                                                                }
                                                                                else
                                                                                {
                                                                                    // ตรวจสอบ คลังและที่เก็บ
                                                                                    if (__serialNumberDataTable.Rows[0][_g.d.ic_serial._wh_code].ToString().Equals(this._posWareHouse) == false || __serialNumberDataTable.Rows[0][_g.d.ic_serial._shelf_code].ToString().Equals(this._posLocation) == false)
                                                                                    {
                                                                                        MessageBox.Show(MyLib._myGlobal._resource("คลังและที่เก็บไม่ตรงกับ หมายเลขเครื่อง") + " : " + __barCode);
                                                                                        __barCode = "";

                                                                                    }
                                                                                    else
                                                                                    {

                                                                                        // ตรวจสอบซ้ำ
                                                                                        Boolean __serialDup = false;
                                                                                        for (int __find = 0; __find < this._itemList.Count; __find++)
                                                                                        {
                                                                                            if (this._itemList[__find]._serialNumber.Equals(__barCode))
                                                                                            {
                                                                                                __serialDup = true;
                                                                                                break;
                                                                                            }
                                                                                        }
                                                                                        if (__serialDup)
                                                                                        {
                                                                                            MessageBox.Show("ยิงหมายเลขเครื่องไปแล้ว" + " : " + __barCode);
                                                                                            __barCode = "";
                                                                                        }
                                                                                        else
                                                                                        {
                                                                                            // เปลี่ยน __barcode เป็นรหัสสินค้า เพื่อค้นหา
                                                                                            serialNumber = __barCode;
                                                                                            __barCode = __serialNumberDataTable.Rows[0]["barcode"].ToString();
                                                                                            if (__barCode.Trim().Length != 0)
                                                                                            {
                                                                                                this._command("append:textbox:input=" + __barCode + "@end:textbox:input", serialNumber);
                                                                                                //this._command(__barCode, serialNumber);
                                                                                                break;
                                                                                            }
                                                                                            else
                                                                                            {
                                                                                                __barCode = __serialNumberDataTable.Rows[0][_g.d.ic_serial._ic_code].ToString();
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }

                                                                                #endregion
                                                                            }
                                                                        }

                                                                        #endregion
                                                                    }


                                                                    if (__barCode.Length > 0)
                                                                    {
                                                                        // ไม่พบ Barcode และไม่พบ Serial Number ให้หาตามรหัสสินค้า
                                                                        __myquery = new StringBuilder();
                                                                        __myquery.Append(MyLib._myGlobal._xmlHeader + "<node>");
                                                                        __myquery.Append(MyLib._myUtil._convertTextToXmlForQuery("select " +
                                                                            MyLib._myGlobal._fieldAndComma(
                                                                                "(select " + _g.d.ic_inventory_detail._have_point + " from " + _g.d.ic_inventory_detail._table +
                                                                                " where " + _g.d.ic_inventory_detail._table + "." + _g.d.ic_inventory_detail._ic_code + "=" + _g.d.ic_inventory._table + "." + _g.d.ic_inventory._code +
                                                                                ") as " + __fieldHavePoint,

                                                                                _g.d.ic_inventory._code,
                                                                                _g.d.ic_inventory._unit_type,
                                                                                _g.d.ic_inventory._unit_standard,
                                                                                _g.d.ic_inventory._name_1,
                                                                                _g.d.ic_inventory._item_type,
                                                                                _g.d.ic_inventory._tax_type,
                                                                                _g.d.ic_inventory._drink_type,
                                                                                _g.d.ic_inventory._ic_serial_no,
                                                                                _g.d.ic_inventory._no_discount,
                                                                                _g.d.ic_inventory._remark,
                                                                                _g.d.ic_inventory._pos_no_sum
                                                                           ) +

                                                                           ", (select " + _g.d.ic_inventory_detail._is_hold_sale + " from " + _g.d.ic_inventory_detail._table +
                                                                           " where " + _g.d.ic_inventory_detail._table + "." + _g.d.ic_inventory_detail._ic_code + "=" + _g.d.ic_inventory._table + "." + _g.d.ic_inventory._code +
                                                                           ") as " + _g.d.ic_inventory_detail._is_hold_sale +

                                                                           ", (select " + _g.d.ic_inventory_detail._balance_control + " from " + _g.d.ic_inventory_detail._table +
                                                                           " where " + _g.d.ic_inventory_detail._table + "." + _g.d.ic_inventory_detail._ic_code + "=" + _g.d.ic_inventory._table + "." + _g.d.ic_inventory._code +
                                                                           ") as " + _g.d.ic_inventory_detail._balance_control +


                                                                           " from " + _g.d.ic_inventory._table + " where " + _g.d.ic_inventory._code + "=\'" + __barCode.ToUpper() + "\'"));
                                                                        __myquery.Append(MyLib._myUtil._convertTextToXmlForQuery("select * from " + _g.d.ic_inventory_detail._table + " where " + _g.d.ic_inventory_detail._ic_code + "=\'" + __barCode.Trim() + "\'"));
                                                                        __myquery.Append(MyLib._myUtil._convertTextToXmlForQuery("select * from " + _g.d.ic_unit_use._table + " where " + _g.d.ic_unit_use._ic_code + "=\'" + __barCode.Trim() + "\' order by " + _g.d.ic_unit_use._code));

                                                                        // ยอดคงเหลือ ตามคลังที่เก็บ   (3)                                                                  
                                                                        __myquery.Append(MyLib._myUtil._convertTextToXmlForQuery(__process._queryItemBalance(__barCode, _g.d.ic_trans_detail._wh_code + " as " + _g.d.ic_resource._warehouse + "," + _g.d.ic_trans_detail._shelf_code + " as " + _g.d.ic_resource._location, _g.d.ic_resource._qty, _g.d.ic_trans_detail._item_code + "," + _g.d.ic_trans_detail._wh_code + "," + _g.d.ic_trans_detail._shelf_code, "")));

                                                                        if (_isPharmacist || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLPOSMED)
                                                                        {
                                                                            //string m_information_query = "select " + MyLib._myGlobal._fieldAndComma("(select " + _g.d.m_dozen._name_1 + " from " + _g.d.m_dozen._table + " where " + _g.d.m_dozen._icode + " = (select " + _g.d.m_information._dozen + " from " + _g.d.m_information._table + " where " + _g.d.m_information._ic_code + "=" + _g.d.ic_inventory_barcode._ic_code + ")) as " + _g.d.m_information._dozen) + " from " + _g.d.ic_inventory_barcode._table + " where " + MyLib._myGlobal._addUpper(_g.d.ic_inventory_barcode._barcode) + "=\'" + __barCode + "\'";
                                                                            // รายละเอียดยา (4)
                                                                            string m_information_query = "select " + MyLib._myGlobal._fieldAndComma(
                                                                                "(select " + _g.d.m_dozen._name_1 +
                                                                                " from " + _g.d.m_dozen._table + " where " + _g.d.m_dozen._table + "." + _g.d.m_dozen._icode +
                                                                                " = (select " + _g.d.m_information._dozen + " from " + _g.d.m_information._table +
                                                                                " where " + _g.d.m_information._table + "." + _g.d.m_information._ic_code + "=" +
                                                                                _g.d.ic_inventory._table + "." + _g.d.ic_inventory._code + ")) as " +
                                                                                _g.d.m_information._dozen,

                                                                                "(select " + _g.d.m_times._name_1 + " from " + _g.d.m_times._table +
                                                                                " where " + _g.d.m_times._table + "." + _g.d.m_times._code + " = (select " + _g.d.m_information._times +
                                                                                " from " + _g.d.m_information._table + " where " + _g.d.m_information._table + "." +
                                                                                _g.d.m_information._ic_code + "=" + _g.d.ic_inventory._table + "." +
                                                                                _g.d.ic_inventory._code + ")) as " + _g.d.m_information._times,

                                                                                "(select " +
                                                                                _g.d.m_frequency._name_1 + " from " + _g.d.m_frequency._table + " where " + _g.d.m_frequency._table +
                                                                                "." + _g.d.m_frequency._code + " = (select " + _g.d.m_information._frequency + " from " +
                                                                                _g.d.m_information._table + " where " + _g.d.m_information._table + "." + _g.d.m_information._ic_code +
                                                                                "=" + _g.d.ic_inventory._table + "." + _g.d.ic_inventory._code + ")) as " +
                                                                                _g.d.m_information._frequency,

                                                                                "(select " + _g.d.m_information._remark + " from " +
                                                                                _g.d.m_information._table + " where " + _g.d.m_information._table + "." + _g.d.m_information._ic_code +
                                                                                "=" + _g.d.ic_inventory._table + "." + _g.d.ic_inventory._code + ") as " +
                                                                                _g.d.m_information._remark

                                                                                ) + " from " + _g.d.ic_inventory._table + " where " +
                                                                                _g.d.ic_inventory._code + "=\'" + __barCode + "\'";
                                                                            __myquery.Append(MyLib._myUtil._convertTextToXmlForQuery(m_information_query));

                                                                            // ตรวจสอบการแพ้ยา (5)
                                                                            string __allergicQuery =
                                                                                "select " + MyLib._myGlobal._fieldAndComma(_g.d.m_allergic._ic_group_main,
                                                                                _g.d.m_allergic._symptom,
                                                                                _g.d.m_allergic._remark) +
                                                                                " from " + _g.d.m_allergic._table +
                                                                                " where " + _g.d.m_allergic._ar_code + " = '" + this._custCode + "' AND " +
                                                                                _g.d.m_allergic._ic_group_main + "= (select " + _g.d.ic_inventory._group_main +
                                                                                " from " + _g.d.ic_inventory._table + " where " + _g.d.ic_inventory._code +
                                                                                " = '" + __barCode + "' ) ";

                                                                            __myquery.Append(MyLib._myUtil._convertTextToXmlForQuery(__allergicQuery));
                                                                        }
                                                                        __myquery.Append("</node>");
                                                                        ArrayList __dataProduct = __myFrameWork._queryListGetData(MyLib._myGlobal._databaseName, __myquery.ToString());
                                                                        DataTable __itemDataTable = ((DataSet)__dataProduct[0]).Tables[0];
                                                                        if (__itemDataTable.Rows.Count > 0)
                                                                        {
                                                                            if (_checkSelectCust() == false)
                                                                            {
                                                                                // warning
                                                                                MessageBox.Show(MyLib._myGlobal._resource("กรุณาเลือกลูกค้าก่อนทำการขาย"), MyLib._myGlobal._resource("เตือน"), MessageBoxButtons.OK, MessageBoxIcon.Exclamation);
                                                                                return;

                                                                            }
                                                                            else
                                                                            {

                                                                                #region ค้นหาจากสินค้า

                                                                                Boolean __is_hold_sale = __itemDataTable.Rows[0][_g.d.ic_inventory_detail._is_hold_sale].ToString().Equals("1") ? true : false;
                                                                                Boolean __balanceControl = __itemDataTable.Rows[0][_g.d.ic_inventory_detail._balance_control].ToString().Equals("1") ? true : false;

                                                                                if (__is_hold_sale)
                                                                                {
                                                                                    MessageBox.Show(MyLib._myGlobal._resource("สินค้า") + " " + __itemDataTable.Rows[0][_g.d.ic_inventory._name_1].ToString() + "(" + __barCode + ") " + MyLib._myGlobal._resource("เลิกขาย"), MyLib._myGlobal._resource(""), MessageBoxButtons.OK, MessageBoxIcon.Error);
                                                                                    return;
                                                                                }


                                                                                // สินค้าชุด ดึงรายการในสินค้าชุดออกมา
                                                                                //string __type = __getData.Rows[0][_g.d.ic_inventory._item_type].ToString();
                                                                                string __setGuid = "";
                                                                                if (__itemDataTable.Rows[0][_g.d.ic_inventory._item_type].ToString().Equals("3"))
                                                                                {
                                                                                    if (this._use_item_set == false)
                                                                                    {
                                                                                        // สินค้าชุด
                                                                                        MessageBox.Show(MyLib._myGlobal._resource("สินค้าชุด ไม่อนุญาติ"), "เตือน", MessageBoxButtons.OK, MessageBoxIcon.Exclamation);
                                                                                        return;
                                                                                    }
                                                                                    __setGuid = System.Guid.NewGuid().ToString();
                                                                                    //MessageBox.Show("สินค้าชุด");

                                                                                    // โต๋ย้ายไปล่าง
                                                                                    /*
                                                                                    string __ic_code = __itemDataTable.Rows[0][_g.d.ic_inventory._code].ToString();
                                                                                    //string __barcode = __getData.Rows[0][_g.d.ic_inventory_barcode._barcode].ToString();
                                                                                    string __queryItemSet = "select barcode,ic_code,qty, price from ic_inventory_set_detail where ic_set_code = \'" + __ic_code + "\'";

                                                                                    __myquery = new StringBuilder();
                                                                                    __myquery.Append(MyLib._myGlobal._xmlHeader + "<node>");
                                                                                    __myquery.Append(MyLib._myUtil._convertTextToXmlForQuery(__queryItemSet));
                                                                                    __myquery.Append("</node>");
                                                                                    ArrayList __dataICSetNumber = __myFrameWork._queryListGetData(MyLib._myGlobal._databaseName, __myquery.ToString());
                                                                                    DataTable __icSetDataTable = ((DataSet)__dataICSetNumber[0]).Tables[0];

                                                                                    for (int __row = 0; __row < __icSetDataTable.Rows.Count; __row++)
                                                                                    {
                                                                                        this._lastBarcode = "";
                                                                                        this._lastItemCode = "";
                                                                                        decimal __qtyDetail = MyLib._myGlobal._decimalPhase(__icSetDataTable.Rows[__row][_g.d.ic_inventory_set_detail._qty].ToString()) * __qty; // เอา qty หลัก มา * ด้วย
                                                                                        string __iccodeDetail = __icSetDataTable.Rows[__row][_g.d.ic_inventory_set_detail._ic_code].ToString();
                                                                                        string __barcodeDetail = __icSetDataTable.Rows[__row][_g.d.ic_inventory_set_detail._barcode].ToString();
                                                                                        this._command("&command&," + __qtyDetail.ToString() + "*" + ((__barcodeDetail.Length > 0) ? __barcodeDetail : __iccodeDetail), "");

                                                                                        if (_g.g._companyProfile._fix_item_set_price)
                                                                                        {
                                                                                            this._autoInsertItem = true;
                                                                                            decimal __itemSetPrice = MyLib._myGlobal._decimalPhase(__icSetDataTable.Rows[__row][_g.d.ic_inventory_set_detail._price].ToString());
                                                                                            this._command("&command&,*1*" + __itemSetPrice.ToString(), "");
                                                                                            this._autoInsertItem = false;
                                                                                        }

                                                                                    }
                                                                                    break;*/
                                                                                }

                                                                                // ตรวจสอบรายละเอียดการแพ้ยา
                                                                                if ((_isPharmacist || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLPOSMED) && ((DataSet)__dataProduct[5]).Tables[0].Rows.Count > 0)
                                                                                {
                                                                                    // แสดงอาการแพ้ยา กับสินค้าตัวนี้ออกมา
                                                                                    DataTable __allergicData = ((DataSet)__dataProduct[5]).Tables[0];
                                                                                    string __message = "พบอาการแพ้ยา ในกลุ่มยา : " + __allergicData.Rows[0][_g.d.m_allergic._ic_group_main].ToString() + "\n โดยจะมีอาการ : " + __allergicData.Rows[0][_g.d.m_allergic._symptom].ToString() + ((__allergicData.Rows[0][_g.d.m_allergic._remark].ToString().Length > 0) ? "\n หมายเหตุ : \n" + __allergicData.Rows[0][_g.d.m_allergic._remark].ToString() : "");
                                                                                    if (MessageBox.Show(__message, "ยืนยันการจ่ายยา", MessageBoxButtons.YesNo, MessageBoxIcon.Asterisk, MessageBoxDefaultButton.Button2) == DialogResult.No)
                                                                                    {
                                                                                        return;
                                                                                    }
                                                                                }


                                                                                string __unitCode = __itemDataTable.Rows[0][_g.d.ic_inventory._unit_standard].ToString();
                                                                                string __itemCodeTmp = __itemDataTable.Rows[0][_g.d.ic_inventory._code].ToString();
                                                                                Boolean __ic_serial_no = __itemDataTable.Rows[0][_g.d.ic_inventory._ic_serial_no].ToString().Equals("1") ? true : false;
                                                                                // toe add item more
                                                                                if (MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLPOSMED)
                                                                                {
                                                                                    if (_checkDrugInteractive(__itemCodeTmp) == false)
                                                                                    {
                                                                                        return;
                                                                                    }
                                                                                }


                                                                                DataTable __itemDetailDataTable = ((DataSet)__dataProduct[1]).Tables[0];
                                                                                if (__itemDetailDataTable.Rows.Count > 0)
                                                                                {
                                                                                    string __unitCode2 = __itemDetailDataTable.Rows[0][_g.d.ic_inventory_detail._start_sale_unit].ToString().Trim().ToUpper();
                                                                                    if (__unitCode2.Length > 0)
                                                                                    {
                                                                                        __unitCode = __unitCode2;
                                                                                    }
                                                                                }
                                                                                // add
                                                                                decimal __price = 0M;
                                                                                int __price_type = -1;
                                                                                //
                                                                                decimal __unitStandValue = 1M;
                                                                                decimal __unitDivideValue = 1M;
                                                                                if ((int)MyLib._myGlobal._decimalPhase(__itemDataTable.Rows[0][_g.d.ic_inventory._unit_type].ToString()) == 1)
                                                                                {
                                                                                    DataTable __unitDataTable = ((DataSet)__dataProduct[2]).Tables[0];
                                                                                    DataRow[] __select = __unitDataTable.Select(_g.d.ic_unit_use._code + "=\'" + __unitCode + "\'");
                                                                                    if (__select.Length > 0)
                                                                                    {
                                                                                        __unitStandValue = (decimal)MyLib._myGlobal._decimalPhase(__select[0][_g.d.ic_unit_use._stand_value].ToString());
                                                                                        __unitDivideValue = (decimal)MyLib._myGlobal._decimalPhase(__select[0][_g.d.ic_unit_use._divide_value].ToString());
                                                                                    }
                                                                                }

                                                                                // toe ตรวจสอบ สินค้า serial
                                                                                if (__ic_serial_no == true && serialNumber.Length == 0)
                                                                                {
                                                                                    MessageBox.Show("สินค้ามี Serial กรุณาป้อน Serial เท่านั้น", "สินค้า : " + __itemCodeTmp, MessageBoxButtons.OK, MessageBoxIcon.Exclamation);
                                                                                    break;
                                                                                }


                                                                                // ตรวจสอบห้ามขายสินค้าติดลบ
                                                                                if (__balanceControl == false && _checkbalanceControl(0, ((DataSet)__dataProduct[3]).Tables[0], __itemCodeTmp, "", __qty * (__unitStandValue / __unitDivideValue), (int)MyLib._myGlobal._decimalPhase(__itemDataTable.Rows[0][_g.d.ic_inventory._item_type].ToString())) == false)
                                                                                {
                                                                                    break;
                                                                                }

                                                                                Boolean __found = false;
                                                                                int __foundAddr = -1;
                                                                                for (int __row = 0; __row < this._itemList.Count; __row++)
                                                                                {
                                                                                    if (this._itemList[__row]._pos_no_sum == false && extraItemName.Length == 0 && __itemCodeTmp.Equals(this._itemList[__row]._itemCode) && __unitCode.Equals(this._itemList[__row]._unitCode) && serialNumber.Equals(this._itemList[__row]._serialNumber) && __itemCodeTmp.Equals(this._itemList[__row]._barCode))
                                                                                    {
                                                                                        if (__qty < 0 && (this._itemList[__row]._qty + __qty) <= 0)
                                                                                        {
                                                                                            __found = true;
                                                                                            break;
                                                                                        }

                                                                                        __foundAddr = __row;
                                                                                        this._itemList[__row]._qtyLast = __qty;
                                                                                        this._itemList[__row]._qty += __qty;

                                                                                        this._itemList[__row]._amount = this._itemList[__row]._qty * this._itemList[__row]._price;

                                                                                        // หาราคา
                                                                                        string __today = MyLib._myGlobal._convertDateToQuery(DateTime.Now);
                                                                                        SMLInventoryControl._findPriceClass __getPrice = new SMLInventoryControl._findPriceClass();
                                                                                        SMLInventoryControl._icTransItemGridControl._priceStruct __result = __getPrice._findPriceByItem(__barCode, __barCode, __unitCode, __qty, this._custCode, this._memberCode, false, "", __today, _g.g._vatTypeEnum.ภาษีรวมใน, 0, 1, 0);

                                                                                        this._itemList[__row]._price = __result._price;
                                                                                        this._itemList[__row]._price_type = __result._type;
                                                                                        this._itemList[__row]._discountWord = __result._discountWord;
                                                                                        this._itemList[__row]._discountNumber = __result._discountNumber;
                                                                                        this._itemList[__row]._price_stand = __result._stand_price;

                                                                                        __found = true;
                                                                                        if (this._posConfig._use_sound_on_already_item == 1)
                                                                                        {
                                                                                            this._playSound(this._posConfig._sound_on_already_item);
                                                                                        }

                                                                                        break;
                                                                                    }
                                                                                }

                                                                                if (__found == false)
                                                                                {

                                                                                    // หาราคา
                                                                                    SMLInventoryControl._icTransItemGridControl._priceStruct __result = new SMLInventoryControl._icTransItemGridControl._priceStruct();
                                                                                    if (__itemDataTable.Rows[0][_g.d.ic_inventory._item_type].ToString().Equals("3") == false)
                                                                                    {
                                                                                        string __today = MyLib._myGlobal._convertDateToQuery(DateTime.Now);
                                                                                        SMLInventoryControl._findPriceClass __getPrice = new SMLInventoryControl._findPriceClass();
                                                                                        __result = __getPrice._findPriceByItem(__barCode, __barCode, __unitCode, __qty, this._custCode, this._memberCode, false, "", __today, _g.g._vatTypeEnum.ภาษีรวมใน, 0, 1, 0);
                                                                                        __price = __result._price;
                                                                                        __price_type = __result._type;
                                                                                        if (__price == 0)
                                                                                        {
                                                                                            // เอาราคารวมในมาเพิ่ม vat
                                                                                            __price = MyLib._myGlobal._round(__result._price1 + (__result._price1 * (_g.g._companyProfile._vat_rate / 100M)), 2);
                                                                                        }
                                                                                    }
                                                                                    //
                                                                                    this._lastItemCode = __itemDataTable.Rows[0][_g.d.ic_inventory._code].ToString();
                                                                                    // toe แสดงยอดคงเหลือ 
                                                                                    if (this._itemBalanceForm != null)
                                                                                    {
                                                                                        this._itemBalanceForm._load(this._lastItemCode);
                                                                                    }

                                                                                    _posClientItemClass __item = new _posClientItemClass();
                                                                                    __item._barCode = __itemDataTable.Rows[0][_g.d.ic_inventory._code].ToString();
                                                                                    __item._itemCode = __item._barCode;
                                                                                    __item._itemName = __itemDataTable.Rows[0][_g.d.ic_inventory._name_1].ToString() + ((extraItemName.Length > 0) ? " " + extraItemName : "");
                                                                                    __item._unitCode = __unitCode;
                                                                                    __item._itemType = (int)MyLib._myGlobal._decimalPhase(__itemDataTable.Rows[0][_g.d.ic_inventory._item_type].ToString());
                                                                                    __item._discountWord = "";
                                                                                    __item._taxType = (int)MyLib._myGlobal._decimalPhase(__itemDataTable.Rows[0][_g.d.ic_inventory._tax_type].ToString());
                                                                                    __item._vat_type = (this._posConfig._pos_vat_type == 1) ? 0 : 1;
                                                                                    __item._vatRate = _g.g._companyProfile._vat_rate;
                                                                                    __item._havePoint = (((int)MyLib._myGlobal._decimalPhase(__itemDataTable.Rows[0][__fieldHavePoint].ToString()) == 0)) ? false : true;
                                                                                    __item._qtyLast = __qty;
                                                                                    __item._qty = __qty;
                                                                                    __item._price = __price;
                                                                                    __item._amount = __item._qty * __item._price;
                                                                                    __item._standValue = __unitStandValue;
                                                                                    __item._divideValue = __unitDivideValue;
                                                                                    __item._priceInfo = "";
                                                                                    __item._discountNumber = 0;
                                                                                    __item._priceDefault = __price;
                                                                                    __item._serialNumber = serialNumber;
                                                                                    __item._price_type = __price_type;
                                                                                    __item._price_stand = __result._stand_price;
                                                                                    __item._no_discount = __itemDataTable.Rows[0][_g.d.ic_inventory._no_discount].ToString().Equals("1") ? true : false;
                                                                                    __item._pos_no_sum = __itemDataTable.Rows[0][_g.d.ic_inventory._pos_no_sum].ToString().Equals("1") ? true : false;
                                                                                    __item._balanceControl = __balanceControl;

                                                                                    // toe 
                                                                                    __item._drink_type = (int)MyLib._myGlobal._decimalPhase(__itemDataTable.Rows[0][_g.d.ic_inventory._drink_type].ToString());
                                                                                    if (this._isPharmacist || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLPOSMED)
                                                                                    {
                                                                                        // เพิ่มเติมรายละเอียดยา

                                                                                        DataTable __m_information_table = ((DataSet)__dataProduct[4]).Tables[0];
                                                                                        string _m_dozen = __m_information_table.Rows[0][_g.d.m_information._dozen].ToString();
                                                                                        string _m_times = __m_information_table.Rows[0][_g.d.m_information._times].ToString();
                                                                                        string _m_frequency = __m_information_table.Rows[0][_g.d.m_information._frequency].ToString();
                                                                                        string _m_remark = __m_information_table.Rows[0][_g.d.m_information._remark].ToString();

                                                                                        _sendMessage("update:label,m_dozen", _m_dozen, serialNumber);
                                                                                        _sendMessage("update:label,m_times", _m_times, serialNumber);
                                                                                        _sendMessage("update:label,m_frequency", _m_frequency, serialNumber);
                                                                                        _sendMessage("update:label,m_remark", _m_remark, serialNumber);

                                                                                        __item._m_dozen = _m_dozen;
                                                                                        __item._m_times = _m_times;
                                                                                        __item._m_frequency = _m_frequency;
                                                                                        __item._m_warning = _m_remark;

                                                                                    }
                                                                                    // replace remark ขึ้นต้นด้วย #
                                                                                    if (__itemDataTable.Rows[0][_g.d.ic_inventory._remark].ToString().IndexOf("#") == 0)
                                                                                    {
                                                                                        __item._replace_remark_qty = true;
                                                                                        __item._item_remark = __itemDataTable.Rows[0][_g.d.ic_inventory._remark].ToString().Substring(1);
                                                                                        __item._item_name_remark = __itemDataTable.Rows[0][_g.d.ic_inventory._name_1].ToString();
                                                                                    }


                                                                                    if (_g.g._companyProfile._ic_price_formula_control)
                                                                                    {
                                                                                        if (this._checkSaleLowStandPrice(__item._barCode, __item._price_stand, __item._price, __item._qty, __item._discountWord))
                                                                                        {
                                                                                            _sendMessage("clear:textbox,input", null, "");
                                                                                            return;
                                                                                        }
                                                                                    }

                                                                                    __item._ref_guid = __setGuid;
                                                                                    __item._set_ref_line = refGuid;
                                                                                    __item._item_code_main = icCodeMain;
                                                                                    __item._set_ref_qty = setRefQty;
                                                                                    __item._set_ref_price = setRefPrice;
                                                                                    __item._price_set_ratio = priceSetRatio;
                                                                                    if (refGuid.Length > 0)
                                                                                    {
                                                                                        __item._ref_row = -1;
                                                                                    }


                                                                                    this._itemList.Add(__item);
                                                                                    _sendMessage("update:label,price_info", __item._priceInfo, serialNumber);
                                                                                    if (this._show_barcode_picture)
                                                                                    {
                                                                                        _sendMessage("update:image,item_image", __item._barCode, serialNumber);
                                                                                    }
                                                                                    else
                                                                                    {
                                                                                        _sendMessage("update:image,item_image", __item._itemCode, serialNumber);
                                                                                    }
                                                                                }

                                                                                this._addItemToGrid(true, -1);
                                                                                __isProduct = true;

                                                                                // สินค้าชุด

                                                                                if (__itemDataTable.Rows[0][_g.d.ic_inventory._item_type].ToString().Equals("3"))
                                                                                {
                                                                                    //MessageBox.Show("สินค้าชุด");

                                                                                    string __ic_code = __itemDataTable.Rows[0][_g.d.ic_inventory._code].ToString();
                                                                                    //string __barcode = __getData.Rows[0][_g.d.ic_inventory_barcode._barcode].ToString();
                                                                                    string __queryItemSet = "select barcode,ic_code,qty, price from ic_inventory_set_detail where ic_set_code = \'" + __ic_code + "\'";

                                                                                    __myquery = new StringBuilder();
                                                                                    __myquery.Append(MyLib._myGlobal._xmlHeader + "<node>");
                                                                                    __myquery.Append(MyLib._myUtil._convertTextToXmlForQuery(__queryItemSet));
                                                                                    __myquery.Append("</node>");
                                                                                    ArrayList __dataICSetNumber = __myFrameWork._queryListGetData(MyLib._myGlobal._databaseName, __myquery.ToString());
                                                                                    DataTable __icSetDataTable = ((DataSet)__dataICSetNumber[0]).Tables[0];

                                                                                    for (int __row = 0; __row < __icSetDataTable.Rows.Count; __row++)
                                                                                    {
                                                                                        this._lastBarcode = "";
                                                                                        this._lastItemCode = "";
                                                                                        decimal __qtyDetail = MyLib._myGlobal._decimalPhase(__icSetDataTable.Rows[__row][_g.d.ic_inventory_set_detail._qty].ToString()) * __qty; // เอา qty หลัก มา * ด้วย
                                                                                        string __iccodeDetail = __icSetDataTable.Rows[__row][_g.d.ic_inventory_set_detail._ic_code].ToString();
                                                                                        string __barcodeDetail = __icSetDataTable.Rows[__row][_g.d.ic_inventory_set_detail._barcode].ToString();
                                                                                        this._command("&command&," + __qtyDetail.ToString() + "*" + ((__barcodeDetail.Length > 0) ? __barcodeDetail : __iccodeDetail), "");

                                                                                        if (_g.g._companyProfile._fix_item_set_price)
                                                                                        {
                                                                                            this._autoInsertItem = true;
                                                                                            decimal __itemSetPrice = MyLib._myGlobal._decimalPhase(__icSetDataTable.Rows[__row][_g.d.ic_inventory_set_detail._price].ToString());
                                                                                            this._command("&command&,*1*" + __itemSetPrice.ToString(), "");
                                                                                            this._autoInsertItem = false;
                                                                                        }

                                                                                    }
                                                                                    break;
                                                                                }


                                                                                this._lastItemCode = __itemCodeTmp;

                                                                                #endregion

                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                                #endregion
                                                            }
                                                            else
                                                            {
                                                                // check option warnning_select_cust

                                                                if (_checkSelectCust() == false)
                                                                {
                                                                    // warning
                                                                    MessageBox.Show(MyLib._myGlobal._resource("กรุณาเลือกลูกค้าก่อนทำการขาย"), MyLib._myGlobal._resource("เตือน"), MessageBoxButtons.OK, MessageBoxIcon.Exclamation);

                                                                    return;

                                                                }
                                                                else
                                                                {
                                                                    #region ค้นหาสินค้าจาก barcode

                                                                    // สินค้าชุด ดึงรายการในสินค้าชุดออกมา
                                                                    //string __type = __getData.Rows[0][_g.d.ic_inventory._item_type].ToString();
                                                                    string __itemCode = __getData.Rows[0][_g.d.ic_inventory_barcode._ic_code].ToString();
                                                                    decimal __standValue = MyLib._myGlobal._decimalPhase(__getData.Rows[0]["stand_value"].ToString());
                                                                    decimal __divideValue = MyLib._myGlobal._decimalPhase(__getData.Rows[0]["divide_value"].ToString());
                                                                    Boolean __ic_serial_no = __getData.Rows[0][_g.d.ic_inventory._ic_serial_no].ToString().Equals("1") ? true : false;

                                                                    Boolean __is_hold_sale = __getData.Rows[0][_g.d.ic_inventory_detail._is_hold_sale].ToString().Equals("1") ? true : false;
                                                                    if (__is_hold_sale)
                                                                    {
                                                                        MessageBox.Show(MyLib._myGlobal._resource("สินค้า") + " " + __getData.Rows[0][_g.d.ic_inventory_barcode._description].ToString() + ((extraItemName.Length > 0) ? " " + extraItemName : "") + "(" + __itemCode + ") " + MyLib._myGlobal._resource("เลิกขาย"), MyLib._myGlobal._resource(""), MessageBoxButtons.OK, MessageBoxIcon.Error);
                                                                        return;
                                                                    }

                                                                    Boolean __balanceControl = __getData.Rows[0][_g.d.ic_inventory_detail._balance_control].ToString().Equals("1") ? true : false;

                                                                    string __setGuid = "";
                                                                    if (__divideValue.Equals(0))
                                                                    {
                                                                        MessageBox.Show(MyLib._myGlobal._resource("ไม่พบหน่วยนับสินค้า"), MyLib._myGlobal._resource("เตือน"), MessageBoxButtons.OK, MessageBoxIcon.Error);
                                                                        return;
                                                                    }

                                                                    if (__getData.Rows[0][_g.d.ic_inventory._item_type].ToString().Equals("3"))
                                                                    {
                                                                        //MessageBox.Show("สินค้าชุด");
                                                                        if (this._use_item_set == false)
                                                                        {
                                                                            // สินค้าชุด
                                                                            MessageBox.Show(MyLib._myGlobal._resource("สินค้าชุด ไม่อนุญาติ"), "เตือน", MessageBoxButtons.OK, MessageBoxIcon.Exclamation);

                                                                            return;
                                                                        }
                                                                        __setGuid = System.Guid.NewGuid().ToString();

                                                                        // toe ย้ายไปล่าง
                                                                        /*
                                                                        string __ic_code = __getData.Rows[0][_g.d.ic_inventory_barcode._ic_code].ToString();
                                                                        string __barcode = __getData.Rows[0][_g.d.ic_inventory_barcode._barcode].ToString();
                                                                        string __queryItemSet = "select barcode,ic_code,qty, price from ic_inventory_set_detail where ic_set_code = \'" + __ic_code + "\'";

                                                                        __myquery = new StringBuilder();
                                                                        __myquery.Append(MyLib._myGlobal._xmlHeader + "<node>");
                                                                        __myquery.Append(MyLib._myUtil._convertTextToXmlForQuery(__queryItemSet));
                                                                        __myquery.Append("</node>");
                                                                        ArrayList __dataICSetNumber = __myFrameWork._queryListGetData(MyLib._myGlobal._databaseName, __myquery.ToString());
                                                                        DataTable __icSetDataTable = ((DataSet)__dataICSetNumber[0]).Tables[0];

                                                                        for (int __row = 0; __row < __icSetDataTable.Rows.Count; __row++)
                                                                        {
                                                                            this._lastBarcode = "";
                                                                            this._lastItemCode = "";
                                                                            decimal __qtyDetail = MyLib._myGlobal._decimalPhase(__icSetDataTable.Rows[__row][_g.d.ic_inventory_set_detail._qty].ToString()) * __qty; // เอา qty หลัก มา * ด้วย
                                                                            string __iccodeDetail = __icSetDataTable.Rows[__row][_g.d.ic_inventory_set_detail._ic_code].ToString();
                                                                            string __barcodeDetail = __icSetDataTable.Rows[__row][_g.d.ic_inventory_set_detail._barcode].ToString();
                                                                            this._command("&command&," + __qtyDetail.ToString() + "*" + ((__barcodeDetail.Length > 0) ? __barcodeDetail : __iccodeDetail), "");
                                                                            if (_g.g._companyProfile._fix_item_set_price)
                                                                            {
                                                                                this._autoInsertItem = true;
                                                                                decimal __itemSetPrice = MyLib._myGlobal._decimalPhase(__icSetDataTable.Rows[__row][_g.d.ic_inventory_set_detail._price].ToString());
                                                                                this._command("&command&,*1*" + __itemSetPrice.ToString(), "");
                                                                                this._autoInsertItem = false;
                                                                            }
                                                                        }
                                                                        break;*/
                                                                    }

                                                                    // ค้นหา Barcode เดิม
                                                                    // ตรวจสอบรายละเอียดการแพ้ยา
                                                                    if ((_isPharmacist || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLPOSMED) && ((DataSet)__data[__allergicTable]).Tables[0].Rows.Count > 0)
                                                                    {
                                                                        // แสดงอาการแพ้ยา กับสินค้าตัวนี้ออกมา
                                                                        DataTable __allergicData = ((DataSet)__data[__allergicTable]).Tables[0];
                                                                        string __message = "พบอาการแพ้ยา ในกลุ่มยา : " + __allergicData.Rows[0][_g.d.m_allergic._ic_group_main].ToString() + "\n โดยจะมีอาการ : " + __allergicData.Rows[0][_g.d.m_allergic._symptom].ToString() + ((__allergicData.Rows[0][_g.d.m_allergic._remark].ToString().Length > 0) ? "\n หมายเหตุ : \n" + __allergicData.Rows[0][_g.d.m_allergic._remark].ToString() : "");
                                                                        if (MessageBox.Show(__message, "ยืนยันการจ่ายยา", MessageBoxButtons.YesNo, MessageBoxIcon.Asterisk, MessageBoxDefaultButton.Button2) == DialogResult.No)
                                                                        {
                                                                            return;
                                                                        }
                                                                    }

                                                                    if (MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLPOSMED)
                                                                    {
                                                                        if (_checkDrugInteractive(__itemCode) == false)
                                                                        {
                                                                            return;
                                                                        }
                                                                    }

                                                                    __isProduct = true;

                                                                    // toe ตรวจสอบ สินค้า serial
                                                                    if (__ic_serial_no == true && serialNumber.Length == 0)
                                                                    {
                                                                        MessageBox.Show(MyLib._myGlobal._resource("สินค้ามี Serial กรุณาป้อน Serial เท่านั้น"), MyLib._myGlobal._resource("สินค้า Serial ") + " : " + __itemCode, MessageBoxButtons.OK, MessageBoxIcon.Exclamation);
                                                                        break;
                                                                    }

                                                                    // ตรวจสอบห้ามขายสินค้าติดลบ
                                                                    if (__balanceControl == false && _checkbalanceControl(0, ((DataSet)__data[__icBalanceTable]).Tables[0], __itemCode, __barCode, __qty * (__standValue / __divideValue), (int)MyLib._myGlobal._decimalPhase(__getData.Rows[0]["item_type"].ToString())) == false)
                                                                    {
                                                                        break;
                                                                    }

                                                                    Boolean __found = false;
                                                                    int __foundAddr = -1;
                                                                    for (int __row = 0; __row < this._itemList.Count; __row++)
                                                                    {
                                                                        if (this._itemList[__row]._pos_no_sum == false && extraItemName.Length == 0 && __barCode.Equals(this._itemList[__row]._barCode) && serialNumber.Equals(this._itemList[__row]._serialNumber) && this._itemList[__row]._isChangePrice == 0 && isPriceChange == false)
                                                                        {
                                                                            if (__qty < 0 && (this._itemList[__row]._qty + __qty) <= 0)
                                                                            {
                                                                                __found = true;
                                                                                break;
                                                                            }

                                                                            __foundAddr = __row;
                                                                            this._itemList[__row]._qtyLast = __qty;
                                                                            this._itemList[__row]._qty += __qty;

                                                                            this._itemList[__row]._amount = this._itemList[__row]._qty * this._itemList[__row]._price;


                                                                            // เมื่อมีการแก้ไข จำนวน หาราคาใหม่
                                                                            SMLInventoryControl._findPriceClass __getPrice = new SMLInventoryControl._findPriceClass();
                                                                            SMLInventoryControl._icTransItemGridControl._priceStruct __result = __getPrice._findPricePOS(this._itemList[__row]._itemCode, this._itemList[__row]._barCode, this._itemList[__row]._unitCode, this._itemList[__row]._qty, this._custCode, this._memberCode, this._posConfigPriceNumber, this._isStaff, this._posConfig._posid, this._posDefaultCust);

                                                                            this._itemList[__row]._price = __result._price;
                                                                            this._itemList[__row]._price_type = __result._type;
                                                                            this._itemList[__row]._discountWord = __result._discountWord;
                                                                            this._itemList[__row]._discountNumber = __result._discountNumber;
                                                                            this._itemList[__row]._price_stand = __result._stand_price;

                                                                            if (__result._price_info.Length > 0)
                                                                            {
                                                                                this._itemList[__row]._priceInfo = __result._price_info;
                                                                                _sendMessage("update:label,price_info", __result._price_info, serialNumber);
                                                                            }

                                                                            __found = true;
                                                                            _sendMessage("update:label,price_info", this._itemList[__row]._priceInfo, serialNumber);
                                                                            if (this._posConfig._use_sound_on_already_barcode == 1)
                                                                            {
                                                                                this._playSound(this._posConfig._sound_on_already_barcode);
                                                                            }
                                                                            break;
                                                                        }
                                                                    }
                                                                    if (__found == false)
                                                                    {
                                                                        if (this._memberCode.Trim().Length > 0 && (this._memberCode.Equals(this._posDefaultCust) == false))
                                                                        {
                                                                            // ค้นหาว่าเคยซื้อล่าสุดเมื่อไหร่
                                                                            DataTable __dtLastBy = ((DataSet)__data[__lastBuyTable]).Tables[0];
                                                                            if (__dtLastBy.Rows.Count > 0)
                                                                            {
                                                                                this._lastBuy = MyLib._myGlobal._resource("เคยซื้อล่าสุด") + " : " + __dtLastBy.Rows[0][_g.d.ic_trans_detail._doc_date].ToString() + " @ " + MyLib._myGlobal._resource("เวลา") + " : " + __dtLastBy.Rows[0][_g.d.ic_trans_detail._doc_time].ToString() + " @ " + MyLib._myGlobal._resource("จำนวน") + " " + MyLib._myGlobal._decimalPhase(__dtLastBy.Rows[0][_g.d.ic_trans_detail._qty].ToString()).ToString(this._formatNumber1) + " " + __dtLastBy.Rows[0][_g.d.ic_trans_detail._unit_code].ToString() + " @ " + MyLib._myGlobal._resource("ราคา") + " " + MyLib._myGlobal._decimalPhase(__dtLastBy.Rows[0][_g.d.ic_trans_detail._price].ToString()).ToString(this._formatNumber1) + " " + MyLib._myGlobal._resource("บาท");
                                                                                decimal __lastDiscountAmount = MyLib._myGlobal._decimalPhase(__dtLastBy.Rows[0][_g.d.ic_trans_detail._discount_amount].ToString());
                                                                                if (__lastDiscountAmount != 0)
                                                                                {
                                                                                    this._lastBuy = this._lastBuy + " @ " + MyLib._myGlobal._resource("มีส่วนลด") + " : " + __lastDiscountAmount.ToString(this._formatNumber1) + " " + MyLib._myGlobal._resource("บาท");
                                                                                }
                                                                                this._lastBuy = this._lastBuy + " (" + __dtLastBy.Rows[0][_g.d.ic_trans_detail._item_name].ToString() + ")";
                                                                            }
                                                                        }

                                                                        // Step
                                                                        // 1.หาราคาพนักงาน (กรณีเป็นสมาชิก+พนักงาน)
                                                                        // 2.ส่วนลดพิเศษ
                                                                        // 3.ส่วนลดพิเศษสมาชิก
                                                                        // 4.หาราคา Promotion (กรณีไม่ใช่สมาชิก)
                                                                        // 5.หาราคา Member (กรณีเป็นสมาชิก)
                                                                        // 6.ราคาปรกติ
                                                                        // price1=ราคาลดพิเศษ
                                                                        // price2=ราคาลดพิเศษ (สมาชิก)
                                                                        // price3=ราคา Promotion
                                                                        // price4=ราคา สมาชิก
                                                                        // price5=ราคาพนักงาน


                                                                        DataTable __priceTable = ((DataSet)__data[__barcodePriceTable]).Tables[0];
                                                                        DataRow[] __price1 = (__priceTable.Rows.Count == 0) ? null : __priceTable.Select(_g.d.ic_inventory_barcode_price._discount_type + "=1");
                                                                        DataRow[] __price2 = (__priceTable.Rows.Count == 0) ? null : __priceTable.Select(_g.d.ic_inventory_barcode_price._discount_type + "=2");
                                                                        DataRow[] __price3 = (__priceTable.Rows.Count == 0) ? null : __priceTable.Select(_g.d.ic_inventory_barcode_price._discount_type + "=3");
                                                                        DataRow[] __price4 = (__priceTable.Rows.Count == 0) ? null : __priceTable.Select(_g.d.ic_inventory_barcode_price._discount_type + "=4");
                                                                        DataRow[] __price5 = (__priceTable.Rows.Count == 0) ? null : __priceTable.Select(_g.d.ic_inventory_barcode_price._discount_type + "=5");

                                                                        decimal __priceNormal = 0M;
                                                                        decimal __priceMember = 0M;

                                                                        int __discountNumber = 0;
                                                                        string __priceInfo = "";
                                                                        int __price_type = 5;
                                                                        decimal __price_stand = 0M;
                                                                        decimal __price = 0M;
                                                                        string __discountWord = "";

                                                                        if (__getData.Rows[0]["item_type"].ToString().Equals("3") == false)
                                                                        {
                                                                            //Boolean __foundPriceOrDiscount = false;
                                                                            this._lastBarcode = __barCode;
                                                                            this._lastItemCode = __itemCode;


                                                                            // toe แสดงยอดคงเหลือ 
                                                                            if (this._itemBalanceForm != null)
                                                                            {
                                                                                this._itemBalanceForm._load(this._lastItemCode);
                                                                            }

                                                                            switch (this._posConfigPriceNumber)
                                                                            {
                                                                                case 0:
                                                                                case 1:
                                                                                    __priceNormal = MyLib._myGlobal._decimalPhase(__getData.Rows[0][_g.d.ic_inventory_barcode._price].ToString());
                                                                                    __priceMember = MyLib._myGlobal._decimalPhase(__getData.Rows[0][_g.d.ic_inventory_barcode._price_member].ToString());
                                                                                    break;
                                                                                case 2:
                                                                                    __priceNormal = MyLib._myGlobal._decimalPhase(__getData.Rows[0][_g.d.ic_inventory_barcode._price_2].ToString());
                                                                                    __priceMember = MyLib._myGlobal._decimalPhase(__getData.Rows[0][_g.d.ic_inventory_barcode._price_member_2].ToString());
                                                                                    break;
                                                                                case 3:
                                                                                    __priceNormal = MyLib._myGlobal._decimalPhase(__getData.Rows[0][_g.d.ic_inventory_barcode._price_3].ToString());
                                                                                    __priceMember = MyLib._myGlobal._decimalPhase(__getData.Rows[0][_g.d.ic_inventory_barcode._price_member_3].ToString());
                                                                                    break;
                                                                                case 4:
                                                                                    __priceNormal = MyLib._myGlobal._decimalPhase(__getData.Rows[0][_g.d.ic_inventory_barcode._price_4].ToString());
                                                                                    __priceMember = MyLib._myGlobal._decimalPhase(__getData.Rows[0][_g.d.ic_inventory_barcode._price_member_4].ToString());
                                                                                    break;
                                                                            }

                                                                            /*__price = __priceNormal;
                                                                            __discountWord = "";*/

                                                                            _itemPriceClass __findPriceClass = _posProcess._findPOSPrice(this._custCode, this._memberCode, this._posDefaultCust, this._isStaff, __itemCode, __barCode, __qty, __getData.Rows[0][_g.d.ic_inventory_barcode._unit_code].ToString(), __priceNormal, __priceMember, __price1, __price2, __price3, __price4, __price5);
                                                                            __discountWord = __findPriceClass._discountWord;
                                                                            __price = __findPriceClass._price;
                                                                            __priceInfo = __findPriceClass._priceInfo;
                                                                            __discountNumber = __findPriceClass._discountNumber;
                                                                            __price_type = __findPriceClass._price_type;

                                                                            #region หาราคา ย้ายไป _posProcess._findPOSPrice
                                                                            /*
                                                                        // 

                                                                        string __staffDiscount = (__price5 == null || __price5.Length == 0) ? "" : __price5[0][_g.d.ic_inventory_barcode_price._discount_word].ToString().Trim();
                                                                        string __extraDiscount = (__price1 == null || __price1.Length == 0) ? "" : __price1[0][_g.d.ic_inventory_barcode_price._discount_word].ToString().Trim();
                                                                        string __extraDiscountMember = (__price2 == null || __price2.Length == 0) ? "" : __price2[0][_g.d.ic_inventory_barcode_price._discount_word].ToString().Trim();
                                                                        string __discount = (__price3 == null || __price3.Length == 0) ? "" : __price3[0][_g.d.ic_inventory_barcode_price._discount_word].ToString().Trim();
                                                                        string __discountMember = (__price4 == null || __price4.Length == 0) ? "" : __price4[0][_g.d.ic_inventory_barcode_price._discount_word].ToString().Trim();
                                                                        //
                                                                        if (this._memberCode.Length > 0 && (this._memberCode.Equals(this._posDefaultCust) == false) && this._isStaff && __staffDiscount.Length > 0)
                                                                        {
                                                                            if (__staffDiscount.IndexOf("#") == 0)
                                                                            {
                                                                                int __startDiscountPoint = __staffDiscount.IndexOf(",");

                                                                                __price = MyLib._myGlobal._decimalPhase(__staffDiscount.Substring(1, (__startDiscountPoint == -1) ? __staffDiscount.Length - 1 : __startDiscountPoint));
                                                                                __priceInfo = MyLib._myGlobal._resource("ราคาพนักงาน") + " " + __price.ToString(this._formatNumber1);
                                                                                __foundPriceOrDiscount = true;

                                                                                // เช็คส่วนลด
                                                                                if (__startDiscountPoint != -1)
                                                                                {
                                                                                    __discountWord = __staffDiscount.Substring(__startDiscountPoint + 1, __staffDiscount.Length - (__startDiscountPoint + 1));
                                                                                    __priceInfo = MyLib._myGlobal._resource("ส่วนลดพนักงาน") + " " + __discountWord;
                                                                                    __discountNumber = 5;
                                                                                }
                                                                            }
                                                                            else
                                                                            {
                                                                                // ราคาพนักงาน
                                                                                __foundPriceOrDiscount = true;
                                                                                __discountWord = __staffDiscount;
                                                                                __priceInfo = MyLib._myGlobal._resource("ส่วนลดพนักงาน") + " " + __discountWord;
                                                                                __discountNumber = 5;
                                                                            }
                                                                        }
                                                                        if (__foundPriceOrDiscount == false)
                                                                        {
                                                                            // ส่วนลดพิเศษ (ตามฤดู)
                                                                            if (this._memberCode.Length > 0 && (this._memberCode.Equals(this._posDefaultCust) == false))
                                                                            {
                                                                                // สมาชิก
                                                                                string __memberDiscount = __extraDiscountMember;
                                                                                if (__memberDiscount.Length > 0)
                                                                                {
                                                                                    if (__memberDiscount.IndexOf("#") == 0)
                                                                                    {
                                                                                        int __startDiscountPoint = __memberDiscount.IndexOf(",");

                                                                                        __price = MyLib._myGlobal._decimalPhase(__memberDiscount.Substring(1, (__startDiscountPoint == -1) ? __memberDiscount.Length - 1 : __startDiscountPoint));
                                                                                        __priceInfo = MyLib._myGlobal._resource("ราคาพิเศษ+สมาชิก") + " " + __price.ToString(this._formatNumber1);
                                                                                        __foundPriceOrDiscount = true;

                                                                                        // เช็คส่วนลด
                                                                                        if (__startDiscountPoint != -1)
                                                                                        {
                                                                                            __discountWord = __memberDiscount.Substring(__startDiscountPoint + 1, __memberDiscount.Length - (__startDiscountPoint + 1));
                                                                                            __priceInfo = MyLib._myGlobal._resource("ส่วนลดพิเศษ+สมาชิก") + " " + __discountWord;
                                                                                            __discountNumber = 2;
                                                                                        }


                                                                                    }
                                                                                    else
                                                                                    {
                                                                                        __discountWord = __extraDiscountMember;
                                                                                        if (__priceInfo.Length > 0)
                                                                                        {
                                                                                            __priceInfo = __priceInfo + " ";
                                                                                        }
                                                                                        __priceInfo = __priceInfo + MyLib._myGlobal._resource("ส่วนลดพิเศษ+สมาชิก") + " " + __discountWord;
                                                                                        __foundPriceOrDiscount = true;
                                                                                        __discountNumber = 2;
                                                                                    }
                                                                                }
                                                                            }
                                                                            if (__foundPriceOrDiscount == false)
                                                                            {
                                                                                string __promotionDiscount = __extraDiscount;
                                                                                if (__promotionDiscount.Length > 0)
                                                                                {
                                                                                    if (__promotionDiscount.IndexOf("#") == 0)
                                                                                    {
                                                                                        int __startDiscountPoint = __promotionDiscount.IndexOf(",");

                                                                                        __price = MyLib._myGlobal._decimalPhase(__promotionDiscount.Substring(1, (__startDiscountPoint == -1) ? __promotionDiscount.Length - 1 : __startDiscountPoint));
                                                                                        __priceInfo = MyLib._myGlobal._resource("ราคาพิเศษ+โปรโมชั่น") + " " + __price.ToString(this._formatNumber1);
                                                                                        __foundPriceOrDiscount = true;

                                                                                        // เช็คส่วนลด
                                                                                        if (__startDiscountPoint != -1)
                                                                                        {
                                                                                            __discountWord = __promotionDiscount.Substring(__startDiscountPoint + 1, __promotionDiscount.Length - (__startDiscountPoint + 1));
                                                                                            __priceInfo = MyLib._myGlobal._resource("ส่วนลดพิเศษ+โปรโมชั่น") + " " + __discountWord;
                                                                                            __discountNumber = 1;
                                                                                        }
                                                                                    }
                                                                                    else
                                                                                    {
                                                                                        __discountWord = __promotionDiscount;
                                                                                        __foundPriceOrDiscount = true;
                                                                                        if (__priceInfo.Length > 0)
                                                                                        {
                                                                                            __priceInfo = __priceInfo + " ";
                                                                                        }
                                                                                        __priceInfo = __priceInfo + MyLib._myGlobal._resource("ส่วนลดพิเศษ+โปรโมชั่น") + " " + __discountWord;
                                                                                        __discountNumber = 1;
                                                                                    }
                                                                                }
                                                                            }
                                                                            // ส่วนลดทั่วไป
                                                                            if (__foundPriceOrDiscount == false && this._memberCode.Length > 0 && (this._memberCode.Equals(this._posDefaultCust) == false))
                                                                            {
                                                                                // สมาชิก
                                                                                string __memberDiscount = __discountMember;
                                                                                if (__memberDiscount.Length > 0)
                                                                                {
                                                                                    if (__memberDiscount.IndexOf("#") == 0)
                                                                                    {
                                                                                        int __startDiscountPoint = __memberDiscount.IndexOf(",");

                                                                                        __price = MyLib._myGlobal._decimalPhase(__memberDiscount.Substring(1, (__startDiscountPoint == -1) ? __memberDiscount.Length - 1 : __startDiscountPoint));
                                                                                        __priceInfo = MyLib._myGlobal._resource("ราคาสมาชิก") + " " + __price.ToString(this._formatNumber1);
                                                                                        __foundPriceOrDiscount = true;


                                                                                        // เช็คส่วนลด
                                                                                        if (__startDiscountPoint != -1)
                                                                                        {
                                                                                            __discountWord = __memberDiscount.Substring(__startDiscountPoint + 1, __memberDiscount.Length - (__startDiscountPoint + 1));
                                                                                            __priceInfo = MyLib._myGlobal._resource("ส่วนลดสมาชิก") + " " + __discountWord;
                                                                                            __discountNumber = 4;
                                                                                        }

                                                                                    }
                                                                                    else
                                                                                    {
                                                                                        __discountWord = __memberDiscount;
                                                                                        if (__priceInfo.Length > 0)
                                                                                        {
                                                                                            __priceInfo = __priceInfo + " ";
                                                                                        }
                                                                                        __priceInfo = __priceInfo + MyLib._myGlobal._resource("ส่วนลดสมาชิก") + " " + __discountWord;
                                                                                        __foundPriceOrDiscount = true;
                                                                                        __discountNumber = 4;
                                                                                    }
                                                                                }
                                                                            }
                                                                            if (__foundPriceOrDiscount == false)
                                                                            {
                                                                                // Promotion
                                                                                string __promotionDiscount = __discount;
                                                                                if (__promotionDiscount.Length > 0)
                                                                                {
                                                                                    if (__promotionDiscount.IndexOf("#") == 0)
                                                                                    {
                                                                                        int __startDiscountPoint = __promotionDiscount.IndexOf(",");

                                                                                        __price = MyLib._myGlobal._decimalPhase(__promotionDiscount.Substring(1, (__startDiscountPoint == -1) ? __promotionDiscount.Length - 1 : __startDiscountPoint));
                                                                                        __priceInfo = MyLib._myGlobal._resource("ราคาโปรโมชั่น") + " " + __price.ToString(this._formatNumber1);
                                                                                        __foundPriceOrDiscount = true;

                                                                                        // เช็คส่วนลด
                                                                                        if (__startDiscountPoint != -1)
                                                                                        {
                                                                                            __discountWord = __promotionDiscount.Substring(__startDiscountPoint, __promotionDiscount.Length - __startDiscountPoint);
                                                                                            __priceInfo = " " + MyLib._myGlobal._resource("ส่วนลดโปรโมชั่น") + " " + __discountWord;
                                                                                            __discountNumber = 3;
                                                                                        }

                                                                                    }
                                                                                    else
                                                                                    {
                                                                                        __discountWord = __promotionDiscount;
                                                                                        __foundPriceOrDiscount = true;
                                                                                        if (__priceInfo.Length > 0)
                                                                                        {
                                                                                            __priceInfo = __priceInfo + " ";
                                                                                        }
                                                                                        __priceInfo = __priceInfo + MyLib._myGlobal._resource("ส่วนลดโปรโมชั่น") + " " + __discountWord;
                                                                                        __discountNumber = 3;
                                                                                    }
                                                                                }
                                                                            }

                                                                            // toe หยิบราคาตาม สมาชิก และทั่วไป
                                                                            //toe if (__foundPriceOrDiscount == false) 
                                                                            //toe {
                                                                            if (__foundPriceOrDiscount == false)
                                                                            {
                                                                                // ปรกติ
                                                                                if (this._memberCode.Length > 0 && __priceMember > 0M && (this._memberCode.Equals(this._posDefaultCust) == false))
                                                                                {
                                                                                    __price = __priceMember;
                                                                                    __foundPriceOrDiscount = true;
                                                                                    __priceInfo = MyLib._myGlobal._resource("ราคาสมาชิก") + " " + __price.ToString(this._formatNumber1);
                                                                                    __price_type = 7;
                                                                                }
                                                                                else
                                                                                    if (__priceNormal > 0M)
                                                                                    {
                                                                                        __price = __priceNormal;
                                                                                        __foundPriceOrDiscount = true;
                                                                                        __priceInfo = MyLib._myGlobal._resource("ราคาปรกติ") + " " + __price.ToString(this._formatNumber1);
                                                                                    }
                                                                            }
                                                                            //toe }
                                                                        }
                                                                        if (__foundPriceOrDiscount == false)
                                                                        {                                                                            
                                                                            if (__getData.Rows.Count > 0)
                                                                            {
                                                                                string __today = MyLib._myGlobal._convertDateToQuery(DateTime.Now);
                                                                                //string __itemCode = __getData.Rows[0][_g.d.ic_inventory_barcode._ic_code].ToString();
                                                                                string __unitCode = __getData.Rows[0][_g.d.ic_inventory_barcode._unit_code].ToString();
                                                                                SMLInventoryControl._findPriceClass __getPrice = new SMLInventoryControl._findPriceClass();
                                                                                SMLInventoryControl._icTransItemGridControl._priceStruct __result = __getPrice._findPriceByItem(__itemCode, __barCode, __unitCode, __qty, this._custCode, this._memberCode, false, "", __today, _g.g._vatTypeEnum.ภาษีรวมใน, 0, 1, 0);
                                                                                __price = __result._price;
                                                                                __price_type = __result._type;
                                                                                __price_stand = __result._stand_price;
                                                                                __discountWord = __result._discountWord;
                                                                                if (__price == 0)
                                                                                {
                                                                                    // เอาราคารวมในมาเพิ่ม vat
                                                                                    __price = MyLib._myGlobal._round(__result._price1 + (__result._price1 * (_g.g._companyProfile._vat_rate / 100M)), 2);
                                                                                }
                                                                            }
                                                                        }
                                                                        */
                                                                            #endregion
                                                                        }

                                                                        if (this._posConfig._use_sound_scan_barcode == 1)
                                                                        {
                                                                            this._playSound(this._posConfig._sound_on_scan_barcode);
                                                                        }

                                                                        // add
                                                                        _posClientItemClass __item = new _posClientItemClass();
                                                                        __item._barCode = __barCode;
                                                                        __item._itemCode = __getData.Rows[0][_g.d.ic_inventory_barcode._ic_code].ToString();
                                                                        __item._itemName = __getData.Rows[0][_g.d.ic_inventory_barcode._description].ToString() + ((extraItemName.Length > 0) ? " " + extraItemName : "");
                                                                        __item._unitCode = __getData.Rows[0][_g.d.ic_inventory_barcode._unit_code].ToString();
                                                                        __item._itemType = (int)MyLib._myGlobal._decimalPhase(__getData.Rows[0]["item_type"].ToString());
                                                                        __item._discountWord = __discountWord;
                                                                        __item._taxType = (int)MyLib._myGlobal._decimalPhase(__getData.Rows[0]["tax_type"].ToString());
                                                                        __item._vat_type = (this._posConfig._pos_vat_type == 1) ? 0 : 1;
                                                                        __item._vatRate = _g.g._companyProfile._vat_rate;
                                                                        __item._havePoint = (((int)MyLib._myGlobal._decimalPhase(__getData.Rows[0][__fieldHavePoint].ToString()) == 0)) ? false : (((int)MyLib._myGlobal._decimalPhase(__getData.Rows[0][_g.d.ic_inventory_barcode._no_point].ToString()) == 1)) ? false : true;
                                                                        __item._qtyLast = __qty;
                                                                        __item._qty = __qty;
                                                                        __item._price = __price;
                                                                        __item._amount = __item._qty * __item._price;
                                                                        __item._standValue = __standValue;
                                                                        __item._divideValue = __divideValue;
                                                                        __item._priceInfo = __priceInfo;
                                                                        __item._discountNumber = __discountNumber;
                                                                        __item._priceDefault = __priceNormal;
                                                                        __item._serialNumber = serialNumber;
                                                                        __item._price_type = __price_type;
                                                                        __item._no_discount = __getData.Rows[0][_g.d.ic_inventory._no_discount].ToString().Equals("1") ? true : false;
                                                                        __item._pos_no_sum = __getData.Rows[0][_g.d.ic_inventory._pos_no_sum].ToString().Equals("1") ? true : false;
                                                                        __item._balanceControl = __balanceControl;

                                                                        // ใส่ราคากลาง
                                                                        __item._price_base = MyLib._myGlobal._decimalPhase(__getData.Rows[0][_g.d.ic_inventory_price_formula._price_0].ToString());

                                                                        // item set
                                                                        __item._ref_guid = __setGuid;
                                                                        __item._set_ref_line = refGuid;
                                                                        __item._item_code_main = icCodeMain;
                                                                        __item._set_ref_qty = setRefQty;
                                                                        __item._set_ref_price = setRefPrice;
                                                                        __item._price_set_ratio = priceSetRatio;
                                                                        if (refGuid.Length > 0)
                                                                        {
                                                                            __item._ref_row = -1;
                                                                        }
                                                                        // toe พิมพ์ใบสั่งจัด

                                                                        if (_g.g._companyProfile._print_packing_pos_order == true && this._isTableCheckOut == false)
                                                                        {
                                                                            __item._kitchen_code = __getData.Rows[0][_g.d.kitchen_master_item._kitchen_code].ToString();

                                                                            if (_g.g._companyProfile._use_order_checker == true)
                                                                            {
                                                                                string __ConformGuid = Guid.NewGuid().ToString();
                                                                                __ConformGuid = __ConformGuid.Substring(0, 18);
                                                                                __item._confirm_guid = __ConformGuid;
                                                                                __item._barcode_checker_print = __getData.Rows[0][_g.d.ic_inventory._barcode_checker_print].ToString().Equals("1") ? true : false;
                                                                                __item._print_per_unit = __getData.Rows[0][_g.d.ic_inventory._print_order_per_unit].ToString().Equals("1") ? true : false;
                                                                            }
                                                                        }

                                                                        // toe check ราคากลาง
                                                                        if (_g.g._companyProfile._ic_price_formula_control)
                                                                        {
                                                                            DataTable __stand_price_table = __myFrameWork._queryShort("select " + _g.d.ic_inventory_price_formula._price_0 + " from " + _g.d.ic_inventory_price_formula._table + " where " + _g.d.ic_inventory_price_formula._ic_code + "=\'" + __getData.Rows[0][_g.d.ic_inventory_barcode._ic_code].ToString() + "\' and " + _g.d.ic_inventory_price_formula._unit_code + "=\'" + __getData.Rows[0][_g.d.ic_inventory_barcode._unit_code].ToString() + "\' and " + _g.d.ic_inventory_price_formula._sale_type + " in (0,1) order by " + _g.d.ic_inventory_price_formula._sale_type + " desc ").Tables[0];
                                                                            if (__stand_price_table.Rows.Count > 0)
                                                                            {
                                                                                __price_stand = MyLib._myGlobal._decimalPhase(__stand_price_table.Rows[0][_g.d.ic_inventory_price_formula._price_0].ToString());
                                                                            }
                                                                        }

                                                                        __item._price_stand = __price_stand;
                                                                        // toe 
                                                                        __item._drink_type = (int)MyLib._myGlobal._decimalPhase(__getData.Rows[0][_g.d.ic_inventory._drink_type].ToString());
                                                                        __item._hidden = (MyLib._myGlobal._decimalPhase(__getData.Rows[0][_g.d.ic_inventory_barcode._hidden_text].ToString()) == 1) ? true : false;

                                                                        // replace remark ขึ้นต้นด้วย #
                                                                        if (__getData.Rows[0][_g.d.ic_inventory._remark].ToString().IndexOf("#") == 0)
                                                                        {
                                                                            __item._replace_remark_qty = true;
                                                                            __item._item_remark = __getData.Rows[0][_g.d.ic_inventory._remark].ToString().Substring(1);
                                                                            __item._item_name_remark = __getData.Rows[0][_g.d.ic_inventory_barcode._description].ToString();
                                                                        }

                                                                        // เช็คขายต่ำกว่าราคากลาง
                                                                        if (_g.g._companyProfile._ic_price_formula_control)
                                                                        {
                                                                            if (this._checkSaleLowStandPrice(((__item._barCode != null && __item._barCode.Length > 0) ? __item._barCode : __item._itemCode), __item._price_stand, __item._price, __item._qty, __item._discountWord))
                                                                            {
                                                                                _sendMessage("clear:textbox,input", null, "");
                                                                                return;
                                                                            }
                                                                        }

                                                                        if (this._isPharmacist || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLPOSMED)
                                                                        {
                                                                            // เพิ่มเติมรายละเอียดยา

                                                                            DataTable __m_information_table = ((DataSet)__data[__drugTable]).Tables[0];
                                                                            string _m_dozen = __m_information_table.Rows[0][_g.d.m_information._dozen].ToString();
                                                                            string _m_times = __m_information_table.Rows[0][_g.d.m_information._times].ToString();
                                                                            string _m_frequency = __m_information_table.Rows[0][_g.d.m_information._frequency].ToString();
                                                                            string _m_remark = __m_information_table.Rows[0][_g.d.m_information._remark].ToString();

                                                                            _sendMessage("update:label,m_dozen", _m_dozen, serialNumber);
                                                                            _sendMessage("update:label,m_times", _m_times, serialNumber);
                                                                            _sendMessage("update:label,m_frequency", _m_frequency, serialNumber);
                                                                            _sendMessage("update:label,m_remark", _m_remark, serialNumber);

                                                                            __item._m_dozen = _m_dozen;
                                                                            __item._m_times = _m_times;
                                                                            __item._m_frequency = _m_frequency;
                                                                            __item._m_warning = _m_remark;

                                                                        }
                                                                        this._itemList.Add(__item);
                                                                        _sendMessage("update:label,price_info", __item._priceInfo, serialNumber);
                                                                        if (this._show_barcode_picture)
                                                                        {
                                                                            _sendMessage("update:image,item_image", __item._barCode, serialNumber);
                                                                        }
                                                                        else
                                                                        {
                                                                            _sendMessage("update:image,item_image", __item._itemCode, serialNumber);
                                                                        }

                                                                        this._writeDisplay(__item._barCode, __item._qty + "x" + __item._price.ToString(this._formatNumber1), "", "");
                                                                        //
                                                                    }


                                                                    //
                                                                    this._addItemToGrid(true, __foundAddr);

                                                                    // กรณีสินค้าชุด ทำต่อ
                                                                    if (__getData.Rows[0][_g.d.ic_inventory._item_type].ToString().Equals("3"))
                                                                    {

                                                                        string __ic_code = __getData.Rows[0][_g.d.ic_inventory_barcode._ic_code].ToString();
                                                                        string __barcode = __getData.Rows[0][_g.d.ic_inventory_barcode._barcode].ToString();
                                                                        string __queryItemSet = "select barcode,ic_code,qty, price," + _g.d.ic_inventory_set_detail._price_ratio + " from ic_inventory_set_detail where ic_set_code = \'" + __ic_code + "\'";

                                                                        __myquery = new StringBuilder();
                                                                        __myquery.Append(MyLib._myGlobal._xmlHeader + "<node>");
                                                                        __myquery.Append(MyLib._myUtil._convertTextToXmlForQuery(__queryItemSet));
                                                                        __myquery.Append("</node>");
                                                                        ArrayList __dataICSetNumber = __myFrameWork._queryListGetData(MyLib._myGlobal._databaseName, __myquery.ToString());
                                                                        DataTable __icSetDataTable = ((DataSet)__dataICSetNumber[0]).Tables[0];

                                                                        for (int __row = 0; __row < __icSetDataTable.Rows.Count; __row++)
                                                                        {
                                                                            this._lastBarcode = "";
                                                                            this._lastItemCode = "";
                                                                            decimal __qtyDetail = MyLib._myGlobal._decimalPhase(__icSetDataTable.Rows[__row][_g.d.ic_inventory_set_detail._qty].ToString()) * __qty; // เอา qty หลัก มา * ด้วย
                                                                            string __iccodeDetail = __icSetDataTable.Rows[__row][_g.d.ic_inventory_set_detail._ic_code].ToString();
                                                                            string __barcodeDetail = __icSetDataTable.Rows[__row][_g.d.ic_inventory_set_detail._barcode].ToString();

                                                                            decimal __setRefPrice = MyLib._myGlobal._decimalPhase(__icSetDataTable.Rows[__row][_g.d.ic_inventory_set_detail._price].ToString());
                                                                            decimal __priceSetRatio = MyLib._myGlobal._decimalPhase(__icSetDataTable.Rows[__row][_g.d.ic_inventory_set_detail._price_ratio].ToString());
                                                                            //this._command("&command&," + __qtyDetail.ToString() + "*" + ((__barcodeDetail.Length > 0) ? __barcodeDetail : __iccodeDetail), "", false, __setGuid);
                                                                            this._command("&command&," + __qtyDetail.ToString() + "*" + ((__barcodeDetail.Length > 0) ? __barcodeDetail : __iccodeDetail), "", false, __setGuid, __ic_code, __qtyDetail, __setRefPrice, __priceSetRatio);
                                                                            if (_g.g._companyProfile._fix_item_set_price)
                                                                            {
                                                                                this._autoInsertItem = true;
                                                                                decimal __itemSetPrice = MyLib._myGlobal._decimalPhase(__icSetDataTable.Rows[__row][_g.d.ic_inventory_set_detail._price].ToString());
                                                                                this._command("&command&,*1*" + __itemSetPrice.ToString(), "");
                                                                                this._autoInsertItem = false;
                                                                            }
                                                                        }
                                                                        break;
                                                                    }
                                                                    //
                                                                    //if (__split.Length > 2)
                                                                    //{
                                                                    //    _sendMessage(__split[2], __message.ToString());
                                                                    //}

                                                                    // ขอยอดรวม (return xml)
                                                                    // string __result = __readMessage("item_grid,a1");
                                                                    // คำนวณยอดรวม (for)
                                                                    // ส่งไปที่ label ยอดรวม __sendMessage("change:label,total_amount",__message);
                                                                    // สั่ง clear text box _sendMessage("clear:textbox,input");
                                                                    #endregion
                                                                }
                                                            }
                                                        }


                                                        #endregion

                                                        // ค้นหาสมาชิก
                                                        if (__isProduct == false)
                                                        {
                                                            __isCustCode = this._findCust(__barCode);

                                                            if (__isCustCode == false)
                                                            {
                                                                __isCustCode = this._findAr(__barCode);
                                                            }

                                                            if (__isCustCode == false)
                                                            {
                                                                __isSaleCode = this._findSale(__barCode);
                                                            }
                                                        }

                                                        bool __isOrderNumber = false;
                                                        if (MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoong || MyLib._myGlobal._isVersionEnum == _myGlobal._versionType.SMLTomYumGoongPro)
                                                        {
                                                            if (__barCode.Trim().Length > 0)
                                                            {
                                                                // check order

                                                                __myquery = new StringBuilder(MyLib._myGlobal._xmlHeader + "<node>");
                                                                // table order
                                                                __myquery.Append(MyLib._myUtil._convertTextToXmlForQuery("select * " +
                                                                    ", (select coalesce(" + _g.d.ic_inventory._drink_type + ", 0) from " + _g.d.ic_inventory._table + " where " + _g.d.ic_inventory._table + "." + _g.d.ic_inventory._code + " = " + _g.d.table_order._table + "." + _g.d.table_order._item_code + ") as " + _g.d.ic_inventory._drink_type +
                                                                    ", (select price from ic_inventory_barcode where ic_inventory_barcode.barcode=table_order.barcode and table_order.unit_code= ic_inventory_barcode.unit_code and ic_inventory_barcode.ic_code = table_order.item_code) as barcode_price_default " +
                                                                    " from " + _g.d.table_order._table +
                                                                    " where ((" + MyLib._myGlobal._addUpper(_g.d.table_order._doc_no) + "=\'" + __barCode.ToString().ToUpper() + "\') or (" + _g.d.table_order._order_number_barcode + " = \'" + __barCode.ToString().ToUpper() + "\')) and " + _g.d.table_order._order_type + "=2 and " + _g.d.table_order._last_status + "=0 "));

                                                                // table order doc // ไม่เข้าใจ
                                                                // ดึงเลขโต๊ะ สมาชิก etc
                                                                __myquery.Append(MyLib._myUtil._convertTextToXmlForQuery("select * " +
                                                                    ",(select " + _g.d.table_master._name_1 + " from " + _g.d.table_master._table + " where " + _g.d.table_master._table + "." + _g.d.table_master._number + "  = " + _g.d.table_order_doc._table + "." + _g.d.table_order_doc._table_number + ") as " + _g.d.table_master._name_1 +
                                                                    " from " + _g.d.table_order_doc._table + " where " + MyLib._myGlobal._addUpper(_g.d.table_order_doc._doc_no) + "=\'" + __barCode.ToString().ToUpper() + "\' or " + MyLib._myGlobal._addUpper(_g.d.table_order_doc._order_number_barcode) + "=\'" + __barCode.ToString().ToUpper() + "\' "));

                                                                __myquery.Append("</node>");

                                                                ArrayList __getDataResult = __myFrameWork._queryListGetData(MyLib._myGlobal._databaseName, __myquery.ToString());
                                                                if (__getDataResult.Count > 0)
                                                                {
                                                                    DataTable __tableOrderDataTable = ((DataSet)__getDataResult[0]).Tables[0];
                                                                    DataTable __tableOrderDocDataTable = ((DataSet)__getDataResult[1]).Tables[0];

                                                                    if (__tableOrderDataTable.Rows.Count > 0)
                                                                    {
                                                                        string __tableCustCode = __tableOrderDocDataTable.Rows[0][_g.d.table_order_doc._cust_code].ToString();
                                                                        this._tableNumberSelect = __tableOrderDocDataTable.Rows[0][_g.d.table_order_doc._table_number].ToString();
                                                                        this._tableNameSelect = __tableOrderDocDataTable.Rows[0][_g.d.table_master._name_1].ToString();

                                                                        // ใส่สมาชิก
                                                                        if (__tableCustCode.Length > 0)
                                                                        {
                                                                            this._command("&command&," + __tableCustCode, "");
                                                                        }


                                                                        string __orderDocNo = __tableOrderDataTable.Rows[0][_g.d.table_order._doc_no].ToString(); ;
                                                                        for (int __row = 0; __row < __tableOrderDataTable.Rows.Count; __row++)
                                                                        {
                                                                            string _qty = ((int)MyLib._myGlobal._decimalPhase(__tableOrderDataTable.Rows[__row][_g.d.table_order._qty].ToString())).ToString();
                                                                            decimal _qty_balance = (decimal)MyLib._myGlobal._decimalPhase(__tableOrderDataTable.Rows[__row][_g.d.table_order._qty_balance].ToString());
                                                                            string _barcode = __tableOrderDataTable.Rows[__row][_g.d.table_order._barcode].ToString();
                                                                            string _item_code = __tableOrderDataTable.Rows[__row][_g.d.table_order._item_code].ToString();
                                                                            string _as_item_name = __tableOrderDataTable.Rows[__row][_g.d.table_order._as_item_name].ToString();
                                                                            decimal _price = MyLib._myGlobal._decimalPhase(__tableOrderDataTable.Rows[__row][_g.d.table_order._price].ToString());
                                                                            decimal __defaultPrice = MyLib._myGlobal._decimalPhase(__tableOrderDataTable.Rows[__row]["barcode_price_default"].ToString());
                                                                            this._lastBarcode = _barcode;
                                                                            if (_qty_balance > 0)
                                                                            {
                                                                                bool __isChangePrice = false;
                                                                                if (_price != __defaultPrice)
                                                                                {
                                                                                    __isChangePrice = true;
                                                                                }

                                                                                this._command("&command&," + _qty_balance.ToString() + "*" + ((_barcode.Length > 0) ? _barcode : _item_code), "", __isChangePrice); // + "@&command&,*1*" + _price.ToString()

                                                                                // check last price ถ้าไม่ตรงกันค่อย แก้ไขราคา
                                                                                if (this._itemList.Count >= 1)
                                                                                {
                                                                                    if (this._itemList[this._itemList.Count - 1]._barCode == _barcode && this._itemList[this._itemList.Count - 1]._priceDefault != _price)
                                                                                    {
                                                                                        this._command("&command&,*1*" + _price.ToString(), "");
                                                                                    }
                                                                                }
                                                                            }

                                                                            if (_as_item_name.Length > 0)
                                                                            {
                                                                                // rename order
                                                                                this._command("&command&,*5*" + _as_item_name, "");
                                                                            }
                                                                        }
                                                                        __isOrderNumber = true;
                                                                        this._orderList.Add(__orderDocNo.ToUpper());
                                                                    }
                                                                }
                                                            }
                                                        }

                                                        if (__isCustCode == false && __isProduct == false && __isSaleCode == false && __isOrderNumber == false && __barCode.Length > 0)
                                                        {
                                                            if (MyLib._myGlobal._programName.ToUpper().Equals("POS-RETAIL"))
                                                            {
                                                                SMLProcess._syncClass __sync = new SMLProcess._syncClass();
                                                                //string __findBarcode = (MyLib._myGlobal._isVersionEnum == MyLib._myGlobal._versionType.SMLColorStore) ? itemCode : barCode;
                                                                if (__sync._findProduct(__barCode))
                                                                {
                                                                    this._command(source, "");
                                                                    __isProduct = true;
                                                                }
                                                            }
                                                        }

                                                        if (__isCustCode == false && __isProduct == false && __isSaleCode == false && __isOrderNumber == false && __barCode.Length > 0)
                                                        {
                                                            if (this._posConfig._use_sound_on_not_found_barcode == 1)
                                                            {
                                                                this._playSound(this._posConfig._sound_on_not_found_barcode);
                                                            }
                                                            MessageBox.Show("ไม่พบรายการ" + " :" + __barCode);
                                                        }
                                                    }
                                                    #endregion
                                                }
                                                break;
                                        }
                                    }
                                }
                            }
                        }
                    }
                    else
                    {
                        string[] __getValue = __source[__sourceLoop].Split('=');
                        if (__getValue.Length == 1)
                        {
                            _sendMessage(__getValue[0].ToString(), "", serialNumber);
                        }
                        if (__getValue.Length == 2)
                        {
                            _sendMessage(__getValue[0].ToString(), __getValue[1].ToString(), serialNumber);
                        }
                    }
                }
            }
            _sendMessage("focus:textbox:input", "", serialNumber);
        }

        #endregion

        #region Pharmacist Method

        /// <summary>
        /// ตรวจสอบ Drug Interaction
        /// </summary>
        /// <param name="itemCode"></param>
        /// <returns>false ไม่ดำเนินการต่อ</returns>
        public bool _checkDrugInteractive(string itemCode)
        {
            bool __result = true;

            StringBuilder __checkQuery = new StringBuilder();
            for (int __row = 0; __row < this._itemProcess.Count; __row++)
            {
                if (__checkQuery.Length > 0)
                {
                    __checkQuery.Append(" or ");
                }

                string __oldItemCode = this._itemProcess[__row]._itemCode;
                __checkQuery.Append(" ( " + _g.d.m_druginteraction._item_code_1 + "=\'" + itemCode + "\' and " + _g.d.m_druginteraction._item_code_2 + "=\'" + __oldItemCode + "\' ) or ( " + _g.d.m_druginteraction._item_code_2 + "=\'" + itemCode + "\' and " + _g.d.m_druginteraction._item_code_1 + "=\'" + __oldItemCode + "\' ) ");
            }

            if (__checkQuery.Length > 0)
            {
                MyLib._myFrameWork __myFrameWork = new _myFrameWork();
                DataSet __CheckResult = __myFrameWork._queryShort("select * from " + _g.d.m_druginteraction._table + " where " + __checkQuery.ToString());
                if (__CheckResult.Tables.Count > 0 && __CheckResult.Tables[0].Rows.Count > 0)
                {
                    string __effectDrugName = __CheckResult.Tables[0].Rows[0][_g.d.m_druginteraction._item_code_1].ToString().Equals(itemCode) ? __CheckResult.Tables[0].Rows[0][_g.d.m_druginteraction._item_code_2].ToString() : __CheckResult.Tables[0].Rows[0][_g.d.m_druginteraction._item_code_1].ToString();

                    if (MessageBox.Show(itemCode + " มีปฏิกริยากับ " + __effectDrugName + " คุณต้องการดำเนินการต่อหรือไม่", "เตือน", MessageBoxButtons.YesNo) == DialogResult.No)
                    {
                        __result = false;
                    }
                }

            }

            return __result;
        }

        // HTML ข้อมูลสุขภาพ
        // conecpt get HTML schema แล้ว replace ค่าลงไป ให้ลูกค้าออกแบบ HTML เอาได้เลย
        public string _yourHealtryInfo(string _custCode, string _htmlSchema)
        {
            // get healthy
            MyLib._myFrameWork __myFrameWork = new _myFrameWork();

            string __query = "select * from " + _g.d.m_yourhealthy._table + " where " + MyLib._myGlobal._addUpper(_g.d.m_yourhealthy._member_id) + " = \'" + _custCode.ToUpper() + "\'";
            DataSet __ds = __myFrameWork._queryShort(__query);
            if (__ds.Tables.Count > 0)
            {

                // get healthydata and replace it
                string __measure_date = __ds.Tables[0].Rows[0][_g.d.m_yourhealthy._measure_date].ToString();
                string __height = __ds.Tables[0].Rows[0][_g.d.m_yourhealthy._high].ToString();
                string __weight = __ds.Tables[0].Rows[0][_g.d.m_yourhealthy._weight].ToString();
                string __presure = __ds.Tables[0].Rows[0][_g.d.m_yourhealthy._pressure].ToString();
                string __body_fat = __ds.Tables[0].Rows[0][_g.d.m_yourhealthy._body_fat].ToString();
                string __ldl = __ds.Tables[0].Rows[0][_g.d.m_yourhealthy._ldl].ToString();
                string __hdl = __ds.Tables[0].Rows[0][_g.d.m_yourhealthy._hdl].ToString();
                string __triglyceride = __ds.Tables[0].Rows[0][_g.d.m_yourhealthy._triglyceride].ToString();
                string __cholesterol = __ds.Tables[0].Rows[0][_g.d.m_yourhealthy._cholesterol].ToString();
                string __kkos = __ds.Tables[0].Rows[0][_g.d.m_yourhealthy._kkos].ToString();
                string __blood_Oxygen = __ds.Tables[0].Rows[0][_g.d.m_yourhealthy._blood_Oxygen].ToString();
                string __bmi = __ds.Tables[0].Rows[0][_g.d.m_yourhealthy._bmi].ToString();
                string __blood_sugar = __ds.Tables[0].Rows[0][_g.d.m_yourhealthy._blood_sugar].ToString();
                string __bun = __ds.Tables[0].Rows[0][_g.d.m_yourhealthy._bun].ToString();
                string __creatinine = __ds.Tables[0].Rows[0][_g.d.m_yourhealthy._creatinine].ToString();
                string __remark = __ds.Tables[0].Rows[0][_g.d.m_yourhealthy._remark].ToString();
                string __ar_name = __ds.Tables[0].Rows[0][_g.d.m_yourhealthy._ar_name].ToString();

            }

            string __html = @"
<head>
<style type='text/css'>
body {
	font-family: Tahoma,Arial, Helvetica, sans-serif;
    font-size:12px;
}
</style>
</head>
<body>
Healthy " + _custCode + @"
</body>";

            return __html;
        }

        #endregion

        #region Event ที่ทำงานตลอด

        private void _TimerDate_Tick(object sender, EventArgs e)
        {
            foreach (control._posLabelShadow __label in __dateTimeLabel)
            {
                string __dateText = (__label.Tag != null && !__label.Tag.ToString().Equals("")) ? DateTime.Now.ToString(__label.Tag.ToString()) : DateTime.Now.ToString();
                __label.Text = __dateText;
            }
        }

        SMLERPControl._icBalanceForm _itemBalanceForm;
        protected override bool ProcessCmdKey(ref Message msg, Keys keyData)
        {

            if (keyData == Keys.F11)
            {
                return true;
            }
            switch (keyData)
            {
                case Keys.Control | Keys.R:
                    {
                        string __computerName = SystemInformation.ComputerName.ToLower();
                        if (__computerName.IndexOf("toe-pc") != -1)
                        {
                            this._addItemToGrid(false, -1);
                        }
                    }
                    break;
                case Keys.Control | Keys.Insert:
                    {
                        string __computerName = SystemInformation.ComputerName.ToLower();
                        if (__computerName.IndexOf("toe-pc") != -1)
                        {
                            //this._command()
                            this._command("&command&,9509076990056", "");

                            //this._command("&command&,EMB00010194", "");

                            this._command("&command&,2200168221682", "");
                            this._command("&command&,8850830515821", "");
                            this._command("&command&,8850830511045", "");
                            this._command("&command&,8850830511007", "");

                            // premium
                            this._command("&command&,8850830514084", "");
                            this._command("&command&,8850830700630", "");

                        }
                    }
                    break;
                case Keys.Control | Keys.D2:
                    {
                        // add level form
                        if (this._itemBalanceForm == null)
                        {
                            this._itemBalanceForm = new SMLERPControl._icBalanceForm();
                            DockableFormInfo __form0 = this._container.Add(this._itemBalanceForm, Crom.Controls.Docking.zAllowedDock.All, Guid.NewGuid());
                            __form0.ShowCloseButton = true;
                            __form0.ShowContextMenuButton = false;
                            __form0.Disposed += (s1, e1) =>
                            {
                                try
                                {
                                    this._itemBalanceForm.Dispose();
                                }
                                catch
                                {
                                }
                                this._itemBalanceForm = null;
                            };
                            if (this._lastItemCode.Length > 0)
                            {
                                this._itemBalanceForm._load(this._lastItemCode);
                            }
                        }
                    }
                    break;
                case Keys.Control | Keys.D1:
                    {
                        // แสดงประวัติการขาย
                        Form __form = new Form();
                        //
                        __form.Text = "ประวัติการขาย" + " : " + this._custName + "(" + this._custCode + ")";
                        SMLERPSO._soInvoice __control = new SMLERPSO._soInvoice(__form.Text, _g.d.ic_trans._cust_code + "=\'" + this._custCode + "\' ", true);
                        __control.Dock = DockStyle.Fill;
                        __form.Controls.Add(__control);
                        __form.WindowState = FormWindowState.Maximized;
                        __form.ShowDialog();
                        return true;

                    }
                    break;
                case Keys.Control | Keys.D9:
                    {
                        // แสดงประวัติการขาย จาก Datacenter
                        if (_g.g._companyProfile._activeSync == true)
                        {
                            Form __form = new Form();
                            //
                            __form.Text = "ประวัติการขาย" + " : " + this._custName + "(" + this._custCode + ")";
                            SMLERPSO._soInvoiceCenter __control = new SMLERPSO._soInvoiceCenter(this._custCode, this._memberCode);
                            __control.Dock = DockStyle.Fill;
                            __form.Controls.Add(__control);
                            __form.WindowState = FormWindowState.Maximized;
                            __form.ShowDialog();

                        }
                        return true;
                    }
                    break;
            }
            return base.ProcessCmdKey(ref msg, keyData);
        }

        #endregion

        #region TomyumKoong Method Only

        /// <summary>
        /// ดึงรายการสั่งอาหาร ลงไปใน grid
        /// </summary>
        /// <param name="__tableNumber"></param>
        /// <param name="__tableName"></param>
        public void _getTableOrderForPay(SMLPOSControl._tableSearchLevelMenuControl table)
        {
            _getTableOrderForPay(table, true);
        }

        public void _setTableSelect(SMLPOSControl._tableSearchLevelMenuControl table)
        {
            this._table = table;
            this._tableNumberSelect = table._tableNumber;
            this._tableNameSelect = table._tableName;
            this._trans_guid = table._transGuidNumber;
        }

        public void _getTableOrderForPay(SMLPOSControl._tableSearchLevelMenuControl table, Boolean isCloseTable)
        {
            this._table = table;
            this._tableNumberSelect = table._tableNumber;
            this._tableNameSelect = table._tableName;
            this._trans_guid = table._transGuidNumber;

            // clear รายการใน grid ก่อน
            this._itemProcess = new List<_posClientItemClass>();
            this._itemList = new List<_posClientItemClass>();
            _sendMessage("clear:item_grid,sale", "", "");
            _sendMessage("show_total:item_grid,sale", "", "");
            _sendMessage("update:label,table_label", this._tableNumberSelect + "/" + this._tableNameSelect, "");

            // จับรายการอาหารใส่
            MyLib._myFrameWork __fw = new _myFrameWork();
            StringBuilder __myQuery = new StringBuilder(MyLib._myGlobal._xmlHeader + "<node>");

            string __tableOrderQuery = "select * " +
                ", (select coalesce(" + _g.d.ic_inventory._drink_type + ", 0) from " + _g.d.ic_inventory._table + " where " + _g.d.ic_inventory._table + "." + _g.d.ic_inventory._code + " = " + _g.d.table_order._table + "." + _g.d.table_order._item_code + ") as " + _g.d.ic_inventory._drink_type +
                ",(select price from ic_inventory_barcode where ic_inventory_barcode.barcode=table_order.barcode and table_order.unit_code= ic_inventory_barcode.unit_code and ic_inventory_barcode.ic_code = table_order.item_code) as barcode_price_default " +
                ", (select " + _g.d.ic_inventory._name_1 + " from ic_inventory where ic_inventory.code = table_order.item_code ) as " + _g.d.table_order._item_name +
                ", (select " + _g.d.ic_inventory._name_eng_1 + " from ic_inventory where ic_inventory.code = table_order.item_code ) as " + _g.d.ic_inventory._name_eng_1 +
                ", (select " + _g.d.ic_unit._name_2 + " from ic_inventory where ic_inventory.code = table_order.item_code ) as unit_name_eng " +
                ", (select " + _g.d.ic_inventory._item_type + " from ic_inventory where ic_inventory.code = table_order.item_code ) as " + _g.d.ic_inventory._item_type +
                ", (select " + _g.d.ic_inventory._tax_type + " from ic_inventory where ic_inventory.code = table_order.item_code ) as " + _g.d.ic_inventory._tax_type +
                ", (select " + _g.d.ic_inventory_detail._have_point + " from " + _g.d.ic_inventory_detail._table + " where " + _g.d.ic_inventory_detail._table + "." + _g.d.ic_inventory_detail._ic_code + " = table_order.item_code ) as " + _g.d.ic_inventory_detail._have_point +
                ", (select " + _g.d.ic_unit_use._stand_value + " from " + _g.d.ic_unit_use._table + " where ic_unit_use.code = table_order.unit_code and ic_unit_use.ic_code = table_order.item_code ) as " + _g.d.ic_unit_use._stand_value +
                ", (select " + _g.d.ic_unit_use._divide_value + " from " + _g.d.ic_unit_use._table + " where ic_unit_use.code = table_order.unit_code and ic_unit_use.ic_code = table_order.item_code ) as " + _g.d.ic_unit_use._divide_value +
                ", (select " + _g.d.ic_inventory_barcode._hidden_text + " from " + _g.d.ic_inventory_barcode._table + " where ic_inventory_barcode.barcode = table_order.barcode ) as " + _g.d.ic_inventory_barcode._hidden_text +
                ", (select " + _g.d.ic_inventory._no_discount + " from ic_inventory where ic_inventory.code = table_order.item_code ) as " + _g.d.ic_inventory._no_discount +
                ", (select " + _g.d.ic_inventory._pos_no_sum + " from ic_inventory where ic_inventory.code = table_order.item_code ) as " + _g.d.ic_inventory._pos_no_sum +

                ",(select " + _g.d.ic_inventory_barcode._price_member + " from ic_inventory_barcode where ic_inventory_barcode.barcode=table_order.barcode and table_order.unit_code= ic_inventory_barcode.unit_code and ic_inventory_barcode.ic_code = table_order.item_code) as " + _g.d.ic_inventory_barcode._price_member +

                " from " + _g.d.table_order._table +
                " where " + _g.d.table_order._table_number + " = \'" + this._table._tableNumber + "\' and " + _g.d.table_order._last_status + "" + ((isCloseTable == true) ? " = 2 " : " in (0,1) ") +
                " order by (select coalesce(" + _g.d.ic_inventory._drink_type + ", 0) from " + _g.d.ic_inventory._table + " where " + _g.d.ic_inventory._table + "." + _g.d.ic_inventory._code + " = " + _g.d.table_order._table + "." + _g.d.table_order._item_code + "), doc_no ";

            __myQuery.Append(MyLib._myUtil._convertTextToXmlForQuery(__tableOrderQuery));

            string __tableTransQuery = "select *" +
                ", (select " + _g.d.table_master._last_member_code + " from " + _g.d.table_master._table + " where " + _g.d.table_master._number + "=" + _g.d.table_trans._table_number + " and " + _g.d.table_master._trans_guid + "=" + _g.d.table_trans._trans_guid + " ) as " + _g.d.table_master._last_member_code +
                ", (select " + _g.d.table_master._last_discount + " from " + _g.d.table_master._table + " where " + _g.d.table_master._number + "=" + _g.d.table_trans._table_number + " and " + _g.d.table_master._trans_guid + "=" + _g.d.table_trans._trans_guid + " ) as " + _g.d.table_master._last_discount +
                ", (select " + _g.d.table_master._last_service_charge + " from " + _g.d.table_master._table + " where " + _g.d.table_master._number + "=" + _g.d.table_trans._table_number + " and " + _g.d.table_master._trans_guid + "=" + _g.d.table_trans._trans_guid + " ) as " + _g.d.table_master._last_service_charge +
                " from " + _g.d.table_trans._table + " where " + _g.d.table_trans._trans_guid + " = (select " + _g.d.table_master._trans_guid + " from " + _g.d.table_master._table + " where " + _g.d.table_master._number + "= \'" + this._table._tableNumber + "\' and " + _g.d.table_master._status + "" + ((isCloseTable == true) ? " = 2 " : " in (0,1) ") + " ) and " + _g.d.table_trans._table_number + " = \'" + this._table._tableNumber + "\'";
            __myQuery.Append(MyLib._myUtil._convertTextToXmlForQuery(__tableTransQuery));

            // query ดึงราคา สำหรับ process ใหม่
            string __dateCompare = "\'" + DateTime.Now.ToString(_dateFormat, new CultureInfo("en-US")) + "\'";
            string __queryBarcodePrice = "select " + _g.d.ic_inventory_barcode_price._discount_word + "," + _g.d.ic_inventory_barcode_price._discount_type + "," + _g.d.ic_inventory_barcode_price._barcode + " from " +
                                                        _g.d.ic_inventory_barcode_price._table + " where " +
                                                        " exists (select barcode from  table_order where table_order.table_number = \'" + this._table._tableNumber + "\' and last_status in (0,1) and ( table_order.qty between ic_inventory_barcode_price.qty_begin and ic_inventory_barcode_price.qty_end ) and ic_inventory_barcode_price.barcode=table_order.barcode) " +
                                                        " and " + __dateCompare + " between " + _g.d.ic_inventory_barcode_price._date_begin + " and " + _g.d.ic_inventory_barcode_price._date_end +
                                                        " and " + _g.d.ic_inventory_barcode_price._status + "=1 " +
                                                        " and ((coalesce(" + _g.d.ic_inventory_barcode_price._lock_discount + ", 0)=0) or (coalesce(" + _g.d.ic_inventory_barcode_price._lock_discount + ", 0)=1 " + " and " + _g.d.ic_inventory_barcode_price._lock_code_list + " like '%" + this._posConfig._posid + "%' ))" +
                                                        "  order by " + _g.d.ic_inventory_barcode_price._discount_type + "," + _g.d.ic_inventory_barcode_price._priority;

            __myQuery.Append(MyLib._myUtil._convertTextToXmlForQuery(__queryBarcodePrice));

            __myQuery.Append("</node>");

            String __debugQuery = __myQuery.ToString();
            ArrayList __result = __fw._queryListGetData(MyLib._myGlobal._databaseName, __myQuery.ToString());

            DataTable __ds = ((DataSet)__result[0]).Tables[0]; //__fw._queryShort(_query).Tables[0];
            DataTable __dsTableTrans = ((DataSet)__result[1]).Tables[0];

            this._autoInsertItem = true;
            string __tableCustCode = "";
            string __tableFoodDiscount = "";
            string __tableTotalDiscount = "";
            string __transServiceCharge = "";

            string __tablemasterLastDiscount = "";
            string __tableMasterLastServiceCharge = "";

            bool __isPromotionProcess = true;
            string __trans_cust_code = "";
            // if (__dsTableTrans.Rows.Count > 0)
            if (__ds.Rows.Count > 0)
            {
                if (this._isScreenCloseTable == false && __dsTableTrans.Rows.Count > 0)
                {
                    __tableCustCode = __dsTableTrans.Rows[0][_g.d.table_trans._cust_code].ToString();
                    __tableFoodDiscount = __dsTableTrans.Rows[0][_g.d.table_trans._food_discount].ToString();
                    __tableTotalDiscount = __dsTableTrans.Rows[0][_g.d.table_trans._total_discount].ToString();
                    __isPromotionProcess = MyLib._myGlobal._decimalPhase(__dsTableTrans.Rows[0][_g.d.table_trans._ispromotion_process].ToString()).Equals(1) ? false : true;
                    __transServiceCharge = __dsTableTrans.Rows[0][_g.d.table_trans._service_charge].ToString();

                    __trans_cust_code = __dsTableTrans.Rows[0][_g.d.table_master._last_member_code].ToString();
                    __tablemasterLastDiscount = __dsTableTrans.Rows[0][_g.d.table_master._last_discount].ToString();
                    __tableMasterLastServiceCharge = __dsTableTrans.Rows[0][_g.d.table_master._last_service_charge].ToString();
                }

                // ใส่สมาชิก จาก android 
                if (__trans_cust_code.Length > 0)
                {
                    this._command("&command&," + __trans_cust_code, "");
                }

                // ใส่สมาชิก
                if (__tableCustCode.Length > 0)
                {
                    this._command("&command&," + __tableCustCode, "");
                }

                if (__dsTableTrans.Rows.Count > 0)
                {
                    this._openTableTime = __dsTableTrans.Rows[0][_g.d.table_trans._open_doc_time].ToString();
                    this._closeTableTime = __dsTableTrans.Rows[0][_g.d.table_trans._close_doc_time].ToString();
                }

                for (int __i = 0; __i < __ds.Rows.Count; __i++)
                {
                    // process ใหม่

                    string __nameEng = __ds.Rows[__i][_g.d.ic_inventory._name_eng_1].ToString();
                    string __unitEng = __ds.Rows[__i]["unit_name_eng"].ToString();

                    string __item_code = __ds.Rows[__i][_g.d.table_order._item_code].ToString();
                    string __barcode = __ds.Rows[__i][_g.d.table_order._barcode].ToString();
                    string __itemName = __ds.Rows[__i][_g.d.table_order._item_name].ToString();
                    string __as_item_name = __ds.Rows[__i][_g.d.table_order._as_item_name].ToString();

                    decimal __qty = ((decimal)MyLib._myGlobal._decimalPhase(__ds.Rows[__i][_g.d.table_order._qty].ToString()));

                    decimal __qty_balance = (decimal)MyLib._myGlobal._decimalPhase(__ds.Rows[__i][_g.d.table_order._qty_balance].ToString());
                    decimal __price = MyLib._myGlobal._decimalPhase(__ds.Rows[__i][_g.d.table_order._price].ToString());
                    decimal __defaultPrice = MyLib._myGlobal._decimalPhase(__ds.Rows[__i]["barcode_price_default"].ToString());
                    decimal __priceMember = MyLib._myGlobal._decimalPhase(__ds.Rows[__i][_g.d.ic_inventory_barcode._price_member].ToString());

                    string __unitCode = __ds.Rows[__i][_g.d.table_order._unit_code].ToString();
                    bool __pos_no_sum = __ds.Rows[__i][_g.d.ic_inventory._pos_no_sum].ToString().Equals("1") ? true : false;
                    string __itemRemark = (this._isScreenCloseTable && this._orderDeviceConfig._remark_print) ? __ds.Rows[__i][_g.d.table_order._remark].ToString() : "";

                    // toe รวมจำนวน
                    Boolean __found = false;
                    int __foundAddr = -1;
                    for (int __row = 0; __row < this._itemList.Count; __row++)
                    {
                        if (this._itemList[__row]._pos_no_sum == false && __barcode.Equals(this._itemList[__row]._barCode) && this._itemList[__row]._price == __price && this._itemList[__row]._isChangePrice == 0 && __as_item_name.Length == 0)
                        {
                            __found = true;
                            __foundAddr = __row;

                            this._itemList[__row]._qtyLast = __qty_balance;
                            this._itemList[__row]._qty += __qty_balance;

                            this._itemList[__row]._amount = this._itemList[__row]._qty * this._itemList[__row]._price;

                        }
                    }

                    if (__found == false)
                    {
                        if (__qty_balance > 0)
                        {
                            _posClientItemClass __item = new _posClientItemClass();
                            __item._barCode = __barcode;
                            __item._itemCode = __item_code;
                            __item._itemName = (__as_item_name.Length > 0) ? __as_item_name : __itemName;
                            __item._itemNameEng = __nameEng;
                            __item._unitCodeEng = __unitEng;

                            __item._unitCode = __unitCode;
                            __item._itemType = (int)MyLib._myGlobal._decimalPhase(__ds.Rows[__i][_g.d.ic_inventory._item_type].ToString());
                            __item._taxType = (int)MyLib._myGlobal._decimalPhase(__ds.Rows[__i][_g.d.ic_inventory._tax_type].ToString());

                            __item._vat_type = (this._posConfig._pos_vat_type == 1) ? 0 : 1;

                            __item._vatRate = _g.g._companyProfile._vat_rate;
                            __item._havePoint = (((int)MyLib._myGlobal._decimalPhase(__ds.Rows[__i][_g.d.ic_inventory_detail._have_point].ToString()) == 0)) ? false : true;

                            __item._standValue = (int)MyLib._myGlobal._decimalPhase(__ds.Rows[__i][_g.d.ic_unit_use._stand_value].ToString());
                            __item._divideValue = (int)MyLib._myGlobal._decimalPhase(__ds.Rows[__i][_g.d.ic_unit_use._divide_value].ToString());

                            __item._no_discount = __ds.Rows[__i][_g.d.ic_inventory._no_discount].ToString().Equals("1") ? true : false;
                            __item._pos_no_sum = __pos_no_sum;

                            __item._drink_type = (int)MyLib._myGlobal._decimalPhase(__ds.Rows[__i][_g.d.ic_inventory._drink_type].ToString());
                            __item._hidden = (MyLib._myGlobal._decimalPhase(__ds.Rows[__i][_g.d.ic_inventory_barcode._hidden_text].ToString()) == 1) ? true : false;

                            // หาราคา
                            __item._qty = __qty_balance;

                            if (_memberCode.Length > 0 && __priceMember > 0M && (_memberCode.Equals(_posDefaultCust) == false))
                            {
                                __item._price = __priceMember;
                                __item._price_type = 7;
                            }
                            else
                            {
                                __item._price = __price;
                            }
                            __item._amount = __item._qty * __item._price;

                            /*__item._priceInfo = __priceInfo;
                            __item._discountWord = __discountWord;
                            __item._discountNumber = __discountNumber;
                            __item._priceDefault = __priceNormal;
                            __item._price_type = __price_type;
                            */
                            //__item._qtyLast = __qty;
                            // ใส่ราคากลาง
                            /*__item._price_base = MyLib._myGlobal._decimalPhase(__getData.Rows[0][_g.d.ic_inventory_price_formula._price_0].ToString());*/

                            // item set
                            /*__item._ref_guid = __setGuid;
                            __item._set_ref_line = refGuid;
                            __item._item_code_main = icCodeMain;
                            __item._set_ref_qty = setRefQty;
                            __item._set_ref_price = setRefPrice;
                            __item._price_set_ratio = priceSetRatio;*/

                            /*if (refGuid.Length > 0)
                            {
                                __item._ref_row = -1;
                            }*/
                            // __item._price_stand = __price_stand;


                            this._itemList.Add(__item);

                        }
                    }



                    // process เดิม
                    /*
                    string _qty = ((int)MyLib._myGlobal._decimalPhase(__ds.Rows[__i][_g.d.table_order._qty].ToString())).ToString();
                    decimal _qty_balance = (decimal)MyLib._myGlobal._decimalPhase(__ds.Rows[__i][_g.d.table_order._qty_balance].ToString());
                    string _barcode = __ds.Rows[__i][_g.d.table_order._barcode].ToString();
                    string _item_code = __ds.Rows[__i][_g.d.table_order._item_code].ToString();
                    string _as_item_name = __ds.Rows[__i][_g.d.table_order._as_item_name].ToString();
                    decimal _price = MyLib._myGlobal._decimalPhase(__ds.Rows[__i][_g.d.table_order._price].ToString());
                    decimal __defaultPrice = MyLib._myGlobal._decimalPhase(__ds.Rows[__i]["barcode_price_default"].ToString());
                    this._lastBarcode = _barcode;

                    string __itemRemark = (this._isScreenCloseTable && this._orderDeviceConfig._remark_print) ? __ds.Rows[__i][_g.d.table_order._remark].ToString() : "";
                    if (_qty_balance > 0)
                    {
                        bool __isChangePrice = false;
                        if (_price != __defaultPrice)
                        {
                            __isChangePrice = true;
                        }

                        this._command("&command&," + _qty_balance.ToString() + "*" + ((_barcode.Length > 0) ? _barcode : _item_code), "", __isChangePrice, "", "", 0m, 0m, 0m, __itemRemark); // + "@&command&,*1*" + _price.ToString()

                        // check last price ถ้าไม่ตรงกันค่อย แก้ไขราคา
                        if (this._itemList.Count >= 1)
                        {
                            if (this._itemList[this._itemList.Count - 1]._barCode == _barcode && this._itemList[this._itemList.Count - 1]._priceDefault != _price)
                            {
                                this._command("&command&,*1*" + _price.ToString(), "");
                            }
                        }
                    }

                    if (_as_item_name.Length > 0)
                    {
                        // rename order
                        this._command("&command&,*5*" + _as_item_name, "");
                    }
                    */
                }
                this._addItemToGrid(true, -1);


                // service charge จาก android
                if (__tableMasterLastServiceCharge.Length > 0)
                {
                    this._command("f8@" + __tableMasterLastServiceCharge, "");
                }

                // service charge
                if (__transServiceCharge.Length > 0)
                {
                    this._command("f8@" + __transServiceCharge, "");
                }

                // ส่วนลดอาหารจาก android
                if (__tablemasterLastDiscount.Length > 0)
                {
                    this._command("f7@" + __tablemasterLastDiscount, "");
                }

                // ส่วนลดอาหาร
                if (__tableFoodDiscount.Length > 0)
                {
                    this._command("f7@" + __tableFoodDiscount, "");
                }

                // promotion process
                if (__isPromotionProcess == false)
                {
                    this._command("&command&,*10", "");
                }

                // ลดท้ายบิล
                if (__tableTotalDiscount.Length > 0)
                {
                    this._command("&command&,*9*" + __tableTotalDiscount, "");
                }

                this._autoInsertItem = false;

                _sendMessage("update:label,status", "", "");
            }
            else
            {
                MessageBox.Show("ไม่พบรายการ " + this._tableNumberSelect);
            }
        }

        /// <summary>
        ///  get จอรายการที่จะคิดเงิน
        /// </summary>
        void _setPrePayScreen()
        {
            //if (File.Exists("postableclose.xml"))
            //{
            //    Stream __readFileStream = File.OpenRead("postableclose.xml");
            //    XmlSerializer __xs = new XmlSerializer(typeof(SMLPOSControl._designer._posDesignXML));
            //    this._designXML = (SMLPOSControl._designer._posDesignXML)__xs.Deserialize(__readFileStream);

            //    // set screen pos from xml
            //    //_setPosDesignXML(__xml);
            //    __readFileStream.Close();
            //    //-- โหลดจอ
            //    //this._designXML = __designObject;
            //}

            this._designXML = (SMLPOSControl._designer._posDesignXML)MyLib._myGlobal._objectFromXml(global::SMLPosClient.Properties.Resources.postableclose, typeof(SMLPOSControl._designer._posDesignXML));


            // โหลด order device config
            string __configFilePath = string.Format(MyLib._myGlobal._smlConfigFile + "{3}-{0}-{1}-{2}.xml", MyLib._myGlobal._encapeStringForFilePath(MyLib._myGlobal._getFirstWebServiceServer), MyLib._myGlobal._providerCode, MyLib._myGlobal._databaseName, SMLPOSControl._orderdeviceConfig._saveOrderDeviceConfigFileName);

            try
            {
                TextReader readFile = new StreamReader(__configFilePath.ToLower());
                XmlSerializer __xsLoad = new XmlSerializer(typeof(SMLPOSControl._orderDeviceXMLConfig));
                this._orderDeviceConfig = (SMLPOSControl._orderDeviceXMLConfig)__xsLoad.Deserialize(readFile);
                readFile.Close();
            }
            catch
            {
                this._orderDeviceConfig = new SMLPOSControl._orderDeviceXMLConfig();
            }

            this._fontHeaderName = this._orderDeviceConfig._pos_slip_header_fontname;
            this._fontHeaderSize = this._orderDeviceConfig._pos_slip_header_fontsize;
            this._fontDetailName = this._orderDeviceConfig._pos_slip_detail_fontname;
            this._fontDetailSize = this._orderDeviceConfig._pos_slip_detail_fontsize;
            this._fontFooterName = this._orderDeviceConfig._pos_slip_footer_fontname;
            this._fontFooterSize = this._orderDeviceConfig._pos_slip_footer_fontsize;

            // load close form number
            MyLib._myFrameWork __myFrameWork = new _myFrameWork();
            DataSet __result = __myFrameWork._queryShort("select * from " + _g.d.order_device_id._table + " where " + _g.d.order_device_id._device_id + "='" + this._orderDeviceConfig._device_id + "'");
            if (__result.Tables.Count > 0 && __result.Tables[0].Rows.Count > 0)
            {
                this._closeTableSlipNumber = (int)MyLib._myGlobal._decimalPhase(__result.Tables[0].Rows[0][_g.d.order_device_id._close_form_number].ToString());
                this._posConfigNumber = (int)MyLib._myGlobal._decimalPhase(__result.Tables[0].Rows[0][_g.d.order_device_id._pos_config_number].ToString());

            }

            this._loadPOSGlobalConfig();
        }

        #endregion
    }

    #region POS Enum And Object

    public enum _posClientObjectType
    {
        Label,
        TextBox,
        Grid,
        Button,
        Image,
        HTML
    }

    public class _processDepositMoney
    {
        public void _run()
        {
            try
            {
                MyLib._myFrameWork __myFrameWork = new _myFrameWork();
                StringBuilder __query = new StringBuilder(MyLib._myGlobal._xmlHeader + "<node>");
                SMLProcess._docFlowThread __process = new SMLProcess._docFlowThread(_g.g._transControlTypeEnum.ขาย_ขายสินค้าและบริการ, "", "");
                __query.Append(__process._advanceFlowQueryList());
                __query.Append("</node>");

                string __queryString = __query.ToString();
                string __queryResult = __myFrameWork._queryList(MyLib._myGlobal._databaseName, __queryString);

            }
            catch
            {
            }
        }
    }

    public class _processStockThread
    {
        public string _itemList = "";

        public void _run()
        {
            try
            {
                SMLERPGlobal._smlFrameWork __smlFrameWork = new SMLERPGlobal._smlFrameWork();
                __smlFrameWork._process_stock_balance(MyLib._myGlobal._databaseName, _itemList, _g.g._transFlagGlobal._transFlag(_g.g._transControlTypeEnum.ขาย_ขายสินค้าและบริการ).ToString());
            }
            catch
            {
            }
        }
    }

    public class _processSerialNumberThread
    {
        public void _run()
        {
            try
            {
                MyLib._myFrameWork __myFrameWork = new _myFrameWork();
                StringBuilder __query = new StringBuilder(MyLib._myGlobal._xmlHeader + "<node>");
                SMLProcess._docFlowThread __flow = new SMLProcess._docFlowThread(_g.g._transControlTypeEnum.ขาย_ขายสินค้าและบริการ, "", "");
                __query.Append(__flow._serialNumberQueryList());
                __query.Append("</node>");

                string __queryString = __query.ToString();
                string __queryResult = __myFrameWork._queryList(MyLib._myGlobal._databaseName, __queryString);

            }
            catch
            {
            }
        }
    }

    public class _promotionResultClass
    {
        public decimal _count = 0;
        public string _promotionCode = "";
        public string _promotionName = "";
        public string _itemCode = "";
        public decimal _qty = 0;
        public decimal _price = 0;
        public decimal _discount = 0;
        public decimal _amount = 0;

        /// <summary>ประเภทเครื่องดิ่ม</summary>
        public int _drink_type = 0;

        // toe
        /// <summary>มูลค่าสินค้าที่ไม่ลด</summary>
        public decimal _no_discount_amount = 0M;
        public decimal _noPointAmount = 0M;
    }

    public class _posClientItemClass
    {
        public string _barCode = "";
        public string _itemCode = "";
        public string _itemName = "";
        public string _itemNameEng = "";

        public string _unitCode = "";
        public string _unitCodeEng = "";
        /// <summary>จำนวนคงเหลือ Promotion (ปรับหน่วยอัตโนมัติ)</summary>
        public decimal _promotion_qty_balance = 0;

        /// <summary>จำนวนคงเหลือ Promotion (ไม่ปรับหน่วย)</summary>
        public decimal _promotion_qty_balance_unit = 0;
        /// <summary>จำนวนเงินคงเหลือ Promotion</summary>
        public decimal _promotionAmount = 0M;


        /// <summary>จำนวน</summary>
        public decimal _qty = 0M;
        /// <summary>
        /// จำนวนที่ป้อนล่าสุด
        /// </summary>
        public decimal _qtyLast = 0M;
        /// <summary>จำนวน</summary>
        public decimal _price = 0M;
        public decimal _price_stand = 0M;
        public string _discountWord = "";
        public decimal _discount = 0M;
        public decimal _amount = 0M;
        /// <summary>
        /// 0=มีภาษี,1=ยกเว้นภาษี
        /// </summary>
        public int _taxType = 0;

        /// <summary>
        /// ประเภทภาษี (0=แยกนอก,1=รวมใน,2=อัตรา 0)
        /// </summary>
        public int _vat_type = 1;

        public decimal _vatRate = 0;
        public bool _havePoint = false;
        public int _itemType = 0;
        public decimal _standValue = 0M;
        public decimal _divideValue = 0M;
        public string _priceInfo = "";
        public int _discountNumber = 0;
        public int _isChangePrice = 0;
        public int _isChangeDiscount = 0;
        /// <summary>
        /// ประเภทราคา  -1=Null,1=ราคาทั่วไป,2=ราคาตามกลุ่มลูกค้า,3=ราคาตามกลุ่มสินค้า,5=ราคาตาม Barcode,6=ราคาตามสูตร,7=ราคาสมาชิก
        /// </summary>
        public int _price_type = -1;
        public decimal _priceDefault = 0;
        /// <summary>
        /// มูลค่าสินค้าไม่รวมภาษี
        /// </summary>
        public decimal _sumAmountExcludeVat
        {
            get
            {
                if (this._taxType == 0 && this._vat_type == 1)
                {
                    // มีภาษี
                    decimal __totalVatValue = MyLib._myGlobal._round((this._amount * this._vatRate) / (this._vatRate + 100.0M), 2);
                    decimal __result = this._amount - __totalVatValue;
                    return __result;
                }
                return this._amount;
            }
        }
        /// <summary>
        /// มูลค่าภาษี
        /// </summary>
        public decimal _totalVatValue
        {
            get
            {
                if (this._taxType == 0)
                {
                    // มีภาษี
                    decimal __result = MyLib._myGlobal._round((this._amount * this._vatRate) / (this._vatRate + 100.0M), 2);
                    return __result;
                }
                return 0M;
            }
        }

        // drug 
        /// <summary>ขนาดและวิธีใช้</summary>
        public string _m_dozen = "";
        /// <summary>เวลาที่ใช้</summary>
        public string _m_times = "";
        /// <summary>ช่วงเวลาที่ใช้</summary>
        public string _m_frequency = "";
        /// <summary>คำเตือน</summary>
        public string _m_warning = "";
        /// <summary>หมายเหตุ</summary>
        public string _m_remark = "";
        /// <summary>ซ่อน</summary>
        public bool _hidden = false;
        /// <summary>หมายเลขเครื่อง</summary>
        public string _serialNumber = "";
        /// <summary>ประเภทเครื่องดิ่ม</summary>
        public int _drink_type = 0;
        // กลุ่ม
        public int _groupNumber = 0;
        /// <summary>เป็นรายการ promotion</summary>
        public bool _isPromotionProduct = false;
        public string _promotionCode = "";
        public decimal _no_discount_amount = 0M;
        /// <summary>ราคากลาง</summary>
        public decimal _price_base = 0M;
        /// <summary>เป็นสินค้าไม่ลดราคา</summary>
        public bool _no_discount = false;

        public string _kitchen_code = "";
        public string _confirm_guid = "";
        public bool _barcode_checker_print = false;
        public bool _print_per_unit = false;

        /// <summary>
        /// ใช้การ เติมชื่่อสินค้า (รายละเอียด จากหมายเหตุ)
        /// </summary>
        public bool _replace_remark_qty = false;
        public string _item_remark = "";
        public string _item_name_remark = "";

        // for item set

        public string _ref_guid = "";
        /// <summary>
        /// Ref GUID สำหรับสินค้าตัวลูก
        /// </summary>
        public string _set_ref_line = "";
        /// <summary>
        /// กรณีสินค้าชุด -1
        /// </summary>
        public int _ref_row = 0;
        /// <summary>
        /// รหัสสินค้าชุดหลัก
        /// </summary>
        public string _item_code_main = "";
        public decimal _set_ref_qty = 0M;
        public decimal _set_ref_price = 0M;
        public decimal _price_set_ratio = 0M;

        public Boolean _pos_no_sum = false;
        public Boolean _balanceControl = false;

    }

    public enum _printSlipMode
    {
        ใบกำกับภาษีอย่างย่อ,
        ใบกำกับภาษีอย่างเต็ม
    }

    public enum _labelObjectType
    {
        Label,
        Text,
        Barcode,
        Image
    }

    /// <summary>
    /// พักบิล
    /// </summary>
    public class _holdBillClass
    {
        /// <summary>วันที่/เวลา</summary>
        public DateTime _dateTime = new DateTime();
        /// <summary>รหัสสมาชิก</summary>
        public string _custCode = "";
        /// <summary>ชื่อสมาชิก</summary>
        public string _custName = "";
        /// <summary>รายละเอียดสินค้า</summary>
        public List<_posClientItemClass> _item = new List<_posClientItemClass>();
        /// <summary>ยอดเงิน</summary>
        public decimal _totalAmount = 0.0M;
    }

    [Serializable]
    public class _labelPrintClass
    {
        [XmlArrayItem("PrintObject", typeof(_labelPrintObject))]
        public ArrayList _drawObject = new ArrayList();
    }

    public class _itemPriceClass
    {
        public int _price_type = 0;
        public decimal _price = 0M;
        public string _discountWord = "";
        public string _priceInfo = "";
        public int _discountNumber = 0;
    }

    public enum _labelFontSet
    {
        Header,
        Detail
    }

    [Serializable]
    public class _labelPrintObject
    {
        /// <summary>ข้อความ</summary>
        public string _text;

        /// <summary>ตำแหน่ง X</summary>
        public float _xPos = 0f;

        /// <summary>ตำแหน่ง Y</summary>
        public float _yPos = 0f;

        /// <summary>ความกว้าง (-1 = paperwidth)</summary>
        public float _objectWidth = -1;

        /// <summary>ความสูง (-1 = paperHeight)</summary>
        public float _objectHeight = -1;

        public SMLPOSControl._printSlipTextStyle _textAlign = SMLPOSControl._printSlipTextStyle.Left;

        /// <summary>ประเภท Control</summary>
        public _labelObjectType _objectType = _labelObjectType.Label;

        /// <summary>อนุญาติให้ขึ้นบรรทัดใหม่่</summary>
        public Boolean _wrapText = false;

        /// <summary>รูปแบบ</summary>
        public string _format = "";

        public string _fontName = "";
        public float _fontSize = 0f;

        public _labelFontSet _fontSet = _labelFontSet.Detail;

        //public _labelPrintObject(_labelObjectType __type, float __posX, float __posY, string __Value, SMLPOSControl._printSlipTextStyle __textAlign, float __textWidth, float __height, Boolean __warpText)
        //{
        //    _objectType = __type;
        //    _xPos = __posX;
        //    _yPos = __posY;
        //    _objectWidth = __textWidth;
        //    _text = __Value;
        //    _textAlign = __textAlign;
        //}

        //public _labelPrintObject(_labelObjectType __type, float __posX, float __posY, string __Value, SMLPOSControl._printSlipTextStyle __textAlign, float __textWidth, float __height, Boolean __warpText, string __format)
        //{
        //    _objectType = __type;
        //    _xPos = __posX;
        //    _yPos = __posY;
        //    _objectWidth = __textWidth;
        //    _text = __Value;
        //    _textAlign = __textAlign;
        //    _format = __format;

        //}

    }

    #endregion

    public delegate void afterClosePosClientForm(object sender);
}
